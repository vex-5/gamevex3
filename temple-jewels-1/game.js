(()=>{var __webpack_modules__={475:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_RESULT__;function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}(function(){var G={};window.G=G,window.gameG=G,void 0===G&&(G={}),G.ExtLoader=function(){Phaser.Loader.call(this,game),game.state.onStateChange.add(this.reset,this),this.imagesToRemoveOnStateChange=[],this.loadedUrls={}},G.ExtLoader.prototype=Object.create(Phaser.Loader.prototype),G.ExtLoader.prototype.reset=function(t,e){this.imagesToRemoveOnStateChange.forEach((function(t){this.cache.removeImage(t)}),this),this.imagesToRemoveOnStateChange=[],Phaser.Loader.prototype.reset.call(this,t,e)},G.ExtLoader.prototype.addToFileList=function(t,e,i,s,a,r){if(void 0===a&&(a=!1),void 0===e||""===e)return this;if(null==i){if(!r)return this;i=e+r}var o={type:t,key:e,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(s)for(var n in s)o[n]=s[n];var h=this.getAssetIndex(t,e);if(a&&h>-1){var l=this._fileList[h];l.loading||l.loaded?(this._fileList.push(o),this._totalFileCount++):this._fileList[h]=o}else-1===h&&(this._fileList.push(o),this._totalFileCount++);return this.loadFile(this._fileList.shift()),this},G.ExtLoader.prototype.asyncComplete=function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,e&&(t.errorMessage=e)},G.ExtLoader.prototype.fileComplete=function(t,e){switch(t.type){case"packfile":var i=JSON.parse(e.responseText);t.data=i||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(null==t.atlasURL)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(!1,t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH||t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else{if(t.format!=Phaser.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}break;case"bitmapfont":t.atlasURL?(!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",(function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}i?(t.atlasType="json",this.jsonLoadComplete(t,e)):(t.atlasType="xml",this.xmlLoadComplete(t,e))}))):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=e.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=e.responseText,this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText,this.cache.addShader(t.key,t.url,t.data);break;case"physics":i=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,i,t.format);break;case"script":t.data=document.createElement("script"),t.data.language="javascript",t.data.type="text/javascript",t.data.defer=!1,t.data.text=e.responseText,document.head.appendChild(t.data),t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,e.responseText));break;case"binary":t.callback?t.data=t.callback.call(t.callbackContext,t.key,e.response):t.data=e.response,this.cache.addBinary(t.key,t.data)}this.onFileComplete.dispatch(0,t.key,!t.error)};/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */var saveAs=saveAs||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,i=function(){return t.URL||t.webkitURL||t},s=e.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in s,r=/constructor/i.test(t.HTMLElement)||t.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),n=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},h=function(t){setTimeout((function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()}),4e4)},l=function(t,e,i){for(var s=(e=[].concat(e)).length;s--;){var a=t["on"+e[s]];if("function"==typeof a)try{a.call(t,i||t)}catch(t){n(t)}}},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},d=function(e,n,d){d||(e=c(e));var p,u=this,g="application/octet-stream"===e.type,f=function(){l(u,"writestart progress write writeend".split(" "))};if(u.readyState=u.INIT,a)return p=i().createObjectURL(e),void setTimeout((function(){s.href=p,s.download=n,function(t){var e=new MouseEvent("click");t.dispatchEvent(e)}(s),f(),h(p),u.readyState=u.DONE}));!function(){if((o||g&&r)&&t.FileReader){var s=new FileReader;return s.onloadend=function(){var e=o?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,u.readyState=u.DONE,f()},s.readAsDataURL(e),void(u.readyState=u.INIT)}(p||(p=i().createObjectURL(e)),g)?t.location.href=p:t.open(p,"_blank")||(t.location.href=p);u.readyState=u.DONE,f(),h(p)}()},p=d.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(t,e,i){return new d(t,e||t.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);module.exports?module.exports.saveAs=saveAs:null!==__webpack_require__.amdD&&null!==__webpack_require__.amdO&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return saveAs}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)),void 0===G&&(G={}),G.Button=function(t,e,i,s,a){Phaser.Button.call(this,game,G.l(t),G.l(e),null),this.state=game.state.getCurrentState(),G.changeTexture(this,i),this.anchor.setTo(.5),this.sfx=G.sfx.pop,this.active=!0,this.onClick=new Phaser.Signal,s&&this.onClick.add(s,a||this),this.onInputDown.add(this.click,this),this.terms=[],this.IMMEDIATE=!1,this.scaleOnClick=!0,this.targetAlphaTermsNotFulfilled=.5,this.targetAlpha=1,this.refractorPeriod=400,this.scaleChange=.1,this.pulsing=!1},G.Button.prototype=Object.create(Phaser.Button.prototype),G.Button.constructor=G.Button,G.Button.prototype.update=function(){this.checkTerms()?this.targetAlpha=1:this.targetAlpha=this.targetAlphaTermsNotFulfilled,this.alpha=G.lerp(this.alpha,this.targetAlpha,.2,.05),this.updateChildren()},G.Button.prototype.pulse=function(t){this.pulsing=!0,this.pulsingTween=game.add.tween(this.scale).to({x:t||1.1,y:t||1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},G.Button.prototype.stopPulse=function(t){this.pulsingTween&&this.pulsingTween.stop(),this.scale.setTo(t||1),this.pulsing=!1},G.Button.prototype.click=function(){if(this.active&&this.checkTerms()){this.active=!1,this.onClick.dispatch(),this.sfx&&this.sfx.play();var t=this.scale.x,e=this.scale.y;this.IMMEDIATE?this.active=!0:this.pulsing||!this.scaleOnClick?game.time.events.add(this.refractorPeriod,(function(){this.active=!0}),this):game.add.tween(this.scale).to({x:t+this.scaleChange,y:e+this.scaleChange},Math.floor(.5*this.refractorPeriod),Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){game.add.tween(this.scale).to({x:t,y:e},Math.floor(.5*this.refractorPeriod),Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){this.active=!0}),this)}),this)}},G.Button.prototype.checkTerms=function(){for(var t=0;t<this.terms.length;t++)if(!this.terms[t][0].call(this.terms[t][1]))return!1;return!0},G.Button.prototype.addTerm=function(t,e){this.terms.push([t,e])},G.Button.prototype.addImageLabel=function(t){this.label=game.make.image(0,0,"ssheet",t),this.label.anchor.setTo(.5),this.addChild(this.label)},G.Button.prototype.addTextLabel=function(t,e,i){var s=1/G.Loader.currentConfigMulti;this.label=new G.OneLineText(-7,-6,t,e,i||Math.floor(this.height*s*.7),this.width*s*.9,.5,.5),this.addChild(this.label)},G.Button.prototype.addTextLabelMultiline=function(t,e){var i=1/G.Loader.currentConfigMulti;this.label=new G.MultiLineText(0,0,t,e,Math.floor(this.height*i*.5),this.width*i*.8,this.height*i*.7,"center",.5,.5),this.addChild(this.label)},G.Button.prototype.addGTextLabel=function(t,e){this.label=new G.Text(0,0,t,e,.5,.9*this.width,.9*this.height,!0,"center"),this.addChild(this.label)},G.Button.prototype.stopTweens=function(){G.stopTweens(this)},G.Button.prototype.changeTexture=function(t){G.changeTexture(this,t)},G.Button.prototype.add=function(t){return this.addChild(t)},G.Button.prototype.updateChildren=function(){for(var t=this.children.length;t--;)this.children[t].update()},void 0===G&&(G={}),G.FrameAnimation=function(t,e,i,s,a){Phaser.Image.call(this,game,G.l(t),G.l(e)),this.anchor.setTo(.5),this.frameNamePrefix=i,this.animFramesLen=this.getAnimationLength(this.frameNamePrefix),this.timerEvery=s?60/s:1,this.animDir=1,G.changeTexture(this,this.frameNamePrefix+"_0"),this.currentTimer=0,this.currentIndex=0,this.onFinish=new Phaser.Signal,this.active=a||!1},G.FrameAnimation.prototype=Object.create(Phaser.Image.prototype),G.FrameAnimation.prototype.play=function(t,e,i){return this.currentTimer=0,this.currentIndex=i||0,this.active=!0,this.loop=t-1||0,this.animDir=1,this.bounce=e||!1,G.changeTexture(this,this.frameNamePrefix+"_"+this.currentIndex),this},G.FrameAnimation.prototype.update=function(){if(this.active&&(this.currentTimer+=G.deltaTime,this.currentTimer>=this.timerEvery)){if(this.currentTimer=this.currentTimer-this.timerEvery,this.currentIndex+=this.animDir,this.bounce){if(this.currentIndex==this.animFramesLen||0==this.currentIndex){if(0==this.loop&&0==this.currentIndex)return this.onFinish.dispatch(),this.active=!1;this.loop>0&&0==this.currentIndex&&this.loop--,this.currentIndex==this.animFramesLen&&(this.currentIndex=this.animFramesLen-1),this.animDir*=-1}}else if(this.currentIndex==this.animFramesLen){if(0==this.loop)return this.onFinish.dispatch(),this.active=!1;this.loop>0&&this.loop--,this.currentIndex=0}G.changeTexture(this,this.frameNamePrefix+"_"+this.currentIndex)}},G.FrameAnimation.prototype.getAnimationLength=function(t){if(G.FrameAnimation.CacheAnimLength[t])return G.FrameAnimation.CacheAnimLength[t];for(var e=0,i=0;i<1e3&&G.isImageInCache(t+"_"+i);i++)e++;return G.FrameAnimation.CacheAnimLength[t]=e,e},G.FrameAnimation.CacheAnimLength={},G.gift={},G.gift.getGift=function(t){t=t||"normals";var e=G.json.settings.gifts[t],i=e.boosterMaxNr||G.json.settings.gifts.boosterMaxNr,s=e.boosterChance||G.json.settings.gifts.boosterChance,a=[];e.list.forEach((function(t){("coin"==t[0]||-1!==t[0].indexOf("booster")&&G.saveState.isBoosterUnlocked(parseInt(t[0][8]))&&G.saveState.getBoosterAmount(parseInt(t[0][8]))<i)&&a.push(t)})),Phaser.ArrayUtils.shuffle(a);for(var r=Math.random()<s,o=0;o<a.length;o++){var n=a[o];if(-1===n[0].indexOf("booster"))return n.slice();if(r)return n.slice()}return["coin",50]},G.gift.getLabelString=function(t){return t[1]+" @"+G.json.settings.gifts.icons[t[0]]+"@"},G.gift.applyGift=function(t){"coin"==t[0]?G.saveState.changeCoins(t[1]):G.saveState.changeBoosterAmount(parseInt(t[0][8]),t[1])},G.gift.getIcon=function(t){return G.json.settings.gifts.icons[t[0]]},void 0===G&&(G={}),G.GridArray=function(t,e,i,s){"number"==typeof t?this.createGrid.apply(this,arguments):"string"==typeof t?(this.data=JSON.parse(arguments[0]),this.width=this.data.length,this.height=this.data[0].length):Array.isArray(t)&&(a=arguments[0],this.data=arguments[0],this.width=this.data.length,this.height=this.data[0].length)},G.GridArray.prototype={createGrid:function(t,e,i){this.data=[],this.width=t,this.height=e;for(var s=0;s<t;s++){this.data[s]=[];for(var a=0;a<e;a++)this.data[s][a]=i}},set:function(t,e,i){return this.isInGrid(t,e)?this.data[t][e]=i:(this.dbg,!1)},get:function(t,e){return this.isInGrid(t,e)?this.data[t][e]:(this.dbg,!1)},swapValues:function(t,e,i,s){if(!this.isInGrid(t,e)||!this.isInGrid(i,s))return this.dbg,!1;var a=this.data[t][e];this.data[t][e]=this.data[i][s],this.data[i][s]=a},isInGrid:function(t,e){return!(t<0||t>=this.width||e<0||e>=this.height)},find:function(t,e){for(var i=0;i<this.width;i++)for(var s=0;s<this.height;s++){if(t.call(e,this.data[i][s],i,s,this.data))return this.data[i][s]}return!1},filter:function(t,e){for(var i=[],s=0;s<this.width;s++)for(var a=0;a<this.height;a++){t.call(e,this.data[s][a],s,a,this.data)&&i.push(this.data[s][a])}return i},loop:function(t,e){for(var i=0;i<this.width;i++)for(var s=0;s<this.height;s++)t.call(e,this.data[i][s],i,s,this.data)},clear:function(t){this.loop((function(e,i,s,a){a[i][s]=t||!1}))},findPattern:function(t,e){var i=!1,s=t.length;return this.loop((function(a,r,o,n){if(a==e&&!i){for(var h=0;h<s;h+=2){if(!this.get(r+t[h],o+t[h+1]))return;if(this.get(r+t[h],o+t[h+1])!==e)return}i=[];for(var l=0;l<s;l+=2)i.push(r+t[l],o+t[l+1])}}),this),i},count:function(){for(var t=0,e=0;e<this.width;e++)for(var i=0;i<this.height;i++)this.data[e][i]&&t++;return t},getAllElements:function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)this.data[e][i]&&t.push(this.data[e][i]);return t}},G.Image=function(t,e,i,s,a){Phaser.Image.call(this,game,G.l(t),G.l(e),null),Object.defineProperty(this,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(t){this.rotation=Phaser.Math.degToRad(t)}}),this.angle=0,this.state=game.state.getCurrentState(),this.changeTexture(i),s&&("number"==typeof s?this.anchor.setTo(s):this.anchor.setTo(s[0],s[1])),a?(a.add||a.addChild).call(a,this):null!==a&&game.world.add(this)},G.Image.prototype=Object.create(Phaser.Image.prototype),G.Image.prototype.stopTweens=function(){G.stopTweens(this)},G.Image.prototype.changeTexture=function(t){G.changeTexture(this,t)},Phaser.Image.prototype.changeTexture=function(t){G.changeTexture(this,t)},G.Image.prototype.add=function(t){return this.addChild(t)},G.LabelGroupT=function(t,e,i,s,a,r,o){Phaser.Group.call(this,game),this.str=t,this.tagArray=G.LabelParser.changeIntoTagArray(t),this.x=e,this.y=i,this.textStyle=s,this.fontSize=parseInt(s.fontSize),this.distanceBetween=o||0,"number"==typeof a?this.anchorX=this.anchorY=a:(this.anchorX=a[0],this.anchorY=a[1]),this.maxWidth=r||0,this.processTagArray()},G.LabelGroupT.prototype=Object.create(Phaser.Group.prototype),G.LabelGroupT.prototype.processTagArray=function(){for(var t=0;t<this.tagArray.length;t++){if("img"==this.tagArray[t].type)(e=G.makeImage(0,0,this.tagArray[t].content,0,this)).tagScale=this.tagArray[t].scale;else if("separator"==this.tagArray[t].type){var e;(e=G.makeImage(0,0,null,0,this)).SEPARATOR=!0,e.SEP_LENGTH=this.tagArray[t].length}else this.add(new G.Text(0,0,this.tagArray[t].content,this.textStyle))}this.refresh()},G.LabelGroupT.prototype.refresh=function(){if(this.applySizeAndAnchor(),this.maxWidth>0&&this.getWholeWidth()>this.maxWidth)for(;this.getWholeWidth()>this.maxWidth;)this.distanceBetween=Math.floor(.9*this.distanceBetween),this.fontSize=Math.floor(.9*this.fontSize),this.applySizeAndAnchor();this.spreadElements()},G.LabelGroupT.prototype.applySizeAndAnchor=function(){this.children.forEach((function(t){t.anchor.setTo(this.anchorX,this.anchorY),t.fontSize?(t.fontSize=this.fontSize,t.updateTransform()):(t.height=this.fontSize*(t.tagScale||1),t.scale.x=t.scale.y),t.SEPARATOR&&(t.width=this.fontSize*t.SEP_LENGTH)}),this)},G.LabelGroupT.prototype.getWholeWidth=function(){var t=(this.children.length-1)*this.distanceBetween,e=0;return this.children.forEach((function(t){e+=t.width})),t+e},G.LabelGroupT.prototype.spreadElements=function(){var t=this.getWholeWidth()*this.anchorX*-1;this.children.forEach((function(e,i,s){e.left=0==i?t:s[i-1].right+this.distanceBetween}),this)},G.LabelParser={specialChars:["$","@","%","^"],changeIntoTagArray:function(t,e){for(var i=[],s=0;t.length>0&&!(s++>20);){var a=this.findFirstSpecialChar(t);if(-1===a){i.push(t);break}a[0]>0&&(i.push(t.slice(0,a[0])),t=t.slice(a[0])),t=this.cutOffTag(t,i,a[1])}var r=[];for(s=0;s<i.length;s++)r.push(this.processTag(i[s],e));return this.mergeTextTagsInArray(r)},mergeTextTagsInArray:function(t){for(var e=[],i=null,s=0;s<t.length;s++)"text"!==t[s].type?(null!==i&&(e.push(this.mergeTextTags(t,i,s)),i=null),e.push(t[s])):null==i&&(i=s);return null!==i&&e.push(this.mergeTextTags(t,i,s)),e},mergeTextTags:function(t,e,i){for(var s={type:"text",content:[]};e<i;e++)s.content.push(t[e].content);return s.content=s.content.join(" "),s},processTag:function(t,e){if("@"==t[0]){var i=1;return"*"==t[1]&&t.indexOf("*",2)&&(i=parseFloat(t.slice(t.indexOf("*")+1,t.indexOf("*",2))),t=t.slice(t.indexOf("*",2))),{type:"img",content:t.slice(1,-1),scale:i}}return"%"==t[0]?{type:"text",content:e[t.slice(1,-1)]}:"$"==t[0]?{type:"text",content:G.txt(t.slice(1,-1))}:"^"==t[0]?{type:"text",content:t.slice(1,-1)}:this.isStringJustSpaces(t)?{type:"separator",content:t,length:t.length}:{type:"text",content:t}},isStringJustSpaces:function(t){for(var e=0;e<t.length;e++)if(" "!==t[e])return!1;return!0},cutOffTag:function(t,e,i){var s=t.indexOf(i),a=t.indexOf(i,s+1);return e.push(t.slice(s,a+1)),t.slice(0,s)+t.slice(a+1)},findFirstSpecialChar:function(t){var e=1/0,i=!1;return this.specialChars.forEach((function(s){var a=t.indexOf(s);a>-1&&e>a&&(i=s,e=Math.min(a,e))})),e===1/0?-1:[e,i]},createLabel:function(t,e,i,s,a,r,o,n,h,l){this.changeIntoTagArray(t,e);return new G.LabelGroup(i,s,r,h,o,n,l)}},G.LabelGroup=function(t,e,i,s,a,r,o,n){Phaser.Group.call(this,game),this.fontData=game.cache.getBitmapFont(s).font,this.fontBaseSize=this.fontData.size,this.fontSpaceOffset=this.fontData.chars[32].xOffset+this.fontData.chars[32].xAdvance,this.str=t,this.tagArray=G.LabelParser.changeIntoTagArray(t),this.x=void 0===e?0:G.l(e),this.y=void 0===i?0:G.l(i),this.font=s,this.fontSize=void 0===a?G.l(30):G.l(a),this.distanceBetween=0,this.anchorX=void 0===r?.5:r,this.anchorY=void 0===o?.5:o,this.maxWidth=n||0,this.processTagArray()},G.LabelGroup.prototype=Object.create(Phaser.Group.prototype),G.LabelGroup.prototype.processTagArray=function(){for(var t=0;t<this.tagArray.length;t++){if("img"==this.tagArray[t].type)(e=G.makeImage(0,0,this.tagArray[t].content,0,this)).tagScale=this.tagArray[t].scale;else if("separator"==this.tagArray[t].type){var e;(e=G.makeImage(0,0,null,0,this)).SEPARATOR=!0,e.SEP_LENGTH=this.tagArray[t].length}else this.add(game.add.bitmapText(0,0,this.font,this.tagArray[t].content,this.fontSize))}this.refresh()},G.LabelGroup.prototype.refresh=function(){if(this.applySizeAndAnchor(),this.maxWidth>0&&this.getWholeWidth()>this.maxWidth)for(;this.getWholeWidth()>this.maxWidth;)this.distanceBetween*=.9,this.fontSize*=.9,this.applySizeAndAnchor();this.spreadElements()},G.LabelGroup.prototype.applySizeAndAnchor=function(){this.children.forEach((function(t){t.anchor.setTo(this.anchorX,this.anchorY),t.fontSize?(t.fontSize=this.fontSize,t.updateText()):(t.height=this.fontSize*(t.tagScale||1),t.scale.x=t.scale.y),t.SEPARATOR&&(t.width=this.fontSize/this.fontBaseSize*this.fontSpaceOffset*t.SEP_LENGTH)}),this)},G.LabelGroup.prototype.getWholeWidth=function(){var t=(this.children.length-1)*this.distanceBetween,e=0;return this.children.forEach((function(t){e+=t.width})),t+e},G.LabelGroup.prototype.spreadElements=function(){var t=this.getWholeWidth()*this.anchorX*-1;this.children.forEach((function(e,i,s){e.left=0==i?t:s[i-1].right+this.distanceBetween}),this)},G.LineEditor=function(){Phaser.Group.call(this,game),this.gfx=game.add.graphics(),this.gfx.fixedToCamera=!0,this.points={x:[],y:[]},this.currentIndex=null,this.pointerStart=new Phaser.Point(0,0),this.interpolation="linearInterpolation",game.input.onDown.add((function(t){this.currentIndex=this.findCurrentIndex(t),null!==this.currentIndex&&(this.pointerStart.x=t.x,this.pointerStart.y=t.y)}),this),game.input.onUp.add((function(t){this.currentIndex=null}),this),this.keys=game.input.keyboard.addKeys({Z:Phaser.Keyboard.Z,X:Phaser.Keyboard.X,C:Phaser.Keyboard.C,A:Phaser.Keyboard.A,S:Phaser.Keyboard.S,D:Phaser.Keyboard.D}),this.keys.Z.onDown.add((function(){this.interpolation="catmullRomInterpolation"}),this),this.keys.X.onDown.add((function(){this.interpolation="bezierInterpolation"}),this),this.keys.C.onDown.add((function(){this.interpolation="linearInterpolation"}),this),this.keys.A.onDown.add((function(){var t=game.input.activePointer;this.points.x.push(t.x),this.points.y.push(t.y)}),this),this.keys.S.onDown.add((function(){this.currentIndex&&(this.points.x.splice(this.currentIndex,1),this.points.y.splice(this.currentIndex,1))}),this),this.keys.D.onDown.add((function(){this.points.x.pop(),this.points.y.pop()}),this)},G.LineEditor.prototype=Object.create(Phaser.Group.prototype),G.LineEditor.prototype.update=function(){if(this.currentIndex){var t=game.input.activePointer,e=this.pointerStart.x-t.x,i=this.pointerStart.y-t.y;this.pointerStart.x=t.x,this.pointerStart.y=t.y,this.points.x[this.currentIndex]-=e,this.points.y[this.currentIndex]-=i}this.redraw()},G.LineEditor.prototype.findCurrentIndex=function(t){for(var e=null,i=1/0,s=0;s<this.points.x.length;s++){var a=game.math.distance(t.x,t.y,this.points.x[s],this.points.y[s]);a<i&&(e=s,i=a)}return e},G.LineEditor.prototype.redraw=function(){this.gfx.clear(),this.drawLine(),this.drawPoints()},G.LineEditor.prototype.drawPoints=function(){this.gfx.lineStyle(2,255,1),this.gfx.beginFill(255,.5);for(var t=0;t<this.points.x.length;t++)this.gfx.drawCircle(this.points.x[t],this.points.y[t],10)},G.LineEditor.prototype.drawLine=function(){if(0!=this.points.x.length){this.gfx.lineStyle(2,16711680,1),this.gfx.moveTo(this.points.x[0],this.points.y[0]);for(var t=0;t<1;t+=.001){var e=game.math[this.interpolation](this.points.x,t),i=game.math[this.interpolation](this.points.y,t);this.gfx.lineTo(e,i)}}},void 0===G&&(G={}),G.Loader={currentConfig:"hd",currentConfigMulti:1,loadingScreenActive:!1,lang:!1,passConfigs:function(t){this.configs=t},setConfig:function(t){this.currentConfig=t,this.currentConfigMulti=this.configs[t]},killLoadingScreen:function(){G.imgRotate&&(G.whiteOverlay.destroy(),G.imgRotate.fadeOut=!0,G.imgRotate=!1,this.loadingScreenActive=!1)},loadPOSTImage:function(t){void 0!==t&&(game.cache.checkImageKey(t)||(this.makeLoadingScreen(),game.load.image(t,"assets/"+this.currentConfig+"/imagesPOST/"+t)))},loadBootAssets:function(t){t&&(this.lang=t.toUpperCase()),G.ASSETS.images.forEach((function(t){this.checkIfLoad(t,!0)&&game.load.image(this.removeExt(this.cutOffPrefixes(t)),"assets/"+this.currentConfig+"/images/"+t)}),this),G.ASSETS.spritesheets.forEach((function(t){this.checkIfLoad(t,!0)&&game.load.atlasJSONHash(this.cutOffPrefixes(t),"assets/"+this.currentConfig+"/spritesheets/"+t+".png","assets/"+this.currentConfig+"/spritesheets/"+t+".json")}),this),game.load.onLoadComplete.addOnce((function(){this.createSpritesheetMap(!0)}),this)},loadAssets:function(t){t&&(this.lang=t.toUpperCase()),game.load.onLoadComplete.addOnce(this.processAssets,this),this.loadSFX(G.ASSETS.sfx),this.loadImages(G.ASSETS.images),this.loadSpritesheets(G.ASSETS.spritesheets),this.loadJson(G.ASSETS.json),this.loadFonts(G.ASSETS.fonts)},processAssets:function(){this.processJson(G.ASSETS.json),this.processSFX(G.ASSETS.sfx),this.createSpritesheetMap()},createSpritesheetMap:function(t){G.spritesheetMap||(G.spritesheetMap={});for(var e=0,i=G.ASSETS.spritesheets.length;e<i;e++)if(this.checkIfLoad(G.ASSETS.spritesheets[e],t)){var s=this.cutOffPrefixes(G.ASSETS.spritesheets[e]);if(game.cache.checkImageKey(s))for(var a=game.cache.getFrameData(s),r=0;r<a._frames.length;r++){var o=a._frames[r];G.spritesheetMap[o.name],G.spritesheetMap[o.name]=s}}},loadSFX:function(t){t.forEach((function(t){game.load.audio(this.removeExt(t),"assets/sfx/"+t)}),this)},loadFonts:function(t){for(var e in t){if(!this.checkIfLoad(e))return;game.load.bitmapFont(this.cutOffPrefixes(e),"assets/"+this.currentConfig+"/fonts/"+t[e].frame,"assets/"+this.currentConfig+"/fonts/"+t[e].data)}},loadImages:function(t){t.forEach((function(t){this.checkIfLoad(t)&&game.load.image(this.removeExt(this.cutOffPrefixes(t)),"assets/"+this.currentConfig+"/images/"+t)}),this)},loadJson:function(t){t.forEach((function(t){game.load.json(this.removeExt(t),"assets/json/"+t)}),this)},loadSpritesheets:function(t){t.forEach((function(t){this.checkIfLoad(t)&&game.load.atlasJSONHash(this.cutOffPrefixes(t),"assets/"+this.currentConfig+"/spritesheets/"+t+".png","assets/"+this.currentConfig+"/spritesheets/"+t+".json")}),this)},checkIfLoad:function(t,e){return(!e||-1!=t.indexOf("BOOT-"))&&(!(!e&&-1!==t.indexOf("BOOT-"))&&((-1===t.indexOf("MOBILE-")||!game.device.desktop)&&(!(-1!==t.indexOf("DESKTOP-")&&!game.device.desktop)&&(!this.lang||!t.match(/^[A-Z]{2}\-/)||0==t.indexOf(this.lang+"-")))))},cutOffPrefixes:function(t){return t=(t=(t=(t=t.replace(/^[A-Z]{2}\-/,"")).replace("BOOT-","")).replace("MOBILE-","")).replace("DESKTOP-","")},removeExt:function(t){return t.slice(0,t.lastIndexOf("."))},processJson:function(t){G.json={},t.forEach((function(t){t=this.removeExt(t),G.json[t]=game.cache.getJSON(t)}),this)},processSFX:function(t){G.sfx={},game.sfx=G.sfx;var e={};t.forEach((function(t){t=this.removeExt(t),G.sfx[t]=game.add.audio(t);var i=t.lastIndexOf("_");if(-1!==i&&!isNaN(t.slice(i+1))){parseInt(t.slice(i+1));var s=t.slice(0,i);e[s]||(e[s]=[]),e[s].push(G.sfx[t])}}),this),Object.keys(e).forEach((function(t){G.sfx[t]={sfxArray:e[t],play:function(t,e,i){game.rnd.pick(this.sfxArray).play("",0,t,e,i)}}}))}},G.MultiLineText=function(t,e,i,s,a,r,o,n,h,l){if(t=G.l(t),e=G.l(e),a=G.l(a),r=G.l(r),o=G.l(o),this.maxUserWidth=r,this.maxUserHeight=o,Phaser.BitmapText.call(this,game,t,e,i,"",a),this.splitText(s,r),this.align=n||"center",o)for(;this.height>o&&(this.fontSize-=2,this.splitText(s,r),this.updateText(),!(this.fontSize<5)););this.anchor.setTo(h,l),this.cacheAsBitmap=!0},G.MultiLineText.prototype=Object.create(Phaser.BitmapText.prototype),G.MultiLineText.prototype.constructor=G.MultiLineText,G.MultiLineText.prototype.splitText=function(t,e){for(var i=t,s=[],a=0,r=0;i.length>0;)if(a=r,-1==(r=i.indexOf(" ",r+1))?this.setText(i):this.setText(i.substring(0,r)),this.updateText(),this.width>e){if(0==a&&-1==r){s.push(i),i="",r=0;continue}if(0==a){s.push(i.substring(0,r)),i=i.substring(r+1),r=0;continue}s.push(i.substring(0,a)),i=i.substring(a+1),r=0}else-1==r&&(s.push(i),i="");this.setText(s.join("\n"))},G.MultiLineText.prototype.popUpAnimation=function(){this.cacheAsBitmap=!1;for(var t=this.children.length,e=[],i=0;i<t;i++)e[i]=i;e=Phaser.ArrayUtils.shuffle(e),delay_index=0,this.activeTweens=0,this.children.forEach((function(t){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+t.height,t.anchor.setTo(.5,1));var i=t.scale.x;t.scale.setTo(0,0),this.activeTweens++;var s=game.add.tween(t.scale).to({x:1.5*i,y:1.5*i},200,Phaser.Easing.Quadratic.In,!1,25*e[delay_index]).to({x:i,y:i},200,Phaser.Easing.Sinusoidal.In);s.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.alive&&(this.cacheAsBitmap=!0)}),this),s.start(),delay_index++}),this)},G.OneLineText=function(t,e,i,s,a,r,o,n){if(Phaser.BitmapText.call(this,game,G.l(t),G.l(e),i,s,G.l(a),G.l(r)),r)for(;this.width>G.l(r)&&(this.fontSize-=2,this.updateText(),!(this.fontSize<5)););this.orgFontSize=G.l(a),this.maxUserWidth=G.l(r),this.skipCaching=G.skipOneLineTextCaching||!1,this.hAnchor=o,this.vAnchor=n,this.anchor.setTo(this.hAnchor,this.vAnchor),this.updateText(),this.insertCoin(this.fontSize),this.skipCaching||(this.cacheAsBitmap=!0,this.updateCache())},G.OneLineText.prototype=Object.create(Phaser.BitmapText.prototype),G.OneLineText.prototype.constructor=G.OneLineText,G.OneLineText.prototype.insertCoin=function(t){-1!=this.text.indexOf("$$")&&this.children.forEach((function(e,i,s){if(e.name&&"$"==e.name&&e.visible&&i+1<=s.length-1&&"$"==s[i].name){var a=e,r=s[i+1];a.visible=!1,r.visible=!1,coin=G.makeImage(a.x+.05*t,a.y-.05*t,"coin"),coin.width=t,coin.height=t,a.parent.addChild(coin)}}))},G.OneLineText.prototype.setText=function(t){Phaser.BitmapText.prototype.setText.call(this,t.toString());var e=this.scale.x,i=this.scale.y,s=this.alpha,a=this.angle;if(this.alpha=1,this.scale.setTo(1),this.maxUserWidth){this.fontSize=this.orgFontSize,this.updateText();for(;this.width>this.maxUserWidth&&(this.fontSize-=1,this.updateText(),!(this.fontSize<5)););}!this.skipCaching&&this.cacheAsBitmap&&this.updateCache(),this.scale.setTo(e,i),this.alpha=s,this.angle=a},G.OneLineText.prototype.popUpAnimation=function(){this.cacheAsBitmap=!1;for(var t=this.children.length,e=[],i=0;i<t;i++)e[i]=i;e=Phaser.ArrayUtils.shuffle(e),delay_index=0,this.activeTweens=0,this.children.forEach((function(t){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+t.height,t.anchor.setTo(.5,1));var i=t.scale.x;t.scale.setTo(0,0),this.activeTweens++;var s=game.add.tween(t.scale).to({x:1.5*i,y:1.5*i},200,Phaser.Easing.Quadratic.In,!1,25*e[delay_index]).to({x:i,y:i},200,Phaser.Easing.Sinusoidal.In);s.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.alive&&!this.skipCaching&&(this.cacheAsBitmap=!0)}),this),s.start(),delay_index++}),this)},G.OneLineText.prototype.scaleOut=function(t,e){this.cacheAsBitmap=!1,this.activeTweens=0,this.children.forEach((function(t,e){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+.5*t.height,t.anchor.setTo(.5,.5)),this.activeTweens++,t.scale.setTo(t.scale.x,t.scale.y);var i=game.add.tween(t.scale).to({x:0,y:0},400,Phaser.Easing.Cubic.In,!1,20*e);i.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.destroy()}),this),i.start()}),this)},G.OneLineCounter=function(t,e,i,s,a,r,o,n,h,l){G.OneLineText.call(this,t,e,i,"",a,r,o,n),this.amount=s,this.amountDisplayed=s,this.amountMaxInterval=5,this.amountMaxNegInterval=-5,this.absoluteDisplay=!1,this.fixedToDecimal=0,this.stepCurrent=0,this.step=0,this.preText=h||"",this.postText=l||"",this.setText(this.preText+s+this.postText)},G.OneLineCounter.prototype=Object.create(G.OneLineText.prototype),G.OneLineCounter.prototype.update=function(){if(this.lerp)this.lerpUpdate();else if(this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.amountDisplayed!=this.amount)){var t=this.amount-this.amountDisplayed;this.amountDisplayed+=game.math.clamp(t,this.amountMaxNegInterval,this.amountMaxInterval);var e=this.amountDisplayed;this.absoluteDisplay&&(e=Math.abs(e)),0!=this.fixedTo&&(e=e.toFixed(this.fixedToDecimal)),this.setText(this.preText+e+this.postText)}},G.OneLineCounter.prototype.changeAmount=function(t){this.amount=t},G.OneLineCounter.prototype.increaseAmount=function(t){this.amount+=t},G.OneLineCounter.prototype.changeIntervals=function(t,e){void 0===e?(this.amountMaxInterval=t,this.amountMaxNegInterval=-t):(this.amountMaxInterval=t,this.amountMaxNegInterval=e)},G.OneLineCounter.prototype.lerpUpdate=function(){this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.amountDisplayed=Math.round(G.lerp(this.amountDisplayed,this.amount,.5,.6)),this.setText(this.amountDisplayed.toString()))},G.PartCacher=function(){Phaser.Group.call(this,game),this.active=!1,this.every=1,this.rt=game.add.renderTexture(10,10),this.frameCounter=0,this.framesToRecord=null},G.PartCacher.prototype=Object.create(Phaser.Group.prototype),G.PartCacher.prototype.update=function(){if(this.active){if(this.stepForward(),!this.checkChildren())return this.active=!1,void this.removeAll(!0,!0);this.frameCounter%this.frameRate==0&&(this.saveFrame(),this.frameNr++,null!==this.framesToRecord&&(this.framesToRecord--,0==this.framesToRecord&&(this.active=!1))),this.frameCounter++}},G.PartCacher.prototype.stepForward=function(){for(var t=this.children.length;t--;)this.children[t].update()},G.PartCacher.prototype.start=function(t,e,i){this.fileName=t,this.frameNr=0,this.frameRate=60/e,this.active=!0,this.frameCounter=0,this.framesToRecord=i||null},G.PartCacher.prototype.saveFrame=function(){var t=this.getBounds(),e=Math.max(this.x-t.x,t.x+t.width-this.x,400),i=Math.max(this.y-t.y,t.y+t.height-this.y,400);this.rt.resize(2*e,2*i,!0),this.rt.renderXY(this,e,i,!0);var s=this.rt.getCanvas(),a=this.fileName+"_"+this.frameNr;s.toBlob((function(t){saveAs(t,a)}))},G.PartCacher.prototype.checkChildren=function(){var t=this.children.filter((function(t){return!t.alive||0===t.alpha||0==t.scale.x||0==t.scale.y}));return this.children.length!==t.length},G.PoolGroup=function(t,e,i,s){if(Phaser.Group.call(this,game),this._deadArray=[],this._elementConstructor=t,this._argumentsArray=e||[],this._argumentsArray.unshift(null),i&&G.sb(i).add(this.init,this),s)for(var a=0;a<s;a++)element=new(Function.prototype.bind.apply(this._elementConstructor,this._argumentsArray)),this.add(element),element.events.onKilled.add(this._onElementKilled,this),element.kill()},G.PoolGroup.prototype=Object.create(Phaser.Group.prototype),G.PoolGroup.prototype.getFreeElement=function(){var t;return this._deadArray.length>0?t=this._deadArray.pop():(t=new(Function.prototype.bind.apply(this._elementConstructor,this._argumentsArray))).events.onKilled.add(this._onElementKilled,this),this.add(t),t},G.PoolGroup.prototype._onElementKilled=function(t){this===t.parent&&(this._deadArray.push(t),this.removeChild(t))},G.PoolGroup.prototype.init=function(){var t=this.getFreeElement();return t.init.apply(t,arguments),t},G.PoolGroup.prototype.initBatch=function(t){for(var e=0;e<t;e++)this.init.apply(this,[].slice.call(arguments,1))},G.PreloaderBar=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.softgamesBtn=game.add.button(0,200,"sg_logo",(function(){SG_Hooks.triggerMoreGames()}),this),this.softgamesBtn.anchor.setTo(.5,.5),this.add(this.softgamesBtn),this.gfx=game.add.graphics(),this.add(this.gfx),this.drawProgress(0),G.sb("onScreenResize").add(this.onResize,this),this.onResize(),game.load.onFileComplete.add(this.drawProgress,this)},G.PreloaderBar.prototype=Object.create(Phaser.Group.prototype),G.PreloaderBar.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.4*game.height},G.PreloaderBar.prototype.drawProgress=function(t){this.gfx.clear(),this.gfx.lineStyle(2,16777215,1),this.gfx.beginFill(0,1),this.gfx.drawRect(-150,0,300,50),this.gfx.beginFill(16777215,1),this.gfx.drawRect(-145,5,t/100*290,40)},G.ProgressBar=function(t,e,i,s,a,r,o){G.Image.call(this,t,e,i+"_empty",0,null),r=void 0===r?0:r,o=void 0===o?0:r,this.fill=G.makeImage(r,o,i+"_full",0,this),this.fillFullWidth=this.fill.width,this.fillOverlay=G.makeImage(r,o,i+"_full_overlay",this.fill,this),this.fillOverlay.alpha=0,this.fill.cropRect=new Phaser.Rectangle(0,0,0,this.fill.height),this.fill.updateCrop(),this.currentValue=s,this.prevCurrentValue=s,this.targetValue=s,this.maxValue=a,this.lerpValue=.05,this.updateBarCrop(),this.onTargetReached=new Phaser.Signal,this.onBarFilled=new Phaser.Signal},G.ProgressBar.prototype=Object.create(G.Image.prototype),G.ProgressBar.prototype.update=function(){this.currentValue!==this.targetValue&&(this.currentValue=G.lerp(this.currentValue,this.targetValue,this.lerpValue,.005*this.maxValue),this.currentValue===this.targetValue&&this.onTargetReached.dispatch()),this.currentValue!==this.prevCurrentValue&&(this.updateBarCrop(),this.currentValue===this.maxValue&&(game.add.tween(this.fillOverlay).to({alpha:1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0),this.onBarFilled.dispatch(),this.label&&game.add.tween(this.label).to({alpha:0},600,Phaser.Easing.Sinusoidal.InOut,!0)),this.label&&Math.floor(this.currentValue)!==Math.floor(this.prevCurrentValue)&&this.label.updateValue(Math.floor(this.currentValue))),this.prevCurrentValue=this.currentValue},G.ProgressBar.prototype.updateBarCrop=function(){var t=this.fill.cropRect.width,e=Math.round(this.fillFullWidth*(this.currentValue/this.maxValue));t!==e&&(this.fill.cropRect.width=e,this.fill.updateCrop())},G.ProgressBar.prototype.changeCurrentValue=function(t,e){this.targetValue=game.math.clamp(t,0,this.maxValue),this.lerpValue=e||this.lerpValue},G.ProgressBar.prototype.increaseCurrentValue=function(t){this.changeCurrentValue(this.targetValue+(t||1))},G.ProgressBar.prototype.decreaseCurrentValue=function(t){this.changeCurrentValue(this.targetValue-(t||1))},G.ProgressBar.prototype.changeValues=function(t,e){this.currentValue=t,this.prevCurrentValue=t,this.targetValue=t,this.maxValue=e,this.label&&this.label.changeValues(t,e),this.updateBarCrop()},G.ProgressBar.prototype.addLabel=function(t,e){this.label=new G.ProgressBar.Label(G.rl(.5*this.width),G.rl(.5*this.height),this.currentValue,this.maxValue,Math.floor(.6*G.rl(this.height)),G.rl(.7*this.width),t,e),this.add(this.label)},G.ProgressBar.Label=function(t,e,i,s,a,r,o,n){G.OneLineText.call(this,t,e,"font","",a,r,.5,.5),this.labelType=o||0,this.labelType1Text=G.txt("%AMOUNT% left"),this.currentValue=i,this.maxValue=s,this.animationOnIncrease=n||!1,this.updateValue(this.currentValue,!0)},G.ProgressBar.Label.prototype=Object.create(G.OneLineText.prototype),G.ProgressBar.Label.prototype.updateValue=function(t,e){(e||Math.min(t,this.maxValue)!==this.currentValue)&&(this.currentValue=t,this.updateLabelText(),!e&&this.animationOnIncrease&&(G.stopTweens(this),this.scale.setTo(1),game.add.tween(this.scale).to({x:1.2,y:1.2},200,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)))},G.ProgressBar.Label.prototype.changeValues=function(t,e){this.currentValue=t,this.maxValue=e,this.alpha=this.currentValue<this.maxValue?1:0,this.updateLabelText()},G.ProgressBar.Label.prototype.updateLabelText=function(){0==this.labelType?this.setText(this.currentValue+"/"+this.maxValue):this.setText(this.labelType1Text.replace("%AMOUNT%",this.maxValue-this.currentValue))},void 0===G&&(G={}),G.SignalBox=function(){Phaser.Signal.prototype.addPermanent||(Phaser.Signal.prototype.addPermanent=function(){var t=this.add.apply(this,arguments);return t._PERMANENT=!0,t},Phaser.Signal.prototype.removeNonPermanent=function(){if(this._bindings)for(var t=this._bindings.length;t--;)this._bindings[t]._PERMANENT||(this._bindings[t]._destroy(),this._bindings.splice(t,1))});var t=!1,e={};function i(){Object.keys(e).forEach((function(t){e[t].removeNonPermanent()}))}function s(s){return t||game.state.onStateChange.add(i,this),e[s]||(e[s]=new Phaser.Signal),e[s]}return s.signals=e,s.clearNonPermanent=i,s.clearAll=function(){Object.keys(e).forEach((function(t){e[t].removeAll()}))},s}(),G.Slider=function(t,e,i,s){Phaser.Graphics.call(this,game,t,e),this.sliderWidth=i,this.pos=s,this.beginFill(0,1),this.drawRect(0,-2,this.sliderWidth,4),this.circleGfx=this.addChild(game.make.graphics(i*s,0)),this.circleGfx.clear(),this.circleGfx.lineStyle(1,0,1),this.circleGfx.beginFill(10066329,1),this.circleGfx.drawCircle(0,0,32),this.circleGfx.sliderWidth=i,this.circleGfx.inputEnabled=!0,this.circleGfx.input.useHandCursor=!0,this.circleGfx.input.draggable=!0,this.circleGfx.input.setDragLock(!0,!1)},G.Slider.prototype=Object.create(Phaser.Graphics.prototype),G.Slider.prototype.update=function(){this.circleGfx.x=game.math.clamp(this.circleGfx.x,0,this.sliderWidth),this.pos=this.circleGfx.x/this.sliderWidth},G.SliderPanel=function(t,e,i,s,a,r){Phaser.Group.call(this,game),this.sliderWidth=G.l(i),this.sliderHeight=G.l(s),this.x=t+-.5*this.sliderWidth,this.y=e+-.5*this.sliderHeight,this.gfxMask=game.add.graphics(),this.gfxMask.beginFill(0,1),this.gfxMask.drawRect(0,0,i,s),this.clickableObjects=[],this.config=r,this.applyConfig(this.config),this.addContent(a),this.add(this.gfxMask),this.contentGroup.mask=this.gfxMask,this.slideY=0,this.inputSprite=G.makeImage(0,0,null,0,this),this.inputSprite.inputEnabled=!0,this.inputSprite.hitArea=new Phaser.Rectangle(0,0,i,s),this.inputSpriteDown=!1,this.inputData={x:null,y:null,velX:0,velY:0,xStart:null,yStart:null,startFrameStamp:null,clickDistanceWindow:10,clickTimeWindow:10},this.inputSprite.events.onInputDown.add((function(t){var e=game.input.activePointer;this.inputSpriteDown=!0,this.inputData.x=this.inputData.xStart=e.worldX,this.inputData.y=this.inputData.yStart=e.worldY,this.inputData.startFrameStamp=this.frameCounter}),this),this.inputSprite.events.onInputUp.add((function(){var t=game.input.activePointer;this.inputSpriteDown=!1;var e=game.math.distance(this.inputData.xStart,this.inputData.yStart,t.worldX,t.worldY),i=this.frameCounter-this.inputData.startFrameStamp;e<=this.inputData.clickDistanceWindow&&i<=this.inputData.clickTimeWindow&&(this.propagateClick(t.x,t.y),this.inputData.velX=0,this.inputData.velY=0)}),this),this.frameCounter=0},G.SliderPanel.prototype=Object.create(Phaser.Group.prototype),G.SliderPanel.prototype.applyConfig=function(t){this.horizontal=t.horizontal||!1,this.horizontalLerp=t.horizontalLerp||!1,this.vertical=t.vertical||!0,this.verticalLerp=t.verticalLerp},G.SliderPanel.prototype.addContent=function(t){this.changeInputSettings(t),this.contentGroup=t,this.add(t),this.contentGroup.x=0,this.contentGroupMinY=-this.contentGroup.height+this.sliderHeight,this.contentGroupMaxY=0,this.contentGroupMinX=this.sliderWidth-this.contentGroup.width,this.contentGroupMaxX=0},G.SliderPanel.prototype.changeInputSettings=function(t){for(var e=t.children.length;e--;){var i=t.children[e];i.inputEnabled&&(this.clickableObjects.push(i),i.inputEnabled=!1),i.children.length>0&&this.changeInputSettings(i)}},G.SliderPanel.prototype.update=function(){if(this.frameCounter++,this.inputSpriteDown&&game.input.activePointer.isDown){var t=this.inputData.x-game.input.activePointer.worldX,e=this.inputData.y-game.input.activePointer.worldY;this.inputData.x=game.input.activePointer.worldX,this.inputData.y=game.input.activePointer.worldY,this.inputData.velX=.8*t+.2*this.inputData.velX,this.inputData.velY=.8*e+.2*this.inputData.velY,this.horizontal&&(this.contentGroup.x-=this.inputData.velX),this.vertical&&(this.contentGroup.y-=this.inputData.velY)}else this.horizontal&&(this.contentGroup.x-=this.inputData.velX,this.inputData.velX*=.95,Math.abs(this.inputData.velX)<1&&(this.inputData.velX=0)),this.vertical&&(this.contentGroup.y-=this.inputData.velY,this.inputData.velY*=.95,Math.abs(this.inputData.velY)<1&&(this.inputData.velY=0));this.vertical&&this.boundRestrict("y",this.verticalLerp,this.contentGroupMinY,this.contentGroupMaxY),this.horizontal&&this.boundRestrict("x",this.horizontalLerp,this.contentGroupMinX,this.contentGroupMaxX),this.boundRestrict()},G.SliderPanel.prototype.propagateClick=function(t,e){for(var i=0;i<this.clickableObjects.length;i++)if(this.clickableObjects[i].visible&&this.clickableObjects[i].getBounds().contains(t,e)){this.clickableObjects[i].onInputDown.dispatch();break}},G.SliderPanel.prototype.boundRestrict=function(t,e,i,s){e?(this.contentGroup[t]>s&&(this.contentGroup[t]=G.lerp(this.contentGroup[t],s,.5),this.contentGroup[t]<s+1&&(this.contentGroup[t]=s)),this.contentGroup[t]<i&&(this.contentGroup[t]=G.lerp(this.contentGroup[t],i,.2),this.contentGroup[t]>i-1&&(this.contentGroup[t]=i))):this.contentGroup[t]=game.math.clamp(this.contentGroup[t],i,s)},G.StrObjGroup=function(t,e,i){Phaser.Group.call(this,game),this.x=t||0,this.y=e||0,this.importObj="string"==typeof i?JSON.parse(i):i,this.parseImportObj(this.importObj)},G.StrObjGroup.prototype=Object.create(Phaser.Group.prototype),G.StrObjGroup.prototype.parseImportObj=function(t){for(var e=0;e<t.length;e++){var i=t[e],s=G.makeImage(i.x,i.y,i.frame,i.anchor,this);s.scale.setTo(i.scale[0],i.scale[1]),s.angle=i.angle}},G.Text=function(t,e,i,s,a,r,o,n,h){"object"!==_typeof(s)&&(s=JSON.parse(JSON.stringify(G.Text.styles[s]))),this.userMaxWidth=r||1/0,this.userMaxHeight=o||1/0,n&&(s.wordWrap=!0,s.wordWrapWidth=r,s.align=h||"left"),Phaser.Text.call(this,game,t,e,i,s),a&&("number"==typeof a?this.anchor.setTo(a):this.anchor.setTo(a[0],a[1])),this.width=Math.min(this.width,this.userMaxWidth),this.height=Math.min(this.height,this.userMaxHeight)},G.Text.prototype=Object.create(Phaser.Text.prototype),G.Text.styles={},G.Text.addStyle=function(t,e){G.Text.styles[t]=e},G.Text.prototype.setText=function(t){Phaser.Text.prototype.setText.call(this,t),this.scale.setTo(1),this.width=Math.min(this.width,this.userMaxWidth),this.height=Math.min(this.height,this.userMaxHeight)},G.TextCounter=function(t,e,i,s,a,r,o){this.amount=i,this.amountDisplayed=i,G.Text.call(this,t,e,null===i?"...":i.toString(),s,a,r),o=o||{lerpValue:.5},this.lerp=!0,this.lerpValue=o.lerpValue,this.stepCurrent=0,this.step=0},G.TextCounter.prototype=Object.create(G.Text.prototype),G.TextCounter.prototype.setAmount=function(t,e){this.amount=t,e&&(this.amountDisplayed=t,this.setText(this.amountDisplayed.toString()))},G.TextCounter.prototype.changeAmount=function(t,e){this.amount+=t,e&&(this.amountDisplayed=this.amount,this.setText(this.amountDisplayed.toString()))},G.TextCounter.prototype.update=function(){this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.lerp&&this.lerpUpdate())},G.TextCounter.prototype.lerpUpdate=function(){this.amountDisplayed=G.lerp(this.amountDisplayed,this.amount,this.lerpValue,.2),this.setText(Math.round(this.amountDisplayed).toString())},G.TextRTCacher=function(){},G.TextRTCacher.prototype.cacheText=function(t,e,i,s,a){this.txt||(this.txt=game.make.bitmapText(0,0,t,"",80)),this.txt.fontSize=i,this.txt.setText(e),this.txt.tint=a||16777215,this.txt.updateCache(),game.make.renderTexture(this.txt.width,this.txt.height,s,!0).render(this.txt)},G.TextRTCacher.prototype.cachePhaserText=function(t,e,i){var s=game.make.text(0,0,t,i);game.make.renderTexture(s.width,s.height,e,!0).render(s),s.destroy()},G.Timer=function(t,e,i,s,a,r,o){G.OneLineText.call(this,t,e,i,"???",s,a,r,o),this.secLeft=0,this.active=!1,this.timerBinding=G.sb.onWallClockTimeUpdate.add(this.updateTimer,this),this.events.onDestroy.add((function(){this.timerBinding.detach()}),this)},G.Timer.prototype=Object.create(G.OneLineText.prototype),G.Timer.prototype.updateTimer=function(){this.active&&(G.sfx.clock_tick.play(),this.secLeft=Math.max(0,this.secLeft-1),this.setText(G.changeSecToTimerFormat(this.secLeft)))},G.Timer.prototype.setSecLeft=function(t){this.secLeft=t,this.setText(G.changeSecToTimerFormat(this.secLeft))},G.Timer.prototype.start=function(t){this.active=!0},G.TimerT=function(t,e,i,s,a,r,o,n){G.Text.call(this,t,e,"???",s,a,r),this.secLeft=0,this.active=!1,this.timerFormat=o,this.dots=!0,this.sfx=n?G.sfx[sfs]:null,this.timerBinding=G.sb("onWallClockTimeUpdate").add(this.updateTimer,this),this.events.onDestroy.add((function(){this.timerBinding.detach()}),this),i&&this.setDate(i)},G.TimerT.prototype=Object.create(G.Text.prototype),G.TimerT.prototype.updateTimer=function(){this.active&&(this.sfx&&this.sfx.play(),this.secLeft=Math.max(0,this.secLeft-1),this.updateTimerText(this.secLeft,this.dots),this.dots=!this.dots)},G.TimerT.prototype.setSecLeft=function(t){this.secLeft=Math.max(0,t),this.updateTimerText(this.secLeft,!0)},G.TimerT.prototype.updateTimerText=function(t,e){var i=G.changeSecToDHMS(this.secLeft),s=[];this.timerFormat.indexOf("d")>-1&&s.push(i[0]),this.timerFormat.indexOf("h")>-1&&s.push(i[1]),this.timerFormat.indexOf("m")>-1&&s.push(i[2]),this.timerFormat.indexOf("s")>-1&&s.push(i[3]),this.setText(s.join(e?":":" "))},G.TimerT.prototype.start=function(t){this.active=!0},G.TimerT.prototype.setDate=function(t){var e=new Date(t).getTime(),i=Date.now(),s=Math.ceil((e-i)/1e3);this.setSecLeft(s),this.active=!0},G.UITargetParticles=function(){G.PoolGroup.call(this,G.UITargetParticle),this.fixedToCamera=!0},G.UITargetParticles.prototype=Object.create(G.PoolGroup.prototype),G.UITargetParticles.prototype.initPart=function(t,e,i,s,a,r){return this.init(t,e,i,s,a)},G.UITargetParticles.prototype.createDividedBatch=function(t,e,i,s,a,r){var o=new G.UITargetParticles.BatchObj,n=n||25;a/r>n&&(r=Math.ceil(a/n));for(var h=Math.floor(a/r)+Math.sign(a%r),l=0;l<h;l++){var c=this.init(t,e,i,s,Math.min(r,a));a-=r,o.add(c)}return o},G.UITargetParticles.prototype.createBatch=function(t,e,i,s,a,r){for(var o=new G.UITargetParticles.BatchObj,n=Array.isArray(t),h=0;h<r;h++){if(n)var l=this.init(t[h].x,t[h].y,i,s,a);else l=this.init(t,e,i,s,a);o.add(l)}return o},G.UITargetParticles.BatchObj=function(){this.parts=[],this.nrOfParts=0,this.nrOfFinished=0,this.onFinish=new Phaser.Signal},G.UITargetParticles.BatchObj.prototype.add=function(t){this.parts.push(t),t.onFinish.addOnce(this.onPartFinish,this),this.nrOfParts++},G.UITargetParticles.BatchObj.prototype.onPartFinish=function(){this.nrOfFinished++,this.nrOfFinished==this.nrOfParts&&this.onFinish.dispatch()},G.UITargetParticles.BatchObj.prototype.addOnPartStart=function(t,e){this.parts.forEach((function(i){i.onStart.addOnce(t,e||i,1)}))},G.UITargetParticles.BatchObj.prototype.addOnPartFinish=function(t,e){this.parts.forEach((function(i){i.onFinish.addOnce(t,e||i,1)}))},G.UITargetParticles.BatchObj.prototype.start=function(t){var e=0;this.parts.forEach((function(i){i.start(e),e+=t||0}))},G.UITargetParticle=function(){G.Image.call(this,0,0,null,.5),this.onStart=new Phaser.Signal,this.onFinish=new Phaser.Signal,this.speed=0,this.speedMax=30,this.speedDelta=.75,this.vel=new Phaser.Point(0,0),this.velInit=new Phaser.Point(0,0),this.kill()},G.UITargetParticle.prototype=Object.create(G.Image.prototype),G.UITargetParticle.prototype.init=function(t,e,i,s,a){this.position.setTo(t,e),this.changeTexture(i),this.onStart.removeAll(),this.onFinish.removeAll(),this.carriedValue=a||1,this.targetObj=s,this.stopTweens(this),this.scale.setTo(1),this.alpha=1,this.speed=0,this.vel.setTo(0,0)},G.UITargetParticle.prototype.start=function(t){t?game.time.events.add(t,this.start,this):(this.revive(),this.onStart.dispatch(this,this.carriedValue))},G.UITargetParticle.prototype.update=function(){if(this.alive){this.position.add(this.vel.x,this.vel.y),this.vel.x*=.95,this.vel.y*=.95,this.speed+=this.speedDelta,this.speed=Math.min(this.speed,this.speedMax);var t=Phaser.Point.distance(this.worldPosition,this.targetObj.worldPosition),e=Phaser.Point.angle(this.targetObj.worldPosition,this.worldPosition);this.position.add(G.lengthDirX(e,Math.min(t,this.speed),!0),G.lengthDirY(e,Math.min(t,this.speed),!0)),t<1.2*this.speedMax&&(this.onFinish.dispatch(this,this.carriedValue),this.kill())}},void 0===G&&(G={}),Math.sign=Math.sign||function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1},G.isImageInCache=function(t){return""!=this.checkSheet(t)||game.cache.checkImageKey(t)},G.checkSheet=function(t){return G.spritesheetMap?G.spritesheetMap[t]||"":this.checkSheetOld()},G.checkSheetOld=function(){for(var t=0,e=G.ASSETS.spritesheets.length;t<e;t++){G.ASSETS.spritesheets[t];if(game.cache.checkImageKey(G.ASSETS.spritesheets[t])&&game.cache.getFrameData(G.ASSETS.spritesheets[t]).getFrameByName(frame))return G.ASSETS.spritesheets[t]}return""},G.lerp=function(t,e,i,s){return s&&Math.abs(t-e)<=s?e:t+i*(e-t)},G.l=function(t){return Math.floor(t*G.Loader.currentConfigMulti)},G.rl=function(t){return Math.floor(t*(1/G.Loader.currentConfigMulti))},G.lnf=function(t){return t*G.Loader.currentConfigMulti},G.rnd=function(t,e){return game.rnd.realInRange(t||0,e||1)},G.rndInt=function(t,e){return game.rnd.between(t,e)},G.changeTexture=function(t,e){if("string"!=typeof e)return t.loadTexture(e);var i=this.checkSheet(e);""==i?t.loadTexture(e):t.loadTexture(i,e)},G.txt=function(t){return G.lang||(G.lang="ja"),G.json.languages[G.lang]||(G.lang="ja"),G.json.languages[G.lang][t]||t+"***"},G.deltaTime=1,G.delta=function(){G.deltaTime=Math.min(1.5,game.time.elapsedMS/16),17==game.time.elapsedMS&&(G.deltaTime=1)},G.rotatePositions=function(t){for(var e=[],i=0,s=t.length;i<s;i+=2)e.push(-1*t[i+1],t[i]);return e},G.loadTexture=G.changeTexture,G.makeImage=function(t,e,i,s,a){var r,o=this.checkSheet(i);return r=""==o?game.make.image(this.l(t),this.l(e),i):game.make.image(this.l(t),this.l(e),o,i),s&&("number"==typeof s?r.anchor.setTo(s):r.anchor.setTo(s[0],s[1])),a?(a.add||a.addChild).call(a,r):null!==a&&game.world.add(r),r},G.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},G.lengthDirX=function(t,e,i){return(i=i||!1)?Math.cos(t)*e:Math.cos(game.math.degToRad(t))*e},G.lengthDirY=function(t,e,i){return(i=i||!1)?Math.sin(t)*e:Math.sin(game.math.degToRad(t))*e},G.stopTweens=function(t){game.tweens._add.forEach((function(e){t.scale&&e.target==t.scale&&e.stop(),e.target==t&&e.stop()})),game.tweens._tweens.forEach((function(e){t.scale&&e.target==t.scale&&e.stop(),e.target==t&&e.stop()}))},G.makeExtImage=function(t,e,i,s,a,r,o,n){var h;if(G.extLoader||(G.extLoader=new G.ExtLoader(game)),G.extLoader.loadedUrls[i])return h=G.makeImage(t,e,G.extLoader.loadedUrls[i],a,r),n.call(h),h;(h=G.makeImage(t,e,s,a,r)).onImgLoaded=new Phaser.Signal,G.extImagesKeys||(G.extImagesKeys=[]);var l="extImgBlankName"+G.extImagesKeys.length;G.extImagesKeys.push(l);var c=G.extLoader.onFileComplete.add((function(t,e,s){e==l&&s&&(G.extLoader.loadedUrls[i]=l,G.changeTexture(h,l),n&&n.call(h),c.detach())}));return G.extLoader.image(l,i,!0),h},G.drawCircleSegment=function(t,e,i,s,a,r,o){if(a===r)return t;void 0===o&&(o=10);var n=(r-a)/o;t.moveTo(e,i);for(var h=t.currentPath.shape.points;a<=r;a+=n)h.push(Math.floor(e+G.lengthDirX(a,s,!1)),Math.floor(i+G.lengthDirY(a,s,!1)));return h.push(Math.floor(e+G.lengthDirX(r,s,!1)),Math.floor(i+G.lengthDirY(r,s,!1))),t.dirty=!0,t._boundsDirty=!0,t},G.centerElements=function(t,e,i){void 0===i&&(i=0),void 0===e&&(e=[]);var s=0,a=Array.isArray(e);t.forEach((function(t,i){s+=t.width,(a?e[i-1]:void 0!==e)&&(s+=G.l(a?e[i-1]:e))}));var r=i+-.5*s;t.forEach((function(t,i,s){t.x=r,t.x+=t.width*t.anchor.x,r+=t.width,(a?e[i-1]:void 0!==e)&&(r+=G.l(a?e[i]:e))}))},G.centerElements2=function(t,e,i){void 0===i&&(i=0),void 0===e&&(e=0);var s=0;t.forEach((function(t,e){s+=t.width})),s+=e*(t.length-1),t.forEach((function(t,a,r){t.left=0==a?i+-.5*s:r[a-1].right+e}))},G.makeMover=function(t){void 0!==G.activeMover&&(G.activeMover.destroy(),G.activeMover.eKey.onDown.removeAll()),G.activeMover=game.add.image(),G.activeMover.obj=t,G.activeMover.cursors=game.input.keyboard.createCursorKeys(),G.activeMover.shiftKey=game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),G.activeMover.eKey=game.input.keyboard.addKey(Phaser.Keyboard.E),G.activeMover.eKey.onDown.add((function(){}),G.activeMover),G.activeMover.update=function(){var e=this.shiftKey.isDown?10:2;this.cursors.down.isDown&&(t.y+=e),this.cursors.up.isDown&&(t.y-=e),this.cursors.left.isDown&&(t.x-=e),this.cursors.right.isDown&&(t.x+=e)}},G.makeLineEditor=function(t){var e=game.add.group();return e.interpolation=t||"linear",e.pointsX=[0],e.pointsY=[0],e.gfx=e.add(game.make.graphics()),e.shiftKey=game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),e.wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),e.wKey.onDown.add((function(){var t,e;this.children.length>2?(t=this.children[this.children.length-1].x,e=this.children[this.children.length-1].y):(t=0,e=0);var i=G.makeImage(t,e,"candy_1");i.anchor.setTo(.5),i.scale.setTo(.1),this.add(i),this.activeObject=i,this.changed=!0}),e),e.qKey=game.input.keyboard.addKey(Phaser.Keyboard.Q),e.qKey.onDown.add((function(){this.children.length<=2||(this.removeChildAt(this.children.length-1),this.children.length>3?this.activeObject=this.children[this.children.length-1]:this.activeObject=null,this.changed=!0)}),e),e.aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),e.aKey.onDown.add((function(){if(this.activeObject){var t=this.getChildIndex(this.activeObject);2!=t&&(this.activeObject=this.getChildAt(t-1))}}),e),e.sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),e.sKey.onDown.add((function(){if(this.activeObject){var t=this.getChildIndex(this.activeObject);t!=this.children.length-1&&(this.activeObject=this.getChildAt(t+1))}}),e),e.eKey=game.input.keyboard.addKey(Phaser.Keyboard.E),e.eKey.onDown.add((function(){}),e),e.cursors=game.input.keyboard.createCursorKeys(),e.activeObject=null,e.preview=G.makeImage(0,0,"candy_2",.5,e),e.preview.width=8,e.preview.height=8,e.preview.progress=0,e.update=function(){if(null!==this.activeObject&&(this.forEach((function(t){t==this.activeObject?t.alpha=1:t.alpha=.5}),this),0!=this.children.length)){var t=this.shiftKey.isDown?3:1;if(this.cursors.down.isDown&&(this.activeObject.y+=t,this.changed=!0),this.cursors.up.isDown&&(this.activeObject.y-=t,this.changed=!0),this.cursors.left.isDown&&(this.activeObject.x-=t,this.changed=!0),this.cursors.right.isDown&&(this.activeObject.x+=t,this.changed=!0),e.preview.progress+=.01,e.preview.progress>1&&(e.preview.progress=0),e.preview.x=game.math[this.interpolation+"Interpolation"](this.pointsX,e.preview.progress),e.preview.y=game.math[this.interpolation+"Interpolation"](this.pointsY,e.preview.progress),this.changed){var i=[],s=[];this.pointsX=i,this.pointsY=s,this.children.forEach((function(t,e){e<=1||(i.push(t.x),s.push(t.y))})),this.gfx.clear(),this.gfx.beginFill(16711680,1);for(var a=0;a<200;a++)this.gfx.drawRect(game.math[this.interpolation+"Interpolation"](i,a/200),game.math[this.interpolation+"Interpolation"](s,a/200),3,3)}}},e},G.lineUtils={getWholeDistance:function(t,e){for(var i=0,s=1;s<t.length;s++)i+=game.math.distance(t[s-1],e[s-1],t[s],e[s]);return i},findPointAtDitance:function(t,e,i){for(var s=0,a=1;a<t.length;a++){var r=game.math.distance(t[a-1],e[a-1],t[a],e[a]);if(r+s>i){var o=game.math.angleBetween(t[a-1],e[a-1],t[a],e[a]);return[t[a-1]+G.lengthDirX(o,i-s,!0),e[a-1]+G.lengthDirY(o,i-s,!0)]}s+=r}return[t[t.length-1],e[e.length-1]]},spreadAcrossLine:function(t,e,i,s,a){for(var r=this.getWholeDistance(t,e)/(i.length-1),o=0;o<i.length;o++){var n=this.findPointAtDitance(t,e,r*o);i[o][s||"x"]=n[0],i[o][a||"y"]=n[1]}},spreadOnNodes:function(t,e,i,s,a){for(var r=0;r<t.length;r++){if(void 0===i[r])return;i[r][s||"x"]=t[r],i[r][a||"y"]=e[r]}}},G.changeSecToTimerFormat=function(t,e){var i=parseInt(t,10),s=!!e&&-1!==e.toUpperCase().indexOf("D"),a=!!e&&-1!==e.toUpperCase().indexOf("H"),r=Math.floor(i/86400),o=Math.floor((i-86400*r)/3600),n=Math.floor((i-86400*r-3600*o)/60),h=i-86400*r-3600*o-60*n,l=G.zeroPad(n)+":"+G.zeroPad(h);return(o>0||r>0||a)&&(l=G.zeroPad(o)+":"+l),(r>0||s)&&(l=G.zeroPad(r)+":"+l),l},G.changeSecToDHMS=function(t,e){var i=parseInt(t,10),s=(!!e&&e.toUpperCase().indexOf("D"),!!e&&e.toUpperCase().indexOf("H"),Math.floor(i/86400)),a=Math.floor((i-86400*s)/3600),r=Math.floor((i-86400*s-3600*a)/60),o=i-86400*s-3600*a-60*r;return[G.zeroPad(s),G.zeroPad(a),G.zeroPad(r),G.zeroPad(o)]},G.zeroPad=function(t){return t<10?"0"+t:t},G.arrayJoin=function(t,e){return t.reduce((function(t,i){return i?t?t+e+i:i:t}),"")},G.makeTextButton=function(t,e,i,s,a,r){var o=game.make.text(t,e,i,s);return o.inputEnabled=!0,o.input.useHandCursor=!0,o.hitArea=new Phaser.Rectangle(0,0,o.width,o.height),o.events.onInputDown.add(a,r||null),o},G.setObjProp=function(t,e,i){var s=t;"string"==typeof e&&e.split(".");try{for(var a=0;a<this.refreshProp.length-1;a++)s=s[this.refreshProp[a]];s[this.refreshProp[this.refreshProp.length-1]]=i}catch(t){}},G.getObjProp=function(t,e){var i=t;"string"==typeof e&&(e=e.split("."));try{for(var s=0;s<e.length;s++)i=i[e[s]]}catch(t){return}return i},void 0===G&&(G={}),G.Utils={cacheText:function(t,e,i,s,a){(e=game.make.bitmapText(0,0,i,e,s)).tint=a||16777215,e.updateCache(),game.make.renderTexture(e.width,e.height,t,!0).render(e),e.destroy()},cacheGText:function(t,e,i){e=new G.Text(0,0,e,i,0);game.make.renderTexture(e.width,e.height,t,!0).render(e),e.destroy()},lerp:function(t,e,i,s){return s&&Math.abs(t-e)<=s?e:t+i*(e-t)},copyToClipboard:function(t){this.copyArea||(this.copyArea=document.createElement("textarea"),this.copyArea.style.positon="fixed",this.copyArea.style.opacity=0,document.body.appendChild(this.copyArea)),this.copyArea.value=t,this.copyArea.select(),document.execCommand("copy")},getObjProp:function(t,e){var i=t;"string"==typeof e&&(e=e.split("."));try{for(var s=0;s<e.length;s++)i=i[e[s]]}catch(t){return}return i},setObjProp:function(t,e,i){var s=t;"string"==typeof e&&(e=e.split("."));try{for(var a=0;a<e.length-1;a++)s=s[e[a]];s[e[e.length-1]]=i}catch(t){return null}},replaceAll:function(t,e,i){return t.split(e).join(i)},removeDuplicates:function(t){var e=[];return t.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),e},getParentsScaleX:function(t,e){return t==game.stage?1:G.Utils.getParentsScaleX(t.parent,!0)*(e?t.scale.x:1)},getParentsScaleY:function(t,e){return t==game.stage?1:G.Utils.getParentsScaleY(t.parent,!0)*(e?t.scale.y:1)},makeTextButton:function(t,e,i,s,a,r){var o=game.add.text(t,e,i,r);return o.inputEnabled=!0,o.input.useHandCursor=!0,o.hitArea=new Phaser.Rectangle(0,0,o.width,o.height),o.events.onInputDown.add(s,a),o},injectCSS:function(t){var e=document.createElement("style");e.type="text/css",e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e)},toClientX:function(t){return(parseInt(game.canvas.style.marginLeft)||0)+t/game.width*game.canvas.clientWidth},toClientY:function(t){return(parseInt(game.canvas.style.marginTop)||0)+t/game.height*game.canvas.clientHeight},clientXToWorldX:function(t){t-=parseInt(game.canvas.style.marginLeft)||0;var e=parseInt(game.canvas.style.width),i=(parseInt(game.canvas.style.height),parseInt(game.canvas.width));parseInt(game.canvas.height);return t*(i/e)},clientYToWorldY:function(t){t-=parseInt(game.canvas.style.marginTop)||0;parseInt(game.canvas.style.width);var e=parseInt(game.canvas.style.height);parseInt(game.canvas.width);return t*(parseInt(game.canvas.height)/e)},getImageURI:function(t){return this._bmpMarker||(this._bmpMarker=G.makeImage(0,0,null,0,null)),this._bmp||(this._bmp=game.make.bitmapData()),this._bmp.clear(),G.changeTexture(this._bmpMarker,t),this._bmp.resize(this._bmpMarker.width,this._bmpMarker.height),this._bmp.draw(this._bmpMarker),this._bmp.canvas.toDataURL()},getRT:function(t){return game.cache.getRenderTexture(t).texture},arraysEqual:function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}},G.lineCircleColl=function(t,e,i){var s=t.start,a=t.end,r=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2)),o=(a.x-s.x)/r,n=(a.y-s.y)/r,h=o*(e.x-s.x)+n*(e.y-s.y),l=h*o+s.x,c=h*n+s.y,d=Math.sqrt(Math.pow(l-e.x,2)+Math.pow(c-e.y,2));if(d<e.radius){var p=Math.sqrt(e.radius*e.radius-d*d),u=(h-p)*o+s.x,g=(h-p)*n+s.y,f=(h+p)*o+s.x,m=(h+p)*n+s.y,y=game.math.distance(s.x,s.y,u,g),G=game.math.distance(s.x,s.y,f,m);return y<G?t.length>y&&(i.setTo(u,g),i):t.length>G&&(i.setTo(f,m),i)}return!1},G.getRT=function(t){var e=game.cache.getRenderTexture(t);return e?e.texture:null},G.numberDot=function(t){for(var e="",i=0,s=(t=t.toString()).length-1;s>=0;s--)e=t[s]+e,3==++i&&0!==s&&(e="."+e,i=0);return e},G.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},G.AnimationElement=function(t,e,i,s){G.Image.call(this,t,e,null),this.ANIMATIONELEMENT=!0,this.SPR=new G.Image(0,0,null,.5,this),this.frameCounter=0,this.data=i,this.currentAnimationData=null,this.currentAnimationName=null,this.playing=void 0===s||s},G.AnimationElement.prototype=Object.create(G.Image.prototype),G.AnimationElement.prototype.update=function(){this.currentAnimationName&&this.playing&&(this.frameCounter++,this.updateAnimation(this.frameCounter))},G.AnimationElement.prototype.pause=function(){this.playing=!1},G.AnimationElement.prototype.resume=function(){this.playing=!0},G.AnimationElement.prototype.play=function(){this.playing=!0},G.AnimationElement.prototype.stop=function(){this.playing=!1,this.updateAnimation(0)};var testObj={normal:{eventTL:[],frameTL:[{f:0,v:"candy_1"}],propTLS:{alpha:[{f:0,v:1}],x:[{f:0,v:0}],y:[{f:0,v:0}],angle:[{f:0,v:0}],"scale.x":[{f:0,v:1}],"scale.y":[{f:0,v:1}],"anchor.x":[{f:0,v:.5}],"anchor.y":[{f:0,v:1}]}},jump:{eventTL:[],frameTL:[{f:0,v:null}],propTLS:{alpha:[{f:0,v:1}],x:[{f:0,v:0}],y:[{f:0,v:0},{f:120,v:-300}],angle:[{f:0,v:0,e:["Linear","None"]},{f:400,v:360}],"scale.x":[{f:0,v:1}],"scale.y":[{f:0,v:1}],"anchor.x":[{f:0,v:.5}],"anchor.y":[{f:0,v:1}]}}};G.AnimationElement.prototype.changeAnimationData=function(t){this.data[t]||(t=Object.keys(this.data)[0]),this.eventTL=this.data[t].eventTL,this.frameTL=this.data[t].frameTL,this.propTLS=this.data[t].propTLS,this.propKeys=Object.keys(this.propTLS),this.currentAnimationData=this.data[t],this.currentAnimationName=t,this.updateAnimation(0)},G.AnimationElement.prototype.playAnimation=function(t){this.changeAnimationData(t),this.playing=!0},G.AnimationElement.prototype.getLastKeyFrame=function(t,e){for(var i=t.length,s=0;s<i;s++){if(t[s].f==e||s==i-1)return t[s];if(t[s].f<e&&e<t[s+1].f)return t[s]}},G.AnimationElement.prototype.getNextKeyFrame=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].f>t||s==i-1)return t[s]},G.AnimationElement.prototype.getKeyFrameAt=function(t,e){if(!this.currentAnimationName)return null;for(var i=0;i<t.length;i++){var s=t[i];if(s.f===e)return s}return null},G.AnimationElement.prototype.isAnyKeyFrameAt=function(t){if(!this.currentAnimationName)return!1;if(this.getKeyFrameAt(this.eventTL,t))return!0;if(this.getKeyFrameAt(this.frameTL,t))return!0;for(var e=0;e<this.propKeys.length;e++){var i=this.propKeys[e];if(this.getKeyFrameAt(this.propTLS[i],t))return!0}return!1},G.AnimationElement.prototype.getFrameValue=function(t,e){var i=this.getLastKeyFrame(t,e),s=this.getNextKeyFrame(t,e);if(i.e){var a=s.f-i.f,r=s.v-i.v,o=Phaser.Easing[i.e[0]][i.e[1]]((e-i.f)/a);return i.v+r*o}return i.v},G.AnimationElement.prototype.updateAnimation=function(t){if(this.currentAnimationName){this.frameCounter=t,this.updateFromPropTLS(t);var e=this.getTextureFrameValue(this.frameTL,t);this.SPR.key!=e&&this.SPR.frameName!=e&&G.changeTexture(this.SPR,e)}},G.AnimationElement.prototype.updateFromPropTLS=function(t){for(var e=0;e<this.propKeys.length;e++){var i=this.propKeys[e];this.setProp(i,this.getFrameValue(this.propTLS[i],t))}},G.AnimationElement.prototype.setProp=function(t,e){"scale.x"==t?this.SPR.scale.x=e:"scale.y"==t?this.SPR.scale.y=e:"anchor.x"==t?this.SPR.anchor.x=e:"anchor.y"==t?this.SPR.anchor.y=e:this.SPR[t]=e},G.AnimationElement.prototype.getTextureFrameValue=function(t,e){var i=this.getLastKeyFrame(t,e),s=i.frameSkip||1,a=e-i.f;if(a=Math.floor(a/s),!i.animation)return i.v;var r=i.v.length;return i.loop?i.refraction||i.reverse?i.refraction&&!i.reverse?i.v[Math.min(r-1,a%(r+i.refraction))]:void 0:i.v[a%r]:i.v[Math.min(r-1,a)]},G.GroupColliderLineLine=function(t,e,i,s){G.Image.call(this,0,0,null),this.group1=t,this.group2=e,this.callback=i,this.context=s||null,this.collPoint=new Phaser.Point(0,0)},G.GroupColliderLineLine.prototype=Object.create(G.Image.prototype),G.GroupColliderLineLine.prototype.update=function(){for(var t=this.group1.length,e=this.group2.length,i=0;i<t;i++)for(var s=this.group1.children[i],a=0;a<e;a++){var r=this.group2.children[a];s!==r&&(s.collLine.intersects(r.collLine,!0,this.collPoint)&&this.callback.call(this.context,s,r,this.collPoint,this.group1,this.group2))}},G.GroupColliderLineCircle=function(t,e,i,s){G.Image.call(this,0,0,null),this.group1=t,this.group2=e,this.callback=i,this.context=s||null,this.collPoint=new Phaser.Point(0,0)},G.GroupColliderLineCircle.prototype=Object.create(G.Image.prototype),G.GroupColliderLineCircle.prototype.update=function(){this.group1.length,this.group2.length;for(var t=this.group1.length;t--;)for(var e=this.group1.children[t],i=this.group2.length;i--;){var s=this.group2.children[i];e!==s&&(G.lineCircleColl(e.collLine,s.collCircle,this.collPoint)&&this.callback.call(this.context,e,s,this.collPoint,this.group1,this.group2))}},Phaser.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||(void 0===t&&(t=!0),void 0===e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,this.alive=!1,this.pendingDestroy=!1,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Phaser.exportChildren=function(t){for(var e=[],i=0;i<t.children.length;i++){var s=t.children[i];s.exportToString&&e.push(s.exportToString())}return e},Phaser.Group.prototype.exportToString=function(){return{type:"GROUP",x:this.x,y:this.y,scale:[this.scale.x,this.scale.y],angle:this.angle,children:Phaser.exportChildren(this)}},Phaser.Image.prototype.exportToString=function(){return exportObj={type:"IMG",x:this.x,y:this.y,frame:this.frameName,anchor:[this.anchor.x,this.anchor.y],scale:[this.scale.x,this.scale.y],angle:this.angle,children:Phaser.exportChildren(this)},exportObj},G.Modify=function(){if(this===G)return new G.Modify;Phaser.Group.call(this,game),G.Modify.instance=this,this.onLevelObjChange=new Phaser.Signal,this.onCurrentObjChange=new Phaser.Signal,this.onObjDestroy=new Phaser.Signal,this.onCurrentObjPropModified=new Phaser.Signal,game.state.onStateChange.addOnce(this.turnOff,this),this.inputBlocker=new G.ModifyInputBlocked,this.add(this.inputBlocker),game.stage.disableVisibilityChange=!0,game.paused=!1,obj=game.state.getCurrentState(),obj===game.state.getCurrentState()&&(game.state.getCurrentState().children=game.world.children),this.objectName="WORLD",this.currentLevel=game.world,this.currentObject=null,this.gfx=game.add.graphics(),this.gfx.fixedToCamera=!0,this.add(this.gfx),this.obj=obj,this.leftBar=document.createElement("div"),this.leftBar.style.position="fixed",this.leftBar.style.top="0",this.leftBar.style.left="0",this.leftBar.style.pointerEvents="none",document.body.appendChild(this.leftBar),this.childList=new G.ModifyDOMChildList(this),this.leftBar.appendChild(this.childList.mainDiv),this.propList=new G.ModifyDOMPropList(this),this.leftBar.appendChild(this.propList.mainDiv),this.bottomBar=document.createElement("div"),this.bottomBar.style.position="fixed",this.bottomBar.style.bottom="0",this.bottomBar.style.left="0",this.bottomBar.style.width="100%",document.body.appendChild(this.bottomBar),this.objectFactory=new G.ModifyObjectFactory(this),this.objectFactory.onObjectAdded.add((function(t){this.changeCurrentObject(t),this.refreshLevel()}),this),this.bottomBar.appendChild(this.objectFactory.mainDiv),this.buttonGroup=new G.ModifyDOMButtonGroup(this),this.frameSelector=new G.ModifyDOMFrameSelector,this.frameSelector.onFrameClicked.add(this.changeFrame,this),this.addKeyboardControlls(),this.animationEditor=new G.ModifyAnimationEditor(this),this.add(this.animationEditor),this.removeCash={},this.codeGenerator=new G.ModifyCodeGenerator(this),game.state.states.MODIFYEMPTYSTATE||game.state.add("MODIFYEMPTYSTATE",{create:function(){new G.Modify}}),this.domLayer=new G.ModifyDOMLayer(this),game.input.onDown.add(this.processClick,this),this.changeLevelObject(game.world)},G.Modify.prototype=Object.create(Phaser.Group.prototype),G.Modify.prototype.removeCashObjToString=function(t){if(!this.removeCash[t])return"";for(var e="\tREMOVED:",i=0;i<this.removeCash[t].length;i++)e+="\t\t"+this.removeCash[t][i]+"\n";return e},G.Modify.prototype.removeObject=function(){var t=this.getCurrentObject();t&&(t.destroy(),this.currentObject=null,this.refreshLevel())},G.Modify.prototype.refreshLevel=function(){this.currentLevel=this.currentLevel,this.onLevelObjChange.dispatch(this.currentLevel)},G.Modify.prototype.update=function(){this.updateKeyboard(),this.redrawGfx();for(var t=0;t<this.children.length;t++)this.children[t].update()},G.Modify.prototype.getChildrenData=function(t){t=t||this.currentLevel;for(var e=[],i=0;i<t.children.length;i++){var s=t.children[i];if(s!==this){var a=t.children[i].children&&t.children[i].children.length>0||t.children[i].constructor===Phaser.Group,r=t.children[i].constructor==G.OneLineText||t.children[i].constructor==G.MultiLineText,o={label:this.getChildLabel(s),openable:!r,hasChildren:a,obj:s,current:s==this.currentObject};e.push(o)}}return e},G.Modify.prototype.getChildLabel=function(t){var e=t.parent;if(e==game.stage&&(t.___LABEL="WORLD"),t.___LABEL)return t.___LABEL;var i=e==game.world?game.state.getCurrentState():e;for(var s in i)if("children"!=s&&"cursor"!=s){if(t===i[s])return t.___LABEL=s,t.___LABEL;if(Array.isArray(i[s])&&"children"!==s){var a=i[s].indexOf(t);if(a>0)return"prop["+a+"]"}}return"children["+e.children.indexOf(t)+"]"},G.Modify.prototype.getCurrentObject=function(){return this.currentObject},G.Modify.prototype.changeFrame=function(t){var e=this.getCurrentObject();this.saveInitPropValue("frameName",t),e.loadTexture&&G.changeTexture(e,t),this.onCurrentObjPropModified.dispatch()},G.Modify.prototype.getCurrentLevelObject=function(){return this.currentLevel},G.Modify.prototype.redrawGfx=function(){},G.Modify.prototype.addKeyboardControlls=function(){this.keys=game.input.keyboard.addKeys({Q:Phaser.Keyboard.Q,W:Phaser.Keyboard.W,E:Phaser.Keyboard.E,UP:Phaser.Keyboard.UP,ONE:Phaser.Keyboard.ONE,TWO:Phaser.Keyboard.TWO,DOWN:Phaser.Keyboard.DOWN,RIGHT:Phaser.Keyboard.RIGHT,LEFT:Phaser.Keyboard.LEFT,ALT:Phaser.Keyboard.ALT,Z:Phaser.Keyboard.Z,X:Phaser.Keyboard.X,C:Phaser.Keyboard.C,U:Phaser.Keyboard.U,PLUS:107,MINUS:109,ESC:Phaser.Keyboard.ESC,NUM8:104,NUM5:101,NUM4:100,NUM6:102,NUM2:98,NUM7:103,NUM9:105,NUMSTAR:106,SPACE:Phaser.Keyboard.SPACEBAR,V:Phaser.Keyboard.V,L:Phaser.Keyboard.L,I:Phaser.Keyboard.I,P:Phaser.Keyboard.P,O:Phaser.Keyboard.O,M:Phaser.Keyboard.M,DEL:Phaser.Keyboard.DELETE,sqBracketOpen:219,sqBracketClose:221,SHIFT:Phaser.Keyboard.SHIFT}),this.keys.sqBracketOpen.onDown.add((function(){this.keys.SHIFT.isDown?this.objToBottom():this.objMoveDown()}),this),this.keys.sqBracketClose.onDown.add((function(){this.keys.SHIFT.isDown?this.objToTop():this.objMoveUp()}),this),this.keys.frameCounter=0,this.keys.L.onDown.add((function(){var t=this.getCurrentLevelObject(),e=this.getCurrentObject();e&&this.domLayer.openInputDiv((e.___LABEL||"obj")+" | label",e.___LABEL||"",(function(i){void 0===t[i]&&(e.___LABEL&&delete t[e.___LABEL],t[i]=e,e.___LABEL=i,this.refreshLevel())}),this,"string")}),this),this.keys.Q.onDown.add((function(){this.changeCurrentChildrenIndex(-1)}),this),this.keys.W.onDown.add((function(){this.changeCurrentChildrenIndex(1)}),this),this.keys.TWO.onDown.add((function(){this.currentObject&&this.changeLevelObject(this.currentObject)}),this),this.keys.ONE.onDown.add(this.currentLevelGoUp,this),this.keys.ESC.onDown.add((function(){void 0===this.escPressed&&(this.escPressed=0),this.escPressed++,game.time.events.add(2e3,(function(){this.escPressed=0}),this),this.escPressed<5||this.turnOff()}),this),this.keys.E.onDown.add((function(){this.exportChanges()}),this),this.keys.NUM5.onDown.add((function(){var t=this.getCurrentObject();t&&(t.scale.setTo(1),t.angle=0,t.alpha=1,t.visible=!0,t.anchor.setTo(.5))}),this),this.keys.V.onDown.add((function(){this.alpha=1==this.alpha?.1:1}),this),this.keys.O.onDown.add((function(){var t=this.getCurrentObject();t instanceof Phaser.Group&&(t.___CONSTRUCTOR=!0)}),this),this.keys.P.onDown.add((function(){var t=this.getCurrentObject();this.codeGenerator.start(t)}),this),this.keys.C.onDown.add((function(){var t=game.input.activePointer,e=this.addImage();this.setNewCurrentChildren(e),this.moveCurrentObjectToWorldPos(t.x,t.y)}),this),this.keys.I.onDown.add((function(){void 0===this.pressCounterI&&(this.pressCounterI=0),this.pressCounterI++,3==this.pressCounterI&&game.state.start("MODIFYEMPTYSTATE"),game.time.events.add(1e3,(function(){this.pressCounterI=0}),this)}),this),this.keys.DEL.onDown.add(this.removeObject,this),this.keys.NUMSTAR.onDown.add(this.frameSelector.toggle,this.frameSelector),this.keys.U.onDown.add((function(){this.childList.toggleList()}),this)},G.Modify.prototype.turnOff=function(t){for(key in this.keys)this.keys[key].onDown&&this.keys[key].onDown.removeAll();this.gfx.destroy(),this.buttonGroup.destroy(),this.frameSelector.destroy(),this.leftBar.remove(),this.destroy()},G.Modify.prototype.modifyCurrentObjProp=function(t,e){var i=this.getCurrentObject();this.saveInitPropValue(t,e),G.Utils.setObjProp(i,t,e),this.onCurrentObjPropModified.dispatch()},G.Modify.prototype.saveInitPropValue=function(t,e){var i=this.getCurrentObject();Array.isArray(t)&&(t=t.join(".")),G.Utils.getObjProp(i,t)!==e&&(i.___initState||(i.___initState={}),void 0===i.___initState[t]&&(i.___initState[t]=G.Utils.getObjProp(i,t)))},G.Modify.prototype.updateKeyboard=function(){var t=this.getCurrentObject();if(t){this.keys.frameCounter++;var e=1,i=!0;this.keys.Z.isDown&&this.keys.frameCounter%5!=0&&(i=!1),this.keys.X.isDown&&(e=5),this.keys.C.isDown&&(e=20),i&&this.keys.UP.isDown&&this.modifyCurrentObjProp("y",t.y-e),i&&this.keys.DOWN.isDown&&this.modifyCurrentObjProp("y",t.y+e),i&&this.keys.LEFT.isDown&&this.modifyCurrentObjProp("x",t.x-e),i&&this.keys.RIGHT.isDown&&this.modifyCurrentObjProp("x",t.x+e),e=.025,this.keys.X.isDown&&(e=.05),this.keys.C.isDown&&(e=.1),i&&this.keys.NUM8.isDown&&this.modifyCurrentObjProp("scale.y",t.scale.y+e),i&&this.keys.NUM2.isDown&&(this.modifyCurrentObjProp("scale.y",t.scale.y-e),t.scale.y-=e),i&&this.keys.NUM4.isDown&&this.modifyCurrentObjProp("scale.x",t.scale.x-e),i&&this.keys.NUM6.isDown&&this.modifyCurrentObjProp("scale.x",t.scale.x+e),i&&this.keys.PLUS.isDown&&(this.modifyCurrentObjProp("scale.x",t.scale.x+e),this.modifyCurrentObjProp("scale.y",t.scale.y+e)),i&&this.keys.MINUS.isDown&&(this.modifyCurrentObjProp("scale.x",t.scale.x-e),this.modifyCurrentObjProp("scale.y",t.scale.y-e)),e=1,this.keys.X.isDown&&(e=2),this.keys.C.isDown&&(e=5),i&&this.keys.NUM7.isDown&&this.modifyCurrentObjProp("angle",t.angle-e),i&&this.keys.NUM9.isDown&&this.modifyCurrentObjProp("angle",t.angle+e),this.keys.SPACE.isDown&&(this.modifyCurrentObjProp("x",5*Math.floor(t.x/5)),this.modifyCurrentObjProp("y",5*Math.floor(t.y/5)),this.modifyCurrentObjProp("scale.x",.025*Math.floor(t.scale.x/.025)),this.modifyCurrentObjProp("scale.y",.025*Math.floor(t.scale.y/.025)),this.modifyCurrentObjProp("angle",Math.floor(t.angle)))}},G.Modify.prototype.currentLevelGoUp=function(){this.currentLevel.parent!=game.stage&&this.changeLevelObject(this.currentLevel.parent)},G.Modify.prototype.changeLevelObject=function(t){this.currentLevel=t,this.onLevelObjChange.dispatch(t),this.changeCurrentObject(this.currentLevel.children[0])},G.Modify.prototype.changeCurrentObject=function(t){t&&(this.currentObject=t,this.onCurrentObjChange.dispatch())},G.Modify.prototype.changeCurrentChildrenIndex=function(t){if(this.currentObject){var e=this.currentLevel.children.indexOf(this.currentObject)+t;e<0&&(e=this.currentLevel.children.length-1),e>=this.currentLevel.children.length&&(e=0),this.currentLevel.children[e]==this&&(e=t>0?0:e+t),this.currentLevel.children[e]&&this.changeCurrentObject(this.currentLevel.children[e])}},G.Modify.prototype.processClick=function(){var t=game.input.activePointer;this.keys.M.isDown&&this.moveCurrentObjectToWorldPos(t.x,t.y)},G.Modify.prototype.moveCurrentObjectToWorldPos=function(t,e){var i=this.getCurrentObject();if(i){i.updateTransform();var s=t-i.worldPosition.x,a=e-i.worldPosition.y,r=new Phaser.Point(s,a),o=new Phaser.Point(t,e);r.normalize();for(var n=i.worldPosition.distance(o);;){var h=n;if(i.x+=r.x,i.y+=r.y,i.updateTransform(),(n=i.worldPosition.distance(o))>h)break}i.x=Math.floor(i.x),i.y=Math.floor(i.y)}},G.Modify.prototype.moveCurrentObjectToWorldPos=function(t,e){if(this.currentObject){var i=this.currentLevel.toLocal({x:t,y:e});this.modifyCurrentObjProp("x",Math.floor(i.x)),this.modifyCurrentObjProp("y",Math.floor(i.y))}},G.Modify.prototype.worldPosToLocal,G.Modify.prototype.addMouseWheel=function(){game.input.mouse.mouseWheelCallback=function(t){var e=this.getCurrentLevelObject();e&&e!==game.world&&(e.y+=150*game.input.mouse.wheelDelta)}.bind(this)},G.Modify.prototype.exportLvlAsString=function(){for(var t=[],e=this.getCurrentLevelObject(),i=0;i<e.children.length;i++){var s=e.children[i];if(s instanceof Phaser.Image){var a=null;"string"==typeof s.frameName&&(a=-1==s.frameName.indexOf("/")?s.frameName:s.key);var r={x:s.x,y:s.y,frame:a,anchor:[s.anchor.x,s.anchor.y],scale:[s.scale.x,s.scale.y],angle:s.angle};s.___LABEL&&(r.label=s.___LABEL),s.___DATA&&(r.data=s.___DATA),t.push(r)}}G.Utils.copyToClipboard(JSON.stringify(t))},G.Modify.prototype.objToTop=function(){this.currentObject&&this.currentLevel.bringToTop(this.currentObject),this.refreshLevel()},G.Modify.prototype.objMoveUp=function(){this.currentObject&&this.currentLevel.moveUp(this.currentObject),this.refreshLevel()},G.Modify.prototype.objMoveDown=function(){this.currentObject&&this.currentLevel.moveDown(this.currentObject),this.refreshLevel()},G.Modify.prototype.objToBottom=function(){this.currentObject&&this.currentLevel.sendToBack(this.currentObject),this.refreshLevel()},G.Modify.prototype.childPropChange=function(t){var e=this.currentLevel,i=this.currentChildIndex;this.currentLevel=t||[];for(var s=this.currentLevel.join("/")||this.currentLevel[0]||game.state.current,a=this.removeCashObjToString(s),r="",o=this.getChildrenPropNames(),n=0;n<o.length;n++){this.currentChildIndex=n;var h=this.getCurrentObject();if(h!==this){o[n].toString();var l=h.___NEWOBJECT,c=h.constructor===G.OneLineText||h.constructor===G.MultiLineText;if(l&&(r+="NEW OBJECT \n"),h.___initState)r+="\t"+o[n]+"\n",Object.keys(h.___initState).forEach((function(t){r+="\t"+t+":  "+G.Utils.getObjProp(h,t)+"\n"}),this),h.___initState=void 0;!c&&(l||h.children&&h.children.length>0)&&this.childPropChange(this.currentLevel.concat(o[n]))}}(r.length>0||a.length>0)&&(a.length,r.length,this.export+=s+"\n"+a+r),this.currentChildIndex=i,this.currentLevel=e},G.Modify.prototype.exportChanges=function(){this.export="",this.childPropChange(),this.export&&(this.export=this.objectName+"\n"+this.export,G.Utils.copyToClipboard(this.export))},G.ModifyButtonGroup=function(){Phaser.Group.call(this,game),this.modify=G.Modify.instance,this.fixedToCamera=!0,this.gfx=this.add(game.add.graphics()),this.transformButtons=this.add(game.add.group()),this.changeObjButtons=this.add(game.add.group()),this.mode=0,this.tabKey=game.input.keyboard.addKey(Phaser.Keyboard.TAB),this.tabKey.onDown.add((function(){this.gfx.clear(),this.mode=(this.mode+1)%2,this.transformButtons.visible=0==this.mode,this.changeObjButtons.visible=1==this.mode}),this),this.keys={ALT:game.input.keyboard.addKey(Phaser.Keyboard.ALT)},this.clickedButton=null,this.clickedPos=null,this.posButton=game.add.button(0,0,null),this.posButton.onInputDown.add((function(){this.clickedButton=this.posButton,this.clickedPos={x:game.input.activePointer.x,y:game.input.activePointer.y}}),this),this.posButton.anchor.setTo(.5,.5),this.posButton.tint=16711680,this.transformButtons.add(this.posButton),this.scaleButton=game.add.button(0,0,null),this.scaleButton.onInputDown.add((function(){this.clickedButton=this.scaleButton,this.clickedPos={x:game.input.activePointer.x,y:game.input.activePointer.y}}),this),this.scaleButton.anchor.setTo(.5,.5),this.scaleButton.tint=65280,this.transformButtons.add(this.scaleButton),this.rotateButton=game.add.button(0,0,null),this.rotateButton.onInputDown.add((function(){this.clickedButton=this.rotateButton,this.clickedPos={x:game.input.activePointer.x,y:game.input.activePointer.y}}),this),this.rotateButton.anchor.setTo(.5,.5),this.rotateButton.tint=65280,this.transformButtons.add(this.rotateButton),this.refreshChangeObjButtons(),this.modify.onLevelObjChange.add(this.refreshChangeObjButtons,this),this.modify.onObjDestroy.add(this.refreshChangeObjButtons,this)},G.ModifyButtonGroup.prototype=Object.create(Phaser.Group.prototype),G.ModifyButtonGroup.prototype.update=function(){0==this.mode?(this.updateTransformButtons(),this.transformButtons.ignoreChildInput=!1,this.changeObjButtons.ignoreChildInput=!0):(this.transformButtons.ignoreChildInput=!0,this.changeObjButtons.ignoreChildInput=!1,this.updateChangeObjButtons())},G.ModifyButtonGroup.prototype.updateTransformButtons=function(){var t=this.modify.getCurrentObject();if(!t)return this.posButton.position.setTo(-9999,-9999),this.scaleButton.position.setTo(-9999,-9999),void this.rotateButton.position.setTo(-9999,-9999);var e=t.getBounds(),i=t.getLocalBounds(),s=game.input.activePointer;if(this.posButton.x=t.worldPosition.x,this.posButton.y=t.worldPosition.y,this.scaleButton.x=t.worldPosition.x+i.x*t.scale.x+e.width*t.scale.x+20,this.scaleButton.y=t.worldPosition.y+i.y*t.scale.y+e.height*t.scale.y+20,this.rotateButton.x=t.worldPosition.x+i.x*t.scale.x-20,this.rotateButton.y=t.worldPosition.y+i.y*t.scale.y-20,this.gfx.clear(),this.gfx.lineStyle(1,0,1),this.gfx.beginFill(16711680,1),this.gfx.drawCircle(this.posButton.worldPosition.x,this.posButton.worldPosition.y,10),this.gfx.endFill(),this.gfx.beginFill(65280,1),this.gfx.drawCircle(this.scaleButton.worldPosition.x,this.scaleButton.worldPosition.y,10),this.gfx.endFill(),this.gfx.beginFill(255,1),this.gfx.drawCircle(this.rotateButton.worldPosition.x,this.rotateButton.worldPosition.y,10),this.gfx.endFill(),this.clickedButton)if(s.isDown){var a=s.x-this.clickedPos.x,r=s.y-this.clickedPos.y;this.clickedButton===this.posButton&&(this.modify.modifyCurrentObjProp("x",t.x+a),this.modify.modifyCurrentObjProp("y",t.y+r)),this.clickedButton===this.scaleButton&&(this.modify.modifyCurrentObjProp("width",t.width+a),this.modify.modifyCurrentObjProp("height",t.height+r),this.keys.ALT.isDown&&this.modify.modifyCurrentObjProp("scale.y",t.scale.x)),this.clickedButton===this.rotateButton&&this.modify.modifyCurrentObjProp("angle",t.angle+.25*a),this.clickedPos={x:game.input.activePointer.x,y:game.input.activePointer.y}}else this.modify.modifyCurrentObjProp("x",5*Math.floor(t.x/5)),this.modify.modifyCurrentObjProp("y",5*Math.floor(t.y/5)),this.modify.modifyCurrentObjProp("scale.x",.025*Math.floor(t.scale.x/.025)),this.modify.modifyCurrentObjProp("scale.y",.025*Math.floor(t.scale.y/.025)),this.modify.modifyCurrentObjProp("angle",Math.floor(t.angle)),this.clickedButton=null},G.ModifyButtonGroup.prototype.updateChangeObjButtons=function(){this.gfx.clear(),this.gfx.beginFill(65280,1),this.gfx.lineStyle(3,16711680,1);for(var t=0;t<this.changeObjButtons.length;t++){var e=this.changeObjButtons.children[t];this.gfx.drawCircle(e.worldPosition.x,e.worldPosition.y,10)}},G.ModifyButtonGroup.prototype.refreshChangeObjButtons=function(){this.changeObjButtons.removeAll(!0);for(var t=this.modify.getCurrentLevelObject(),e=0;e<t.children.length;e++)if(t.children[e]!=this.modify){var i=t.children[e],s=game.make.button(0,0,null);this.changeObjButtons.add(s),s.attachement=i,s.modify=this.modify,s.position=i.worldPosition,s.hitArea=new Phaser.Circle(0,0,10),s.onInputDown.add((function(){this.modify.setNewCurrentChildren(this.attachement)}),s)}},G.ModifyCodeGenerator=function(t){this.modify=t},G.ModifyCodeGenerator.prototype.start=function(t){this.constStr="";var e=this.generateCode(t),i=this.constStr+"\n\n"+e;G.Utils.copyToClipboard(i)},G.ModifyCodeGenerator.prototype.generateCode=function(t,e){return G.OneLineText&&t instanceof G.OneLineText?this.generateCodeOneLineText(t,e):G.MultiLineText&&t instanceof G.MultiLineText?this.generateCodeMultiLineText(t,e):G.Button&&t instanceof G.Button?this.generateCodeButton(t,e):t instanceof Phaser.Group&&!(t instanceof Phaser.BitmapText)?t.___CONSTRUCTOR?this.generateConstructorCode(t,e):this.generateGroupCode(t,e):this.generateCodeImage(t,e)},G.ModifyCodeGenerator.prototype.generateConstructorCode=function(t,e,i){var s=this.getObjName(t),a=G.capitalize(s),r="";r+="G."+a+" = function(x,y){\n",r+="\tPhaser.Group.call(this,game);\n",r+="\tthis.position.setTo(x,y);\n",r+=this.generateCodeUniProp(t,"this"),r+="\n";for(var o=0;o<t.children.length;o++)r+="\t"+this.generateCode(t.children[o],"this"),r+="\n";r+="};\n",r+="G."+a+".prototype = Object.create(Phaser.Group.prototype);\n\n",this.constStr+=r;var n=(e?e+".":"var ")+"%NAME% = new G."+a+"(^x^,^y^);\n";return e&&(n+=e+".add("+e+".%NAME%);\n"),n=G.Utils.replaceAll(n,"%NAME%",s),n=this.injectObjPropToString(t,n)},G.ModifyCodeGenerator.prototype.generateGroupCode=function(t,e){var i=this.getObjName(t),s=(e?e+".":"var ")+"%NAME% = game.add.group();\n";s+=(e?e+".":"")+"%NAME%.position.setTo(^x^,^y^);\n",s+=this.generateCodeUniProp(t,e),e&&(s+=e+".add("+e+".%NAME%);\n");for(var a=0;a<t.children.length;a++){var r=this.generateCode(t.children[a],(e?e+".":"")+i,!0);s+=G.Utils.replaceAll(r,"this","%NAME%")}return s=G.Utils.replaceAll(s,"%NAME%",i),this.injectObjPropToString(t,s)},G.ModifyCodeGenerator.prototype.generateGroupConstructor=function(t){},G.ModifyCodeGenerator.prototype.generateChildrensCode=function(t){},G.ModifyCodeGenerator.prototype.generateCodeButton=function(t,e){var i="";return i+=((e=e||"")?e+".":"var ")+"%NAME% = new G.Button(^x^,^y^,'^frameName^',function(){},this);\n",i+=(e?e+".":"")+"add("+(e?e+".":"var ")+"%NAME%);\n",i+=this.generateCodeUniProp(t,e),i=G.Utils.replaceAll(i,"%NAME%",this.getObjName(t)),this.injectObjPropToString(t,i)},G.ModifyCodeGenerator.prototype.generateCodeImage=function(t,e){var i="";return i+=(e?e+".":"var ")+"%NAME% = G.makeImage(^x^,^y^,'^frameName^',[^anchor.x^,^anchor.y^],"+e+");\n",i+=this.generateCodeUniProp(t,e),i=G.Utils.replaceAll(i,"%NAME%",this.getObjName(t)),this.injectObjPropToString(t,i)},G.ModifyCodeGenerator.prototype.generateCodeOneLineText=function(t,e){var i="";return i+=(e?e+".":"var ")+"%NAME% = new G.OneLineText(^x^,^y^,'^font^','^text^',^fontSize^,^maxUserWidth^,^anchor.x^,^anchor.y^);\n",i+=(e?e+".":"")+"add("+(e?e+".":"var ")+"%NAME%);\n",i+=this.generateCodeUniProp(t,e),i=G.Utils.replaceAll(i,"%NAME%",this.getObjName(t)),this.injectObjPropToString(t,i)},G.ModifyCodeGenerator.prototype.generateCodeMultiLineText=function(t,e){var i="";return i+=(e?e+".":"var ")+"%NAME% = new G.MultiLineText(^x^,^y^,'^font^','^text^',^fontSize^,^maxUserWidth^,^maxUserHeight^,'^align^',^anchor.x^,^anchor.y^);\n",i+=(e?e+".":"")+"add("+(e?e+".":"var ")+"%NAME%);\n",i+=this.generateCodeUniProp(t,e),i=G.Utils.replaceAll(i,"%NAME%",this.getObjName(t)),this.injectObjPropToString(t,i)},G.ModifyCodeGenerator.prototype.getObjName=function(t){if(t.___LABEL)return t.___LABEL;var e=prompt("enter name");return t.___LABEL=e,e},G.ModifyCodeGenerator.prototype.generateCodeUniProp=function(t,e){var i="";return e=e?e+".":"",1===t.scale.x&&1===t.scale.y||(i+=e+"%NAME%.scale.setTo(^scale.x^, ^scale.y^);\n"),0!==t.angle&&(i+=e+"%NAME%.angle = ^angle^;\n"),1!==t.alpha&&(i+=e+"%NAME%.alpha = ^alpha^;\n"),t.fixedToCamera&&(i+=e+"%NAME%.fixedToCamera = true;\n",i+=e+"%NAME%.cameraOffset.setTo(^cameraOffset.x^,^cameraOffset.y^);\n"),i},G.ModifyCodeGenerator.prototype.injectObjPropToString=function(t,e){for(;;){var i=e.indexOf("^"),s=e.indexOf("^",i+1);if(-1==i)break;var a=e.slice(i,s+1),r=e.slice(i+1,s);e=e.replace(a,G.Utils.getObjProp(t,r))}return e},G.ModifyInputBlocked=function(){Phaser.Graphics.call(this,game,0,0),this.beginFill(16711680,1e-4),this.drawRect(0,0,5e3,4e3),this.inputEnabled=!0,this.events.onInputDown.add((function(){})),this.fixedToCamera=!0},G.ModifyInputBlocked.prototype=Object.create(Phaser.Graphics.prototype),G.ModifyObjectFactory=function(t){G.Utils.injectCSS(this.cssClasses.join("\n")),this.modify=t,this.mainDiv=document.createElement("div"),this.domUl=document.createElement("ul"),this.domUl.className="modifyOFul",this.mainDiv.appendChild(this.domUl),this.addLiButtons([["+GROUP",this.addGroup],["+IMG",this.addImage],["+OneLineTXT",this.addOneLineText],["+MulitLineTXT",this.addMultiLineText],["+BTN",this.addButton],["-REMOVE",this.modify.removeObject],["EXPORT LVLOBJ STR",this.modify.exportLvlAsString]]),this.defaultNewObjectsNames=!0,this.onObjectAdded=new Phaser.Signal},G.ModifyObjectFactory.prototype.cssClasses=[".modifyOFul {padding: 0px; margin: 0px;}",".modifyOFli {display: inline; list-style-type: none;}"],G.ModifyObjectFactory.prototype.addLiButtons=function(t){t.forEach((function(t){var e=this.createLiButton(t);this.domUl.appendChild(e)}),this)},G.ModifyObjectFactory.prototype.createLiButton=function(t){var e=document.createElement("li");e.className="modifyOFli";var i=document.createElement("button");return i.innerHTML=t[0],i.onclick=t[1].bind(this),e.appendChild(i),e},G.ModifyObjectFactory.prototype.addToGroup=function(t,e){var i;t!=game.world&&t!=game.state.getCurrentState()||(t=game.world,e.x=game.camera.x+.5*game.width,e.y=game.camera.y+.5*game.height),t.add?t.add(e):t.addChild&&t.addChild(e);var s=this.modify.currentLevel;(i=this.defaultNewObjectsNames?"child_"+s.children.length:prompt("Enter object name"))&&(e.___LABEL=i,t==game.world?game.state.getCurrentState()[i]=e:t[i]=e),this.onObjectAdded.dispatch(e)},G.ModifyObjectFactory.prototype.addGroup=function(){var t=this.modify.currentLevel,e=game.make.group();return e.___NEWOBJECT=!0,this.addToGroup(t,e),e},G.ModifyObjectFactory.prototype.addImage=function(){var t=this.modify.currentLevel,e=new G.Image(0,0,"__missing",.5,null);return e.___NEWOBJECT=!0,this.addToGroup(t,e),e},G.ModifyObjectFactory.prototype.addButton=function(){var t=this.modify.currentLevel,e=new G.Button(0,0,"__missing",(function(){}),this);return e.___NEWOBJECT=!0,this.addToGroup(t,e),e},G.ModifyObjectFactory.prototype.addOneLineText=function(){var t=this.modify.currentLevel,e=Object.keys(game.cache._cache.bitmapFont),i=new G.OneLineText(0,0,e[0],"TEXT",50,300,.5,.5);return i.cacheAsBitmap=!1,this.addToGroup(t,i),i},G.ModifyObjectFactory.prototype.addMultiLineText=function(){var t=this.modify.currentLevel,e=Object.keys(game.cache._cache.bitmapFont),i=new G.MultiLineText(0,0,e[0],"TEXT",50,300,300,"center",.5,.5);return i.cacheAsBitmap=!1,this.addToGroup(t,i),i},G.ModifyAnimationEditor=function(t){Phaser.Group.call(this,game),this.modify=G.Modify.instance,this.tl=new G.ModifyAnimationTL,this.tl.x=100,this.add(this.tl),this.fw=new G.ModifyAnimationFrameWindow,this.fw.x=-250,this.add(this.fw),this.tl.onFrameSelected.add(this.fw.refresh,this.fw),this.fw.onChange.add((function(t,e){this.tl.redrawTl(),t.updateAnimation(e)}),this),this.tl.changeTlPxWidth(800),this.visible=!1,this.modify.onLevelObjChange.add((function(){var t=this.modify.getCurrentLevelObject();t.ANIMATIONELEMENT?this.open(t):this.close()}),this)},G.ModifyAnimationEditor.prototype=Object.create(Phaser.Group.prototype),G.ModifyAnimationEditor.prototype.open=function(t){this.visible=!0,this.tl.open(t),this.fw.refresh(t,0)},G.ModifyAnimationEditor.prototype.close=function(){this.visible=!1},G.ModifyAnimationFrameGroup=function(t,e){Phaser.Group.call(this,game),this.x=t,this.y=e,this.active=!1,this.currentObj=null,this.currentKeyFrame=null,this.currentFrameNr=0,this.style={font:"Verdana",fontSize:13,fontWeight:"bold"},this.onOffBtn=game.add.text(0,0,"off",this.style),this.onOffBtn.inputEnabled=!0,this.onOffBtn.hitArea=new Phaser.Rectangle(0,0,this.onOffBtn.width,this.onOffBtn.height),this.onOffBtn.events.onInputDown.add(this.onOff,this),this.propValue=game.add.text(280,0,"---",this.style),this.propValue.anchor.x=1,this.addMultiple([this.onOffBtn,this.propValue]),this.onChange=new Phaser.Signal},G.ModifyAnimationFrameGroup.prototype=Object.create(Phaser.Group.prototype),G.ModifyAnimationFrameGroup.prototype.onOff=function(){if(0!=this.currentFrameNr){if(this.active){this.active=!1,this.alpha=.5,this.onOffBtn.setText("off");var t=this.currentObj.frameTL.indexOf(this.currentKeyFrame);this.currentObj.frameTL.splice(t,1)}else{this.active=!0,this.alpha=1,this.onOffBtn.setText("on");for(var e={f:this.currentFrameNr,v:G.Utils.getObjProp(this.currentObj.SPR,"frameName")},i=this.currentFrameNr,s=this.currentObj.frameTL,a=0,r=0;r<s.length;r++)s[r].f<i&&a++;s.splice(a,0,e)}this.refresh(this.currentObj,this.currentFrameNr)}},G.ModifyAnimationFrameGroup.prototype.update=function(){if(this.currentObj.playing)this.refresh(this.currentObj,this.currentObj.frameCounter);else if(this.currentObj){var t=G.Utils.getObjProp(this.currentObj.SPR,"frameName")||G.Utils.getObjProp(this.currentObj.SPR,"key");t.indexOf("/")&&(t=t.slice(t.lastIndexOf("/")+1)),null==this.currentKeyFrame&&(t!=this.valAtRefresh?(this.propValue.fill="red",this.alpha=1):(this.alpha=.5,this.propValue.fill="black")),!this.currentObj.playing&&this.currentKeyFrame&&this.currentKeyFrame.v!==t&&(this.currentKeyFrame.v=t),this.propValue.setText(t)}else this.propValue.setText("---")},G.ModifyAnimationFrameGroup.prototype.refresh=function(t,e){this.currentObj=t,this.currentObj.currentAnimationName&&(this.currentKeyFrame=t.getKeyFrameAt(t.frameTL,e),this.currentFrameNr=e,this.propValue.fill="black",this.valAtRefresh=G.Utils.getObjProp(this.currentObj.SPR,"frameName"),this.currentKeyFrame?(this.active=!0,this.alpha=1,this.onOffBtn.setText("on"),this.propValue.setText(this.currentObj.getTextureFrameValue(t.frameTL,e)||"---")):(this.onOffBtn.setText("off"),this.active=!1,this.alpha=.5,this.propValue.setText("---")))},G.ModifyAnimationFrameWindow=function(){Phaser.Group.call(this,game),this.onChange=new Phaser.Signal,this.gfx=game.add.graphics(),this.gfx.inputEnabled=!0,this.add(this.gfx),this.gfx.beginFill(14540253),this.gfx.drawRect(0,0,300,500),this.style={font:"Verdana",fontSize:13,fontWeight:"bold"},this.currentAnimationTxt=game.add.text(10,10,"",this.style),this.add(this.currentAnimationTxt),this.currentAnimationTxt.inputEnabled=!0,this.currentAnimationTxt.events.onInputDown.add((function(){this.changeAnimation()}),this),this.addAnimationBtn=game.add.text(170,10,"+",this.style),this.add(this.addAnimationBtn),this.addAnimationBtn.inputEnabled=!0,this.addAnimationBtn.events.onInputDown.add(this.addNewAnimation,this),this.renameAnimationBtn=game.add.text(200,10,"R",this.style),this.add(this.renameAnimationBtn),this.renameAnimationBtn.inputEnabled=!0,this.renameAnimationBtn.events.onInputDown.add(this.renameAnimation,this),this.removeAnimationBtn=game.add.text(230,10,"-",this.style),this.add(this.removeAnimationBtn),this.removeAnimationBtn.inputEnabled=!0,this.removeAnimationBtn.events.onInputDown.add(this.removeAnimation,this),this.frameNr=game.add.text(290,10,"",this.style),this.frameNr.anchor.x=1,this.add(this.frameNr),this.frameGroup=new G.ModifyAnimationFrameGroup(10,50),this.add(this.frameGroup),this.propGroups=[new G.ModifyAnimationPropGroup(10,70,"alpha","#43c9e7"),new G.ModifyAnimationPropGroup(10,90,"x","#e08040"),new G.ModifyAnimationPropGroup(10,110,"y","#d8ff30"),new G.ModifyAnimationPropGroup(10,130,"angle","#072ba0"),new G.ModifyAnimationPropGroup(10,150,"scale.x","#6c0674"),new G.ModifyAnimationPropGroup(10,170,"scale.y","#d34ed9"),new G.ModifyAnimationPropGroup(10,190,"anchor.x"),new G.ModifyAnimationPropGroup(10,210,"anchor.y")],this.propGroups.forEach((function(t){t.onChange.add(this.onChange.dispatch,this.onChange)}),this),this.addMultiple(this.propGroups)},G.ModifyAnimationFrameWindow.prototype=Object.create(Phaser.Group.prototype),G.ModifyAnimationFrameWindow.prototype.update=function(){this.currentObj&&(this.propGroups.forEach((function(t){t.update()}),this),this.frameGroup.update())},G.ModifyAnimationFrameWindow.prototype.loadFrame=function(t,e){this.currentObj=t,this.labelObjTxt.setText(t.LABEL||"obj"),this.frameNr.setText(e)},G.ModifyAnimationFrameWindow.prototype.refresh=function(t,e){this.propGroups.forEach((function(i){i.refresh(t,e)})),this.frameGroup.refresh(t,e),this.frameNr.setText(e),this.currentFrameNr=e,this.currentObj=t,this.currentAnimationTxt.setText(this.currentObj.currentAnimationName||"------")},G.ModifyAnimationFrameWindow.prototype.changeAnimation=function(t){if(this.currentObj){var e=Object.keys(this.currentObj.dataAnimation);if(t)this.currentObj.changeAnimationData(t);else if(this.currentObj.currentAnimationName){var i=(e.indexOf(this.currentObj.currentAnimationName)+1)%e.length;this.currentObj.changeAnimationData(e[i])}else this.currentObj.changeAnimationData(e[0]);this.refresh(this.currentObj,this.currentFrameNr),this.onChange.dispatch(this.currentObj,0)}},G.ModifyAnimationFrameWindow.prototype.addNewAnimation=function(){if(this.currentObj){for(var t=Object.keys(this.currentObj.dataAnimation),e="newAnimation",i=0;-1!==t.indexOf(e+i);)i++;this.currentObj.dataAnimation[e+i]={eventTL:[],frameTL:[{f:0,v:null}],propTLS:{alpha:[{f:0,v:1}],x:[{f:0,v:0}],y:[{f:0,v:0}],angle:[{f:0,v:0}],"scale.x":[{f:0,v:1}],"scale.y":[{f:0,v:1}],"anchor.x":[{f:0,v:.5}],"anchor.y":[{f:0,v:.5}]}},this.changeAnimation(e+i)}},G.ModifyAnimationFrameWindow.prototype.removeAnimation=function(){this.currentObj&&this.currentObj.currentAnimationName&&1!=Object.keys(this.currentObj.dataAnimation).length&&confirm("delete "+this.currentObj.currentAnimationName+"?")&&(delete this.currentObj.dataAnimation[this.currentObj.currentAnimationName],this.changeAnimation())},G.ModifyAnimationFrameWindow.prototype.renameAnimation=function(){this.currentObj&&this.currentObj.currentAnimationName&&G.Modify.instance.domLayer.openInputDiv(this.currentObj.currentAnimationName,this.currentObj.currentAnimationName,(function(t){var e=this.currentObj.currentAnimationName,i=this.currentObj.currentAnimationData;delete this.currentObj.dataAnimation[e],this.currentObj.dataAnimation[t]=i,this.changeAnimation(t)}),this,"string")},G.ModifyAnimationPropGroup=function(t,e,i,s){Phaser.Group.call(this,game),this.x=t,this.y=e,this.propKey=i,this.active=!1,this.currentObj=null,this.currentKeyFrame=null,this.currentFrameNr=0,this.style={font:"Verdana",fontSize:13,fontWeight:"bold"},this.easings=["Back","Bounce","Circular","Cubic","Elastic","Exponential","Linear","Quadratic","Quartic","Quintic","Sinusoidal"],this.onOffBtn=game.add.text(0,0,"off",this.style),this.onOffBtn.inputEnabled=!0,this.onOffBtn.hitArea=new Phaser.Rectangle(0,0,this.onOffBtn.width,this.onOffBtn.height),this.onOffBtn.events.onInputDown.add(this.onOff,this),this.label=game.add.text(30,0,i,this.style),s&&this.label.addColor(s,0),this.easingLabel0=game.add.text(120,0,"",this.style),this.easingLabel0.inputEnabled=!0,this.easingLabel0.hitArea=new Phaser.Rectangle(0,0,80,this.easingLabel0.height),this.easingLabel0.events.onInputDown.add(this.changeEasing0,this),this.easingLabel1=game.add.text(200,0,"",this.style),this.easingLabel1.inputEnabled=!0,this.easingLabel1.hitArea=new Phaser.Rectangle(0,0,50,this.easingLabel1.height),this.easingLabel1.events.onInputDown.add(this.changeEasing1,this),this.propValue=game.add.text(280,0,"",this.style),this.propValue.anchor.x=1,this.addMultiple([this.label,this.onOffBtn,this.easingLabel0,this.easingLabel1,this.propValue]),this.onChange=new Phaser.Signal},G.ModifyAnimationPropGroup.prototype=Object.create(Phaser.Group.prototype),G.ModifyAnimationPropGroup.prototype.onOff=function(){if(0!=this.currentFrameNr){if(this.active){this.active=!1,this.alpha=.5,this.onOffBtn.setText("off");var t=this.currentObj.propTLS[this.propKey].indexOf(this.currentKeyFrame);this.currentObj.propTLS[this.propKey].splice(t,1)}else{this.active=!0,this.alpha=1,this.onOffBtn.setText("on");for(var e={f:this.currentFrameNr,v:G.Utils.getObjProp(this.currentObj.SPR,this.propKey)},i=this.currentFrameNr,s=this.currentObj.propTLS[this.propKey],a=0,r=0;r<s.length;r++)s[r].f<i&&a++;s.splice(a,0,e)}this.refresh(this.currentObj,this.currentFrameNr)}},G.ModifyAnimationPropGroup.prototype.update=function(){if(this.currentObj.playing)this.refresh(this.currentObj,this.currentObj.frameCounter);else if(this.currentObj){var t=G.Utils.getObjProp(this.currentObj.SPR,this.propKey);null==this.currentKeyFrame&&(t!=this.valAtRefresh?(this.propValue.fill="red",this.alpha=1):(this.alpha=.5,this.propValue.fill="black")),!this.currentObj.playing&&this.currentKeyFrame&&this.currentKeyFrame.v!==t&&(this.currentKeyFrame.v=t),this.propValue.setText(t.toFixed(1))}else this.propValue.setText("---")},G.ModifyAnimationPropGroup.prototype.changeEasing0=function(){if(this.currentKeyFrame){if(this.currentKeyFrame.e){var t=this.easings.indexOf(this.currentKeyFrame.e[0]);if(t+1==this.easings.length)this.currentKeyFrame.e=!1,this.easingLabel0.setText("--"),this.easingLabel1.setText("--");else{this.currentKeyFrame.e[0]=this.easings[t+1],this.easingLabel0.setText(this.easings[t+1]);var e=this.currentKeyFrame.e[1];Phaser.Easing[this.easings[t+1]][e]||(Phaser.Easing[this.easings[t+1]].None?this.currentKeyFrame.e[1]="None":Phaser.Easing[this.easings[t+1]].In&&(this.currentKeyFrame.e[1]="In")),this.easingLabel1.setText(this.currentKeyFrame.e[1])}}else this.currentKeyFrame.e=["Back","In"],this.easingLabel0.setText("Back"),this.easingLabel1.setText("In");this.onChange.dispatch(this.currentObj,this.currentFrameNr)}},G.ModifyAnimationPropGroup.prototype.changeEasing1=function(){if(this.currentKeyFrame&&this.currentKeyFrame.e){var t=this.currentKeyFrame.e[1],e=Object.keys(Phaser.Easing[this.currentKeyFrame.e[0]]),i=e.indexOf(t);this.currentKeyFrame.e[1]=e[(i+1)%e.length],this.easingLabel1.setText(this.currentKeyFrame.e[1]),this.onChange.dispatch(this.currentObj,this.currentFrameNr)}},G.ModifyAnimationPropGroup.prototype.refresh=function(t,e){this.currentObj=t,this.currentObj.currentAnimationName&&(this.currentKeyFrame=t.getKeyFrameAt(t.propTLS[this.propKey],e),this.currentFrameNr=e,this.propValue.fill="black",this.valAtRefresh=G.Utils.getObjProp(this.currentObj.SPR,this.propKey),this.currentKeyFrame?(this.active=!0,this.alpha=1,this.onOffBtn.setText("on"),this.currentKeyFrame.e?(this.easingLabel0.setText(this.currentKeyFrame.e[0]),this.easingLabel1.setText(this.currentKeyFrame.e[1])):(this.easingLabel0.setText("---"),this.easingLabel1.setText("---"))):(this.onOffBtn.setText("off"),this.active=!1,this.alpha=.5,this.easingLabel0.setText("---"),this.easingLabel1.setText("---")))},G.ModifyAnimationTL=function(){Phaser.Group.call(this,game),this.gfx=game.add.graphics(),this.add(this.gfx),this.tlGfx=game.add.graphics(),this.tlGfx.inputEnabled=!0,this.pointerPressed=!1,this.pointerStartFrame=0,this.tlGfx.events.onInputDown.add(this.onDown,this),this.tlGfx.events.onInputUp.add(this.onUp,this),this.add(this.tlGfx),this.visible=!1,this.currentObj=null,this.frameWidth=10,this.frameHeight=50,this.tlPxWidth=400,this.tlFrameLength=this.tlPxWidth/this.frameWidth,this.selectedFrame=null,this.frameOffset=0,this.cursors=game.input.keyboard.createCursorKeys(),this.cursors.left.onDown.add((function(){this.frameOffset--,this.redrawTl()}),this),this.cursors.right.onDown.add((function(){this.frameOffset++,this.redrawTl()}),this),this.onFrameSelected=new Phaser.Signal},G.ModifyAnimationTL.prototype=Object.create(Phaser.Group.prototype),G.ModifyAnimationTL.prototype.colors=[9904692,35664,4442599,14712896,14221104,469920,7079540,13848281],G.ModifyAnimationTL.prototype.update=function(){if(this.pointerPressed){var t=game.input.activePointer,e=Math.floor((t.x-this.tlGfx.worldPosition.x)/this.frameWidth);if(e!==this.pointerStartFrame){var i=this.pointerStartFrame-e;this.frameOffset+=i,this.pointerStartFrame=e,this.frameOffset=Math.max(0,this.frameOffset),this.redrawTl()}}},G.ModifyAnimationTL.prototype.changeFrameWidth=function(t){this.frameWidth=t,this.tlFrameLength=Math.floor(this.tlPxWidth/this.frameWidth),this.redrawTl()},G.ModifyAnimationTL.prototype.changeTlPxWidth=function(t){this.tlPxWidth=t,this.tlFrameLength=Math.floor(this.tlPxWidth/this.frameWidth),this.redrawTl()},G.ModifyAnimationTL.prototype.open=function(t){this.currentObj=t,this.visible=!0,this.redrawTl(),this.currentObj.stop()},G.ModifyAnimationTL.prototype.onDown=function(t,e){this.currentObj.pause();var i=Math.floor((e.x-this.tlGfx.worldPosition.x)/this.frameWidth);this.pointerStartFrame=i,this.pointerPressed=!0},G.ModifyAnimationTL.prototype.onUp=function(t,e){var i=Math.floor((e.x-this.tlGfx.worldPosition.x)/this.frameWidth);this.pointerStartFrame==i&&(this.selectFrame(i),this.pointerStar),this.pointerPressed=!1},G.ModifyAnimationTL.prototype.selectFrame=function(t){this.selectedFrame=t+this.frameOffset,this.currentObj.updateAnimation(this.selectedFrame),this.redrawTl(),this.onFrameSelected.dispatch(this.currentObj,this.selectedFrame)},G.ModifyAnimationTL.prototype.redrawTl=function(){if(this.tlGfx.clear(),this.currentObj&&this.currentObj.currentAnimationName){this.tlGfx.beginFill(14540253,1),this.tlGfx.drawRect(0,0,this.tlFrameLength*this.frameWidth,this.frameHeight),this.tlGfx.beginFill(10066329,1);for(var t=this.frameOffset;t<this.frameOffset+this.tlFrameLength;t++)this.currentObj.isAnyKeyFrameAt(t)&&(this.tlGfx.lineStyle(1,0,1),this.tlGfx.drawRect(this.frameWidth*t-this.frameOffset*this.frameWidth,0,this.frameWidth,this.frameHeight)),t%60==0&&(this.tlGfx.lineStyle(1,0,.25),this.tlGfx.moveTo(this.frameWidth*t-this.frameOffset*this.frameWidth,0),this.tlGfx.lineTo(this.frameWidth*t-this.frameOffset*this.frameWidth,this.frameHeight));this.tlGfx.lineStyle(0,0,0);for(t=0;t<this.currentObj.eventTL.length;t++){var e=this.currentObj.eventTL[t];this.tlGfx.beginFill(this.colors[0],1),e.f>=this.frameOffset&&e.f<this.frameOffset+this.tlFrameLength&&this.tlGfx.drawRect(this.frameWidth*e.f-this.frameOffset*this.frameWidth,0,this.frameWidth,5)}for(t=0;t<this.currentObj.frameTL.length;t++){e=this.currentObj.frameTL[t];this.tlGfx.beginFill(this.colors[1],1),e.f>=this.frameOffset&&e.f<this.frameOffset+this.tlFrameLength&&this.tlGfx.drawRect(this.frameWidth*e.f-this.frameOffset*this.frameWidth,5,this.frameWidth,5)}for(t=0;t<this.currentObj.propKeys.length;t++)this.drawPropLine(this.currentObj.propTLS[this.currentObj.propKeys[t]],15+5*t,this.colors[2+t]);null!==this.selectedFrame&&this.selectedFrame>=this.frameOffset&&this.selectedFrame<this.frameOffset+this.tlFrameLength&&(this.tlGfx.beginFill(255,.5),this.tlGfx.drawRect(this.frameWidth*this.selectedFrame-this.frameOffset*this.frameWidth,0,this.frameWidth,this.frameHeight))}},G.ModifyAnimationTL.prototype.drawPropLine=function(t,e,i){for(var s,a=.5*this.frameWidth,r=0;r<t.length;r++){var o=t[r];if(s=o.f*this.frameWidth+.5*this.frameWidth-this.frameOffset*this.frameWidth,this.tlGfx.lineStyle(0,0,0),!(o.f<this.frameOffset)){var n=t[r-1];if(n&&n.e&&(this.tlGfx.lineStyle(2,i,1),this.tlGfx.moveTo(0,e),this.tlGfx.lineTo(Math.min(this.tlFrameLength*this.frameWidth,o.f*this.frameWidth-this.frameOffset*this.frameWidth),e)),!(o.f>=this.frameOffset+this.tlFrameLength))if(o.e){if(this.tlGfx.beginFill(i,1),this.tlGfx.drawCircle(s,e,a),t[r+1]){this.tlGfx.lineStyle(2,i,1),this.tlGfx.moveTo(s,e);var h=t[r+1].f*this.frameWidth-this.frameOffset*this.frameWidth;h=Math.min(this.tlFrameLength*this.frameWidth,h),this.tlGfx.lineTo(h,e)}}else this.tlGfx.endFill(),this.tlGfx.lineStyle(2,i,1),this.tlGfx.drawCircle(s,e,a-2)}}},G.ModifyDOMAnimationProp=function(t,e){var i=this;this.mainDiv=document.createElement("div"),this.onOffBtn=document.createElement("button"),this.onOffBtn.innerHTML="ON",this.mainDiv.appendChild(this.onOffBtn),this.label=document.createElement("span"),this.label.innerHTML=t,this.label.style.color=e,this.label.style.fontWeight="bold",this.label.style.width="60px",this.label.style.display="inline-block",this.mainDiv.appendChild(this.label),this.easingTypeList=document.createElement("select"),this.easings=["---","Back","Bounce","Circular","Cubic","Elastic","Exponential","Linear","Quadratic","Quartic","Quintic","Sinusoidal"],this.easings.forEach((function(t){var e=document.createElement("option");e.setAttribute("value",t),e.innerHTML=t,this.easingTypeList.appendChild(e)}),this),this.mainDiv.appendChild(this.easingTypeList),this.easingTypeList.onchange=function(){i.changeEasing(this.value)},this.easingSubtypeList=document.createElement("select"),this.easingSubtypeList.onchange=function(){i.changeEasingSubtype(this.value)},this.mainDiv.appendChild(this.easingSubtypeList),this.propValue=document.createElement("span"),this.propValue.innerHTML="--",this.propValue.style.display="inline-block",this.mainDiv.appendChild(this.propValue),this.active=!1,this.mainDiv.style.position="fixed",this.mainDiv.style.top="0",this.mainDiv.style.left="100px",document.body.appendChild(this.mainDiv),this.currentKeyFrame={e:[]}},G.ModifyDOMAnimationProp.prototype.onOff=function(){if(this.active){this.active=!1,this.onOffBtn.innerHTML="OFF";var t=this.currentObj.propTLS[this.propKey].indexOf(this.currentKeyFrame);this.currentObj.propTLS[this.propKey].splice(t,1)}else{this.active=!0,this.onOffBtn.innerHTML="ON";this.currentFrameNr,G.Utils.getObjProp(this.currentObj.SPR,this.propKey);for(var e=this.currentFrameNr,i=this.currentObj.propTLS[this.propKey],s=0;s<i.length;s++)i[s].f<e&&0}},G.ModifyDOMAnimationProp.prototype.changeEasing=function(t){if(this.currentKeyFrame){if("---"===t)return this.currentKeyFrame.e=[],this.refreshSubtypeList(),void this.selectFromList(this.easingSubtypeList,"---");this.currentKeyFrame.e[0]=t,this.selectFromList(this.easingTypeList,t);var e=this.currentKeyFrame.e[1];this.refreshSubtypeList(),Phaser.Easing[t][e]?this.changeEasingSubtype(e):this.changeEasingSubtype(Object.keys(Phaser.Easing[t])[0])}},G.ModifyDOMAnimationProp.prototype.changeEasingSubtype=function(t){this.selectFromList(this.easingSubtypeList,t),"---"!==t&&(this.currentKeyFrame.e[1]=t)},G.ModifyDOMAnimationProp.prototype.refreshSubtypeList=function(){var t=Phaser.Easing[this.easingTypeList.value];if(this.easingSubtypeList.innerHTML="",t)for(prop in t){var e;(e=document.createElement("option")).setAttribute("value",prop),e.innerHTML=prop,this.easingSubtypeList.appendChild(e)}else(e=document.createElement("option")).setAttribute("value","---"),e.innerHTML="---",this.easingSubtypeList.appendChild(e)},G.ModifyDOMAnimationProp.prototype.selectFromList=function(t,e){for(var i=0;i<t.options.length;i++)if(t.options[i].value===e){t.selectedIndex=i;break}},G.ModifyDOMButtonGroup=function(t){this.modify=t,this.posBtn=document.createElement("div"),this.posBtn.style.width="10px",this.posBtn.style.height="10px",this.posBtn.style.position="fixed",this.posBtn.style.backgroundColor="red",this.posBtn.draggable="true",this.posBtn.ondrag=this.posDragHandler.bind(this),this.posBtn.style.border="1px solid",document.body.appendChild(this.posBtn),this.scaleBtn=document.createElement("div"),this.scaleBtn.style.width="10px",this.scaleBtn.style.height="10px",this.scaleBtn.style.position="fixed",this.scaleBtn.style.backgroundColor="green",this.scaleBtn.draggable="true",this.scaleBtn.onclick=function(){},this.scaleBtn.ondrag=this.scaleDragHandler.bind(this),this.scaleBtn.ondragstart=function(){},this.scaleBtn.style.border="1px solid",document.body.appendChild(this.scaleBtn),this.angleBtn=document.createElement("div"),this.angleBtn.style.width="10px",this.angleBtn.style.height="10px",this.angleBtn.style.position="fixed",this.angleBtn.style.backgroundColor="blue",this.angleBtn.draggable="true",this.angleBtn.ondrag=this.angleDragHandler.bind(this),this.angleBtn.style.border="1px solid",document.body.appendChild(this.angleBtn),this.bindedUpdateTransformButtons=this.updateTransformButtons.bind(this),window.requestAnimationFrame(this.bindedUpdateTransformButtons)},G.ModifyDOMButtonGroup.prototype.updateTransformButtons=function(){if(!this.dragging){var t=this.modify.currentObject;if(t){var e=t.getBounds();this.posBtn.style.display="block",this.posBtn.style.left=G.Utils.toClientX(t.worldPosition.x)+"px",this.posBtn.style.top=G.Utils.toClientY(t.worldPosition.y)+"px",this.scaleBtn.style.display="block";var i=t.getLocalBounds(),s=i.x/i.width*-1,a=i.y/i.height*-1,r=(e=t.getBounds()).x+e.width*s+e.width*(1-s)*Math.sign(t.worldScale.x),o=e.y+e.height*a+e.height*(1-a)*Math.sign(t.worldScale.y);this.scaleBtn.style.left=G.Utils.toClientX(r)+"px",this.scaleBtn.style.top=G.Utils.toClientY(o)+"px";var n=Math.sin(t.worldRotation),h=25*Math.cos(t.worldRotation),l=25*n;this.angleBtn.style.display="block",this.angleBtn.style.left=G.Utils.toClientX(t.worldPosition.x+h)+"px",this.angleBtn.style.top=G.Utils.toClientY(t.worldPosition.y+l)+"px"}else this.posBtn.style.display="none",this.scaleBtn.style.display="none"}window.requestAnimationFrame(this.bindedUpdateTransformButtons)},G.ModifyDOMButtonGroup.prototype.posDragHandler=function(t){if(this.modify.currentObject){if(0==t.pageX&&0==t.pageY)return;this.modify.moveCurrentObjectToWorldPos(G.Utils.clientXToWorldX(t.clientX),G.Utils.clientYToWorldY(t.clientY))}},G.ModifyDOMButtonGroup.prototype.scaleDragHandler=function(t){var e=this.modify.currentObject;if(e){if(!this.prevScalePosition)return void(this.prevScalePosition={x:t.clientX,y:t.clientY});if(0==t.pageX&&0==t.pageY)return this.prevScalePosition=!1,t.shiftKey&&(e.scale.y=e.scale.x),this.modify.modifyCurrentObjProp("width",Math.floor(e.width)),void this.modify.modifyCurrentObjProp("height",Math.floor(e.height));var i=t.clientX-this.prevScalePosition.x,s=t.clientY-this.prevScalePosition.y;this.modify.modifyCurrentObjProp("width",e.width+i),this.modify.modifyCurrentObjProp("height",e.height+s),t.shiftKey&&(e.scale.y=e.scale.x,this.modify.modifyCurrentObjProp("width",Math.floor(e.width)),this.modify.modifyCurrentObjProp("height",Math.floor(e.height))),this.prevScalePosition.x=t.clientX,this.prevScalePosition.y=t.clientY}},G.ModifyDOMButtonGroup.prototype.angleDragHandler=function(t){var e=this.modify.currentObject;if(e){if(!this.prevAnglePosition)return void(this.prevAnglePosition={x:t.clientX,y:t.clientY});if(0==t.pageX&&0==t.pageY)return void(this.prevAnglePosition=!1);var i=game.math.angleBetween(G.Utils.toClientX(e.worldPosition.x),G.Utils.toClientY(e.worldPosition.y),t.clientX,t.clientY)-e.parent.worldRotation;this.modify.modifyCurrentObjProp("rotation",i),this.prevAnglePosition.x=t.clientX,this.prevAnglePosition.y=t.clientY}},G.ModifyDOMButtonGroup.prototype.destroy=function(){this.scaleBtn.remove(),this.posBtn.remove()},G.ModifyDOMChildList=function(t){G.Utils.injectCSS(this.cssClasses.join("\n")),this.modify=t,this.mainDiv=document.createElement("div"),this.mainDiv.className="modifyCLmainDiv",document.body.append(this.mainDiv),this.goToTopBtn=document.createElement("button"),this.goToTopBtn.className="modifyCLButton modifyCLButtonLevel",this.goToTopBtn.innerHTML="T",this.goToTopBtn.onclick=function(){t.currentLevelGoUp()},this.levelSpan=document.createElement("span"),this.levelSpan.className="modifyCLlevelSpan",this.mainDiv.appendChild(this.goToTopBtn),this.mainDiv.appendChild(this.levelSpan),this.list=document.createElement("ul"),this.list.style.display="block",this.list.className="modifyCLul",this.mainDiv.appendChild(this.list),this.modify.onLevelObjChange.add(this.refreshList,this),this.modify.onCurrentObjChange.add(this.highlightCurrent,this),this.modify.onObjDestroy.add(this.refreshList,this)},G.ModifyDOMChildList.prototype.cssClasses=[".modifyCLlevelSpan {font-weight: bold; font-size: 0.7em;}",".modifyCLmainDiv {font-family: verdana; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}",".modifyCLButton {pointer-events: all; margin: 0; border: 0; background-color: rgba(200,200,200,0.5); font-weight: bold; font-size: 0.7em;}",".modifyCLButtonSelection {background-color: rgba(255,255,255,1)}",".modifyCLButtonLevel {background-color: rgba(0,0,200,0.5)}",".modifyCLButtonLevelHasChildren {background-color: rgba(0,200,0,0.5)}",".modifyCLli {margin: 0; padding: 0;}",".modifyCLul {margin: 0; margin-top: 10px; padding: 0; line-style: none;}"],G.ModifyDOMChildList.prototype.onCurrentObjChange=function(){},G.ModifyDOMChildList.prototype.toggleList=function(){this.list.style.display="block"==this.list.style.display?"none":"block"},G.ModifyDOMChildList.prototype.highlightCurrent=function(){for(var t=0;t<this.list.children.length;t++){var e=this.list.children[t].children[0];this.modify.currentObject==e.childData.obj?e.className="modifyCLButton modifyCLButtonSelection":e.className="modifyCLButton"}},G.ModifyDOMChildList.prototype.refreshList=function(t){var e=this.modify.getChildrenData(t);this.levelSpan.innerHTML=this.modify.getChildLabel(t),this.list.innerHTML="",e.forEach((function(t){var e=this.createChildLi(t);this.list.appendChild(e)}),this),this.highlightCurrent()},G.ModifyDOMChildList.prototype.createChildLi=function(t){var e=this.modify,i=document.createElement("li");i.className="modifyCLli";var s=document.createElement("button");if(s.className="modifyCLButton",s.childData=t,s.onclick=function(){e.changeCurrentObject(this.childData.obj)},i.appendChild(s),s.innerHTML=t.label,t.openable){var a=document.createElement("button");t.hasChildren?a.className="modifyCLButton modifyCLButtonLevelHasChildren":a.className="modifyCLButton modifyCLButtonLevel",a.childData=t,a.onclick=function(){e.changeLevelObject(this.childData.obj)},a.innerHTML="+",i.appendChild(a)}return i},G.ModifyDOMFrameSelector=function(){G.Utils.injectCSS(this.css.join("\n"));var t=this;this.mainDiv=document.createElement("div"),this.mainDiv.className="mDOMfsmain",this.mainDiv.style.backgroundColor="gray",document.body.appendChild(this.mainDiv),this.selectList=document.createElement("select"),this.mainDiv.appendChild(this.selectList),this.plusBtn=document.createElement("button"),this.plusBtn.innerHTML="+",this.plusBtn.onclick=function(){t.changeImgBtnsSize(10)},this.mainDiv.appendChild(this.plusBtn),this.minusBtn=document.createElement("button"),this.minusBtn.innerHTML="-",this.minusBtn.onclick=function(){t.changeImgBtnsSize(-10)},this.mainDiv.appendChild(this.minusBtn),this.closeBtn=document.createElement("button"),this.closeBtn.innerHTML="X",this.closeBtn.onclick=function(){t.close()},this.mainDiv.appendChild(this.closeBtn),this.pageContainer=document.createElement("div"),this.pageContainer.className="mDOMpageContainer",this.mainDiv.appendChild(this.pageContainer),this.atlasPages=[],this.selectList.onchange=function(e){t.selectPage(this.value)},this.loadAtlases(),this.selectPage("IMAGES"),this.close(),this.onFrameClicked=new Phaser.Signal},G.ModifyDOMFrameSelector.prototype.css=[".mDOMfsmain {position: fixed; top: 0; right: 0; height: 100%; width: 210px;}",".mDOMpageContainer {height: 95%; overflow-y: scroll;}",".mDOMpageContainer::-webkit-scrollbar {width: 5px;}",".mDOMpageContainer::-webkit-scrollbar-track {-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);}",".mDOMpageContainer::-webkit-scrollbar-thumb {background-color: darkgrey; outline: 1px solid slategray;}"],G.ModifyDOMFrameSelector.prototype.toggle=function(){this.mainDiv.style.display="block"==this.mainDiv.style.display?"none":"block"},G.ModifyDOMFrameSelector.prototype.open=function(){this.mainDiv.style.display="block"},G.ModifyDOMFrameSelector.prototype.close=function(){this.mainDiv.style.display="none"},G.ModifyDOMFrameSelector.prototype.destroy=function(){this.mainDiv.remove()},G.ModifyDOMFrameSelector.prototype.changeImgBtnsSize=function(t){this.atlasPages.forEach((function(e){e.imgBtns.forEach((function(e){var i=parseInt(e.style.width),s=i+t>30?i+t:30;e.style.width=s+"px",e.style.height=s+"px"}))}))},G.ModifyDOMFrameSelector.prototype.selectPage=function(t){this.atlasPages.forEach((function(e){e.style.display=e.atlasName===t?"block":"none"}))},G.ModifyDOMFrameSelector.prototype.loadAtlases=function(){var t=game.cache._cache.image;for(prop in this.makeAtlasPage("IMAGES"),t)"_"==prop[0]&&"_"==prop[1]||t[prop].frame||this.makeAtlasPage(prop)},G.ModifyDOMFrameSelector.prototype.makeAtlasPage=function(t){var e=document.createElement("option");e.setAttribute("value",t),e.innerHTML=t,this.selectList.appendChild(e);var i,s=document.createElement("div");if(s.imgBtns=[],s.atlasName=t,"IMAGES"==t){i={};var a=game.cache._cache.image;for(imgKey in a)0!=imgKey.indexOf("__")&&a[imgKey].frame&&(i[imgKey]=!0)}else i=game.cache.getFrameData(t)._frameNames;for(img in i){var r=this.makeImageBtn(img);s.imgBtns.push(r),s.appendChild(r)}this.pageContainer.appendChild(s),this.atlasPages.push(s)},G.ModifyDOMFrameSelector.prototype.makeImageBtn=function(t){var e=this,i=document.createElement("img");return i.src=G.Utils.getImageURI(t),i.style.width="50px",i.style.height="50px",i.imgName=t,i.onclick=function(){e.onFrameClicked.dispatch(this.imgName)},i},G.ModifyDOMLayer=function(t){this.modify=t,this.openElement=null,this.extraDataDiv=this.initExtraDataDiv(),this.inputDataDiv=this.initInputDiv()},G.ModifyDOMLayer.prototype.closeCurrent=function(){game.time.events.add(1,(function(){game.input.enabled=!0})),this.openElement.style.display="none",game.canvas.focus()},G.ModifyDOMLayer.prototype.initExtraDataDiv=function(){var dataInputDiv=document.createElement("DIV");dataInputDiv.style.backgroundColor="green",dataInputDiv.style.left="10%",dataInputDiv.style.top="10%",dataInputDiv.style.position="fixed",dataInputDiv.style.width="80%",dataInputDiv.style.height="80%";var input=document.createElement("TEXTAREA");return input.style.marginTop="2%",input.style.marginLeft="2%",input.style.width="95%",input.style.height="94%",input.style.resize="none",input.onkeydown=function(e){var textarea=e.target,div=dataInputDiv;if(game.time.events.add(1,(function(){try{eval("var tmp = "+textarea.value),"object"===("undefined"==typeof tmp?"undefined":_typeof(tmp))?(div.style.backgroundColor="green",div.proper=!0):(div.style.backgroundColor="red",div.proper=!1)}catch(t){div.style.backgroundColor="red",div.proper=!1}})),9==e.keyCode||9==e.which){e.preventDefault();var s=textarea.selectionStart;textarea.value=textarea.value.substring(0,textarea.selectionStart)+"\t"+textarea.value.substring(textarea.selectionEnd),textarea.selectionEnd=s+1}if(83==e.keyCode&&e.ctrlKey)return e.preventDefault(),div.proper&&(this.closeCurrent(),div.callback.call(div.context,textarea.value)),!1;27==e.keyCode&&this.closeCurrent()}.bind(this),dataInputDiv.textarea=input,dataInputDiv.appendChild(input),document.body.appendChild(dataInputDiv),dataInputDiv.style.display="none",dataInputDiv.style.position="fixed",dataInputDiv},G.ModifyDOMLayer.prototype.openExtraData=function(t,e,i,s){this.openElement=this.extraDataDiv,this.extraDataDiv.style.backgroundColor="green",this.extraDataDiv.callback=i||function(){},this.extraDataDiv.context=s||this,this.extraDataDiv.style.display="block",game.input.enabled=!1,e?"object"===_typeof(e)&&(e=JSON.stringify(e,null,"\t")):e="",this.extraDataDiv.textarea.value=e,game.time.events.add(1,(function(){this.extraDataDiv.textarea.focus()}),this)},G.ModifyDOMLayer.prototype.initInputDiv=function(){var t=document.createElement("DIV");t.style.backgroundColor="gray",t.style.left="30%",t.style.top="10%",t.style.position="fixed",t.style.width="40%",t.style.textAlign="center",t.style.padding="10px",t.style.fontFamily="Verdana";var e=document.createElement("h3"),i=document.createElement("SPAN");i.style.float="right";var s=document.createElement("SPAN");s.style.float="left",e.innerHTML="";var a=document.createElement("INPUT");return a.style.width="90%",a.style.fontSize="25px",a.onkeydown=function(e){var i=e.target,s=t;if(83==e.keyCode&&e.ctrlKey||13==e.keyCode){e.preventDefault();var a=s.filter(i.value);return void 0===a?(s.style.backgroundColor="red",game.time.events.add(50,(function(){s.style.backgroundColor="gray"}))):(this.closeCurrent(),s.callback.call(s.context,a)),!1}27==e.keyCode&&this.closeCurrent()}.bind(this),t.appendChild(e),t.appendChild(a),t.appendChild(i),t.appendChild(s),document.body.appendChild(t),t.span=e,t.textarea=a,t.input=a,t.filterLabel=i,t.initValue=s,t.filters={number:function(t){var e=parseFloat(t);return isNaN(e)?void 0:e},string:function(t){if(0!=t.length)return t},none:function(t){return t}},t.style.display="none",t.style.position="fixed",t},G.ModifyDOMLayer.prototype.openInputDiv=function(t,e,i,s,a){this.inputDataDiv||this.initInputArea(),this.openElement=this.inputDataDiv,this.inputDataDiv.style.display="block",game.input.enabled=!1,this.inputDataDiv.span.innerHTML=t||"",this.inputDataDiv.input.value=e,this.inputDataDiv.callback=i||function(){},this.inputDataDiv.context=s||this,a=a||"none",this.inputDataDiv.filter=this.inputDataDiv.filters[a],this.inputDataDiv.filterLabel.innerHTML=a,this.inputDataDiv.initValue.innerHTML="init val: "+e,game.time.events.add(1,(function(){this.inputDataDiv.input.focus(),this.inputDataDiv.input.select()}),this)},G.ModifyDOMPropButton=function(t,e,i,s,a){this.modify=t,this.domElement=document.createElement("li"),this.domButton=document.createElement("button"),this.domLabel=document.createElement("span"),this.domLabel.innerHTML=e+": ",this.domButton.appendChild(this.domLabel),this.domValue=document.createElement("span"),this.domButton.appendChild(this.domValue),this.domElement.appendChild(this.domButton),"string"==typeof i?this.refreshProp=i.split("."):this.refreshFunc=i,"string"==typeof s?(this.filterProperty=s.slice(0,s.indexOf(":")),this.setProp=s.slice(s.indexOf(":")+1).split("."),this.setFunc=this.openInput):this.setFunc=s,this.postSet=a,this.domButton.onclick=this.setFunc.bind(this)},G.ModifyDOMPropButton.prototype.setFunc=function(){var t=this.modify.getCurrentObject();if(t){var e=this[this.askFunc]();null!==e&&(this.modify.modifyCurrentObjProp(this.refreshProp,e),this.postSet&&this.postSet(t,e))}},G.ModifyDOMPropButton.prototype.openInput=function(){var t=this.modify.getCurrentObject();t&&this.modify.domLayer.openInputDiv(this.modify.getChildLabel(t)+" | "+this.setProp,G.Utils.getObjProp(t,this.setProp),(function(e){this.modify.modifyCurrentObjProp(this.refreshProp,e),this.postSet&&this.postSet(t,e)}),this,this.filterProperty)},G.ModifyDOMPropButton.prototype.refreshFunc=function(t){if(this.domValue.innerHTML="---",t=this.modify.getCurrentObject()){var e=G.Utils.getObjProp(t,this.refreshProp);void 0===e?this.domElement.style.display="none":(this.domElement.style.display="list-item","number"==typeof e&&(e=e.toFixed(2)),this.domValue.innerHTML=e)}else this.domElement.style.display="none"},G.ModifyDOMPropList=function(modify){G.Utils.injectCSS(this.cssClasses.join("\n")),this.modify=modify,this.buttons=[],this.mainDiv=document.createElement("div"),this.mainDiv.className="modifyPLmainDiv",this.list=document.createElement("ul"),this.list.className="modifyPLul",this.mainDiv.appendChild(this.list),this.addButton("x","x","number:x"),this.addButton("y","y","number:y"),this.addButton("width","width","number:width"),this.addButton("height","height","number:height"),this.addButton("scale.x","scale.x","number:scale.x"),this.addButton("scale.y","scale.y","number:scale.y"),this.addButton("angle","angle","number:angle"),this.addButton("alpha","alpha","number:alpha"),this.addButton("visible","visible",(function(){var t=modify.currentObject;modify.modifyCurrentObjProp("visible",!t.visible)})),this.addButton("anchor.x","anchor.x","number:anchor.x"),this.addButton("anchor.y","anchor.y","number:anchor.y"),this.addButton("frame","frameName",(function(){modify.frameSelector.open()})),this.addButton("fontSize","fontSize","number:fontSize",(function(t,e){t.cacheAsBitmap&&(t.orgFontSize=e,t.setText&&t.setText(t.text)),t.refresh&&t.refresh()})),this.addButton("font","font",(function(){var t=modify.getCurrentObject(),e=Object.keys(game.cache._cache.bitmapFont),i=e.indexOf(t.font);modify.modifyCurrentObjProp("font",e[(i+1)%e.length]),t.cacheAsBitmap&&t.setText&&t.setText(t.text),t.refresh&&t.refresh()})),this.addButton("text","text","string:text",(function(t){t.cacheAsBitmap&&t.setText&&t.setText(t.text)})),this.addButton("maxUserWidth","maxUserWidth","number:maxUserWidth",(function(t,e){t.cacheAsBitmap&&t.setText(t.text)})),this.addButton("maxUserHeight","maxUserHeight","number:maxUserHeight",(function(t,e){t.cacheAsBitmap&&t.setText(t.text)})),this.addButton("fixedToCamera","fixedToCamera",(function(){var t=modify.getCurrentObject();modify.modifyCurrentObjProp("fixedToCamera",!t.fixedToCamera)})),this.addButton("cameraOffset.x","cameraOffset.x","number:cameraOffset.x"),this.addButton("cameraOffset.y","cameraOffset.y","number:cameraOffset.y"),this.addButton("EXTRA_DATA",(function(){var t=this.modify.getCurrentObject();this.domElement.style.display="list-item",t?t&&t.___DATA?this.domValue.innerHTML="YES":this.domValue.innerHTML="---":this.domElement.style.display="none"}),(function(){var obj=this.modify.getCurrentObject();this.modify.domLayer.openExtraData(obj.label,obj.___DATA||{},(function(newData){if(newData)try{eval("var tmp = "+newData),"object"===("undefined"==typeof tmp?"undefined":_typeof(tmp))&&(obj.___DATA=tmp,this.refreshFunc())}catch(t){}else delete obj.___DATA}))})),this.modify.onLevelObjChange.add(this.refreshValues,this),this.modify.onCurrentObjChange.add(this.refreshValues,this),this.modify.onCurrentObjPropModified.add(this.refreshValues,this)},G.ModifyDOMPropList.prototype.addButton=function(t,e,i,s){var a=new G.ModifyDOMPropButton(this.modify,t,e,i,s);this.buttons.push(a),a.domButton.className="modifyPLButton",this.list.appendChild(a.domElement)},G.ModifyDOMPropList.prototype.refreshValues=function(){this.buttons.forEach((function(t){t.refreshFunc()}))},G.ModifyDOMPropList.prototype.cssClasses=[".modifyPLmainDiv {font-family: verdana; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}",".modifyPLButton {pointer-events: all; margin: 0; border: 0; background-color: rgba(100,200,200,0.5); font-weight: bold; font-size: 0.7em;}",".modifyPLul {margin: 0; margin-top: 10px; padding: 0; line-style: none;}"],void 0===G&&(G={}),G.Hex=function(t){t&&(this.grid=t,this.type=this.setGridType(t.type))},G.Hex.constructor=G.Hex,G.Hex.prototype.setGridType=function(t){if(void 0!==t)return t===G.HexGrid.ODD_R?(this.offsetToCube=this.oddRToCube,this.cubeToOffset=this.cubeToOddR):t===G.HexGrid.EVEN_R?(this.offsetToCube=this.evenRToCube,this.cubeToOffset=this.cubeToEvenR):t===G.HexGrid.ODD_Q?(this.offsetToCube=this.oddQToCube,this.cubeToOffset=this.cubeToOddQ):t===G.HexGrid.EVEN_Q&&(this.offsetToCube=this.evenQToCube,this.cubeToOffset=this.cubeToEvenQ),void 0!==this.q?this.setAxial(this.q,this.r):void 0!==this.z&&this.setCube(this.x,this.y,this.z),t},G.Hex.prototype.updatePixelPosition=function(){this.grid&&void 0!==this.r&&(this.px=-this.grid.pointerOffsetX,this.py=-this.grid.pointerOffsetY,this.grid.pointyTop?(this.px+=this.grid.hexSize*Math.sqrt(3)*(this.q+this.r/2),this.py+=1.5*this.grid.hexSize*this.r):(this.px+=1.5*this.grid.hexSize*this.q,this.py+=this.grid.hexSize*Math.sqrt(3)*(this.r+this.q/2)))},G.Hex.prototype.countCorners=function(){for(var t=0;t<6;t++)result.push(this.countCorner(t));return result},G.Hex.prototype.updateCorners=function(t){for(t=0;t<6;t++){var e=60*t+(this.grid.pointyTop?30:0),i=Math.PI/180*e;this.corners[t].x=this.px+this.grid.hexSize*Math.cos(i),this.corners[t].y=this.py+this.grid.hexSize*Math.sin(i)}},G.Hex.prototype.setAxial=function(t,e){return this.q=t,this.r=e,this.axialToCube(),this.grid&&this.cubeToOffset(),this},G.Hex.prototype.setCube=function(t,e,i){return this.x=t,this.y=e,this.z=i,this.cubeToAxial(),this.grid&&this.cubeToOffset(),this},G.Hex.prototype.setOffset=function(t,e){return this.col=t,this.row=e,this.grid&&(this.offsetToCube(),this.cubeToAxial()),this},G.Hex.prototype.cubeToAxial=function(){this.q=this.x,this.r=this.z},G.Hex.add=function(t,e,i){return i||(i=new G.Hex(t.type)),i.copyFrom(t).add(e)},G.Hex.prototype.add=function(t){return this.setCube(this.x+t.x,this.y+t.y,this.z+t.z),this},G.Hex.subtract=function(t,e,i){return i||(i=new G.Hex(t.type)),i.copyFrom(t).subtract(e)},G.Hex.prototype.subtract=function(t){return this.setCube(this.x-t.x,this.y-t.y,this.z-t.z),this},G.Hex.equal=function(t,e){return t.x-e.x==0&&t.y-e.y==0&&t.z-e.z==0},G.Hex.prototype.equalTo=function(t){return this.x-t.x==0&&this.y-t.y==0&&this.z-t.z==0},G.Hex.scale=function(t,e,i){return i||(i=new G.Hex(t.type)),i.copyFrom(t).scale(e)},G.Hex.prototype.scale=function(t){return t>0&&this.setCube(this.x*t,this.y*t,this.z*t),this},G.Hex.areNeighbours=function(t,e){return 1==G.Hex.distance(t,e)},G.Hex.isNeighbourOf=function(t){return 1==G.Hex.distance(this,t)},G.Hex.distance=function(t,e){return Math.max(Math.abs(t.x-e.x),Math.abs(t.y-e.y),Math.abs(t.z-e.z))},G.Hex.prototype.distanceTo=function(t){return G.Hex.distance(this,t)},G.Hex.prototype.copyFrom=function(t){return t.type&&t.type!==this.type&&this.setGridType(t.type),this.setCube(t.x,t.y,t.y),this},G.Hex.prototype.copyTo=function(t){return this.type&&this.type!==t.type&&t.setGridType(t.type),t.setCube(this.x,this.y,this.z),this},G.Hex.prototype.round=function(){var t=Math.round(this.x),e=Math.round(this.y),i=Math.round(this.z),s=Math.abs(t-this.x),a=Math.abs(e-this.y),r=Math.abs(i-this.z);return s>a&&s>r?t=-e-i:a>r?e=-t-i:i=-t-e,this.setCube(t,e,i),this},G.Hex.prototype.axialToCube=function(){this.x=this.q,this.z=this.r,this.y=-this.x-this.z},G.Hex.prototype.cubeToEvenQ=function(){this.col=this.x,this.row=this.z+(this.x+this.x%2)/2},G.Hex.prototype.evenQToCube=function(){this.x=this.col,this.z=this.row-(this.col+this.col%2)/2,this.y=-this.x-this.z},G.Hex.prototype.cubeToOddQ=function(){this.col=this.x,this.row=this.z+(this.x-this.x%2)/2},G.Hex.prototype.oddQToCube=function(){this.x=this.col,this.z=this.row-(this.col-this.col%2)/2,this.y=-this.x-this.z},G.Hex.prototype.cubeToEvenR=function(){this.col=this.x+(this.z+this.z%2)/2,this.row=this.z},G.Hex.prototype.evenRToCube=function(){this.x=this.col-(this.row+this.row%2)/2,this.z=this.row,this.y=-this.x-this.z},G.Hex.prototype.cubeToOddR=function(){this.col=this.x+(this.z-this.z%2)/2,this.row=this.z},G.Hex.prototype.oddRToCube=function(){this.x=this.col-(this.row-this.row%2)/2,this.z=this.row,this.y=-this.x-this.z},G.Hex.prototype.toStringCube=function(){return this.x+"x"+this.y+"x"+this.z},G.Hex.prototype.toStringOffset=function(){return this.col+"x"+this.row},G.Hex.prototype.toStringAxial=function(){return this.q+"x"+this.r},void 0===G&&(G={}),G.HexGrid=function(t,e,i){this.config=i;var s=i.hexType||3;this.type="string"==typeof s?G.HexGrid.types.indexOf(s):s,this.pointyTop=s<2,this.hexSize=i.tileSize?G.l(i.tileSize):G.l(40),this.hexWidth=this.getHexWidth(),this.hexHeight=this.getHexHeight(),this.tileWidth=this.hexWidth,this.tileHeight=this.hexHeight,this.pointerOffsetX=this.getPointerOffsetX(),this.pointerOffsetY=this.getPointerOffsetY(),this.grid=new G.GridArray(t,e),this.grid.loop((function(t,e,i,s){s[e][i]=new G.Hex(this).setOffset(e,i)}),this),this.width=this.grid.width,this.height=this.grid.height,this._tmpHex=new G.Hex(this),this._tmpHex2=new G.Hex(this),this.directions=[(new G.Hex).setCube(1,-1,0),(new G.Hex).setCube(1,0,-1),(new G.Hex).setCube(0,1,-1),(new G.Hex).setCube(-1,1,0),(new G.Hex).setCube(-1,0,1),(new G.Hex).setCube(0,-1,1)],this.directionsLabels={RD:this.directions[0],RU:this.directions[1],U:this.directions[2],LU:this.directions[3],LD:this.directions[4],D:this.directions[5]}},G.HexGrid.types=["oddR","evenR","oddQ","evenQ"],G.HexGrid.ODD_R=0,G.HexGrid.EVEN_R=1,G.HexGrid.ODD_Q=2,G.HexGrid.EVEN_Q=3,G.HexGrid.prototype.getPointerOffsetX=function(){return this.type==G.HexGrid.EVEN_R?-this.hexWidth:.5*-this.hexWidth},G.HexGrid.prototype.getPointerOffsetY=function(){return this.type==G.HexGrid.EVEN_Q?-this.hexHeight:.5*-this.hexHeight},G.HexGrid.prototype.getHexWidth=function(){return this.pointyTop?Math.sqrt(3)/2*(2*this.hexSize):2*this.hexSize},G.HexGrid.prototype.getHexHeight=function(){return this.pointyTop?2*this.hexSize:Math.sqrt(3)/2*(2*this.hexSize)},G.HexGrid.prototype.getPxPosition=function(t,e,i){return void 0===i&&(i=new Phaser.Point(0,0)),this._tmpHex.setOffset(t,e),i.x=-this.pointerOffsetX,i.y=-this.pointerOffsetY,this.pointyTop?(i.x+=this.hexSize*Math.sqrt(3)*(this._tmpHex.q+this._tmpHex.r/2),i.y+=1.5*this.hexSize*this._tmpHex.r):(i.x+=1.5*this.hexSize*this._tmpHex.q,i.y+=this.hexSize*Math.sqrt(3)*(this._tmpHex.r+this._tmpHex.q/2)),i.x=Math.floor(i.x),i.y=Math.floor(i.y),i},G.HexGrid.prototype.pixelToCoord=function(t,e,i,s,a){var r,o;return t=(t-i.x)*(1/s.x)+this.pointerOffsetX,e=(e-i.y)*(1/s.y)+this.pointerOffsetY,this.pointyTop?(r=(t*Math.sqrt(3)/3-e/3)/this.hexSize,o=2*e/3/this.hexSize):(r=2*t/3/this.hexSize,o=(-t/3+Math.sqrt(3)/3*e)/this.hexSize),this.hlHex=new G.Hex(this).setAxial(r,o).round(),a?(a.x=this.hlHex.col,a.y=this.hlHex.row,a):new Phaser.Point(this.hlHex.col,this.hlHex.row)},G.HexGrid.prototype.dbgDrawGrid=function(t){t.clear(),t.beginFill(3355443,1),t.lineStyle(2,0,1),this.grid.loop((function(e,i,s){this.hlHex&&this.hlHex.col==i&&this.hlHex.row==s?t.beginFill(3355443,1):t.beginFill(3355443,.5),e.hl&&t.beginFill(16711680,.5),t.drawPolygon(e.corners)}),this)},G.HexGrid.prototype.getNeighbourCoords=function(t,e,i,s){var a;return void 0===s&&(s={}),"string"==typeof i?a=this.directionsLabels[i]:((i%=this.directions.length)<0&&(i=this.directions.length+i),a=this.directions[i]),this._tmpHex.setOffset(t,e).add(a),s.x=this._tmpHex.col,s.y=this._tmpHex.row,s},G.HexGrid.prototype.areNeighbours=function(t,e,i,s){return this._tmpHex.setOffset(t,e),this._tmpHex2.setOffset(i,s),this._tmpHex.isNeighbourOf(this._tmpHex2)},G.HexGrid.prototype.getRing=function(t,e,i){var s=[];if(i<0)return s;for(var a=new G.Hex(this).copyFrom(this.directions[3]).scale(i),r=new G.Hex(this).setOffset(t,e).add(a),o=0;o<6;o++)for(var n=0;n<i;n++){var h=this.getGridValOffset(r.col,r.row);h&&s.push(h),r.add(this.directions[o])}return s.forEach((function(t){t.hl=!0})),s},G.HexGrid.prototype.getDirection=function(t,e,i,s){for(dir in this._tmpHex.setOffset(i,s).subtract(this._tmpHex2.setOffset(t,e)),this.directionsLabels)if(G.Hex.equal(this.directionsLabels[dir],this._tmpHex))return dir;return!1},G.HexGrid.prototype.isMoveValid=function(t,e,i,s){return this.getDirection(t,e,i,s)},G.HexGrid.prototype.getGridValAxial=function(t,e){return this._tmpHex.setAxial(t,e),this.grid.get(this._tmpHex.col,this._tmpHex.row)},G.HexGrid.prototype.getGridValOffset=function(t,e){return this.grid.get(t,e)},G.HexGrid.prototype.getGridVal=G.HexGrid.prototype.getGridValOffset,G.HexGrid.prototype.getGridValCube=function(t,e,i){return this._tmpHex.setCube(t,e,i),this.grid.get(this._tmpHex.col,this._tmpHex.row)},void 0===G&&(G={}),G.Square=function(t,e,i){this.grid=t,this.x=e,this.y=i,this.updatePixelPosition()},G.Square.constructor=G.Triangle,G.Square.prototype.updatePixelPosition=function(){this.px=this.x*this.grid.squareWidth+.5*this.grid.squareWidth,this.py=this.y*this.grid.squareWidth+.5*this.grid.squareWidth},G.Square.prototype.setTo=function(t,e){this.x=t,this.y=e,this.getDirection(),this.updatePixelPosition()},G.Square.add=function(t,e,i){return i||(i=new G.Triangle(t.grid,t.x,t.y)),i.add(e)},G.Square.prototype.add=function(t){return this.setTo(this.x+t.x,this.y+t.y),this},G.Square.areNeighbours=function(t,e){return t.isNeighbourOf(e)},G.Square.isNeighbourOf=function(t){return 1==Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))},G.Square.prototype.copyFrom=function(t){return this.setTo(t.x,t.y),this},G.Square.prototype.copyTo=function(t){return t.setTo(this.x,this.y),this},G.Square.prototype.toString=function(){return this.x+"x"+this.y+" dir: "+this.dir},void 0===G&&(G={}),G.SquareGrid=function(t,e,i){this.config=i,this.squareWidth=i.tileSize?G.l(i.tileSize):G.l(76),this.squareHeight=i.tileSize?G.l(i.tileSize):G.l(76),this.pointerOffsetX=0,this.pointerOffsetY=0,this.tilePadding=i.tilePadding||0,this.tileWidth=i.tileSize,this.tileHeight=i.tileSize,this.grid=new G.GridArray(t,e),this.grid.loop((function(t,e,i,s){s[e][i]=new G.Square(this,e,i)}),this),this.width=this.grid.width,this.height=this.grid.height,this.directions=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],this.directionsLabels={R:this.directions[0],RU:this.directions[1],U:this.directions[2],LU:this.directions[3],L:this.directions[4],LD:this.directions[5],D:this.directions[6],RD:this.directions[7]}},G.SquareGrid.prototype.pixelToCoord=function(t,e,i,s,a){var r,o;if(t=(t+this.pointerOffsetX-i.x)*(1/s.x),e=(e+this.pointerOffsetY-i.y)*(1/s.y),this.tilePadding>0){var n=t/(this.squareWidth+this.tilePadding),h=e/(this.squareHeight+this.tilePadding);n<=Math.floor(n)+this.squareWidth/(this.squareWidth+this.tilePadding)&&h<=Math.floor(h)+this.squareHeight/(this.squareHeight+this.tilePadding)?(r=Math.floor(n),o=Math.floor(h)):(r=-999999,o=-999999)}else r=Math.floor(t/this.squareWidth),o=Math.floor(e/this.squareHeight);if(!a)return new Phaser.Point(r,o);a.x=r,a.y=o},G.SquareGrid.prototype.getPxPosition=function(t,e,i){return void 0===i&&(i=new Phaser.Point(0,0)),i.x=Math.floor(t*(this.squareWidth+this.tilePadding)+.5*this.squareWidth),i.y=Math.floor(e*(this.squareWidth+this.tilePadding)+.5*this.squareWidth),i},G.SquareGrid.prototype.dbgDrawGrid=function(t){t.clear(),t.beginFill(3355443,1),t.lineStyle(2,0,1),this.grid.loop((function(e,i,s){t.beginFill(3355443,.5),t.drawRect(i*(this.squareWidth+this.tilePadding),s*(this.squareHeight+this.tilePadding),this.squareWidth,this.squareHeight)}),this)},G.SquareGrid.prototype.getNeighbourCoords=function(t,e,i,s){var a;return void 0===s&&(s={}),a="string"==typeof i?this.directionsLabels[i]:this.directions[i],s.x=t+a[0],s.y=e+a[1],s},G.SquareGrid.prototype.getDirection=function(t,e,i,s){for(dir in this.directionsLabels)if(this.directionsLabels[dir][0]==i-t&&this.directionsLabels[dir][1]==s-e)return dir;return!1},G.SquareGrid.prototype.isMoveValid=function(t,e,i,s){var a=this.getDirection(t,e,i,s);return"U"===a||"D"===a||"L"===a||"R"===a},G.SquareGrid.prototype.areNeighbours=function(t,e,i,s){return 1==Math.max(Math.abs(t-i),Math.abs(e-s))},G.SquareGrid.prototype.getGridVal=function(t,e){return this.grid.get(t,e)},G.SquareGrid.prototype.getRing=function(t,e,i){i=i||1;for(var s=[],a={x:t,y:e},r=0;r<i;r++)this.getNeighbourCoords(a.x,a.y,"LD",a);for(var o=["R","U","L","D"],n=0;n<4;n++)for(var h=o[n],l=0;l<i+1;l++)this.getNeighbourCoords(a.x,a.y,h,a),s.push({x:a.x,y:a.y});return s},void 0===G&&(G={}),G.Triangle=function(t,e,i){this.grid=t,this.x=e,this.y=i,this.updatePixelPosition()},G.Triangle.constructor=G.Triangle,G.Triangle.prototype.updatePixelPosition=function(){if(this.px=this.x*this.grid.triangleWidth,this.py=this.y*(.5*this.grid.triangleHeight),!this.corners){this.corners=[];for(var t=0;t<3;t++)this.corners.push(new Phaser.Point(0,0))}this.dir=this.getDirection(),this.updateCorners()},G.Triangle.prototype.setTo=function(t,e){this.x=t,this.y=e,this.getDirection(),this.updatePixelPosition()},G.Triangle.prototype.getDirection=function(){var t=(this.x%2+this.y%2)%2;return(this.grid.firstDir+t)%2},G.Triangle.prototype.updateCorners=function(t){1==this.dir?(this.corners[0].x=this.px,this.corners[0].y=this.py,this.corners[1].x=this.px+this.grid.triangleWidth,this.corners[1].y=this.py+.5*this.grid.triangleHeight,this.corners[2].x=this.px,this.corners[2].y=this.py+this.grid.triangleHeight):(this.corners[0].x=this.px,this.corners[0].y=this.py+.5*this.grid.triangleHeight,this.corners[1].x=this.px+this.grid.triangleWidth,this.corners[1].y=this.py,this.corners[2].x=this.px+this.grid.triangleWidth,this.corners[2].y=this.py+this.grid.triangleHeight)},G.Triangle.add=function(t,e,i){return i||(i=new G.Triangle(t.grid,t.x,t.y)),i.add(e)},G.Triangle.prototype.add=function(t){return this.setTo(this.x+t.x,this.y+t.y),this},G.Triangle.areNeighbours=function(t,e){return t.isNeighbourOf(e)},G.Triangle.isNeighbourOf=function(t){return 1==Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))},G.Triangle.prototype.copyFrom=function(t){return this.setTo(t.x,t.y),this},G.Triangle.prototype.copyTo=function(t){return t.setTo(this.x,this.y),this},G.Triangle.prototype.toString=function(){return this.x+"x"+this.y+" dir: "+this.dir},void 0===G&&(G={}),G.TriangleGrid=function(t,e,i){this.config=i,this.triangleWidth=i.triangleWidth||106,this.triangleHeight=i.triangleHeight||122,this.firstDir=i.firstDir||0,this.pointerOffsetX=0,this.pointerOffsetY=0,this.tileWidth=this.triangleWidth,this.tileHeight=this.triangleHeight,this.gemSideOffset=i.gemSideOffset||.3,this.grid=new G.GridArray(t,e),this.grid.loop((function(t,e,i,s){s[e][i]=new G.Triangle(this,e,i)}),this),this.width=t,this.height=e,this.directions=["RD","RU","U","LU","LD","D"],this.directionsLabels={L:[-1,0],R:[1,0],U:[0,-1],D:[0,1]}},G.TriangleGrid.prototype.getPxPosition=function(t,e,i){void 0===i&&(i=new Phaser.Point(0,0));var s=this.isPointingRight(t,e),a=t*this.triangleWidth+this.triangleWidth*(s?this.gemSideOffset:1-this.gemSideOffset),r=e*this.triangleHeight*.5+.5*this.triangleHeight;return i.x=a,i.y=r,i},G.TriangleGrid.prototype.pixelToCoord=function(t,e,i,s,a){t=(t+this.pointerOffsetX-i.x)*(1/s.x),e=(e+this.pointerOffsetY-i.y)*(1/s.y);var r=Math.floor(t/this.triangleWidth),o=Math.floor(e/(.5*this.triangleHeight));this.__rawCol=r,this.__rawRow=o;var n=(t-r*this.triangleWidth)/this.triangleWidth,h=(e-o*this.triangleHeight*.5)/(.5*this.triangleHeight);if((this.__rawDir=1==this.isPointingRight(r,o))?n>h&&o--:n<1-h&&o--,!a)return new Phaser.Point(r,o);a.x=r,a.y=o},G.TriangleGrid.prototype.isPointingRight=function(t,e){var i=(t%2+e%2)%2;return(this.firstDir+i)%2},G.TriangleGrid.prototype.dbgDrawGrid=function(t){t.clear(),t.beginFill(3355443,1),t.lineStyle(2,0,1),this.grid.loop((function(e,i,s){this.hlTriangle&&this.hlTriangle.x==i&&this.hlTriangle.y==s?t.beginFill(3355443,1):t.beginFill(3355443,.5),t.drawPolygon(e.corners)}),this)},G.TriangleGrid.prototype.getNeighbourCoords=function(t,e,i,s){void 0===s&&(s={});var a=this.isPointingRight(t,e);return"U"==i||a&&"RU"==i||!a&&"LU"==i?(s.x=t,s.y=e-1,s):"D"==i||a&"RD"==i||!a&"LD"==i?(s.x=t,s.y=e+1,s):"L"==i||a&&("LU"==i||"LD"==i)?(s.x=t-1,s.y=e,s):"R"!=i&&(a||"RD"!=i&&"RU"!=i)?void 0:(s.x=t+1,s.y=e,s)},G.TriangleGrid.prototype.getDirection=function(t,e,i,s){for(dir in this.directionsLabels)if(this.directionsLabels[dir][0]==i-t&&this.directionsLabels[dir][1]==s-e)return dir;return!1},G.TriangleGrid.prototype.getGridVal=function(t,e){return this.grid.get(t,e)},G.TriangleGrid.prototype.getRing=function(t,e,i){},G.TriangleGrid.prototype.isMoveValid=function(t,e,i,s){var a=this.isPointingRight(t,e),r=this.getDirection(t,e,i,s);return!!r&&(!(a&&"R"==r||!a&&"L"==r)&&r)},G.anim2=function(t,e,i){GemRotPiece=function(t,e){G.Image.call(this,0,0,t+e,.5,s),e<=1?(this.x-=.5*this.width,this.y+=.5*this.height,this.velX=game.rnd.realInRange(-5,0)):e<=3?(this.x-=.5*this.width,this.y-=.5*this.height,this.velX=game.rnd.realInRange(-5,0)):e<=5?(this.x+=.5*this.width,this.y-=.5*this.height,this.velX=game.rnd.realInRange(0,5)):e<=7&&(this.x+=.5*this.width,this.y+=.5*this.height,this.velX=game.rnd.realInRange(0,5)),this.grav=.5,this.angleSpeed=game.rnd.realInRange(-6,6);game.rnd.realInRange(0,360),game.rnd.realInRange(2,4);this.velY=game.rnd.realInRange(-12,-4),this.timerAlpha=game.rnd.between(20,30)},GemRotPiece.prototype=Object.create(G.Image.prototype),GemRotPiece.prototype.update=function(){this.angle+=this.angleSpeed,this.x+=this.velX,this.y+=this.velY,this.velY+=this.grav,this.velX*=.99,this.timerAlpha--,this.timerAlpha<0&&(this.alpha-=.05,this.alpha<=0&&this.destroy())};var s=game.add.group();s.position.setTo(e||400,i||400);for(var a=0;a<8;a++)s.add(new GemRotPiece("d_"+t+"_rot_piece_",a));return s.scale.setTo(.5),s},void 0===G&&(G={}),G.Boot=function(t){},G.Boot.prototype={init:function(){game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.time.advancedTiming=!0,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.input.maxPointers=1,game.stage.disableVisibilityChange=!0;var t=document.getElementById("gameFontPreload");t.parentNode.removeChild(t);try{game.device.desktop?sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:LandscapeOrientation"}):sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:PortraitOrientation"})}catch(t){}this.game.seededRnd=new G.SeededRandomDataGenerator,G.sb=G.SignalBox,this.scaleGameSizeUpdate=function(){if(game.state.getCurrentState().FORCEFULLHD)return game.scale.setGameSize(1920,1080),void game.world.setBounds(0,0,1920,1080);var t=window.innerWidth/window.innerHeight,e=window.innerHeight/window.innerWidth,i=1280,s=720;(game.device.desktop?t>i/s?game.scale.setGameSize(game.math.clamp(Math.floor(s*t),i,1700),s):game.scale.setGameSize(i,Math.max(s,Math.min(950,Math.floor(i*e)))):(e>(s=960)/(i=700)?game.scale.setGameSize(i,game.math.clamp(Math.floor(i*e),s,1300)):game.scale.setGameSize(game.math.clamp(Math.floor(s*t),i,800),s),game.world.setBounds(0,0,game.width,game.height)),G.sb("onScreenResize").dispatch(),this.orientationDiv=document.getElementById("orientation"),game.device.desktop)||(window.innerHeight<window.innerWidth?"block"!==this.orientationDiv.style.display&&(this.orientationDiv.style.display="block","DIV"==game.canvas.parentElement.tagName&&(game.canvas.parentElement.style.display="none")):"none"!==this.orientationDiv.style.display&&(this.orientationDiv.style.display="none","DIV"==game.canvas.parentElement.tagName&&(game.canvas.parentElement.style.display="block")))},game.resizeGame=this.scaleGameSizeUpdate,this.scale.setResizeCallback((function(){G.old_w==window.innerWidth&&G.old_h==window.innerHeight||(G.old_w=window.innerWidth,G.old_h=window.innerHeight,game.resizeGame())}));try{sdkHandler.trigger("user.login",{nickname:sgSettings.config.user.name,picture:sgSettings.config.user.avatar},this)}catch(t){}},preload:function(){sgSettings.config.bannerUrl&&sgSettings.config.bannerUrl.logo&&(G.SGLOGO=!0,game.load.image("softgames_logo",sgSettings.config.bannerUrl.logo)),G.Loader.loadBootAssets()},create:function(){game.state.start("Preloader")}},Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var s=arguments[1],a=0;a<i;){var r=e[a];if(t.call(s,r,a,e))return a;a++}return-1}}),function(){var t,e={polyfill:s,keys:{3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",28:"Convert",29:"NonConvert",30:"Accept",31:"ModeChange",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Delete",48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],91:"OS",93:"ContextMenu",144:"NumLock",145:"ScrollLock",181:"VolumeMute",182:"VolumeDown",183:"VolumeUp",186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"'],224:"Meta",225:"AltGraph",246:"Attn",247:"CrSel",248:"ExSel",249:"EraseEof",250:"Play",251:"ZoomOut"}};for(t=1;t<25;t++)e.keys[111+t]="F"+t;var i="";for(t=65;t<91;t++)i=String.fromCharCode(t),e.keys[t]=[i.toLowerCase(),i.toUpperCase()];function s(){if(!("KeyboardEvent"in window)||"key"in KeyboardEvent.prototype)return!1;var t={get:function(t){var i=e.keys[this.which||this.keyCode];return Array.isArray(i)&&(i=i[+this.shiftKey]),i}};return Object.defineProperty(KeyboardEvent.prototype,"key",t),t}s()}(),Phaser.ArrayUtils.shuffleSeeded=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(game.rnd.rnd()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}return t},Phaser.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.runWordWrap(this.text));var e=t.split(/(?:\r\n|\r|\n)/),i=this.style.tabs,s=[],a=0,r=this.determineFontProperties(this.style.font),o=e.length;this.style.maxLines>0&&this.style.maxLines<e.length&&(o=this.style.maxLines),this._charCount=0;for(var n=0;n<o;n++){if(0===i){var h=this.style.strokeThickness+this.padding.x;this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(e[n]):h+=this.context.measureText(e[n]).width,this.style.wordWrap&&(h-=this.context.measureText(" ").width)}else{var l=e[n].split(/(?:\t)/);h=this.padding.x+this.style.strokeThickness;if(Array.isArray(i))for(var c=0,d=0;d<l.length;d++){var p=0;p=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(l[d]):Math.ceil(this.context.measureText(l[d]).width),d>0&&(c+=i[d-1]),h=c+p}else for(d=0;d<l.length;d++){this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(l[d]):h+=Math.ceil(this.context.measureText(l[d]).width),h+=this.game.math.snapToCeil(h,i)-h}}s[n]=Math.ceil(h),a=Math.max(a,s[n])}this.canvas.width=a*this._res%2==0?a*this._res:a*this._res+1;var u,g,f=r.fontSize+this.style.strokeThickness+this.padding.y,m=f*o,y=this._lineSpacing;for(y<0&&Math.abs(y)>f&&(y=-f),0!==y&&(m+=y>0?y*e.length:y*(e.length-1)),this.canvas.height=m*this._res%2==0?m*this._res:m*this._res+1,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0,n=0;n<o;n++)u=this.style.strokeThickness/2,g=this.style.strokeThickness/2+n*f+r.ascent,n>0&&(g+=y*n),"right"===this.style.align?u+=a-s[n]:"center"===this.style.align&&(u+=(a-s[n])/2),this.autoRound&&(u=Math.round(u),g=Math.round(g)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(e[n],u,g):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===i?this.context.strokeText(e[n],u,g):this.renderTabLine(e[n],u,g,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===i?this.context.fillText(e[n],u,g):this.renderTabLine(e[n],u,g,!0)));this.updateTexture(),this.dirty=!1},G.EditorLvl=function(t){},G.EditorLvl.prototype={init:function(t){t==G.json.levels.length&&G.json.levels.push({gridConfig:{grid:"Square",tileSize:96},time:90,normalsNr:4,levelData:[["X","@r","@r","@r","@r","@r","X"],["@r","@r","@r,&1","@r,&1","@r,&1","@r","@r"],["@r","@r,&1","@r,&1","@r,&1","@r,&1","@r,&1","@r"],["@r","@r,&1","@r,&1","X","@r,&1","@r,&1","@r"],["@r","@r,&1","@r,&1","@r,&1","@r,&1","@r,&1","@r"],["@r","@r","@r,&1","@r,&1","@r,&1","@r","@r"],["X","@r","@r","@r","@r","@r","X"]]}),this.lvlIndex=game.math.clamp(t||0,0,G.json.levels.length-1)},preload:function(){},create:function(){this.FORCEFULLHD=!0,game.resizeGame(),s=this,this.stage.backgroundColor="white",brt=new G.BoardRTEditor(0,80,G.json.levels,this.lvlIndex),this.cursors=game.input.keyboard.createCursorKeys(),this.cursors.left.onDown.add((function(){game.state.start("EditorLvl",!0,!1,this.lvlIndex-1)}),this),this.cursors.right.onDown.add((function(){game.state.start("EditorLvl",!0,!1,this.lvlIndex+1)}),this),this.keys=game.input.keyboard.addKeys({TAB:Phaser.Keyboard.TAB,SHIFT:Phaser.Keyboard.SHIFT}),this.keys.TAB.onDown.add(this.changeTypeOfBoard,this);var t={fill:"white",fontSize:"30px"};this.exportBtn=new G.TextBtn(1750,0,{label:"EXPORT",style:t,type:"exe",exeFunc:function(){var t=new Blob([JSON.stringify(G.json.levels)],{type:"text/plain;charset=utf-8"});saveAs(t,"levels.json")}.bind(this)}),this.exportBtn=new G.TextBtn(1750,100,{label:"LVL MGR",style:t,type:"exe",exeFunc:function(){game.state.start("EditorLvlMgr")}.bind(this)}),this.exportBtn=new G.TextBtn(1750,200,{label:"LVL MGR2",style:t,type:"exe",exeFunc:function(){game.state.start("EditorLvlMgr2")}.bind(this)}),this.lvlNr=new G.TextBtn(0,0,{label:"LEVEL",style:t,type:"int",valMin:1,valMax:G.json.levels.length,setValFunc:function(t){game.state.start("EditorLvl",!0,!1,t-1)}.bind(this),getValFunc:function(){return this.lvlIndex+1+"/"+G.json.levels.length}.bind(this)}),this.typesOfGem=new G.TextBtn(230,0,{label:"TYPES NR",style:t,type:"int",valMin:3,valMax:8,setValFunc:function(t){G.json.levels[this.lvlIndex].normalsNr=t}.bind(this),getValFunc:function(){return G.json.levels[this.lvlIndex].normalsNr}.bind(this)}),this.timer=new G.TextBtn(450,0,{label:"TIME",style:t,type:"int",valMin:10,setValFunc:function(t){G.json.levels[this.lvlIndex].time=t}.bind(this),getValFunc:function(){return G.json.levels[this.lvlIndex].time}.bind(this)}),this.dropRefillerTypes=new G.TextBtn(620,0,{label:"REFILLER OW",style:t,type:"string",valMin:10,setValFunc:function(t){t=t?t.split(","):void 0,G.json.levels[this.lvlIndex].dropRefillerTypes=t}.bind(this),getValFunc:function(){return G.json.levels[this.lvlIndex].dropRefillerTypes||[]}.bind(this)})},changeTypeOfBoard:function(){var t=G.json.levels[this.lvlIndex];"Square"==t.gridConfig.grid?t.gridConfig={grid:"Hex",hexType:2,tileSize:56}:"Hex"==t.gridConfig.grid?t.gridConfig={grid:"Triangle",triangleWidth:116,triangleHeight:134,firstDir:1}:t.gridConfig={grid:"Square",tileSize:96},game.state.start("EditorLvl",!0,!1,this.lvlIndex),game.time.events.loop((function(){localStorage.setItem}))},update:function(){},render:function(){}},G.EditorLvlMgr=function(t){},G.EditorLvlMgr.prototype={init:function(){this.FORCEFULLHD=!0},preload:function(){},create:function(){game.resizeGame(),s=game.state.getCurrentState(),this.selected=[],this.editorClipboardONE=new G.EditorClipboard(0,0,{label:"1",labelStyle:{fill:"#ffffff"},borderColor:16777215,width:640,height:200}),this.editorClipboardTWO=new G.EditorClipboard(640,0,{label:"2",labelStyle:{fill:"#ffffff"},borderColor:16777215,width:640,height:200}),this.mainLine=new G.EditorLine(G.json.levels),this.mainLine.y=300,this.keys=game.input.keyboard.addKeys({ONE:Phaser.Keyboard.ONE,TWO:Phaser.Keyboard.TWO}),this.keys.ONE.onDown.add((function(){var t=this.mainLine.getPointedItem();t&&this.editorClipboardONE.addItem(this.mainLine.removeFromLine(t));var e=this.mainLine.getPointedSeparator();e&&this.mainLine.addToLine(this.editorClipboardONE.removeAllItems(),e.index)}),this),this.keys.TWO.onDown.add((function(){var t=this.mainLine.getPointedItem();t&&this.editorClipboardTWO.addItem(this.mainLine.removeFromLine(t));var e=this.mainLine.getPointedSeparator();e&&this.mainLine.addToLine(this.editorClipboardTWO.removeAllItems(),e.index)}),this);this.exportBtn=new G.TextBtn(1750,0,{label:"EXPORT",style:{fill:"white",fontSize:"30px"},type:"exe",exeFunc:function(){var t=new Blob([JSON.stringify(G.json.levels)],{type:"text/plain;charset=utf-8"});saveAs(t,"levels.json")}.bind(this)})},update:function(){},selectItems:function(t){this.selected.forEach((function(t){t.deselect()})),this.selected=[],this.lineGroup.forEach((function(e){var i=e.getBounds();t.intersects(i)&&(this.selected.push(e),e.select())}),this)},render:function(){game.debug.text(game.time.desiredFps,10,50)}},G.EditorLvlMgr2=function(t){},G.EditorLvlMgr2.prototype={init:function(){this.FORCEFULLHD=!0},preload:function(){},create:function(){game.resizeGame(),s=game.state.getCurrentState(),this.lvlMgrGrid=new G.LvlMgrGrid(G.json.levels,{itemMaxWidth:200,itemMaxHeight:200,itemPadding:40,columns:7});this.exportBtn=new G.TextBtn(1750,0,{label:"EXPORT",style:{fill:"white",fontSize:"30px"},type:"exe",exeFunc:function(){var t=new Blob([JSON.stringify(G.json.levels)],{type:"text/plain;charset=utf-8"});saveAs(t,"levels.json")}.bind(this)})},update:function(){}},G.Game=function(t){},G.Game.prototype={init:function(t){game.seededRnd.setSeed(Math.random()),void 0!==t&&G.saveState.resetProgress();var e=void 0!==t?t:G.saveState.getProgressLvlIndex();this.freshLvl=null==G.saveState.getProgressBoardData(),this.freshLvl,this.lvlIndex=game.math.clamp(e,0,G.json.levels.length-1),this.lvlData=JSON.parse(JSON.stringify(G.json.levels[this.lvlIndex])),this.tutData=G.json.settings.tutorials[this.lvlIndex.toString()],-1!==G.saveState.data.sawTutorial.indexOf(this.lvlIndex)?this.tutData=null:G.saveState.data.progress.board=null},preload:function(){},create:function(){this.tutorialOverwrites={inputMgrOnClickLock:!1,freezeTime:!1},sdkHandler.trigger("levelStart",{level:Math.max(0,this.lvlIndex+1)},this);try{sdkHandler.trigger("gameTracking",{event:"Start",dimension1:"Level"+G.zeroPad(this.lvlIndex+1)})}catch(t){}s=game.state.getCurrentState(),this.bg=new G.LvlBackground,game.device.desktop?this.gameUI=new G.GameUI(this.lvlIndex+1):this.gameUI=new G.GameUIMobile(this.lvlIndex+1),this.board=new G.Board(this.lvlData),board=this.board,this.gameUI.init(),this.tutData?this.tutLayer=new G.TutorialLayer(this.board,this.tutData):this.tutLayer=!1,this.comboController=new G.ComboController(this.board),this.mainNotifications=new G.MainNotifications,this.uiTargetParticles=new G.UITargetParticles,this.overlay=new G.PopUpOverlay,this.pausePopUp=new G.PausePopUp,this.moreHintPopUp=new G.MoreHintPopUp,game.camera.flash(0,300),game.time.events.add(500,(function(){G.sb("getReady").dispatch()})),game.time.events.add(1200,(function(){G.sb("onGameStart").dispatch()})),G.sb("finishGame").add((function(){this.board.idle?this.onGameCompleted():this.board.onIdle.addOnce(this.onGameCompleted,this)}),this),G.sb("onTimesUp").add((function(){G.sfx.game_over.play()})),G.sb("onGoalAchieved").add((function(){G.sfx.game_won.play()})),game.resizeGame(),-1!==window.location.hash.indexOf("DEBUG")&&(G.DEBUG=!0,this.initDebug())},onGameCompleted:function(){1==this.pausePopUp.alpha&&this.pausePopUp.close();var t=0==this.gameUI.coin.goal,e=this.gameUI.scoreController.score,i=!t||this.lvlIndex===G.json.levels.length-1;t&&G.saveState.levelPassed(),t&&!i||G.saveState.resetProgress(),game.time.events.add(1e3,(function(){new G.LevelFinishedPopUp(t,e,i)}))},setBoardInRect:function(t,e,i,s){this.gfx||(this.gfx=game.add.graphics()),this.gfx.clear(),this.gfx.beginFill(16711680,.5),this.gfx.drawRect(t,e,i,s),this.board.putInRect(t,e,i,s)},update:function(){},initDebug:function(){function t(t,e){var i=game.input.activePointer,a=board.baseGrid.pixelToCoord(i.x,i.y,board.worldPosition,board.scale),r=board.getGem(a.x,a.y);r&&(r.changeType(e),r.parent.updateCache()),s.board.gemLayer.layerCacher.redrawAll()}this.dbgGfx=game.add.graphics(),this.keys=game.input.keyboard.addKeys({one:Phaser.Keyboard.ONE,two:Phaser.Keyboard.TWO,three:Phaser.Keyboard.THREE,four:Phaser.Keyboard.FOUR,five:Phaser.Keyboard.FIVE,six:Phaser.Keyboard.SIX,w:Phaser.Keyboard.W,a:Phaser.Keyboard.A,s:Phaser.Keyboard.S,d:Phaser.Keyboard.D,z:Phaser.Keyboard.Z,q:Phaser.Keyboard.Q,c:Phaser.Keyboard.C,x:Phaser.Keyboard.X,v:Phaser.Keyboard.V,r:Phaser.Keyboard.R,p:Phaser.Keyboard.P,o:Phaser.Keyboard.O,e:Phaser.Keyboard.E,spacebar:Phaser.Keyboard.SPACEBAR}),this.keys.spacebar.onDown.add((function(){game.time.events.loop(800,(function(){if(this.board.possibleMoves.length>0){var t=game.rnd.pick(this.board.possibleMoves);this.board.makeMove(t[0],t[1],t[2],t[3])}}),this)}),this),this.keys.one.onDown.add(t,this,0,"1"),this.keys.two.onDown.add(t,this,0,"2"),this.keys.three.onDown.add(t,this,0,"3"),this.keys.four.onDown.add(t,this,0,"4"),this.keys.five.onDown.add(t,this,0,"5"),this.keys.six.onDown.add(t,this,0,"6"),this.keys.s.onDown.add((function(){for(var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale),i=0;i<20;i++){var s=board.getGem(i,e.y);if(s){var a=s.parent;s.kill(),a.cacheAsBitmap&&a.updateCache()}}})),this.keys.z.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale),i=board.getGem(e.x,e.y);i&&i.changeIntoSpecial("rainbow")})),this.keys.x.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale),i=board.getGem(e.x,e.y);i&&i.changeIntoSpecial("star")})),this.keys.c.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale),i=board.getGem(e.x,e.y);i&&i.changeIntoSpecial("vertical")})),this.keys.v.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale),i=board.getGem(e.x,e.y);i&&i.changeIntoSpecial("horizontal")})),this.keys.q.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale);board.isCellInsideBoard(e.x,e.y)&&board.layer[1].createObjectAt(e.x,e.y)})),this.keys.w.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale);board.isCellInsideBoard(e.x,e.y)&&board.layer[1].createObjectAt(e.x,e.y)})),this.keys.e.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale);board.isCellInsideBoard(e.x,e.y)&&board.layer[4].createObjectAt(e.x,e.y)})),this.keys.r.onDown.add((function(){var t=game.input.activePointer,e=board.baseGrid.pixelToCoord(t.x,t.y,board.worldPosition,board.scale),i=board.getGem(e.x,e.y);i&&i.kill()})),this.keys.o.onDown.add((function(){game.time.desiredFps=60==game.time.desiredFps?10:60})),this.keys.p.onDown.add((function(){game.paused=!game.paused})),this.cursors=game.input.keyboard.createCursorKeys(),this.cursors.left.onDown.add((function(){game.state.start("Game",!0,!1,this.lvlIndex-1)}),this),this.cursors.right.onDown.add((function(){game.state.start("Game",!0,!1,this.lvlIndex+1)}),this)},render:function(){if(G.DEBUG){var t=game.input.activePointer,e=s.board.pixelToCoord(t.x,t.y);game.debug.text(e.x+"x"+e.y,10,10);var i,a=(i=s.board.getGem(e.x,e.y))?i.id+" "+i.matchType:"---";game.debug.text(a,10,30),game.debug.text(s.board.idle,10,60),game.debug.text(game.time.fps,10,100),game.debug.text(this.board.idle,10,200),this.board.possibleMoves&&game.debug.text(this.board.possibleMoves.length,10,300)}}},G.cachPart=function(t,e,i,s){var a=e?game.add.group():new G.PartCacher;return a.position.setTo(i||400,s||400),a.scale.setTo(1),a.alpha=1,GemPiece=function(t,e){G.Image.call(this,game.rnd.realInRange(-14,14),game.rnd.realInRange(-14,14),e,.5,a),this.blendMode=t,this.scale.setTo(game.rnd.realInRange(1,2)),this.orgS=this.scale.x,this.grav=0,this.angle=game.rnd.realInRange(0,360),this.angleSpeed=game.rnd.realInRange(-5,5);var i=game.rnd.realInRange(0,360),s=game.rnd.realInRange(4,6);this.velX=G.lengthDirX(i,s),this.velY=G.lengthDirY(i,s),this.timerAlpha=game.rnd.between(10,20)},GemPiece.prototype=Object.create(G.Image.prototype),GemPiece.prototype.update=function(){this.angle+=this.angleSpeed,this.x+=this.velX,this.y+=this.velY,this.velY+=this.grav,this.velX*=.92,this.velY*=.92,this.timerAlpha--,this.timerAlpha<0&&(this.alpha-=.025,this.scale.setTo(this.alpha*this.orgS),this.alpha<=0&&this.kill())},function(){for(var e=0;e<10;e++)new GemPiece(0,t+"_piece")}(),e||a.start(t+"_explo",30),e&&game.time.events.add(2e3,(function(){a.destroy()})),a},G.MainMenu=function(){},G.MainMenu.prototype={init:function(t,e){this.score=e,this.highscoreAchieved=t},preload:function(){},create:function(){(s=this,G.MainMenu.startTriggered||(G.MainMenu.startTriggered=!1,sdkHandler.trigger("start"),game.input.onDown.addOnce((function(){game.input.onUp.addOnce((function(){G.sfx.music.play("",0,1,!0)}))}))),this.bg=new G.Background,this.fireflyGroup=new G.FireFlyGroup(new Phaser.Rectangle(-300,-200,600,400)),this.logo=new G.Logo(.5,.277),this.fireflyGroup.position=this.logo.position,this.decorGroup=new G.DecorGroup(640,360),this.titleMenu=new G.TitleMenu(.5,.5),this.overlay=new G.PopUpOverlay(.8),this.highscoresPopUp=new G.HighscoresPopUp,this.highscoreAchieved)&&new G.EnterNamePopUp(this.score).open();game.resizeGame(),game.camera.flash(0,1e3),G.makeImage(-9999,0,"sparkle_explo_0")},render:function(){}},G.Preloader=function(){},G.Preloader.prototype={preload:function(){this.ready=!1,G.lang=sgSettings.config.env.locale,new G.Logo(.5,.4),G.SGLOGO&&(this.sgLogo=G.makeImage(.5*game.width,.75*game.height,"softgames_logo",.5),this.sgLogo.onResize=function(){this.x=.5*game.width,this.y=.75*game.height},this.sgLogo.width=game.width,this.sgLogo.scale.x=Math.min(this.sgLogo.scale.x,1),this.sgLogo.scale.y=this.sgLogo.scale.x,G.sb("onScreenResize").add(this.sgLogo.onResize,this.sgLogo)),this.load.onFileComplete.add((function(t){sdkHandler.trigger("loading.update",{progressPercentage:t})})),G.Loader.loadAssets()},create:function(){G.saveState.init(),G.logoURI=this.getImageURL("logo"),this.cacheTexts(),this.highscoreListRt=new G.HighscoreListRT,this.highscoreListRt.redrawList(),game.resizeGame()},update:function(){!this.ready&&G.saveState.ready&&(G.sfx.music.isDecoded||game.device.ie)&&(sdkHandler.trigger("loading.completed",{callback:function(){}}),this.ready=!0,"#data-test-mode"!==location.hash&&-1===window.location.href.indexOf("localhost")||this.attachEditorEventListener())},attachEditorEventListener:function(){var t=!0;window.addEventListener("keydown",(function(e){if("Escape"===e.code){var i=game.state.getCurrentState().lvlIndex;if("EditorLvl"==game.state.current)localStorage.setItem("tmpl-jewels-levels-copy",JSON.stringify(G.json.levels)),t=!1,game.state.start("Game",!0,!1,i);else{if(null==i&&(i=0),t){var s=localStorage.getItem("tmpl-jewels-levels-copy");s&&confirm("do you want to restore level backup?")&&(G.json.levels=JSON.parse(s))}localStorage.removeItem("tmpl-jewels-levels-copy",JSON.stringify(G.json.levels)),game.state.start("EditorLvl",!0,!1,i)}}}))},cacheTexts:function(){this.textRTCacher=new G.TextRTCacher;var t={fill:"white",font:"blogger_sansbold",fontSize:"100px",stroke:"#524863",strokeThickness:10};this.textRTCacher.cachePhaserText(G.txt(2),"notify-ready",t),this.textRTCacher.cachePhaserText(G.txt(3),"notify-start",t),this.textRTCacher.cachePhaserText(G.txt(4),"notify-timesUp",t),this.textRTCacher.cachePhaserText(G.txt(8),"notify-levelComplete",t),this.textRTCacher.cachePhaserText(G.txt(20),"notify-finalRound",t),this.textRTCacher.cachePhaserText(G.txt(13),"notify-congrat",t),this.textRTCacher.cachePhaserText(G.txt(25),"notify-hurryup",t);t={fill:"white",font:"blogger_sansbold",fontSize:"70px",stroke:"#524863",strokeThickness:10};this.textRTCacher.cachePhaserText(G.txt(21),"notify-well_done",t),this.textRTCacher.cachePhaserText(G.txt(22),"notify-amazing",t),this.textRTCacher.cachePhaserText(G.txt(23),"notify-fantastic",t),this.textRTCacher.cachePhaserText(G.txt(24),"notify-perfect",t)},getImageURL:function(t){return this._bmpMarker||(this._bmpMarker=this.game.make.image(0,0,null,0,null)),this._bmp||(this._bmp=this.game.make.bitmapData()),this._bmp.clear(),G.changeTexture(this._bmpMarker,t),this._bmp.resize(this._bmpMarker.width,this._bmpMarker.height),this._bmp.draw(this._bmpMarker),this._bmp.canvas.toDataURL()}},G.Board=function(t){Phaser.Group.call(this,game);var e=t.levelData.length,i=t.levelData[0].length;this.idle=!1;var s=t.gridConfig;this.config=s,this.gemFallSpd=t.gemFallSpd||10,"Hex"==s.grid?(this.baseGrid=new G.HexGrid(e,i,s),this.matcher=new G.BoardMatcherHex(this)):"Triangle"==s.grid?(this.baseGrid=new G.TriangleGrid(e,i,s),this.matcher=new G.BoardMatcherTriangle(this)):(this.baseGrid=new G.SquareGrid(e,i,s),this.matcher=new G.BoardMatcherSquare(this)),this.normalGems=this.getNormalGems(t),this.specialDrops={},this.initLayers(G.json.BOARDSETTINGS.layers),"Triangle"==s.grid?this.fallMgr=new G.BoardTriangleFallMgr(this):"Hex"==s.grid?this.fallMgr=new G.BoardHexFallMgr(this):this.fallMgr=new G.BoardFallMgr(this),this.boardHints=this.add(new G.BoardHints(this,t.gridConfig)),this.inputMgr=this.add(new G.BoardInput(this)),this.fxLayer=new G.PoolGroup(G.FxBoardPart,null,"fxBoard",50),this.fxLayer.position=this.position,this.fxLayer.scale=this.scale;var a=G.saveState.getProgressBoardData();null==a?(this.importLevel(t.levelData),this.gemLayer.processRandomGems()):this.importLevel(a),t.dropRefillerTypes&&(this.gemLayer.refiller.dropOverwrite=t.dropRefillerTypes),this.fallMgr.processGrid(),this.possibleMoves=this.matcher.getAllPossibleMoves(),this.onIdle=new Phaser.Signal,this.onBusy=new Phaser.Signal,this.onElementKilled=new Phaser.Signal,this.onMatch=new Phaser.Signal,this.onCombinedMatch=new Phaser.Signal,this.onCollectableCollected=new Phaser.Signal,this.specialActions=[],this.hintTimer=360,this.saving=!0,G.sb("finishGame").add((function(){this.saving=!1}),this),G.sb("onScreenResize").add(this.onResize,this),this.onResize()},G.Board.prototype=Object.create(Phaser.Group.prototype),G.Board.prototype.onResize=function(){if(game.device.desktop){var t=game.width-350;this.RESIZETUT?this.putInRect(350,100,t,game.height-110):this.putInRect(350,10,t-10,game.height-20)}else{var e=game.height-218;this.RESIZETUT?this.putInRect(10,300,game.width-20,game.height-310):this.putInRect(10,218,game.width-20,e-10)}},G.Board.prototype.getNormalGems=function(t){for(var e=[],i=0;i<t.levelData.length;i++)for(var s=0;s<t.levelData[0].length;s++){var a=t.levelData[i][s],r=a.indexOf("@");if(-1!==r)"r"!==(n=a[r+1])&&-1==e.indexOf(n)&&e.push(n)}if(e.length>t.normalsNr)return e.slice(0,t.normalsNr);for(var o=game.seededRnd.shuffleArray(G.json.BOARDSETTINGS.normalGems.slice()).slice(0,t.normalsNr);e.length<t.normalsNr;){var n=o.pop();-1==e.indexOf(n)&&e.push(n)}return e},G.Board.prototype.addSpecialAction=function(t){this.specialActions.push(t),t.onFinish.add(this.removeSpecialAction,this,0,t),t.start()},G.Board.prototype.removeSpecialAction=function(t){this.specialActions.splice(this.specialActions.indexOf(t),1)},G.Board.prototype.isCellInsideBoard=function(t,e){return t>=0&&t<this.baseGrid.width&&e>=0&&e<this.baseGrid.height},G.Board.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update();this.matcher.update(),this.fallMgr.update();for(t=this.specialActions.length;t--;)this.specialActions[t].update();this.idleCheck(),0==this.hintTimer--&&(this.showHint(),this.hintTimer=720),this.fxLayer.update()},G.Board.prototype.showHint=function(){},G.Board.prototype.initLayers=function(t){this.layer=[],this.editorPrefixes={};for(var e=0;e<t.length;e++)this.addLayer(t[e])},G.Board.prototype.addLayer=function(t){var e;return t.gems?(e=new G.GemLayer(this,t),this.gemLayer=e):e=new G.BoardLayer(this,t),this.editorPrefixes[t.editorPrefix]=e,this.addExsitingLayer(e,t.floor,t.gems)},G.Board.prototype.addExsitingLayer=function(t,e,i){return this.layer.push(t),e&&(this.floorLayer=t),this.add(t),t},G.Board.prototype.getPxPosition=function(t,e,i){return this.baseGrid.getPxPosition(t,e,i)},G.Board.prototype.isCellMoveBlocked=function(t,e){for(var i=this.layer.length;i--;)if(this.layer[i].isMoveBlocked(t,e))return!0;return!1},G.Board.prototype.isCellMatchBlocked=function(t,e){for(var i=this.layer.length;i--;)if(this.layer[i].isMatchBlocked(t,e))return!0;return!1},G.Board.prototype.isCellChangeBlocked=function(t,e){for(var i=this.layer.length;i--;)if(this.layer[i].isChangeBlocked(t,e))return!0;return!1},G.Board.prototype.isCellChangeable=function(t,e){return!this.isCellChangeBlocked(t,e)},G.Board.prototype.isCellMoveable=function(t,e){return!this.isCellMoveBlocked(t,e)&&!this.isHole(t,e)},G.Board.prototype.isCellMatchable=function(t,e){return!this.isCellMatchBlocked(t,e)},G.Board.prototype.isHole=function(t,e){return!this.floorLayer.get(t,e)},G.Board.prototype.isCellFree=function(t,e,i){return this.isCellMoveable(t,e)&&!this.gemLayer.get(t,e)},G.Board.prototype.isCellMatchableWith=function(t,e,i){if(this.isCellMatchable(t,e)){var s=this.gemLayer.get(t,e);return!!s&&s.isMatchableWith(i)}return!1},G.Board.prototype.matchCell=function(t,e){for(var i=this.layer.length;i--&&this.layer[i].onMatch(t,e););},G.Board.prototype.willMatchGem=function(t,e){for(var i=this.layer.length;i--;){if(this.layer[i]===this.gemLayer){var s=this.gemLayer.get(t,e);return s&&s.isMatchable()}if(this.layer[i].get(t,e)&&this.layer[i].stopPropagation)return!1}},G.Board.prototype.hitCell=function(t,e){for(var i=this.layer.length;i--&&this.layer[i].onHit(t,e););},G.Board.prototype.isMovePossible=function(t,e,i,s){return this.isCellMoveable(t,e)&&this.isCellMoveable(i,s)&&this.baseGrid.isMoveValid(t,e,i,s)},G.Board.prototype.makeMove=function(t,e,i,s){if(this.isMovePossible(t,e,i,s)){var a=this.getGem(t,e),r=this.getGem(i,s);a&&r&&(new G.BoardMoveAction(this,a,r),G.sb("hideHint").dispatch())}},G.Board.prototype.getGem=function(t,e){return this.gemLayer.get(t,e)},G.Board.prototype.pixelToCoord=function(t,e,i){return this.baseGrid.pixelToCoord(t,e,this.worldPosition,this.scale,i)},G.Board.prototype.exportLevel=function(){var t=new G.GridArray(this.baseGrid.width,this.baseGrid.height,"");return t.loop((function(t,e,i,s){s[e][i]=this.exportCell(e,i)}),this),t.data},G.Board.prototype.exportCell=function(t,e){for(var i=[],s=0;s<this.layer.length;s++){var a=this.layer[s].exportCell(t,e);a&&i.push(a)}return i.join(",")},G.Board.prototype.idleCheck=function(){var t=this.idle;this.idle=this.checkIfIdle(),t!==this.idle?this.idle?(this.possibleMoves=this.matcher.getAllPossibleMoves(),G.sb("updatePossibleMoves").dispatch(this.possibleMoves),0==this.possibleMoves.length?this.addSpecialAction(new G.SpecialActions.Shuffle(this,this.gemLayer)):(G.sb("board-onIdle").dispatch(),this.onIdle.dispatch(),this.saving&&G.saveState.setProgressBoardData(this.exportLevel(),!1),this.hintTimer=360)):this.hintTimer=360:t&&!this.idle&&(G.sb("board-onBusy").dispatch(),this.onBusy.dispatch())},G.Board.prototype.checkIfIdle=function(){return!(this.specialActions.length>0)&&!this.gemLayer.grid.find(this.checkIfIdleGemCheck,this)},G.Board.prototype.checkIfIdleGemCheck=function(t,e,i){if(t)return t.moving||t.falling||t.locked},G.Board.prototype.importLevel=function(t){this.levelData=new G.GridArray(t),this.levelData.loop(this.importLevelCell,this)},G.Board.prototype.importLevelCell=function(t,e,i){t=t.split(",");for(var s=!1,a=0;a<t.length;a++){var r=t[a];if("X"!=r){var o=this.editorPrefixes[r[0]];o&&o.importCell(e,i,r.slice(1))}else s=!0}s||this.floorLayer.createObjectAt(e,i)},G.Board.prototype.getDimensions=function(){for(var t=0,e=0,i=0;i<this.baseGrid.width;i++)for(var s=0;s<this.baseGrid.height;s++){var a=this.baseGrid.getPxPosition(i,s);t=Math.max(t,a.x+.5*this.baseGrid.tileWidth),e=Math.max(e,a.y+.5*this.baseGrid.tileHeight)}return[t,e]},G.Board.prototype.putInRect=function(t,e,i,s,a){if("object"===_typeof(t)){var r=t;t=r.x,e=r.y,i=r.width,s=r.height}var o=this.floorLayer.width,n=this.floorLayer.height,h=this.floorLayer.getLocalBounds();o=h.width,n=h.height;var l=Math.min(i/o,s/n,a||1);this.scale.setTo(l),this.updateTransform(),o=this.floorLayer.width*l,n=this.floorLayer.height*l,this.x=Math.floor(t+.5*i-.5*o),this.y=Math.floor(e+.5*s-.5*n),this.x-=h.x,this.y-=h.y},G.Board.prototype.getPxWidth=function(){return this.floorLayer.width*this.scale.x},G.Board.prototype.getCenterOfBoard=function(){return{x:this.x+this.floorLayer.width*this.scale.x*.5,y:this.y+this.floorLayer.width*this.scale.y*.5}},G.Board.prototype.addBlockersToFloorTile=function(t){for(var e=t.gridConfig.grid,i=this.layer[0],s={Square:"squ_blocker",Hex:"hex_blocker",Triangle:"tri_blocker"}[e],a=0;a<t.blockers.length;a++){var r=t.blockers[a],o=this.getPxPosition(r[0],r[1]),n=G.makeImage(o.x,o.y,s,.5,i);"Triangle"==e&&(n.anchor.x=this.baseGrid.gemSideOffset,this.baseGrid.isPointingRight(r[0],r[1])||(n.scale.x=-1))}t.blockers.length>0&&i.updateCache()},G.BoardFallMgr=function(t){this.board=t,this.baseGrid=this.board.baseGrid,this.grid=new G.GridArray(this.board.baseGrid.width,this.board.baseGrid.height),this.lowestInCol=[],this.fallStopped=[],this.topDir=1},G.BoardFallMgr.prototype.processGrid=function(){for(var t=0;t<this.grid.width;t++){for(var e=!1,i=0,s=0;s<this.grid.height;s++){this.board.isHole(t,s)||this.board.layer[2].get(t,s)?this.grid.set(t,s,"H"):(i=s,e||(this.grid.set(t,s,"C"),e=!0))}this.lowestInCol[t]=i}},G.BoardFallMgr.prototype.update=function(){this.fallStopped=[],this.fallCheck(),this.fallCheckCrossCollumn();for(var t=0;t<this.fallStopped.length;t++){var e=this.fallStopped[t];this.board.matcher.quickMatchCheck(e.cellX,e.cellY)?this.board.matcher.cellsToProcess.push(e.cellX,e.cellY):this.fallStopped[t].bounce()}},G.BoardFallMgr.prototype.fallCheck=function(t,e,i){for(e=0;e<this.grid.width;e++)for(i=this.grid.height;i>=0;i--){var s=this.board.isCellFree(e,i),a="H"==this.grid.get(e,i);if("C"==this.grid.get(e,i)&&s)this.board.gemLayer.dropNewGem(e,i);else{this.board.isCellMoveable(e,i);var r=this.board.getGem(e,i),o=this.board.isCellMoveable(e,i-1),n=this.board.getGem(e,i-1);s&&o&&n&&n.fallTo(e,i),a&&n&&n.fallToClear&&(n.fallStop(),this.fallStopped.push(n)),r&&r.fallToClear&&this.lowestInCol[e]==i&&(r.fallStop(),this.fallStopped.push(r)),r&&n&&n.fallToClear&&(n.fallStop(),this.fallStopped.push(n))}}},G.BoardFallMgr.prototype.fallCheckCrossCollumn=function(){for(var t=0;t<this.grid.width;t++)for(var e=this.grid.height;e>=0;e--){var i=this.board.isCellFree(t,e),s="H"==this.grid.get(t,e-1),a="C"==this.grid.get(t,e-1);i&&s&&!a&&(this.topDir>0?(this.moveDiagonalByCell(t-1,e-1,t,e)||this.moveDiagonalByCell(t+1,e-1,t,e))&&(this.topDir*=-1):(this.moveDiagonalByCell(t+1,e-1,t,e)||this.moveDiagonalByCell(t-1,e-1,t,e))&&(this.topDir*=-1))}},G.BoardFallMgr.prototype.moveDiagonalByCell=function(t,e,i,s){var a=this.board.isCellMoveable(t,e),r=this.board.getGem(t,e);if(!a||!r)return!1;if(r.falling)return!1;var o=this.fallStopped.indexOf(r);return-1!==o?(this.fallStopped.splice(o,1),r.fallTo(i,s,!1,!0)):r.fallTo(i,s),!0},G.BoardFallMgr.prototype.checkCollumnAwaitsForFall=function(t,e){for(;e>=0;e--){var i=this.board.getGem(t,e);return!(!i||!i.falling)||(i&&!i.falling?!!i.locked||this.board.isCellMoveable(i.cellX,i.cellY):!this.board.isCellFree(t,e-1))}return!1},G.BoardFallMgr.prototype.getGemToMove=function(t,e){this.board.isCellMoveable(t,e)},G.BoardInput=function(t){Phaser.Image.call(this,game),this.board=t,this.state=game.state.getCurrentState(),this.currentCoord={x:0,y:0},this.cell1={x:0,y:0,gem:null,defined:!1},game.input.onDown.add(this.onClick,this),game.input.onUp.add((function(){this.cell1.defined=!1}),this),this.active=!1,G.sb("onGameStart").add((function(){this.active=!0}),this),G.sb("finishGame").add((function(){this.gameCompleted=!0}),this),G.sb("onGoalAchieved").add((function(){this.gameCompleted=!0}),this),G.sb("onPause").add((function(){this.pause=!0}),this),G.sb("onUnpause").add((function(){this.pause=!1}),this)},G.BoardInput.prototype=Object.create(Phaser.Image.prototype),G.BoardInput.prototype.update=function(){if(!this.gameCompleted&&!this.pause&&this.active){var t=game.input.activePointer;if(t.isDown&&this.cell1.defined){if(this.cell1.x!==this.cell1.gem.cellX||this.cell1.y!==this.cell1.gem.cellY)return void(this.cell1.defined=!1);if(this.board.pixelToCoord(t.x,t.y,this.currentCoord),this.cell1.x===this.currentCoord.x&&this.cell1.y==this.currentCoord.y)return;var e=this.board.getGem(this.currentCoord.x,this.currentCoord.y);if(!this.board.isCellMoveable(this.currentCoord.x,this.currentCoord.y)||!e)return void(this.cell1.defined=!1);this.board.makeMove(this.cell1.x,this.cell1.y,this.currentCoord.x,this.currentCoord.y),this.cell1.defined=!1}else this.cell1.defined=!1}},G.BoardInput.prototype.onClick=function(t){if(this.active&&!this.pause&&!this.state.tutorialOverwrites.inputMgrOnClickLock&&(this.board.pixelToCoord(t.x,t.y,this.currentCoord),this.board.isCellMoveable(this.currentCoord.x,this.currentCoord.y))){var e=this.board.getGem(this.currentCoord.x,this.currentCoord.y);if(!e)return;this.cell1.x=this.currentCoord.x,this.cell1.y=this.currentCoord.y,this.cell1.gem=e,G.sfx.click.play(),this.cell1.defined=!0}},G.BoardLayer=function(t,e){Phaser.Group.call(this,game),this.board=t,this.config=e,this.layerLabel=e.label||!1,this.blockMove=e.blockMove||!1,this.blockMatch=e.blockMatch||!1,this.blockChange=e.blockChange||!1,this.reverse=e.reverse||!1,this.stopPropagation=e.stopPropagation||!1,this.objConstructor=G[e.objConstructor]||null,this.blocker=e.blocker||!1,this.floor=e.floor,this.gems=e.gems,this.editorPrefix=e.editorPrefix,this.caching=e.caching||!1,this.deadElements=[],this.grid=new G.GridArray(this.board.baseGrid.width,this.board.baseGrid.height),this.orderCacheUpdate=!1},G.BoardLayer.prototype=Object.create(Phaser.Group.prototype),G.BoardLayer.prototype.update=function(){this.caching&&this.orderCacheUpdate&&(this.orderCacheUpdate=!1,this.caching&&this.updateCache());for(var t=this.children.length;t--;)this.children[t].update()},G.BoardLayer.prototype.getFreeObject=function(){if(this.deadElements[0])return this.deadElements.splice(0,1)[0];if(this.objConstructor)t=new this.objConstructor(this,this.board,this.blocker);else var t=new G.BoardElementBlocker(this,this.board,this.blocker);return t.events.onKilled.add(this.onObjectKill,this),t},G.BoardLayer.prototype.onObjectKill=function(t){this.grid.set(t.cellX,t.cellY,!1),this.board.onElementKilled.dispatch(this.layerLabel,t,this.grid.count()),t.parent&&t.parent.removeChild(t),this.deadElements.push(t)},G.BoardLayer.prototype.isMoveBlocked=function(t,e){var i=this.grid.get(t,e);return i?i.isMoveable?i.isMoveBlocked():this.reverse?!this.blockMove:this.blockMove:!!this.reverse},G.BoardLayer.prototype.isMatchBlocked=function(t,e){var i=this.grid.get(t,e);return!!i&&(i.isMatchable?i.isMatchBlocked():this.reverse?!this.blockMatch:this.blockMatch)},G.BoardLayer.prototype.isChangeBlocked=function(t,e){var i=this.grid.get(t,e);return!!i&&(i.isChangeBlocked?i.isChangeBlocked():this.reverse?!this.blockChange:this.blockChange)},G.BoardLayer.prototype.onMatch=function(t,e){var i=this.grid.get(t,e);return!i||(i.onMatch(),!this.stopPropagation)},G.BoardLayer.prototype.onHit=function(t,e){var i=this.grid.get(t,e);return!i||(i.onHit(),!this.stopPropagation)},G.BoardLayer.prototype.get=function(t,e){return this.grid.get(t,e)},G.BoardLayer.prototype.changeCell=function(t,e,i){if(t.cellX==e&&t.cellY==i);this.grid.set(t.cellX,t.cellY,!1),t.cellX=e,t.cellY=i,this.grid.set(e,i,t)},G.BoardLayer.prototype.swapObjects=function(t,e){var i=t.cellX,s=t.cellY,a=e.cellX,r=e.cellY;t.cellX=a,t.cellY=r,e.cellX=i,e.cellY=s,this.grid.set(t.cellX,t.cellY,!1),this.grid.set(e.cellX,e.cellY,!1),this.grid.set(t.cellX,t.cellY,t),this.grid.set(e.cellX,e.cellY,e)},G.BoardLayer.prototype.createObjectAt=function(t,e,i){var s=this.getFreeObject();s.init(t,e,i),this.add(s),this.grid.set(t,e,s),this.orderCacheUpdate=!0},G.BoardLayer.prototype.fillBoard=function(){this.grid.loop((function(t,e,i){this!==this.board.floorLayer?this.board.floorLayer.get(e,i)&&this.createObjectAt(e,i):this.createObjectAt(e,i)}),this)},G.BoardLayer.prototype.exportCell=function(t,e){return this.reverse?this.grid.get(t,e)?"":this.editorPrefix:this.grid.get(t,e)?this.editorPrefix+this.grid.get(t,e).export():""},G.BoardLayer.prototype.importCell=function(t,e,i){this.reverse?i||this.createObjectAt(t,e,i):i&&this.createObjectAt(t,e,i)},G.BoardLayer.prototype.exportBoard=function(){var t=new G.GridArray(this.grid.width,this.grid.height,"");return t.loop((function(t,e,i,s){s[e][i]=this.exportCell(e,i)}),this),t.data},G.BoardLayer.prototype.detachFromLayer=function(t){this.get(t.cellX,t.cellY)===t&&this.grid.set(t.cellX,t.cellY,!1)},G.BoardMatcher=function(t,e){this.board=t,this.baseGrid=this.board.baseGrid,this.gridMatch=new G.GridArray(this.baseGrid.width,this.baseGrid.height,!1),this.gridHit=new G.GridArray(this.baseGrid.width,this.baseGrid.height,!1),this.cellsToProcess=[],this.specialMatches=[],this.normalMatches=[],this.matchDirections=e},G.BoardMatcher.prototype.update=function(){if(this.cellsToProcess.length>0){this.gridMatch.clear(!1),this.gridHit.clear(!1),this.specialMatches=[],this.normalMatches=[];for(var t=0;t<this.cellsToProcess.length;t+=2)this.checkMatch(this.cellsToProcess[t],this.cellsToProcess[t+1]);this.specialMatches=this.processMatches(this.specialMatches),this.normalMatches=this.processMatches(this.normalMatches),this.dispatchMatches(this.normalMatches),this.dispatchMatches(this.specialMatches),G.sfx.match.play(),this.processMatchGrid(),this.prepareHitGrid(),this.processHitGrid(),this.cellsToProcess=[]}},G.BoardMatcher.prototype.prepareHitGrid=function(){this.gridMatch.loop(this.prepareHitGridCell,this)},G.BoardMatcher.prototype.processHitGrid=function(){this.gridHit.loop(this.processHitGridCell,this)},G.BoardMatcher.prototype.processHitGridCell=function(t,e,i){"h"==t&&this.board.hitCell(e,i)},G.BoardMatcher.prototype.processMatchGridCell=function(t,e,i){if(t){var s=this.board.getGem(e,i),a=this.board.isCellMoveable(e,i),r=this.board.isCellChangeable(e,i);s.wasMoved=!1,"m"!==t&&r&&a?"changeInto"===t[0]?s.changeIntoSpecial(t[1]):"moveTo"===t[0]&&(G.sb("moveToNonCache").dispatch(s),s.mergeWithCell(t[1][0],t[1][1])):this.board.matchCell(e,i),s.wasMoved=!1}},G.BoardMatcher.prototype.tryApplySpecial=function(t){t.gems;var e=t.gems.length;if(this.checkIfSpecialIsPossible(t)){var s=this.findWhichGemShouldBeTurnedInSpecial(t);if(s){for(i=0;i<e;i++)gem=t.gems[i],gem===s?this.gridMatch.set(gem.cellX,gem.cellY,["changeInto",t.specialType]):this.gridMatch.set(gem.cellX,gem.cellY,["moveTo",[s.cellX,s.cellY]]);t.successful=!0}}},G.BoardMatcher.prototype.tryApplyNormal=function(t){t.gems=this.getNotMarkedOnMatchGrid(t.gems),0!=t.gems.length&&(this.markAsRegularMatch(t.gems),t.successful=!0)},G.BoardMatcher.prototype.checkIfSpecialIsPossible=function(t){for(var e=0;e<t.gems.length;e++){var i=t.gems[e];if(!1!==this.gridMatch.get(i.cellX,i.cellY))return!1}return!0},G.BoardMatcher.prototype.dispatchMatches=function(t){t.forEach((function(t){t.gems=t.gems.filter((function(t){return!!(this.board.willMatchGem(t.cellX,t.cellY)&&"m"==this.gridMatch.get(t.cellX,t.cellY))&&(t.pointMarked=!0,!0)}),this),0!=t.gems.length&&(t.centroid=Phaser.Point.centroid(t.gems),this.board.onMatch.dispatch(t))}),this)},G.BoardMatcher.prototype.processMatches=function(t){t.sort((function(t,e){return t.priority-e.priority}));for(var e=0;e<t.length;e++)t[e].special?this.tryApplySpecial(t[e]):this.tryApplyNormal(t[e]);return t.filter((function(t){return t.successful}))},G.BoardMatcher.prototype.processMatchGrid=function(){this.gridMatch.loop(this.processMatchGridCell,this)},G.BoardMatcher.prototype.isAnyMovePossible=function(){for(var t=0;t<this.board.baseGrid.width;t++)for(var e=0;e<this.board.baseGrid.height;e++){if(this.checkPossibleMoves(t,e).length>0)return!0}},G.BoardMatcher.prototype.getAllPossibleMoves=function(){for(var t=[],e=0;e<this.board.baseGrid.width;e++)for(var i=0;i<this.board.baseGrid.height;i++)for(var s=this.checkPossibleMoves(e,i),a=0;a<s.length;a++)t.push(s[a]);return t},G.BoardMatcher.prototype.makeMatchObject=function(t,e,i){i&&this.specialMatches.push({gems:t,special:!0,specialType:i,priority:e}),this.normalMatches.push({gems:t,priority:e})},G.BoardMatcher.prototype.sortCells=function(t){t.sort((function(t,e){return t.priority-e.priority}))},G.BoardMatcher.prototype.markAsRegularMatch=function(t){for(var e=0;e<t.length;e++)this.gridMatch.set(t[e].cellX,t[e].cellY,"m")},G.BoardMatcher.prototype.getNotMarkedOnMatchGrid=function(t){for(var e=[],i=0;i<t.length;i++)!1===this.gridMatch.get(t[i].cellX,t[i].cellY)&&e.push(t[i]);return e},G.BoardMatcher.prototype.quickMatchCheck=function(t,e){var i=this.board.gemLayer.get(t,e);if(!i)return!1;if(!this.board.isCellMatchable(t,e))return!1;for(var s={x:0,y:0},a=0;a<this.matchDirections.length;a++){for(var r=this.matchDirections[a],o=1,n=0;n<r.length;n++){var h=r[n];s.x=i.cellX,s.y=i.cellY;for(var l=0;l<2&&(s=this.board.baseGrid.getNeighbourCoords(s.x,s.y,h,s),this.board.isCellMatchableWith(s.x,s.y,i));l++)o++}if(o>=3)return!0}return!1},G.BoardMatcher.prototype.checkMatchDirection=function(t,e,i,s){for(var a={x:t,y:e},r=[];a=this.baseGrid.getNeighbourCoords(a.x,a.y,i,a),this.board.isCellMatchableWith(a.x,a.y,s);){var o=this.board.getGem(a.x,a.y);r.push(o)}return r},G.BoardMatcher.prototype.getAllPossibleMoves=function(){for(var t=[],e=this.board.baseGrid.width,i=this.board.baseGrid.height,s=0;s<e;s++)for(var a=0;a<i;a++){var r=this.checkPossibleMoves(s,a);r&&(t=t.concat(r))}return t},G.BoardMatcher.prototype.checkMatch=function(t,e){},G.BoardMatcher.prototype.findWhichGemShouldBeTurnedInSpecial=function(t){},G.BoardMatcher.prototype.checkPossibleMoves=function(t,e){return[]},G.BoardMatcher.prototype.quickMatchCheckData=function(t,e,i,s){},G.BoardMatcherHex=function(t){G.BoardMatcher.call(this,t,[["U","D"],["LU","RD"],["LD","RU"]])},G.BoardMatcherHex.prototype=Object.create(G.BoardMatcher.prototype),G.BoardMatcherHex.prototype.checkMatch=function(t,e){var i=this.board.getGem(t,e);if(!i||!i.isMatchable())return[];var s=this.checkMatchDirection(t,e,"U",i),a=this.checkMatchDirection(t,e,"D",i),r=1+s.length+a.length,o=this.checkMatchDirection(t,e,"LU",i),n=this.checkMatchDirection(t,e,"RD",i),h=1+o.length+n.length,l=this.checkMatchDirection(t,e,"LD",i),c=this.checkMatchDirection(t,e,"RU",i),d=1+l.length+c.length,p=[];r>=3&&(this.makeMatchObject([i].concat(s,a),3),p=p.concat(s,a)),h>=3&&(this.makeMatchObject([i].concat(o,n),3),p=p.concat(o,n)),d>=3&&(this.makeMatchObject([i].concat(l,c),3),p=p.concat(l,c)),p.length>0&&(p.push(i),p=G.Utils.removeDuplicates(p),this.board.onCombinedMatch.dispatch(p))},G.BoardMatcherHex.prototype.findWhichGemShouldBeTurnedInSpecial=function(){return!1},G.BoardMatcherHex.prototype.prepareHitGridCell=function(t,e,i){t&&(this.gridHit.set(e,i,"h"),this.gridHit.set(e-1,i,"h"),this.gridHit.set(e+1,i,"h"),this.gridHit.set(e,i-1,"h"),this.gridHit.set(e,i+1,"h"))},G.BoardMatcherHex.prototype.checkPossibleMoves=function(t,e){var i=this.board.gemLayer.get(t,e);if(!i)return!1;if(!this.board.isCellMoveable(t,e))return!1;if(!this.board.isCellMatchable(t,e))return!1;for(var s=[],a={x:0,y:0},r={x:0,y:0},o={x:0,y:0},n=(i.matchType,0);n<this.baseGrid.directions.length;n++)a=this.baseGrid.getNeighbourCoords(t,e,n,a),this.board.isCellMoveable(a.x,a.y)&&(r=this.baseGrid.getNeighbourCoords(a.x,a.y,n,r),o=this.baseGrid.getNeighbourCoords(r.x,r.y,n,o),this.board.isCellMatchableWith(r.x,r.y,i)&&this.board.isCellMatchableWith(o.x,o.y,i)?s.push([t,e,a.x,a.y]):(r=this.baseGrid.getNeighbourCoords(a.x,a.y,n-1,r),o=this.baseGrid.getNeighbourCoords(a.x,a.y,n-1+3,o),this.board.isCellMatchableWith(r.x,r.y,i)&&this.board.isCellMatchableWith(o.x,o.y,i)?s.push([t,e,a.x,a.y]):(r=this.baseGrid.getNeighbourCoords(a.x,a.y,n-1,r),o=this.baseGrid.getNeighbourCoords(r.x,r.y,n-1,o),this.board.isCellMatchableWith(r.x,r.y,i)&&this.board.isCellMatchableWith(o.x,o.y,i)?s.push([t,e,a.x,a.y]):(r=this.baseGrid.getNeighbourCoords(a.x,a.y,n-1+3,r),o=this.baseGrid.getNeighbourCoords(r.x,r.y,n-1+3,o),this.board.isCellMatchableWith(r.x,r.y,i)&&this.board.isCellMatchableWith(o.x,o.y,i)?s.push([t,e,a.x,a.y]):(r=this.baseGrid.getNeighbourCoords(a.x,a.y,n+1,r),o=this.baseGrid.getNeighbourCoords(a.x,a.y,n+1+3,o),this.board.isCellMatchableWith(r.x,r.y,i)&&this.board.isCellMatchableWith(o.x,o.y,i)?s.push([t,e,a.x,a.y]):(r=this.baseGrid.getNeighbourCoords(a.x,a.y,n+1,r),o=this.baseGrid.getNeighbourCoords(r.x,r.y,n+1,o),this.board.isCellMatchableWith(r.x,r.y,i)&&this.board.isCellMatchableWith(o.x,o.y,i)?s.push([t,e,a.x,a.y]):(r=this.baseGrid.getNeighbourCoords(a.x,a.y,n+1+3,r),o=this.baseGrid.getNeighbourCoords(r.x,r.y,n+1+3,o),this.board.isCellMatchableWith(r.x,r.y,i)&&this.board.isCellMatchableWith(o.x,o.y,i)&&s.push([t,e,a.x,a.y]))))))));return s},G.BoardMatcherHex.quickMatchCheckData=function(t,e,i,s){var a=i[t][e];if(!a)return!1;for(var r=[["U","D"],["LU","RD"],["LD","RU"]],o={x:0,y:0},n=0;n<r.length;n++){for(var h=r[n],l=1,c=0;c<h.length;c++){var d=h[c];o.x=t,o.y=e;for(var p=0;p<2&&i[(o=s.getNeighbourCoords(o.x,o.y,d,o)).x]&&a==i[o.x][o.y];p++)l++}if(l>=3)return!0}return!1},G.BoardMatcherSquare=function(t){G.BoardMatcher.call(this,t,[["U","D"],["L","R"]])},G.BoardMatcherSquare.prototype=Object.create(G.BoardMatcher.prototype),G.BoardMatcherSquare.prototype.checkMatch=function(t,e){var i=this.board.getGem(t,e);if(!i||!i.isMatchable())return[];var s=this.checkMatchDirection(t,e,"R",i),a=this.checkMatchDirection(t,e,"L",i),r=1+s.length+a.length,o=this.checkMatchDirection(t,e,"U",i),n=this.checkMatchDirection(t,e,"D",i),h=1+o.length+n.length;if(!(r<3&&h<3)){var l=[];r>=3&&(this.makeMatchObject([i].concat(a,s),3),l=l.concat(a,s)),h>=3&&(this.makeMatchObject([i].concat(o,n),3),l=l.concat(o,n)),l.length>0&&(l.push(i),l=G.Utils.removeDuplicates(l),this.board.onCombinedMatch.dispatch(l))}},G.BoardMatcherSquare.prototype.findWhichGemShouldBeTurnedInSpecial=function(t){var e=t.gems,i=t.gems.length;if("star"==t.specialType&&e[0]&&this.board.isCellChangeable(e[0].cellX,e[0].cellY))return e[0];for(var s=0;s<i;s++)if(e[s].wasMoved&&this.board.isCellChangeable(e[s].cellX,e[s].cellY))return e[s];e.sort((function(t,e){return t.cellX+t.cellY-(e.cellX+e.cellY)}));for(var a=Math.floor(.5*i),r=1,o=0;o<i;o++)if(a+=o*r,r*=-1,this.board.isCellChangeable(e[a].cellX,e[a].cellY))return e[a];return!1},G.BoardMatcherSquare.prototype.prepareHitGridCell=function(t,e,i){t&&(this.gridHit.set(e,i,"h"),this.gridHit.set(e-1,i,"h"),this.gridHit.set(e+1,i,"h"),this.gridHit.set(e,i-1,"h"),this.gridHit.set(e,i+1,"h"))},G.BoardMatcherSquare.prototype.checkPossibleMoves=function(t,e){var i=this.board.gemLayer.get(t,e);if(!i)return!1;if(!this.board.isCellMoveable(t,e))return!1;if(!this.board.isCellMatchable(t,e))return!1;var s=[],a=this.board.isCellMatchableWith(t+1,e-1,i),r=this.board.isCellMatchableWith(t+1,e+1,i),o=this.board.isCellMatchableWith(t-1,e-1,i),n=this.board.isCellMatchableWith(t-1,e+1,i);return this.board.isCellMoveable(t+1,e)&&(a&&r||this.board.isCellMatchableWith(t+2,e,i)&&this.board.isCellMatchableWith(t+3,e,i)||a&&this.board.isCellMatchableWith(t+1,e-2,i)||r&&this.board.isCellMatchableWith(t+1,e+2,i))&&s.push([t,e,t+1,e]),this.board.isCellMoveable(t-1,e)&&(o&&n||this.board.isCellMatchableWith(t-2,e,i)&&this.board.isCellMatchableWith(t-3,e,i)||o&&this.board.isCellMatchableWith(t-1,e-2,i)||n&&this.board.isCellMatchableWith(t-1,e+2,i))&&s.push([t,e,t-1,e]),this.board.isCellMoveable(t,e+1)&&(n&&r||this.board.isCellMatchableWith(t,e+2,i)&&this.board.isCellMatchableWith(t,e+3,i)||n&&this.board.isCellMatchableWith(t-2,e+1,i)||r&&this.board.isCellMatchableWith(t+2,e+1,i))&&s.push([t,e,t,e+1]),this.board.isCellMoveable(t,e-1)&&(o&&a||this.board.isCellMatchableWith(t,e-2,i)&&this.board.isCellMatchableWith(t,e-3,i)||o&&this.board.isCellMatchableWith(t-2,e-1,i)||a&&this.board.isCellMatchableWith(t+2,e-1,i))&&s.push([t,e,t,e-1]),s},G.BoardMatcherSquare.quickMatchCheckData=function(t,e,i,s){var a=i[t][e];if(!a)return!1;for(var r=[["U","D"],["L","R"]],o={x:0,y:0},n=0;n<r.length;n++){for(var h=r[n],l=1,c=0;c<h.length;c++){var d=h[c];o.x=t,o.y=e;for(var p=0;p<2&&i[(o=s.getNeighbourCoords(o.x,o.y,d,o)).x]&&a==i[o.x][o.y];p++)l++}if(l>=3)return!0}return!1},G.BoardMatcherTriangle=function(t){G.BoardMatcher.call(this,t,[["U","D"],["LU","RD"],["LD","RU"]])},G.BoardMatcherTriangle.prototype=Object.create(G.BoardMatcher.prototype),G.BoardMatcherTriangle.prototype.checkMatch=function(t,e){var i=this.board.getGem(t,e);if(!i||!i.isMatchable())return[];var s=this.checkMatchDirection(t,e,"U",i),a=this.checkMatchDirection(t,e,"D",i),r=1+s.length+a.length,o=this.checkMatchDirection(t,e,"LU",i),n=this.checkMatchDirection(t,e,"RD",i),h=1+o.length+n.length,l=this.checkMatchDirection(t,e,"LD",i),c=this.checkMatchDirection(t,e,"RU",i),d=1+l.length+c.length,p=[];r>=3&&(this.makeMatchObject([i].concat(s,a),3),p=p.concat(s,a)),h>=3&&(this.makeMatchObject([i].concat(o,n),3),p=p.concat(o,n)),d>=3&&(this.makeMatchObject([i].concat(l,c),3),p=p.concat(l,c)),p.length>0&&(p.push(i),p=G.Utils.removeDuplicates(p),this.board.onCombinedMatch.dispatch(p))},G.BoardMatcherTriangle.prototype.findWhichGemShouldBeTurnedInSpecial=function(){return!1},G.BoardMatcherTriangle.prototype.prepareHitGridCell=function(t,e,i){t&&(this.gridHit.set(e,i,"h"),this.gridHit.set(e-1,i,"h"),this.gridHit.set(e+1,i,"h"),this.gridHit.set(e,i-1,"h"),this.gridHit.set(e,i+1,"h"))},G.BoardMatcherTriangle.prototype.checkPossibleMoves=function(t,e){var i=this.board.gemLayer.get(t,e);if(!i)return!1;if(!this.board.isCellMoveable(t,e))return!1;if(!this.board.isCellMatchable(t,e))return!1;var s=[];return this.baseGrid.isPointingRight(t,e)?(this.board.isCellMoveable(t,e-1)&&this.checkPossibleMoveCoords(t,e,i,this.possibleMoveCoords.right.U)&&s.push([t,e,t,e-1]),this.board.isCellMoveable(t,e+1)&&this.checkPossibleMoveCoords(t,e,i,this.possibleMoveCoords.right.D)&&s.push([t,e,t,e+1]),this.board.isCellMoveable(t-1,e)&&this.checkPossibleMoveCoords(t,e,i,this.possibleMoveCoords.right.L)&&s.push([t,e,t-1,e])):(this.board.isCellMoveable(t,e-1)&&this.checkPossibleMoveCoords(t,e,i,this.possibleMoveCoords.left.U)&&s.push([t,e,t,e-1]),this.board.isCellMoveable(t,e+1)&&this.checkPossibleMoveCoords(t,e,i,this.possibleMoveCoords.left.D)&&s.push([t,e,t,e+1]),this.board.isCellMoveable(t+1,e)&&this.checkPossibleMoveCoords(t,e,i,this.possibleMoveCoords.left.R)&&s.push([t,e,t+1,e])),s},G.BoardMatcherTriangle.prototype.checkPossibleMoveCoords=function(t,e,i,s){for(var a=0,r=s.length;a<r;a++){var o=s[a];if(this.board.isCellMatchableWith(t+o[0][0],e+o[0][1],i)&&this.board.isCellMatchableWith(t+o[1][0],e+o[1][1],i))return!0}return!1},G.BoardMatcherTriangle.prototype.possibleMoveCoords={right:{D:[[[0,2],[0,3]],[[0,2],[-1,2]],[[1,1],[1,2]],[[1,1],[1,0]],[[0,2],[1,1]]],L:[[[-1,-1],[-1,-2]],[[-1,1],[-1,2]],[[-1,-1],[-2,-1]],[[-1,-1],[-1,1]],[[-1,1],[-2,1]]],U:[[[0,-2],[0,-3]],[[0,-2],[1,-1]],[[1,0],[1,-1]],[[1,-1],[1,-2]],[[0,-2],[-1,-2]]]},left:{U:[[[0,-2],[0,-3]],[[0,-2],[-1,-1]],[[-1,-1],[-1,-2]],[[0,-2],[1,-2]],[[-1,-1],[-1,0]]],D:[[[0,2],[0,3]],[[-1,1],[0,2]],[[0,2],[1,2]],[[-1,1],[-1,2]],[[-1,1],[-1,0]]],R:[[[1,-1],[1,-2]],[[1,1],[1,2]],[[1,-1],[1,1]],[[1,-1],[2,-1]],[[1,1],[2,1]]]}},G.BoardMatcherTriangle.quickMatchCheckData=function(t,e,i,s){var a=i[t][e];if(!a)return!1;for(var r=[["U","D"],["LU","RD"],["RU","LD"]],o={x:0,y:0},n=0;n<r.length;n++){for(var h=r[n],l=1,c=0;c<h.length;c++){var d=h[c];o.x=t,o.y=e;for(var p=0;p<2&&i[(o=s.getNeighbourCoords(o.x,o.y,d,o)).x]&&a==i[o.x][o.y];p++)l++}if(l>=3)return!0}return!1},G.BoardRT=function(t,e,i){Phaser.Group.call(this,game),this.x=t,this.y=e;var s=i.levelData;this.level=i;var a=s.length,r=s[0].length;this.gridConfig=i.gridConfig||G.json.BOARDSETTINGS.gridConfig||{grid:"Square"},"Square"==this.gridConfig.grid?(this.baseGrid=new G.SquareGrid(a,r,this.gridConfig),this.matcher=G.BoardMatcherSquare):"Triangle"==this.gridConfig.grid?(this.baseGrid=new G.TriangleGrid(a,r,this.gridConfig),this.matcher=G.BoardMatcherTriangle):(this.baseGrid=new G.HexGrid(a,r,this.gridConfig),this.matcher=G.BoardMatcherHex),this.tileWidth=this.baseGrid.tileWidth,this.tileHeight=this.baseGrid.tileHeight,this.renderTexture=game.make.renderTexture(1,1),this.markerImg=G.makeImage(0,0,null,.5,null),this.boardLayersData=G.json.BOARDSETTINGS.layers,this.levelData=s,this.image=game.make.image(0,0,this.renderTexture),this.image.autoCull=!0,this.add(this.image),this.redraw()},G.BoardRT.prototype=Object.create(Phaser.Group.prototype),G.BoardRT.prototype.getDimensions=function(){for(var t=0,e=0,i=0;i<this.baseGrid.width;i++)for(var s=0;s<this.baseGrid.height;s++){var a=this.baseGrid.getPxPosition(i,s);t=Math.max(t,a.x+.5*this.tileWidth),e=Math.max(e,a.y+.5*this.tileHeight)}return[t,e]},G.BoardRT.prototype.redraw=function(){this.levelData.length,this.levelData[0].length;var t=this.getDimensions();this.renderTexture.resize(t[0],t[1]),this.renderTexture.clear(),this.processBoardLayers()},G.BoardRT.prototype.processBoardLayers=function(){this.boardLayersData.forEach((function(t){this.processLayer(t)}),this)},G.BoardRT.prototype.processLayer=function(t){for(var e=this.levelData.length,i=this.levelData[0].length,s=0;s<e;s++)for(var a=0;a<i;a++){for(var r=this.levelData[s][a].split(","),o=null,n=0;n<r.length;n++)if(r[n][0]===t.editorPrefix){o=r[n].slice(1);break}var h=this.baseGrid.getPxPosition(s,a);this.markerImg.x=h.x,this.markerImg.y=h.y,this.markerImg.updateTransform(),t.floor&&null===o?G.FloorTile.drawOnRenderTexture(this.renderTexture,this.markerImg,s,a,this.baseGrid):t.gems&&o?G.Gem.drawOnRenderTexture(this.renderTexture,this.markerImg,s,a,this.baseGrid,o):o&&(t.objConstructor?G[t.objConstructor].drawOnRenderTexture(this.renderTexture,this.markerImg,s,a,this.baseGrid,o,t.blocker):t.blocked&&G.BoardElementBlocker.drawOnRenderTexture(this.renderTexture,this.markerImg,s,a,this.baseGrid,o,t.blocker))}},G.BoardRTEditor=function(t,e,i,s){this.levelArray=i,this.levelIndex=s,this.level=this.levelArray[this.levelIndex],G.BoardRT.call(this,t,e,this.level,!1);var a=this.levelArray[this.levelIndex].levelData;this.boardWidth=a.length,this.boardHeight=a[0].length,this.textStyle={font:"bold 20pt Arial",fill:"#000000"},this.textButtonStyle={font:"bold 20pt Arial",fill:"#00ff00"},this.labels=this.add(game.make.group()),this.labelWidth=50,this.labelPadding=10,this.labelOffsetY=30,this.layerVisiblitityGroup=this.add(this.makeVisShufflePanel()),this.initInput(),this.buttonGroup=this.makeButtonGroup(),this.add(this.buttonGroup),this.symmetryVConst=!1,this.symmetryHConst=!1},G.BoardRTEditor.prototype=Object.create(G.BoardRT.prototype),G.BoardRTEditor.prototype.update=function(){this.labels.y=this.image.height,this.layerVisiblitityGroup.x=this.image.width+10,this.layerVisiblitityGroup.y=30},G.BoardRTEditor.prototype.initInput=function(){var t=["Z","X","C","V","B","N","M"];this.keys={},this.keys.control=game.input.keyboard.addKey(Phaser.Keyboard.CONTROL);var e=0;this.boardLayersData.forEach((function(i,s){if(i.gems)this.initGemInput(i);else{var a=t.splice(0,1)[0];this.keys[a]=game.input.keyboard.addKey(Phaser.Keyboard[a]).onDown.add(this.standardChange,this,0,i);var r=e*(this.labelWidth+this.labelPadding),o=3*this.labelOffsetY,n=i.editorIcon,h=G.makeImage(r,o,n,0,this.labels);h.width=.5*this.labelWidth,h.scale.y=h.scale.x;this.labels.add(game.make.text(r+.5*this.labelWidth,o,a,this.textStyle));e++}i._alpha=1}),this)},G.BoardRTEditor.prototype.initGemInput=function(t){for(var e=[["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","ZERO"],["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"]],i=0;i<t.editorPossibilities.length;i++)for(var s=0;s<t.editorPossibilities[i].length;s++){var a=e[i].splice(0,1)[0];this.keys[a]=game.input.keyboard.addKey(Phaser.Keyboard[a]).onDown.add(this.standardChange,this,0,t,t.editorPossibilities[i][s][0]),0==i&&(a=s+1);var r=s*(this.labelWidth+this.labelPadding),o=this.labelOffsetY*i,n=G.makeImage(r,o,t.editorPossibilities[i][s][1],0,this.labels);n.width=.5*this.labelWidth,n.scale.y=n.scale.x;this.labels.add(game.make.text(r+.5*this.labelWidth,o,a,this.textStyle))}},G.BoardRTEditor.prototype.standardChange=function(t,e,i,s,a,r){var o=game.input.activePointer,n=this.baseGrid.pixelToCoord(o.worldX,o.worldY,this.image.worldPosition,this.image.scale);if(void 0!==s&&(n.x=s,n.y=a),this.isCellInBoard(n.x,n.y)){var h,l=this.levelData[n.x][n.y].split(","),c=!1;if(l.forEach((function(t,i){t[0]===e.editorPrefix&&(c=t.slice(1),i)})),e.floor){l[0]?this.levelData[n.x][n.y]="":this.levelData[n.x][n.y]="X";var d=this.posSymmetry(n,!0,!1),p=this.posSymmetry(n,!1,!0),u=this.posSymmetry(n,!0,!0);return this.symmetryVConst&&this.symmetryHConst&&(this.levelData[u.x][u.y]=this.levelData[n.x][n.y]),this.symmetryVConst&&(this.levelData[d.x][d.y]=this.levelData[n.x][n.y]),this.symmetryHConst&&(this.levelData[p.x][p.y]=this.levelData[n.x][n.y]),this.updateAppearances(),void this.redraw()}e.gems&&"X"!==l[0]?h=G.Gem.changeImportData(c,i):e.blocker&&"X"!==l[0]&&(h=G.BoardElementBlocker.changeImportData(c,e.blocker)),this.keys.control.isDown&&(h=""),this.changeCell(n.x,n.y,e.editorPrefix,h),this.updateAppearances(),r||this.redraw()}},G.BoardRTEditor.prototype.changeCell=function(t,e,i,s,a){if("X"===i||"X"!==this.levelData[t][e]){if(!a&&(this.symmetryVConst||this.symmetryHConst)){var r=this.posSymmetry({x:t,y:e},!0,!1),o=this.posSymmetry({x:t,y:e},!1,!0),n=this.posSymmetry({x:t,y:e},!0,!0);this.changeCell(t,e,i,s,!0),this.symmetryVConst&&this.symmetryHConst&&this.changeCell(n.x,n.y,i,s,!0),this.symmetryVConst&&this.changeCell(r.x,r.y,i,s,!0),this.symmetryHConst&&this.changeCell(o.x,o.y,i,s,!0)}s&&(s=i+s);var h=this.levelData[t][e].split(","),l=h.findIndex((function(t){return t[0]==i}));-1!==l?h[l]=s:s&&h.push(s),this.levelData[t][e]=G.arrayJoin(h,",")}},G.BoardRTEditor.prototype.isCellInBoard=function(t,e){return t>=0&&t<this.levelData.length&&e>=0&&e<this.levelData[0].length},G.BoardRTEditor.prototype.changeBoardWidth=function(t){var e=G.json.BOARDSETTINGS;if(!(t<e.widthMin||t>e.widthMax)){var i=this.levelData.length,s=this.levelData[0].length;if(this.boardWidth=t,i<t)for(var a=i;a<t;a++)this.levelData[a]=[],this.levelData[a].length=s,this.levelData[a].fill("@r");else this.levelData.length=t;this.buttonGroup.boardSizeTxt.text=this.boardWidth+"x"+this.boardHeight,this.baseGrid.width=t,this.redraw()}},G.BoardRTEditor.prototype.changeBoardHeight=function(t){var e=G.json.BOARDSETTINGS;if(!(t<e.heightMin||t>e.heightMax)){var i=this.levelData.length,s=this.levelData[0].length;if(this.boardHeight=t,s<t)for(var a=0;a<i;a++)this.levelData[a].length=t,this.levelData[a].fill("@r",s);else for(a=0;a<i;a++)this.levelData[a].length=t;this.buttonGroup.boardSizeTxt.text=this.boardWidth+"x"+this.boardHeight,this.baseGrid.height=t,this.redraw()}},G.BoardRTEditor.prototype.symmetryV=function(){for(var t=this.levelData.length,e=this.levelData,i=JSON.parse(JSON.stringify(e)),s=t%2==0?.5*t:Math.floor(.5*t),a=0;a<s;a++)i[a]=e[a],i[t-(a+1)]=JSON.parse(JSON.stringify(e[a]));this.levelData=i,this.levelArray[this.levelIndex].levelData=this.levelData,this.updateAppearances(),this.redraw()},G.BoardRTEditor.prototype.symmetryH=function(){for(var t=this.levelData[0].length,e=this.levelData,i=JSON.parse(JSON.stringify(e)),s=t%2==0?.5*t:Math.floor(.5*t),a=0;a<e.length;a++)for(var r=0;r<s;r++)i[a][t-(r+1)]=JSON.parse(JSON.stringify(i[a][r]));this.levelData=i,this.levelArray[this.levelIndex].levelData=this.levelData,this.updateAppearances(),this.redraw()},G.BoardRTEditor.prototype.fillWithRandomSoft=function(){for(var t=this.getGemData(),e=0;e<t.length;e++)for(var i=0;i<t[0].length;i++)t[e][i],t[e][i]="r";this.injectGemData(t)},G.BoardRTEditor.prototype.fillWithRandomHard=function(){for(var t=0;t<this.levelData.length;t++)for(var e=0;e<this.levelData[0].length;e++)this.levelData[t][e]="@r";this.updateAppearances(),this.redraw()},G.BoardRTEditor.prototype.makeButtonGroup=function(){var t=this.textButtonStyle,e=game.make.group();e.boardSizeTxt=e.add(G.makeTextButton(0,-30,this.boardWidth+"x"+this.boardHeight,this.textButtonStyle,(function(){var t=parseInt(prompt("width"));isNaN(t)||this.changeBoardWidth(t);var e=parseInt(prompt("height"));isNaN(e)||this.changeBoardHeight(e)}),this)),e.add(G.makeTextButton(150,-30,"W-",t,(function(){this.changeBoardWidth(this.levelData.length-1)}),this)),e.add(G.makeTextButton(200,-30,"W+",t,(function(){this.changeBoardWidth(this.levelData.length+1)}),this)),e.add(G.makeTextButton(250,-30,"H-",t,(function(){this.changeBoardHeight(this.levelData[0].length-1)}),this)),e.add(G.makeTextButton(300,-30,"H+",t,(function(){this.changeBoardHeight(this.levelData[0].length+1)}),this)),e.add(G.makeTextButton(350,-30,"SV",t,this.symmetryV,this)),e.add(G.makeTextButton(400,-30,"SH",t,this.symmetryH,this));var i=G.makeTextButton(450,-30,"SV-",t,(function(){this.symmetryVConst=!this.symmetryVConst,i.text=this.symmetryVConst?"SV+":"SV-",i.style.fill=this.symmetryVConst?"#00ff00":"#ff0000",i.updateText()}),this);i.style.fill="#ff0000",i.updateText(),e.add(i);var s=G.makeTextButton(500,-30,"SH-",t,(function(){this.symmetryHConst=!this.symmetryHConst,s.text=this.symmetryHConst?"SH+":"SH-",s.style.fill=this.symmetryHConst?"#00ff00":"#ff0000",s.updateText()}),this);return s.style.fill="#ff0000",s.updateText(),e.add(s),e.add(G.makeTextButton(600,-30,"SR",t,this.fillWithRandomSoft,this)),e.add(G.makeTextButton(650,-30,"HR",t,this.fillWithRandomHard,this)),e.add(G.makeTextButton(700,-30,"F",t,this.fillWithNormals,this)),e.add(G.makeTextButton(800,-30,"+",t,(function(){this.image.scale.setTo(Math.min(1,this.image.scale.x+.05))}),this)),e.add(G.makeTextButton(830,-30,"-",t,(function(){this.image.scale.setTo(Math.max(.2,this.image.scale.x-.05))}),this)),e},G.BoardRTEditor.prototype.fillWithNormals=function(){for(var t=this.getGemData(),e=JSON.parse(JSON.stringify(G.json.BOARDSETTINGS.normalGems)),i=0;i<t.length;i++)for(var s=0;s<t[0].length;s++)"r"===t[i][s]&&(t[i][s]=game.rnd.pick(e));for(i=0;i<t.length;i++)for(s=0;s<t[0].length;s++){var a=e.indexOf(t[i][s]);if(-1!==a)for(var r=0;r<e.length&&(t[i][s]=e[(a+r)%e.length],this.matcher.quickMatchCheckData(i,s,t,this.baseGrid));r++);}this.injectGemData(t)},G.BoardRTEditor.prototype.getGemData=function(){for(var t=[],e=this.levelData.length,i=this.levelData[0].length,s=0;s<e;s++){t[s]=[];for(var a=0;a<i;a++){var r=this.levelData[s][a].indexOf("@");t[s][a]=-1!==r&&this.levelData[s][a][r+1]}}return t},G.BoardRTEditor.prototype.injectGemData=function(t){for(var e=this.levelData.length,i=this.levelData[0].length,s=0;s<e;s++)for(var a=0;a<i;a++){var r=this.levelData[s][a].indexOf("@"),o=t[s][a];-1!==r?this.levelData[s][a]=this.levelData[s][a].slice(0,r+1)+t[s][a]+this.levelData[s][a].slice(r+2):"X"!==this.levelData[s][a]&&o&&(this.levelData[s][a]+="@"+o)}this.redraw()},G.BoardRTEditor.prototype.processBoardLayers=function(){this.boardLayersData.forEach((function(t){this.markerImg.alpha=void 0===t._alpha?1:t._alpha,this.processLayer(t)}),this)},G.BoardRTEditor.prototype.posSymmetry=function(t,e,i){var s=Math.min(t.x,this.boardWidth-1-t.x),a=Math.min(t.y,this.boardHeight-1-t.y),r=t.x,o=t.y;return e&&(r=t.x===s?this.boardWidth-1-s:s),i&&(o=t.y===a?this.boardHeight-1-a:a),{x:r,y:o}},G.BoardRTEditor.prototype.makeVisShufflePanel=function(){var t=game.make.group();return t.vSwitches=[],t.daSwitches=[],t.sBtns=[],showAll=G.makeTextButton(50,0,"Vall",this.textButtonStyle,(function(){this.boardLayersData.forEach((function(t){t._alpha=1,t._visiblitySwitch&&(t._visiblitySwitch.alpha=1)})),this.redraw()}),this),t.add(showAll),index=0,this.boardLayersData.forEach((function(e,i){e._alpha=1;var s=30+30*index;if(e.floor)(n=G.makeImage(0,s,e.editorIcon,0,t)).height=30,n.scale.x=n.scale.y;else if(e.gems){(n=G.makeImage(0,s,e.editorIcon,0,t)).height=30,n.scale.x=n.scale.y}else if(e.blocker){(n=G.makeImage(0,s,e.editorIcon,0,t)).height=30,n.scale.x=n.scale.y}else t.add(game.make.text(0,s,i,this.textStyle));var a=G.makeTextButton(50,s,"V",this.textButtonStyle,(function(){e._alpha=1===e._alpha?.1:1,a.alpha=Math.min(1,e._alpha+.2),this.redraw()}),this);t.vSwitches.push(a),e._visiblitySwitch=a;var r=G.makeTextButton(80,s,"Vs",this.textButtonStyle,(function(){for(var t=0;t<this.boardLayersData.length;t++){var i=this.boardLayersData[t]===e?1:.1;this.boardLayersData[t]._alpha=i,this.boardLayersData[t]._visiblitySwitch.alpha=Math.min(1,i+.2)}this.redraw()}),this);if(t.vSwitches.push(r),e.gems){var o=e.editorPossibilities[2];for(i=0;i<o.length;i++){index++;var n,h=o[i];s=30+30*index;(n=G.makeImage(50,s,h[1],0,t)).height=30,n.scale.x=n.scale.y;var l="_"+h[0];e[l+"Nr"]=this.countAppearances(h[0]),e[l+"Text"]=t.add(game.make.text(200,s,e[l+"Nr"],this.textStyle)),e[l+"DesiredBtn"]=G.makeTextButton(250,s,"d:"+e[l+"Nr"],this.textButtonStyle,function(t,e){return function(){var i=parseInt(prompt("Amount"));isNaN(i)||(t[e+"DesiredNr"]=i,t[e+"DesiredBtn"].text="d:"+t[e+"DesiredNr"])}}(e,l),this),t.daSwitches.push(e[l+"DesiredBtn"]),e[l+"DesiredNr"]=e[l+"Nr"],e[l+"ShuffleBtn"]=G.makeTextButton(150,s,"S",this.textButtonStyle,function(t,e){return function(){this.shuffleGemsStatusAppearances(t["_"+e+"DesiredNr"],t,e)}}(e,h[0]),this),t.sBtns.push(e[l+"ShuffleBtn"])}}else if(!e.floor){e._appearance=this.countAppearances(e.editorPrefix);var c=t.add(game.make.text(200,s,e._appearance,this.textStyle));e._appearanceText=c;var d=G.makeTextButton(250,s,"d:"+e._appearance,this.textButtonStyle,(function(){var t=parseInt(prompt("Amount"));isNaN(t)||(e._desiredAppearances=t,d.text="d:"+e._desiredAppearances)}),this);t.daSwitches.push(d),e._desiredAppearances=e._appearance,e._desiredAppearancesBtn=d,e._appearenceSwitch=d;var p=G.makeTextButton(150,s,"S",this.textButtonStyle,(function(){this.shuffleLayerAppearances(e._desiredAppearances,e)}),this);t.sBtns.push(p),e._shuffleBtn=p}index++}),this),t.addMultiple(t.vSwitches),t.addMultiple(t.daSwitches),t.addMultiple(t.sBtns),t},G.BoardRTEditor.prototype.countAppearances=function(t){for(var e=0,i=0;i<this.boardWidth;i++)for(var s=0;s<this.boardHeight;s++)-1!==this.levelData[i][s].indexOf(t)&&e++;return e},G.BoardRTEditor.prototype.updateAppearances=function(){this.boardLayersData.forEach((function(t){if(t.gems)for(var e=t.editorPossibilities[2],i=0;i<e.length;i++){var s=e[i],a=(index,"_"+s[0]);t[a+"Nr"]=this.countAppearances(s[0]),t[a+"Text"].text=t[a+"Nr"]}else t._appearance=this.countAppearances(t.editorPrefix),t._appearanceText&&(t._appearanceText.text=t._appearance)}),this)},G.BoardRTEditor.prototype.removeLayerAppearances=function(t){for(var e=0;e<this.boardWidth;e++)for(var i=0;i<this.boardHeight;i++){for(var s=this.levelData[e][i].split(","),a=0;a<s.length;a++)if(s[a][0]==t){s.splice(a,1);break}this.levelData[e][i]=G.arrayJoin(s,",")}},G.BoardRTEditor.prototype.removeGemStatusAppearances=function(t){for(var e=0;e<this.boardWidth;e++)for(var i=0;i<this.boardHeight;i++){for(var s=this.levelData[e][i].split(","),a=0;a<s.length;a++)if("@"==s[a][0]){var r=s[a].split(":");r[1]===t&&(r[1]=!1),s[a]=G.arrayJoin(r,":");break}this.levelData[e][i]=G.arrayJoin(s,",")}},G.BoardRTEditor.prototype.shuffleLayerAppearances=function(t,e,i){var s=t;i=i||"";if(e.blocker&&(i=e.editorPrefix+e.blocker.maxHp),i){this.removeLayerAppearances(e.editorPrefix),e._appearance=this.countAppearances(e.editorPrefix);for(var a=200;s>0&&!(a--<0);){var r=game.rnd.between(0,this.boardWidth-1),o=game.rnd.between(0,this.boardHeight-1);if(this.standardChange(null,e,i,r,o,!0),e._appearance>=s)break}this.redraw()}},G.BoardRTEditor.prototype.shuffleGemsStatusAppearances=function(t,e,i){var s=t,a=i;if(a){this.removeGemStatusAppearances(a),e["_"+i+"Nr"]=this.countAppearances(i);for(var r=200;s>0&&!(r--<0);){var o=game.rnd.between(0,this.boardWidth-1),n=game.rnd.between(0,this.boardHeight-1);if(-1===this.levelData[o][n].indexOf(":")&&(this.standardChange(null,e,a,o,n,!0),e["_"+i+"Nr"]>=s))break}this.redraw()}},G.BoardRTEditor.prototype.export=function(){for(var t=[],e=0;e<100;e++){Math.random()<.5?this.shuffleLayerAppearances(game.rnd.between(4,10),this.boardLayersData[1]):this.removeLayerAppearances(this.boardLayersData[1].editorPrefix),Math.random()<.5?this.shuffleGemsStatusAppearances(game.rnd.between(4,10),this.boardLayersData[2],"Chained"):this.removeGemStatusAppearances("Chained"),Math.random()<.5?this.shuffleGemsStatusAppearances(game.rnd.between(4,10),this.boardLayersData[2],"Choco"):this.removeGemStatusAppearances("Choco"),Math.random()<.5?this.shuffleGemsStatusAppearances(game.rnd.between(4,10),this.boardLayersData[2],"Infected"):this.removeGemStatusAppearances("Infected"),Math.random()<.5?this.shuffleLayerAppearances(game.rnd.between(4,10),this.boardLayersData[3]):this.removeLayerAppearances(this.boardLayersData[3].editorPrefix),Math.random()<.5?this.shuffleLayerAppearances(game.rnd.between(4,10),this.boardLayersData[4]):this.removeLayerAppearances(this.boardLayersData[4].editorPrefix);var i={moves:game.rnd.between(20,30),tutorial:Math.random()<.1,levelData:JSON.parse(JSON.stringify(this.levelData))};t.push(i)}},G.BoardRTItem=function(t,e,i,s){G.BoardRT.call(this,t,e,i),this.config=Object.assign({maxWidth:500,maxHeight:500},s||s),this.inputImg=G.makeImage(0,0,null,0,this),this.inputImg.inputEnabled=!0,this.inputImg.hitArea=new Phaser.Rectangle(0,0,s.maxWidth,s.maxHeight),this.image.x=.5*this.config.maxWidth,this.image.y=.5*this.config.maxHeight,this.image.anchor.setTo(.5),this.image.width=Math.min(this.image.width,this.config.maxWidth),this.image.height=Math.min(this.image.height,this.config.maxHeight),this.image.scale.setTo(Math.min(this.image.scale.x,this.image.scale.y)),this.selected=!1,this.gfx=this.add(game.make.graphics()),this.addInfo(s)},G.BoardRTItem.prototype=Object.create(G.BoardRT.prototype),G.BoardRTItem.prototype.setInput=function(t){this.inputImg.inputEnabled=t},G.BoardRTItem.prototype.isPointerOver=function(){return this.inputImg.input.pointerOver()},G.BoardRTItem.prototype.addInfo=function(t){var e=t.infoData,i=t.infoStyle||{},s=null;for(var a in e)s=this.add(game.make.text(0,s?s.bottom:0,a+":"+G.Utils.getObjProp(this.level,e[a]),i)),20;this.bigLabel=this.add(game.make.text(this.image.x,this.image.y," ",{font:"bold "+.5*this.config.maxHeight+"pt Arial",fill:"#ffffff",stroke:"black",strokeThickness:5})),this.bigLabel.anchor.setTo(.5),this.bigLabel.autoCull=!0,this.bigLabel.alpha=.4},G.BoardRTItem.prototype.setBigLabel=function(t){this.bigLabel.setText(t.toString())},G.BoardRTItem.prototype.updateInfo=function(){var t="Level NR: "+(this.levelContainer.indexOf(this.level)+1);this.levelInfo.text=t},G.BoardRTItem.prototype.select=function(){this.selected||(this.selected=!0,this.gfx.clear(),this.gfx.beginFill(65280,.5),this.gfx.drawRect(0,0,this.image.width,this.image.height))},G.BoardRTItem.prototype.deselect=function(){this.selected&&(this.selected=!1,this.gfx.clear())},G.EditorLine=function(t){Phaser.Group.call(this,game),this.separatorWidth=50,this.levelContainer=t,this.maxWidth=700,this.maxHeight=500,this.itemGroup=this.add(game.add.group()),this.separatorGroup=this.add(game.add.group()),this.itemGroup.y=this.separatorGroup.y=70+.5*this.maxHeight,this.itemGroup.pivot.y=this.separatorGroup.pivot.y=.5*this.maxHeight,this.lineScale=1;for(var e=0;e<t.length;e++){var i=new G.BoardRTItem(0,0,t[e],{maxWidth:700,maxHeight:500,infoData:{Time:"time","G Types":"normalsNr"}});this.itemGroup.add(i)}this.refreshLine(),this.linePos=0,this.scaleMulti=.6,game.input.mouse.mouseWheelCallback=this.mouseWheelHandler.bind(this),this.onDestroy.add((function(){game.input.mouse.mouseWheelCallback=null})),game.time.events.loop(15,(function(){game.input.activePointer.processInteractiveObjects()})),this.keys=game.input.keyboard.addKeys({R:Phaser.Keyboard.R,E:Phaser.Keyboard.E,ADD:Phaser.Keyboard.NUMPAD_ADD,SUBTRACT:Phaser.Keyboard.NUMPAD_SUBTRACT}),this.keys.R.onDown.add((function(){var t=this.getPointedItem();t&&this.removeFromLine(t)}),this),this.keys.E.onDown.add((function(){var t=this.getPointedItem();t&&game.state.start("EditorLvl",!0,!1,this.levelContainer.indexOf(t.level))}),this),this.keys.ADD.onDown.add((function(){this.scaleMulti+=.05}),this),this.keys.SUBTRACT.onDown.add((function(){this.scaleMulti-=.05,this.scaleMulti=Math.max(.1,this.scaleMulti)}),this)},G.EditorLine.prototype=Object.create(Phaser.Group.prototype),G.EditorLine.prototype.getPointedItem=function(){return this.itemGroup.children.find((function(t){return t.isPointerOver()}))},G.EditorLine.prototype.getPointedSeparator=function(){return this.separatorGroup.children.find((function(t){return t.isPointerOver()}))},G.EditorLine.prototype.mouseWheelHandler=function(){game.input.mouse.wheelDelta>0?this.linePos-=1/this.levelContainer.length:this.linePos+=1/this.levelContainer.length,this.linePos=game.math.clamp(this.linePos,0,1)},G.EditorLine.prototype.removeFromLine=function(t){this.itemGroup.removeChild(t),t.setInput(!1);var e=this.levelContainer.indexOf(t.level);return-1!==e&&this.levelContainer.splice(e,1),this.refreshLine(),t},G.EditorLine.prototype.addToLine=function(t,e){if(null==e&&(e=this.levelContainer.length),Array.isArray(t)){this.itemGroup.addMultiple(t);var i=t.map((function(t){return t.level}));this.levelContainer.splice.apply(this.levelContainer,[e,0].concat(i))}else this.levelContainer.splice(e,0,t.level),this.itemGroup.add(t);this.refreshLine()},G.EditorLine.prototype.refreshLine=function(){this.updateSeparatorGroup(),this.updateItemsPositions()},G.EditorLine.prototype.update=function(){var t=this.scaleMulti;this.itemGroup.scale.setTo(t),this.separatorGroup.scale.setTo(t);var e=this.separatorGroup.width-game.width;this.itemGroup.x=this.linePos*(-1*e),this.separatorGroup.x=this.linePos*(-1*e);for(var i=0;i<this.itemGroup.children.length;i++)this.itemGroup.children[i].bigLabel.alpha=1-t;for(var s=this.children.length;s--;)this.children[s].update()},G.EditorLine.prototype.updateSeparatorGroup=function(){for(var t=this.levelContainer.length+1,e=this.separatorGroup.children.length,i=[],s=0;s<Math.max(t,e);s++)s<t?this.separatorGroup.children[s]?(this.separatorGroup.children[s].x=s*(this.maxWidth+this.separatorWidth),this.separatorGroup.index=s):i.push(new G.EditorLine.Separator(s*(this.maxWidth+this.separatorWidth),0,this.separatorWidth,this.maxHeight,s)):this.separatorGroup.children[s].destroy();this.separatorGroup.addMultiple(i)},G.EditorLine.prototype.updateItemsPositions=function(){this.itemGroup.children.forEach((function(t){t.levelIndex=this.levelContainer.indexOf(t.level)}),this),this.itemGroup.sort("levelIndex",Phaser.Group.SORT_ASCENDING),this.itemGroup.children.forEach((function(t,e){t.scale.setTo(1),t.x=this.separatorWidth+e*(this.maxWidth+this.separatorWidth),t.setBigLabel(e+1),t.setInput(!0)}),this)},G.EditorLine.Separator=function(t,e,i,s,a){Phaser.Graphics.call(this,game,t,e),this.inputEnabled=!0,this.input.useHandCursor=!0,this.beginFill(65280),this.drawRect(0,0,i,s),this.index=a},G.EditorLine.Separator.prototype=Object.create(Phaser.Graphics.prototype),G.EditorLine.Separator.prototype.update=function(){this.alpha=this.input.pointerOver()?.5:.1},G.EditorLine.Separator.prototype.isPointerOver=function(){return this.input.pointerOver()},G.EditorLine.SelectorLine=function(t){Phaser.Graphics.call(this,game,0,0),this.inputEnabled=!0,this.input.useHandCursor=!0,this.selectionHeight=t,this.beginFill(255,.5),this.drawRect(0,0,2200,50),this.startX=null,this.currentX=null,this.events.onInputDown.add((function(){var t=game.input.activePointer;this.startX=t.worldX,this.currentX=t.worldX}),this),this.events.onInputUp.add((function(){this.startX=this.currentX=null,this.redraw()}),this)},G.EditorLine.SelectorLine.prototype=Object.create(Phaser.Graphics.prototype),G.EditorLine.SelectorLine.prototype.update=function(){if(null!==this.startX){var t=game.input.activePointer;this.currentX=t.worldX,this.redraw()}},G.EditorLine.SelectorLine.prototype.redraw=function(){if(this.clear(),this.beginFill(255,.5),this.drawRect(0,0,2200,50),null!==this.startX&&null!==this.currentX){var t=this.currentX-this.startX;this.beginFill(255,.5),this.drawRect(this.startX,0,t,this.selectionHeight)}},G.BoardHexFallMgr=function(t){G.BoardFallMgr.call(this,t)},G.BoardHexFallMgr.prototype=Object.create(G.BoardFallMgr.prototype),G.BoardHexFallMgr.prototype.fallCheckCrossCollumn=function(){for(var t=0;t<this.grid.width;t++)for(var e=this.grid.height;e>=0;e--){var i=this.board.isCellFree(t,e),s="H"==this.grid.get(t,e-1);if(i&&s){var a=t%2==0?-1:0;this.topDir>0?(this.moveDiagonalByCell(t-1,e+a,t,e)||this.moveDiagonalByCell(t+1,e+a,t,e))&&(this.topDir*=-1):(this.moveDiagonalByCell(t+1,e+a,t,e)||this.moveDiagonalByCell(t-1,e+a,t,e))&&(this.topDir*=-1)}}},G.BoardItemSelector=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.gfx=game.add.graphics(),this.selectionRect=new Phaser.Rectangle,this.startX=null,this.startY=null,game.input.onDown.add((function(t){this.startX=t.worldX,this.startY=t.worldY}),this),game.input.onUp.add((function(t){if(null!==this.startX){var e=t.worldX-this.startX,i=t.worldY-this.startY;Math.abs(e)>this.minPosDiff&&Math.abs(i)>this.minPosDiff&&(this.updateSelectionRect(this.startX,this.startY,e,i),this.state.selectItems(this.selectionRect)),this.startX=null,this.startY=null}}),this),this.minPosDiff=20},G.BoardItemSelector.prototype=Object.create(Phaser.Group.prototype),G.BoardItemSelector.prototype.update=function(){var t=game.input.activePointer;if(this.gfx.clear(),null!==this.startX){var e=t.worldX-this.startX,i=t.worldY-this.startY;Math.abs(e)>this.minPosDiff&&Math.abs(i)>this.minPosDiff&&(this.gfx.beginFill(255,.3),this.gfx.drawRect(this.startX,this.startY,e,i))}},G.BoardItemSelector.prototype.updateSelectionRect=function(t,e,i,s){i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),this.selectionRect.setTo(t,e,i,s)},G.BoardMoveAction=function(t,e,i){G1=e,G2=i,this.board=t,this.gem1=e,this.gem1moveDone=!1,this.goingBack=!1,this.gem2=i,this.gem2moveDone=!1,this.successful=!1,this.gem1binding=this.gem1.onMoveDone.add(this.onGemMoveFinish,this),this.gem2binding=this.gem2.onMoveDone.add(this.onGemMoveFinish,this),this.gem1&&this.gem2||this.actionFinish(),this.board.gemLayer.moveToNonCache(this.gem1),this.board.gemLayer.moveToNonCache(this.gem2),this.makeSwapMove(this.gem1,this.gem2)},G.BoardMoveAction.prototype.actionFinish=function(){this.board.gemLayer.moveToCache(this.gem1),this.board.gemLayer.moveToCache(this.gem2),this.gem1binding.detach(),this.gem2binding.detach()},G.BoardMoveAction.prototype.makeSwapMove=function(t,e){this.board.gemLayer.swapObjects(t,e),this.gem1.moveTo(t.cellX,t.cellY),this.gem2.moveTo(e.cellX,this.gem2.cellY)},G.BoardMoveAction.prototype.onGemMoveFinish=function(t){this.gem1===t&&(this.gem1moveDone=!0),this.gem2===t&&(this.gem2moveDone=!0),this.gem1moveDone&&this.gem2moveDone&&(this.goingBack?this.actionFinish():this.checkGems())},G.BoardMoveAction.prototype.checkGems=function(){var t=this.comboCheck(this.gem1,this.gem2);if(t)return this.actionFinish(),void this.processCombo(this.gem1,this.gem2,t);var e=this.board.matcher.quickMatchCheck(this.gem1.cellX,this.gem1.cellY),i=this.board.matcher.quickMatchCheck(this.gem2.cellX,this.gem2.cellY);e||this.gem1.activatedByMove||i||this.gem2.activatedByMove?(this.actionFinish(),(e||this.gem1.activatedByMove)&&(this.gem1.wasMoved=!0,this.gem1.lastMovedWith=this.gem2,this.gem1.activatedByMove?this.gem1.onMatch():this.board.matcher.cellsToProcess.push(this.gem1.cellX,this.gem1.cellY)),(i||this.gem2.activatedByMove)&&(this.gem2.wasMoved=!0,this.gem2.lastMovedWith=this.gem1,this.gem2.activatedByMove?this.gem2.onMatch():this.board.matcher.cellsToProcess.push(this.gem2.cellX,this.gem2.cellY))):(this.goingBack=!0,this.gem1moveDone=!1,this.gem2moveDone=!1,this.makeSwapMove(this.gem1,this.gem2))},G.BoardMoveAction.prototype.comboCheck=function(t,e){if(!t.specialType||!e.specialType)return!1;for(var i=0;i<this.combos.length;i++){var s=this.combos[i];if(t.specialType==s[0]&&e.specialType==s[1]||e.specialType==s[0]&&t.specialType==s[1])return s}},G.BoardMoveAction.prototype.combos=[["vertical","vertical",function(t,e){t.specialAction=[G.SpecialActions.Cross],this.mergeAndMatch(t,e,null,90)}],["horizontal","horizontal",function(t,e){t.specialAction=[G.SpecialActions.Cross],this.mergeAndMatch(t,e,null,90)}],["vertical","horizontal",function(t,e){t.specialAction=[G.SpecialActions.Cross],this.mergeAndMatch(t,e)}],["star","star",function(t,e){t.specialAction.push(G.SpecialActions.Cross),this.mergeAndMatch(t,e,null,45)}],["star","horizontal",function(t,e){t.specialAction=t.specialAction.concat(e.specialAction),this.mergeAndMatch(t,e)}],["star","vertical",function(t,e){t.specialAction=t.specialAction.concat(e.specialAction),this.mergeAndMatch(t,e)}],["rainbow","rainbow",function(t,e){t.specialAction=[G.SpecialActions.MatchAndHitEverything],this.mergeAndMatch(t,e)}]],G.BoardMoveAction.prototype.processCombo=function(t,e,i){i[2].call(this,t,e)},G.BoardMoveAction.prototype.mergeAndMatch=function(t,e,i,s){e.mergeWithCell(t.cellX,t.cellY),t.lock(),game.time.events.add(G.json.BOARDSETTINGS.gemSettings.matchTime,(function(){t.unlock(),t.onMatch()})),"number"==typeof i&&t.angle!==i&&game.add.tween(t).to({angle:i},G.json.BOARDSETTINGS.gemSettings.matchTime,Phaser.Easing.Sinusoidal.Out,!0),"number"==typeof s&&e.angle!==s&&game.add.tween(e).to({angle:s},G.json.BOARDSETTINGS.gemSettings.matchTime,Phaser.Easing.Sinusoidal.Out,!0)},G.BoardTriangleFallMgr=function(t){G.BoardFallMgr.call(this,t),this.board=t,this.baseGrid=this.board.baseGrid,this.grid=new G.GridArray(this.board.baseGrid.width,this.board.baseGrid.height),this.pullThroughHoles=!1,this.pullDir="U",this.pullAdditional=["LU","RU"],this.lowestInCol=[],this.fallStopped=[],this.topDir=1},G.BoardTriangleFallMgr.prototype=Object.create(G.BoardFallMgr.prototype),G.BoardTriangleFallMgr.prototype.fallCheckCrossCollumn=function(){for(var t=0;t<this.grid.width;t++)for(var e=this.grid.height;e>=0;e--){var i=this.board.isCellFree(t,e),s="H"==this.grid.get(t,e-1);i&&s&&(this.baseGrid.isPointingRight(t,e)?this.moveDiagonalByCell(t-1,e,t,e):this.moveDiagonalByCell(t+1,e,t,e))}},G.BoardTriangleFallMgr.prototype.moveDiagonalByCell=function(t,e,i,s){var a=this.board.isCellMoveable(t,e),r=this.board.getGem(t,e);if(!a||!r)return!1;if(r.falling)return!1;var o=this.fallStopped.indexOf(r);return-1!==o&&this.fallStopped.splice(o,1),r.fallTo(i,s),!0},G.BoardTut=function(t){G.Board.call(this,t),this.gemLayer.refiller=new G.RefillerTut(this,t.dropArray),this.inputMgr.active=!1,this.pointer=G.makeImage(.5*this.width,.5*this.height,"tut_pointer",0,this),this.moves=t.moves,TUTBOARD=this,game.time.events.add(this.moves[0][4],this.makeTutMove,this),this.onTutorialFinished=new Phaser.Signal},G.BoardTut.prototype=Object.create(G.Board.prototype),G.BoardTut.prototype.idleCheck=function(){},G.BoardTut.prototype.showHint=function(){},G.BoardTut.prototype.makeTutMove=function(){0!=this.moves.length&&this.alive&&game.add.tween(this.pointer).to(this.getPxPosition(this.moves[0][0],this.moves[0][1]),500,Phaser.Easing.Linear.NONE,!0).onComplete.add((function(){game.add.tween(this.pointer).to(this.getPxPosition(this.moves[0][2],this.moves[0][3]),500,Phaser.Easing.Linear.NONE,!0,500),game.time.events.add(750,(function(){this.alive&&(this.makeMove(this.moves[0][0],this.moves[0][1],this.moves[0][2],this.moves[0][3]),this.moves.shift(),this.moves.length>0?game.time.events.add(this.moves[0][4],this.makeTutMove,this):game.time.events.add(2e3,(function(){this.alive&&this.onTutorialFinished.dispatch()}),this))}),this)}),this)},G.EditorClipboard=function(t,e,i){Phaser.Group.call(this,game),this.position.setTo(t,e),this.config=i,this.label=this.add(new G.Text(5,5,i.label||" ",i.labelStyle)),this.gfx=this.addGfx(i),this.itemGroup=this.add(game.make.group())},G.EditorClipboard.prototype=Object.create(Phaser.Group.prototype),G.EditorClipboard.prototype.addItem=function(t){t.scale.setTo(1),t.height=Math.min(t.height,this.config.height),t.scale.x=t.scale.y,t.x=this.itemGroup.children.length*t.width*.5,this.itemGroup.add(t),this.updateBoardItems()},G.EditorClipboard.prototype.updateBoardItems=function(){if(0!=this.itemGroup.children.length){var t=this.itemGroup.children[0].width,e=(this.config.width-t)/this.itemGroup.children.length,i=Math.min(.5*t,e);this.itemGroup.children.forEach((function(t,e){t.x=e*i}))}},G.EditorClipboard.prototype.removeAllItems=function(){var t=this.itemGroup.children.slice();return this.itemGroup.removeAll(),t},G.EditorClipboard.prototype.addGfx=function(t){var e=this.add(game.make.graphics());return e.lineStyle(2,t.borderColor,1),e.drawRect(0,0,t.width,t.height),e},G.FxBoardPart=function(){G.Image.call(this,0,0,null,.5)},G.FxBoardPart.prototype=Object.create(G.Image.prototype),G.FxBoardPart.prototype.updateEmpty=function(){},G.FxBoardPart.prototype.reset=function(t){this.x=t.x,this.y=t.y,this.alpha=1,this.blendMode=0,this.scale.setTo(1),this.angle=0,G.changeTexture(this,null),this.update=this.updateEmpty,this.revive()},G.FxBoardPart.prototype.init=function(t,e,i){"BURST TEST"!==t?(this.reset(e),this[t](e,i)):this.parent.add(G.cachPart("d_"+i,!0,e.x,e.y))},G.FxBoardPart.prototype.gemExplosion=function(t){this.animationTween(t,"d_"+t.matchType+"_explo",25,500),this.angle=game.rnd.between(0,360)},G.FxBoardPart.prototype.sparkleExplosion=function(t){this.animationTween(t,"sparkle_explo",54,600),this.angle=game.rnd.between(0,360),this.blendMode=1},G.FxBoardPart.prototype.animationTween=function(t,e,i,s){this.animSprite=e,G.changeTexture(this,this.animSprite+"_0"),this.animProg=0,game.add.tween(this).to({animProg:i},s,Phaser.Easing.Linear.None,!0).onComplete.add(this.kill,this),this.update=this.animationTweenUpdate},G.FxBoardPart.prototype.animationTweenUpdate=function(){this.changeTexture(this.animSprite+"_"+Math.floor(this.animProg))},G.FxBoardPart.prototype.burst=function(t){this.animData=this.burstArray[t.matchType],this.animProg=0,this.prevAnimFrame=0,G.changeTexture(this,this.animData[0]+"0"),game.add.tween(this).to({animProg:this.animData[1]+1},32*this.animData[1],Phaser.Easing.Linear.None,!0),this.update=this.burstUpdate},G.FxBoardPart.prototype.burstUpdate=function(){this.animProg==this.animData[1]+1?this.kill():Math.floor(this.animProg)!==this.prevAnimFrame&&(this.prevAnimFrame=Math.floor(this.animProg),G.changeTexture(this,this.animData[0]+this.prevAnimFrame))},G.FxBoardPart.prototype.gemMatched=function(t){G.changeTexture(this,t.frameName),this.anchor.setTo(.5),this.blendMode=0,this.velX=game.rnd.realInRange(-3.5,3.5),this.velY=game.rnd.realInRange(-5,-2),this.update=this.gemMatchedUpdate,game.add.tween(this.scale).to({x:2,y:2},1e3,Phaser.Easing.Cubic.In,!0),game.add.tween(this).to({alpha:0},400,Phaser.Easing.Cubic.In,!0,400)},G.FxBoardPart.prototype.gemMatchedUpdate=function(){this.x+=this.velX,this.y+=this.velY,this.velY+=.4},G.FxBoardPart.prototype.animation=function(t,e){var i=e.sprite,s=e.frames,a=e.timePerFrame;this.animProg=0,this.prevAnimFrame=0,this.animSprite=i,this.animProgTarget=s+1,G.changeTexture(this,this.animSprite+"0"),game.add.tween(this).to({animProg:s+1},(s+1)*(a||32),Phaser.Easing.Linear.None,!0).onComplete.add(this.kill,this),this.update=this.animationUpdate},G.FxBoardPart.prototype.animationUpdate=function(){this.animProg<this.animProgTarget&&Math.floor(this.animProg)!==this.prevAnimFrame&&(this.prevAnimFrame=Math.floor(this.animProg),G.changeTexture(this,this.animSprite+this.prevAnimFrame))},G.FxBoardPart.prototype.burstCircle=function(t){G.changeTexture(this,"circle"),this.blendMode=1,this.alpha=.05,game.add.tween(this.scale).to({x:1,y:1},32,Phaser.Easing.Cubic.Out,!0),game.add.tween(this).to({alpha:0},32,Phaser.Easing.Cubic.In,!0).onComplete.add(this.kill,this)},G.FxBoardPart.prototype.colorDirtHit=function(t){this.anchor.x=t.anchor.x,this.anchor.y=t.anchor.y,this.scale.x=t.scale.x,this.scale.y=t.scale.y,this.blendMode=1,G.changeTexture(this,t.frameName),game.add.tween(this).to({width:2*this.width,height:2*this.height,alpha:0},300,Phaser.Easing.Cubic.Out,!0).onComplete.add(this.kill,this)},G.LayerCacher=function(t,e,i,s){Phaser.Group.call(this,game);var a=Math.round(.5*t.baseGrid.width),r=Math.round(.5*t.baseGrid.height),o=t.baseGrid.width,n=t.baseGrid.height;this.gridFrags=[new G.RTGridFrag(t,e,i,0,0,a,r,s),new G.RTGridFrag(t,e,i,a,0,o-a,r,s),new G.RTGridFrag(t,e,i,0,r,a,n-r,s),new G.RTGridFrag(t,e,i,a,r,o-a,n-r,s)],t.add(this),this.addMultiple(this.gridFrags)},G.LayerCacher.prototype=Object.create(Phaser.Group.prototype),G.LayerCacher.prototype.postUpdate=function(){for(var t=0;t<4;t++)this.gridFrags[t].redrawPending&&this.gridFrags[t].redraw()},G.LayerCacher.prototype.changeAt=function(t,e){for(var i=0;i<4;i++)this.gridFrags[i].checkRedraw(t,e)},G.LayerCacher.prototype.redrawAll=function(){for(var t=0;t<4;t++)this.gridFrags[t].redraw()},G.LvlMgrGrid=function(t,e){Phaser.Group.call(this,game),this.config=e,this.state=game.state.getCurrentState(),this.levelContainer=t,this.itemGroup=this.add(game.make.group()),this.selected=[],this.init(t),this.highlights=this.add(new G.LvlMgrGridHighlight(this)),this.msg=this.add(new G.LvlMgrGridDbgMsg(this)),this.help=this.add(new G.LvlMgrGridHelp(this)),game.input.mouse.mouseWheelCallback=this.mouseWheelHandler.bind(this),this.onDestroy.add((function(){game.input.mouse.mouseWheelCallback=null})),this.keys=game.input.keyboard.addKeys({ctrl:Phaser.Keyboard.CONTROL,space:Phaser.Keyboard.SPACEBAR,edit:Phaser.Keyboard.E,remove:Phaser.Keyboard.R,help:Phaser.Keyboard.F1}),window.addEventListener("keydown",(function(t){112===t.keyCode&&t.preventDefault()})),this.keys.space.onDown.add((function(){this.selected=[]}),this),this.keys.edit.onDown.add((function(){var t=this.getPointedItem();t&&game.state.start("EditorLvl",!0,!1,this.levelContainer.indexOf(t.level))}),this),this.keys.remove.onDown.add((function(){var t=this.getPointedItem();t&&this.removeItem(t)}),this),this.keys.help.onDown.add((function(){this.help.visible=!this.help.visible}),this),game.input.onDown.add(this.clickHandler,this),game.time.events.loop(15,(function(){game.input.activePointer.processInteractiveObjects()}))},G.LvlMgrGrid.prototype=Object.create(Phaser.Group.prototype),G.LvlMgrGrid.prototype.clickHandler=function(){var t=this.getPointedItem(),e=this.getPointedPadding();t&&this.selectionToggle(t),e&&this.selected.length>0&&(this.keys.ctrl.isDown?this.putSelectedIntoPos(this.selected,e.index):this.msg.showMsg("Hold CTRL to put levels"))},G.LvlMgrGrid.prototype.selectionToggle=function(t){-1==this.selected.indexOf(t)?this.select(t):this.deselect(t)},G.LvlMgrGrid.prototype.select=function(t){-1==this.selected.indexOf(t)&&this.selected.push(t)},G.LvlMgrGrid.prototype.deselect=function(t){var e=this.selected.indexOf(t);-1!==e&&this.selected.splice(e,1)},G.LvlMgrGrid.prototype.mouseWheelHandler=function(){game.input.mouse.wheelDelta>0?this.itemGroup.y+=60:this.itemGroup.y-=60,this.itemGroup.y=game.math.clamp(this.itemGroup.y,-this.itemGroup.height+game.height,0)},G.LvlMgrGrid.prototype.init=function(t){for(var e=0;e<t.length;e++){var i=new G.BoardRTItem(0,0,t[e],{maxWidth:this.config.itemMaxWidth,maxHeight:this.config.itemMaxHeight,infoData:{Time:"time","G Types":"normalsNr"},infoStyle:{font:"bold 15px Arial",fill:"#ffffff",backgroundColor:"#000000"}});this.itemGroup.add(i)}this.refreshGrid()},G.LvlMgrGrid.prototype.refreshGrid=function(){this.itemGroup.children.forEach((function(t){t.levelIndex=this.levelContainer.indexOf(t.level)}),this),this.itemGroup.sort("levelIndex",Phaser.Group.SORT_ASCENDING),this.itemGroup.children.forEach((function(t,e){t.setBigLabel(e+1),t.setInput(!0)})),this.itemGroup.align(this.config.columns,-1,this.config.itemMaxWidth+this.config.itemPadding,this.config.itemMaxHeight+this.config.itemPadding),this.itemGroup.children.forEach((function(t){t.x+=this.config.itemPadding}),this)},G.LvlMgrGrid.prototype.getPointedItem=function(){return this.itemGroup.children.find((function(t){return t.isPointerOver()}))},G.LvlMgrGrid.prototype.getPointedPadding=function(){var t=game.input.activePointer,e=t.x-this.x,i=t.y-this.y-this.itemGroup.y,s=this.config.itemMaxWidth+this.config.itemPadding,a=this.config.itemMaxHeight+this.config.itemPadding,r=Math.floor(i/a);if(!(i-r*a>this.config.itemMaxHeight)){var o=Math.floor(e/a),n=e-o*s;if(o>=0&&o<=this.config.columns&&n<this.config.itemPadding)return{index:o+r*this.config.columns,x:o*s,y:r*a,width:this.config.itemPadding,height:this.config.itemMaxHeight}}return null},G.LvlMgrGrid.prototype.putSelectedIntoPos=function(t,e){t.forEach((function(t){var e=this.levelContainer.indexOf(t.level);-1!==e&&(G.json.levels[e]=null)}),this),this.itemGroup.addMultiple(t);var i=t.map((function(t){return t.level}));for(this.levelContainer.splice.apply(this.levelContainer,[e,0].concat(i));-1!==this.levelContainer.indexOf(null);){var s=this.levelContainer.indexOf(null);this.levelContainer.splice(s,1)}this.selected=[],this.refreshGrid()},G.LvlMgrGrid.prototype.removeItem=function(t){if(confirm("are you sure?")){this.itemGroup.removeChild(t);var e=this.levelContainer.indexOf(t.level);return-1!==e&&this.levelContainer.splice(e,1),this.deselect(t),t.destroy(),this.refreshGrid(),t}},G.LvlMgrGridDbgMsg=function(t){this.lvlMgr=t,G.Text.call(this,.5*this.lvlMgr.itemGroup.width,50," ",{font:"bold 45px Arial",fill:"#ffffff",backgroundColor:"#000000"},[.5,0],this.lvlMgr.itemGroup.width,!1,!0,"center"),this.alpha=0},G.LvlMgrGridDbgMsg.prototype=Object.create(G.Text.prototype),G.LvlMgrGridDbgMsg.prototype.showMsg=function(t){G.stopTweens(this),this.setText(t),this.alpha=1,game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.InOut,!0,1500)},G.LvlMgrGridHelp=function(t){this.lvlMgr=t,G.Text.call(this,.5*this.lvlMgr.itemGroup.width,50,["E = edit highlighted level","R = remove highlighted level","SPACEBAR = deselect all levels","CTRL + click on lvl padding = move selected lvls to this position","","F1 - help on/off"].join("\n"),{font:"bold 30px Arial",fill:"#ffffff",backgroundColor:"#000000"},[.5,0],this.lvlMgr.itemGroup.width,!1,!0,"center"),this.visible=!1},G.LvlMgrGridHelp.prototype=Object.create(G.Text.prototype),G.LvlMgrGridHighlight=function(t){Phaser.Graphics.call(this,game),this.lvlMgr=t,this.position=t.itemGroup.position,this.itemGroup=t.itemGroup,this.config=t.config},G.LvlMgrGridHighlight.prototype=Object.create(Phaser.Graphics.prototype),G.LvlMgrGridHighlight.prototype.update=function(){this.clear(),this.drawItemHighlight(this.lvlMgr.getPointedItem()),this.drawPaddingHighlight(this.lvlMgr.getPointedPadding());for(var t=0;t<this.lvlMgr.selected.length;t++)this.drawSelection(this.lvlMgr.selected[t],t)},G.LvlMgrGridHighlight.prototype.drawSelection=function(t,e){this.endFill(),this.lineStyle(10,3211238,1),this.drawRect(t.x,t.y,this.config.itemMaxWidth,this.config.itemMaxHeight);var i=25*e*-.5;0==e&&(i=0);for(var s=0;s<=e;s++)this.drawCircle(t.x+.5*this.config.itemMaxWidth+i,t.y+.9*this.config.itemMaxWidth,5),i+=25},G.LvlMgrGridHighlight.prototype.drawItemHighlight=function(t){t&&(this.lineStyle(0,0,0),this.beginFill(16777215,.2),this.drawRect(t.x,t.y,this.config.itemMaxWidth,this.config.itemMaxHeight))},G.LvlMgrGridHighlight.prototype.drawPaddingHighlight=function(t){t&&(this.lineStyle(0,0,0),this.beginFill(65280,.2),this.drawRect(t.x,t.y,t.width,t.height))},G.RTGridFrag=function(t,e,i,s,a,r,o,n){this.cellX=s,this.cellY=a,this.cellW=r,this.cellH=o,this.config=this.getRTRect(t.baseGrid,s,a,r,o,n),this.rt=game.make.renderTexture(this.config.width,this.config.height),G.Image.call(this,this.config.x,this.config.y,this.rt,0),this.board=t,this.layer=e,this.cacheGroup=i,this.redrawPending=!0,this.redraw()},G.RTGridFrag.prototype=Object.create(G.Image.prototype),G.RTGridFrag.prototype.getRTRect=function(t,e,i,s,a,r){for(var o=1/0,n=-1/0,h=new Phaser.Point(0,0),l=i;l<i+a;l++)t.getPxPosition(e,l,h),o=Math.min(o,h.x),t.getPxPosition(e+s,l,h),n=Math.max(h.x,n);for(var c=1/0,d=-1/0,p=e;p<e+s;p++)t.getPxPosition(p,i,h),c=Math.min(c,h.y),t.getPxPosition(p+s,i+a,h),d=Math.max(h.y,d);return{x:e=o-r,y:i=c-r,width:s=n-o+2*r,height:a=d-c+2*r}},G.RTGridFrag.prototype.checkRedraw=function(t,e){t>=this.cellX&&t<this.cellX+this.cellW&&e>=this.cellY&&e<this.cellY+this.cellH&&(this.redrawPending=!0)},G.RTGridFrag.prototype.redraw=function(){this.rt.clear();for(var t=this.cellX;t<this.cellX+this.cellW;t++)for(var e=this.cellY;e<this.cellY+this.cellH;e++){var i=this.layer.get(t,e);i&&i.parent==this.cacheGroup&&this.rt.renderXY(i,i.x-this.config.x,i.y-this.config.y,!1)}this.redrawPending=!1},G.GemLayer=function(t,e){G.BoardLayer.call(this,t,e),this.cacheAsBitmap=!1,this.cacheGroup=this.add(game.make.group()),this.cacheGroup.visible=!1,this.nonCashGroup=this.add(game.make.group()),this.refiller=new G.Refiller(t),this.caching=!0,this.layerCacher=new G.LayerCacher(t,this,this.cacheGroup,40)},G.GemLayer.prototype=Object.create(G.BoardLayer.prototype),G.GemLayer.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update();this.checkForCollectables()},G.GemLayer.prototype.postUpdate=function(){this.layerCacher.postUpdate()},G.GemLayer.prototype.moveToNonCache=function(t){this.layerCacher.changeAt(t.cellX,t.cellY),this.nonCashGroup.add(t)},G.GemLayer.prototype.moveToCache=function(t){this.cacheGroup.add(t),this.layerCacher.changeAt(t.cellX,t.cellY)},G.GemLayer.prototype.processRandomGems=function(t){var e=[];this.grid.loop((function(t,i,s){t&&"r"==t.matchType&&e.push([i,s,t])})),e.forEach((function(t){this.processRandomGem(t[0],t[1],t[2])}),this)},G.GemLayer.prototype.processRandomGem=function(t,e,i){for(var s=game.seededRnd.between(0,this.board.normalGems.length-1),a=0;a<this.board.normalGems.length;a++)if(i.changeType(this.board.normalGems[(s+a)%this.board.normalGems.length]),!this.board.matcher.quickMatchCheck(t,e))return;i.kill()},G.GemLayer.prototype.fillBoard=function(){this.grid.loop((function(t,e,i){this.createObjectAt(e,i,"r")}),this),this.processRandomGems()},G.GemLayer.prototype.import=function(t){new G.GridArray(t).loop((function(t,e,i,s){null!=t&&!1!==t?this.createObjectAt(e,i,t):this.reverse&&this.createObjectAt(e,i)}),this)},G.GemLayer.prototype.dropNewGem=function(t,e){var i=this.createObjectAt(t,e-1,this.refiller.getDropType(),!0);i.fallTo(t,e,!0);var s=this.grid.get(t,e+1);s&&s.falling&&(i.fallSpd=s.fallSpd)},G.GemLayer.prototype.createObjectAt=function(t,e,i,s){var a=this.getFreeObject();return a.init(t,e,i),this.moveToCache(a),s||this.grid.set(t,e,a),a},G.GemLayer.prototype.checkForCollectables=function(){for(var t=this.grid.height-1,e=0;e<this.grid.width;e++){var i=this.get(e,t);i&&(i.status&&"collectable"==i.status.name&&this.board.isCellMoveable(e,t)&&(this.board.onCollectableCollected.dispatch(i),i.kill()))}},G.Refiller=function(t){this.board=t,this.normalGems=this.board.normalGems,this.specialDrops=this.board.specialDrops,this.specialDropsKeys=Object.keys(this.specialDrops),this.specialDropsKeysLen=this.specialDropsKeys.length,this.dropOverwrite=[],this.grid=new G.GridArray(this.board.baseGrid.width,this.board.baseGrid.height)},G.Refiller.prototype.getDropType=function(){if(this.dropOverwrite.length>0)return this.dropOverwrite.shift();for(var t=this.specialDropsKeysLen;t--;)if(game.seededRnd.rnd()<this.specialDrops[this.specialDropsKeys[t]]){var e=this.specialDropsKeys[t];return"r"==e[0]&&(e=game.seededRnd.pick(this.normalGems)+e.slice(1)),e}return game.seededRnd.pick(this.normalGems)},G.RefillerTut=function(t,e){this.board=t,this.gemsToDrop=e,this.grid=new G.GridArray(this.board.baseGrid.width,this.board.baseGrid.height)},G.RefillerTut.prototype.getDropType=function(){return 0==this.gemsToDrop.length?game.rnd.pick(this.normalGems):this.gemsToDrop.shift()},G.BoardElement=function(t,e){Phaser.Image.call(this,game,0,0,null),this.anchor.setTo(.5),this.layer=t,this.board=e,this.kill()},G.BoardElement.prototype=Object.create(Phaser.Image.prototype),G.BoardElement.prototype.init=function(t,e){this._init(t,e)},G.BoardElement.prototype._init=function(t,e){this.cellX=t,this.cellY=e,this.position=this.board.getPxPosition(t,e),this.layer.add(this),this.revive()},G.BoardElement.prototype.onMatch=function(){},G.BoardElement.prototype.onHit=function(){},G.BoardElement.prototype.export=function(){return void 0!==this.hp&&this.hp},G.BoardElementBlocker=function(t,e,i){G.BoardElement.call(this,t,e),this.blockerData=i},G.BoardElementBlocker.prototype=Object.create(G.BoardElement.prototype),G.BoardElementBlocker.prototype.init=function(t,e,i){this._init(t,e),this.hp=i||this.blockerData.maxHp,G.changeTexture(this,this.blockerData.sprite+this.hp)},G.BoardElementBlocker.prototype.onMatch=function(){this.blockerData.onMatch&&this.decreaseHp()},G.BoardElementBlocker.prototype.onHit=function(){this.blockerData.onHit&&this.decreaseHp()},G.BoardElementBlocker.prototype.decreaseHp=function(){this.hp--,0==this.hp?this.kill():G.changeTexture(this,this.blockerData.sprite+this.hp),this.layer.orderCacheUpdate=!0},G.BoardElementBlocker.prototype.export=function(){return this.hp},G.BoardElementBlocker.drawOnRenderTexture=function(t,e,i,s,a,r,o){r&&(G.changeTexture(e,o.sprite+r),t.render(e))},G.BoardElementBlocker.changeImportData=function(t,e){if(!t)return 1;var i=parseInt(t);return++i>e.maxHp?"":i},G.FloorTile=function(t,e){G.BoardElement.call(this,t,e)},G.FloorTile.prototype=Object.create(G.BoardElement.prototype),G.FloorTile.prototype.init=function(t,e){this._init(t,e);var i,s=this.board.config.grid;"Hex"==s?i="hex_tile":"Square"==s?i="square_tile":"Triangle"==s&&(i="triangle_tile",this.anchor.x=this.board.baseGrid.gemSideOffset,this.board.baseGrid.isPointingRight(t,e)||(this.scale.x=-1)),G.changeTexture(this,i)},G.FloorTile.drawOnRenderTexture=function(t,e,i,s,a){var r,o=a.config.grid;"Hex"==o?(r="hex_tile",G.changeTexture(e,r),t.renderXY(e,e.x,e.y)):"Square"==o?(r="square_tile",G.changeTexture(e,r),t.renderXY(e,e.x,e.y)):"Triangle"==o&&(r="triangle_tile",G.changeTexture(e,r),e.anchor.x=a.gemSideOffset,a.isPointingRight(i,s)||(e.scale.x=-1),e.updateTransform(),t.renderXY(e,e.x,e.y),e.scale.x=1,e.anchor.x=.5)},G.AutoSolver=function(t){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.board=this.state.board,this.timer=t,this.timerCurrent=t},G.AutoSolver.prototype=Object.create(Phaser.Group.prototype),G.AutoSolver.prototype.update=function(){if(0==this.timerCurrent--&&(this.timerCurrent=this.timer,this.board.possibleMoves.length>0)){var t=game.rnd.pick(this.board.possibleMoves);this.board.makeMove(t[0],t[1],t[2],t[3])}},G.Blocker=function(t,e){G.BoardElement.call(this,t,e)},G.Blocker.prototype=Object.create(G.BoardElement.prototype),G.Blocker.prototype.init=function(t,e){this._init(t,e);var i,s=this.board.config.grid;"Hex"==s?i="hex_blocker":"Square"==s?i="squ_blocker":"Triangle"==s&&(i="tri_blocker",this.anchor.x=this.board.baseGrid.gemSideOffset,this.board.baseGrid.isPointingRight(t,e)||(this.scale.x=-1)),G.changeTexture(this,i)},G.Blocker.drawOnRenderTexture=function(t,e,i,s,a){var r,o=a.config.grid;"Hex"==o?(r="hex_blocker",G.changeTexture(e,r),t.renderXY(e,e.x,e.y)):"Square"==o?(r="squ_blocker",G.changeTexture(e,r),t.renderXY(e,e.x,e.y)):"Triangle"==o&&(r="tri_blocker",G.changeTexture(e,r),e.anchor.x=a.gemSideOffset,a.isPointingRight(i,s)||(e.scale.x=-1),e.updateTransform(),t.renderXY(e,e.x,e.y),e.scale.x=1,e.anchor.x=.5)},G.ColorDirt=function(t,e,i){G.BoardElementBlocker.call(this,t,e,i),this.gridType=this.board.config.grid.toLowerCase()},G.ColorDirt.prototype=Object.create(G.BoardElementBlocker.prototype),G.ColorDirt.prototype.init=function(t,e,i){this._init(t,e),this.hp=i||this.blockerData.maxHp,G.changeTexture(this,this.gridType+"_dirt_"+this.hp),this.scale.x=1,this.anchor.setTo(.5,.5),"triangle"===this.gridType&&(this.anchor.x=this.board.baseGrid.gemSideOffset,this.board.baseGrid.isPointingRight(t,e)||(this.scale.x=-1))},G.ColorDirt.prototype.decreaseHp=function(){G.sb("colorDirtHit").dispatch(this),this.hp--,G.sb("fxBoard").dispatch("colorDirtHit",this),0==this.hp?(G.sb("onColorDirtDeath").dispatch(this),this.kill()):G.changeTexture(this,this.gridType+"_dirt_"+this.hp),this.layer.orderCacheUpdate=!0},G.ColorDirt.drawOnRenderTexture=function(t,e,i,s,a,r,o){if(r){var n=a.config.grid.toLowerCase();r=r||o.maxHp,G.changeTexture(e,n+"_dirt_"+r),e.scale.x=1,e.anchor.setTo(.5,.5),"triangle"===n&&(e.anchor.x=a.gemSideOffset,a.isPointingRight(i,s)||(e.scale.x=-1)),e.updateTransform(),t.renderXY(e,e.x,e.y),e.scale.x=1,e.anchor.x=.5}},G.Gems={},G.Gems.Specials={horizontal:function(){this.specialType="horizontal",this.specialAction=[G.SpecialActions.Horizontal],G.changeTexture(this,"candy_"+this.matchType+"_bonus_1"),this.matchableType=1},vertical:function(){this.specialType="vertical",this.specialAction=[G.SpecialActions.Vertical],G.changeTexture(this,"candy_"+this.matchType+"_bonus_2"),this.matchableType=1},star:function(){this.specialType="star",this.specialAction=[G.SpecialActions.Diagonals],G.changeTexture(this,"candy_star"),this.matchableType=0,this.activatedByMove=!0},rainbow:function(){this.specialType="rainbow",this.specialAction=[G.SpecialActions.Rainbow],G.changeTexture(this,"candy_rainbow"),this.matchableType=0,this.activatedByMove=!0}},G.Gems.Status=function(t,e){this.gem=t,this.name=e,this.moveable=!0,this.matchable=!0,this.clickable=!1,this.changeable=!0},G.Gems.Status.prototype.isMoveable=function(){return this.moveable},G.Gems.Status.prototype.isMatchable=function(){return this.matchable},G.Gems.Status.prototype.onMatch=function(){return this.matchable},G.Gems.Status.prototype.onHit=function(){return!0},G.Gems.Status.prototype.isClickable=function(){return this.clickable},G.Gems.Status.prototype.onClick=function(){return this.clickable},G.Gems.Status.prototype.isChangeable=function(){return this.changeable},G.Gems.Statuses={},G.Gems.Statuses.Collectable=function(t){G.Gems.Status.call(this,t,"collectable"),this.matchable=!1,this.changeable=!1,this.matchableType=0,this.collectableObj={name:"testname",sprite:"collectable"},G.changeTexture(this.gem,this.collectableObj.sprite)},G.Gems.Statuses.Collectable.editorDraw=[!1,"collectable"],G.Gems.Statuses.Collectable.prototype=Object.create(G.Gems.Status.prototype),G.Gems.Statuses.Infected=function(t,e){G.Gems.Status.call(this,t,"infected"),G.changeTexture(this.gem.topImg,"infection_front"),this.changeable=!1,e||game.add.tween(this.gem.topImg).from({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0)},G.Gems.Statuses.Infected.editorDraw=[!0,"infection_front"],G.Gems.Statuses.Infected.prototype=Object.create(G.Gems.Status.prototype),G.Gems.Statuses.Infected.prototype.onMatch=function(){return G.changeTexture(this.gem.topImg,null),this.gem.removeStatus(),!1},G.Gems.Statuses.Chained=function(t){G.Gems.Status.call(this,t,"chained"),G.changeTexture(this.gem.topImg,"blocker_chain_wrapped")},G.Gems.Statuses.Chained.editorDraw=[!0,"blocker_chain_wrapped"],G.Gems.Statuses.Chained.prototype=Object.create(G.Gems.Status.prototype),G.Gems.Statuses.Chained.prototype.onMatch=function(){return G.changeTexture(this.gem.topImg,null),this.gem.removeStatus(),!1},G.Gems.Statuses.Choco=function(t){G.Gems.Status.call(this,t,"choco"),this.hp=2,G.changeTexture(this.gem.topImg,"choco_2"),this.matchable=!1},G.Gems.Statuses.Choco.editorDraw=[!0,"choco_1"],G.Gems.Statuses.Choco.prototype=Object.create(G.Gems.Status.prototype),G.Gems.Statuses.Choco.prototype.onHit=function(){return this.hp--,1==this.hp?G.changeTexture(this.gem.topImg,"choco_1"):(G.changeTexture(this.gem.topImg,null),this.gem.removeStatus()),!1},G.Gem=function(t,e){G.BoardElement.call(this,t,e),this.colorLayer=this.board.layer[1],this.locked=!1,this.moving=!1,this.falling=!1,this.moveTarget=new Phaser.Point(0,0),this.fallTarget=new Phaser.Point(0,0),this.spd=10,this.wasMoved=!1,this.matchableType=1,this.activatedByMove=!1,this.specialType=!1,this.specialAction=!1,this.pointMarked=!1;var i=G.json.BOARDSETTINGS.gemSettings;this.fallSpd=0,this.fallSpdDelta=G.l(i.fallSpdDelta),this.fallSpdMax=G.l(i.fallSpdMax),this.mergeTime=i.mergeSpeed,this.matchTime=i.matchTime,this.onMoveDone=new Phaser.Signal,G.changeTexture(this,null),this.id=Math.random()},G.Gem.prototype=Object.create(G.BoardElement.prototype),G.Gem.prototype.update=function(){this.moving&&this.moveUpdate(),this.bouncing&&this.bounceUpdate(),this.locked||this.falling&&this.fallUpdate()},G.Gem.prototype.changeType=function(t){this.matchType=t,G.changeTexture(this,"d_"+this.matchType)},G.Gem.prototype.changeIntoSpecial=function(t,e){e||this.lock(),G.Gems.Specials[t].call(this),this.board.gemLayer.moveToCache(this),e||game.time.events.add(this.mergeTime,this.unlock,this)},G.Gem.prototype.moveUpdate=function(){var t=Math.sign(this.moveTarget.x-this.x),e=Math.abs(this.moveTarget.x-this.x),i=Math.sign(this.moveTarget.y-this.y),s=Math.abs(this.moveTarget.y-this.y);if(e+s!==0){var a=e/(e+s),r=s/(e+s);this.x+=Math.min(e,this.spd*a)*t,this.y+=Math.min(s,this.spd*r)*i;game.math.distance(this.x,this.y,this.moveTarget.x,this.moveTarget.y)}this.x==this.moveTarget.x&&this.y==this.moveTarget.y&&(this.moving=!1,this.unlock(),this.onMoveDone.dispatch(this))},G.Gem.prototype.moveToTween=function(t,e){this.lock(),this.board.getPxPosition(t,e,this.moveTarget),this.moveTarget.startX=this.x,this.moveTarget.startY=this.y,this.moveTarget.diffX=this.moveTarget.x-this.x,this.moveTarget.diffY=this.moveTarget.y-this.y,this.moveTarget.progress=0,this.moveTarget.progressDelta=.1,this.moveTarget.tween=Phaser.Easing.Sinusoidal.In,this.moving=!0},G.Gem.prototype.moveUpdate=function(){var t=this.moveTarget;t.progress=Math.min(1,t.progress+t.progressDelta);var e=t.tween(t.progress);this.x=t.startX+e*t.diffX,this.y=t.startY+e*t.diffY,1==t.progress&&(this.x=t.x,this.y=t.y,this.moving=!1,this.unlock(),this.onMoveDone.dispatch(this))},G.Gem.prototype.init=function(t,e,i){this._init(t,e),G.stopTweens(this),this.locked=!1,this.moving=!1,this.falling=!1,this.fallToClear=!1,this.fallSpd=0,this.bouncing=!1,this.bounceData={},this.status=!1,this.matchableType=1,this.activatedByMove=!1,this.specialType=!1,this.specialAction=!1,this.wasMoved=!1,this.pointMarked=!1,this.matchType=!1,this.specialType=!1,this.alpha=1,this.angle=0,this.scale.setTo(1),this.processInitChunk(i)},G.Gem.prototype.isMatchBlocked=function(){return!(!this.status||this.status.isMatchable())||(0==this.matchableType||this.falling&&!this.fallToClear||this.moving||this.locked)},G.Gem.prototype.isMatchable=function(){return!this.isMatchBlocked()},G.Gem.prototype.isMoveBlocked=function(){return!(!this.status||this.status.isMoveable())||(this.falling&&!this.fallToClear||this.moving||this.locked)},G.Gem.prototype.isMoveable=function(){return!this.isMoveBlocked()},G.Gem.prototype.isChangeBlocked=function(){return!(!this.status||this.status.isChangeable())||this.specialType},G.Gem.prototype.isChangeable=function(){return!this.isChangeBlocked()},G.Gem.prototype.lock=function(){this.locked=!0},G.Gem.prototype.unlock=function(){this.locked=!1},G.Gem.prototype.onMatch=function(){this.locked||(this.specialType||0!==this.matchableType)&&(this.status&&!this.status.onMatch()||(this.lock(),this.specialAction.length>0&&this.startSpecialAction(),this.board.gemLayer.moveToNonCache(this),G.sb("fxBoard").dispatch("sparkleExplosion",this),G.sb("fxBoard").dispatch("gemExplosion",this),game.add.tween(this).to({width:1.5*this.width,height:1.5*this.height,alpha:0},100,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.add(this.kill,this)))},G.Gem.prototype.onHit=function(){!this.status||this.status.onHit()},G.Gem.prototype.startSpecialAction=function(){for(var t=0;t<this.specialAction.length;t++)this.board.addSpecialAction(new this.specialAction[t](this.board,this.layer,this))},G.Gem.prototype.mergeWithCell=function(t,e,i){this.lock(),this.board.gemLayer.moveToNonCache(this),this.board.getPxPosition(t,e,this.moveTarget),this.lock();var s=game.add.tween(this).to({x:this.moveTarget.x,y:this.moveTarget.y},this.mergeTime,Phaser.Easing.Sinusoidal.InOut,!0);i||s.onComplete.add((function(){this.kill()}),this)},G.Gem.prototype.isMatchableWith=function(t){return!this.isMatchBlocked()&&(1==this.matchableType?this.matchType===t.matchType:!!this.specialType&&this.specialType===t.specialType)},G.Gem.prototype.moveTo=function(t,e){this.moveToTween(t,e)},G.Gem.prototype.moveToImmediately=function(t,e){this.board.getPxPosition(t,e,this.moveTarget),this.x=this.moveTarget.x,this.y=this.moveTarget.y},G.Gem.prototype.fallUpdate=function(){if(!this.fallToClear){var t=Math.sign(this.fallTarget.x-this.x),e=Math.abs(this.fallTarget.x-this.x),i=Math.sign(this.fallTarget.y-this.y),s=Math.abs(this.fallTarget.y-this.y);if(e+s!==0){var a=e/(e+s),r=s/(e+s);this.x+=Math.min(e,this.fallSpd*a)*t,this.y+=Math.min(s,this.fallSpd*r)*i,this.fallSpd=Math.min(this.fallSpdMax,this.fallSpd+this.fallSpdDelta);var o=game.math.distance(this.x,this.y,this.fallTarget.x,this.fallTarget.y);this.fallTarget.creation&&(this.alpha=game.math.clamp(1-o/this.fallTarget.initDistance,0,1))}this.x==this.fallTarget.x&&this.y==this.fallTarget.y&&(this.lastFallSpd=this.fallSpd,this.alpha=1,this.fallToClear=!0)}},G.Gem.prototype.fallTo=function(t,e,i,s){if(!this.locked){i&&(this.alpha=0),this.fallTarget.creation=i||!1,this.falling||(this.falling=!0,this.fallSpd=0,this.falling=!0),s&&(this.fallSpd=this.lastFallSpd),this.fallToClear=!1;var a=this.board.getPxPosition(t,e,this.fallTarget);this.fallTarget.initDistance=game.math.distance(this.x,this.y,a.x,a.y),this.board.gemLayer.moveToNonCache(this),this.layer.changeCell(this,t,e)}},G.Gem.prototype.fallStop=function(){this.falling=!1,this.fallToClear=!1},G.Gem.prototype.bounce=function(){this.locked=!0,this.bouncing=!0,this.bounceData.velY=-.1*this.fallSpd,this.bounceData.targetY=this.y},G.Gem.prototype.bounceUpdate=function(){this.y+=this.bounceData.velY,this.bounceData.velY+=.7,this.y>this.bounceData.targetY&&(this.y=this.bounceData.targetY,this.locked=!1,this.bouncing=!1,this.board.matcher.quickMatchCheck(this.cellX,this.cellY)?this.board.matcher.cellsToProcess.push(this.cellX,this.cellY):this.board.gemLayer.moveToCache(this))},G.Gem.prototype.export=function(){if(this.collectable)return"c";var t=this.matchType;return this.specialType&&(t+="|"+this.specialType),this.wrapped&&(t+=":wrap"),this.infected&&(t+=":infect"),t},G.Gem.prototype.processInitChunk=function(t){var e=t.split(":");e[0]=e[0].split("|");var i=e[0],s=e[1];this.changeType(i[0]),i[1]&&this.changeIntoSpecial(i[1],!0),s&&this.applyStatus(G.Gems.Statuses[s],!0)},G.Gem.prototype.applyStatus=function(t,e){this.status||(this.status=new t(this,e))},G.Gem.prototype.removeStatus=function(){this.status=!1},G.Gem.prototype.blink=function(){this.board.gemLayer.moveToNonCache(this),this.duringBlink=!0,this.blinkTween=game.add.tween(this).to({alpha:.2},500,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0),this.blinkTween.onComplete.add(this.breakBlink,this)},G.Gem.prototype.breakBlink=function(){this.duringBlink&&(this.duringBlink=!1,this.blinkTween.stop(),this.alpha=1)},G.Gem.drawOnRenderTexture=function(t,e,i,s,a,r){var o=r.split(":");o[0]=o[0].split("|");var n=o[0],h=o[1],l="d_"+n[0];if(n[1]&&("vertical"==n[1]&&(l="candy_"+n[0]+"_bonus_2"),"horizontal"==n[1]&&(l="candy_"+n[0]+"_bonus_1"),"star"==n[1]&&(l="candy_star"),"rainbow"==n[1]&&(l="candy_rainbow")),h){var c=G.Gems.Statuses[h].editorDraw;c[0]&&(G.changeTexture(e,l),t.renderXY(e,e.x,e.y)),c[1]&&(G.changeTexture(e,c[1]),t.renderXY(e,e.x,e.y))}else G.changeTexture(e,l),t.renderXY(e,e.x,e.y)},G.Gem.changeImportData=function(t,e){var i=G.json.BOARDSETTINGS.layers.filter((function(t){return t.gems}))[0].editorPossibilities,s=null;if(i.forEach((function(t,i){-1!==t.map((function(t){return t[0]})).indexOf(e)&&(s=i)})),!t)return 0===s?e:"";var a=t.indexOf(":");t.indexOf("|");if(0===s)return e+t.slice(1);if(1===s){var r=t.split(":");return r[0]=r[0].split("|"),r[0][1]===e?r[0].length=1:r[0][1]=e,r[0]=r[0].join("|"),r.join(":")}return 2===s?-1==a?t+":"+e:t.slice(a+1)==e?t.slice(0,a):t.slice(0,a)+":"+e:void 0},G.SpecialAction=function(t,e,i){this.board=t,this.layer=e,this.gem=i,this.onFinish=new Phaser.Signal},G.SpecialAction.prototype.start=function(){},G.SpecialAction.prototype.update=function(){},G.SpecialAction.prototype.finish=function(){this.onFinish.dispatch()},G.SpecialActions={},G.SpecialActions.SpreadInDirections=function(t,e,i,s){G.SpecialAction.call(this,t,e,i),this.directions=s},G.SpecialActions.SpreadInDirections.prototype=Object.create(G.SpecialAction.prototype),G.SpecialActions.SpreadInDirections.prototype.start=function(){this.dirCells=[];for(var t=0;t<this.directions.length;t++)this.dirCells.push({x:this.gem.cellX,y:this.gem.cellY,dir:this.directions[t],inBoard:!0});this.every=3,this.frameCounter=0,this.prepareMatchObj()},G.SpecialActions.SpreadInDirections.prototype.prepareMatchObj=function(){for(var t={gems:[],centroid:{x:this.gem.x,y:this.gem.y}};;){for(var e=!1,i=0;i<this.dirCells.length;i++){var s=this.dirCells[i];if(s.inBoard)if(this.board.baseGrid.getNeighbourCoords(s.x,s.y,s.dir,s),this.board.isCellInsideBoard(s.x,s.y)){e=!0;var a=this.board.getGem(s.x,s.y);this.board.willMatchGem(s.x,s.y)&&!a.pointMarked&&(a.lock(),t.gems.push(a))}else s.inBoard=!1}if(!e)break}for(i=0;i<this.dirCells.length;i++)this.dirCells[i].x=this.gem.cellX,this.dirCells[i].y=this.gem.cellY,this.dirCells[i].inBoard=!0;this.matchObj=t,this.board.onMatch.dispatch(t)},G.SpecialActions.SpreadInDirections.prototype.update=function(){if(this.frameCounter%this.every==0){for(var t=!1,e=0;e<this.dirCells.length;e++){var i=this.dirCells[e];if(i.inBoard)if(this.board.baseGrid.getNeighbourCoords(i.x,i.y,i.dir,i),this.board.isCellInsideBoard(i.x,i.y)){t=!0;var s=this.board.getGem(i.x,i.y);-1!==this.matchObj.gems.indexOf(s)&&s.unlock(),this.board.matchCell(i.x,i.y),this.board.hitCell(i.x,i.y)}else i.inBoard=!1}t||this.finish()}this.frameCounter++},G.SpecialActions.Horizontal=function(t,e,i){G.SpecialActions.SpreadInDirections.call(this,t,e,i,["L","R"])},G.SpecialActions.Horizontal.prototype=Object.create(G.SpecialActions.SpreadInDirections.prototype),G.SpecialActions.Vertical=function(t,e,i){G.SpecialActions.SpreadInDirections.call(this,t,e,i,["U","D"])},G.SpecialActions.Vertical.prototype=Object.create(G.SpecialActions.SpreadInDirections.prototype),G.SpecialActions.DiagonalInc=function(t,e,i){G.SpecialActions.SpreadInDirections.call(this,t,e,i,["LD","RU"])},G.SpecialActions.DiagonalInc.prototype=Object.create(G.SpecialActions.SpreadInDirections.prototype),G.SpecialActions.DiagonalDec=function(t,e,i){G.SpecialActions.SpreadInDirections.call(this,t,e,i,["LU","RD"])},G.SpecialActions.DiagonalDec.prototype=Object.create(G.SpecialActions.SpreadInDirections.prototype),G.SpecialActions.Diagonals=function(t,e,i){G.SpecialActions.SpreadInDirections.call(this,t,e,i,["RU","RD","LU","LD"])},G.SpecialActions.Diagonals.prototype=Object.create(G.SpecialActions.SpreadInDirections.prototype),G.SpecialActions.Cross=function(t,e,i){G.SpecialActions.SpreadInDirections.call(this,t,e,i,["U","R","L","D"])},G.SpecialActions.Cross.prototype=Object.create(G.SpecialActions.SpreadInDirections.prototype),G.SpecialActions.MatchAndHitEverything=function(t,e,i){G.SpecialAction.call(this,t,e,i)},G.SpecialActions.MatchAndHitEverything.prototype=Object.create(G.SpecialAction.prototype),G.SpecialActions.MatchAndHitEverything.prototype.start=function(){var t={gems:[],centroid:{x:this.gem.x,y:this.gem.y}};this.board.baseGrid.grid.loop((function(e,i,s){var a=this.board.getGem(i,s);a&&!a.specialType&&this.board.willMatchGem(a.cellX,a.cellY)&&!a.pointMarked&&t.gems.push(a),this.board.matchCell(i,s),this.board.hitCell(i,s)}),this),this.board.onMatch.dispatch(t),this.finish()},G.SpecialActions.Rainbow=function(t,e,i){G.SpecialAction.call(this,t,e,i)},G.SpecialActions.Rainbow.prototype=Object.create(G.SpecialAction.prototype),G.SpecialActions.Rainbow.prototype.start=function(){var t=this.gem.lastMovedWith;t?t.specialType?t.specialType&&this.changeInto(t.matchType,t.specialType):t.collectable?this.changeIntoCollectable():this.clearColor(t.matchType):this.clearColor(game.rnd.pick(this.board.normalGems)),this.finish()},G.SpecialActions.Rainbow.prototype.clearColor=function(t){var e={gems:[],centroid:{x:this.gem.x,y:this.gem.y}};this.getAllMatchableGemsOfType(t).forEach((function(t){this.board.willMatchGem(t.cellX,t.cellY)&&!t.pointMarked&&e.gems.push(t),this.board.matchCell(t.cellX,t.cellY)}),this),this.board.onMatch.dispatch(e)},G.SpecialActions.Rainbow.prototype.changeInto=function(t,e){this.getAllMatchableGemsOfType(t).forEach((function(t){this.board.isCellChangeable(t.cellX,t.cellY)&&t.changeIntoSpecial(e)}))},G.SpecialActions.Rainbow.prototype.changeIntoCollectable=function(){var t=this.board.gemLayer.grid.filter((function(t,e,i){return t&&this.board.isCellChangeable(e,i)&&this.board.isCellMoveable(e,i)&&this.board.isCellMatchable(e,i)}),this);Phaser.ArrayUtils.shuffleSeeded(t);for(var e=0;e<Math.min(t.length,3);e++)t[e].changeIntoCollectable()},G.SpecialActions.Rainbow.prototype.getAllMatchableGemsOfType=function(t){var e=[];return this.board.gemLayer.grid.loop((function(i,s,a){i&&i.matchType===t&&this.board.isCellMatchable(s,a)&&e.push(i)}),this),e},G.SpecialActions.Shuffle=function(t,e,i){G.SpecialAction.call(this,t,e)},G.SpecialActions.Shuffle.prototype=Object.create(G.SpecialAction.prototype),G.SpecialActions.Shuffle.prototype.start=function(){var t=this.board.gemLayer.grid.filter((function(t){if(t)return this.board.isCellMoveable(t.cellX,t.cellY)&&this.board.isCellChangeable(t.cellX,t.cellY)&&this.board.isCellMatchable(t.cellX,t.cellY)}),this);Phaser.ArrayUtils.shuffleSeeded(t),changedGems=[];for(var e=0;e<Math.min(5,t.length);e++)t[e].changeIntoSpecial(Math.random()<.5?"vertical":"horizontal"),t[e].lock(),changedGems.push(t[e]);game.time.events.add(500,(function(){for(var t=0;t<changedGems.length;t++)changedGems[t].unlock(),changedGems[t].onMatch();this.finish()}),this)},G.SpecialActions.Shuffle=function(t,e,i){G.SpecialAction.call(this,t,e)},G.SpecialActions.Shuffle.prototype=Object.create(G.SpecialAction.prototype),G.SpecialActions.Shuffle.prototype.start=function(){var t=this.layer.grid.getAllElements().filter((function(t){return this.board.isCellMoveable(t.cellX,t.cellY)}),this);Phaser.ArrayUtils.shuffleSeeded(t);for(var e=0;e<t.length;e+=2){var i=t[e],s=t[e+1];if(!s)break;this.board.gemLayer.swapObjects(i,s),this.board.gemLayer.moveToNonCache(i),this.board.gemLayer.moveToNonCache(s),i.moveToTween(i.cellX,i.cellY,50),s.moveToTween(s.cellX,s.cellY,50),i.onMoveDone.addOnce(this.onMoveDone,this,0,i),s.onMoveDone.addOnce(this.onMoveDone,this,0,s)}this.finish()},G.SpecialActions.Shuffle.prototype.onMoveDone=function(t){this.board.matcher.quickMatchCheck(t.cellX,t.cellY);this.board.matcher.cellsToProcess.push(t.cellX,t.cellY)},G.Background=function(t){Phaser.Group.call(this,game),this.bg=G.makeImage(0,0,"splash_bg",0,this),this.fixedToCamera=!0,this.lightLeft=G.makeImage(159,202,"light",0,this),this.lightLeft.targetAlpha=.7,this.lightRight=G.makeImage(785,157,"light_right",0,this),this.lightRight.targetAlpha=.7,G.sb("onScreenResize").add(this.onResize,this),this.onResize(),this.frameCounter=0},G.Background.prototype=Object.create(Phaser.Group.prototype),G.Background.prototype.onResize=function(){game.device.desktop?(this.width=game.width,this.height=game.height):(this.width=Math.max(1e3,game.width),this.height=game.height,this.cameraOffset.x=-.5*(this.width-game.width))},G.Background.prototype.update=function(){this.frameCounter++%5==0&&(this.lightLeft.targetAlpha=game.rnd.realInRange(.1,.4),this.lightRight.targetAlpha=game.rnd.realInRange(.1,.4)),this.lightLeft.alpha=G.lerp(this.lightLeft.alpha,this.lightLeft.targetAlpha,.2),this.lightRight.alpha=G.lerp(this.lightRight.alpha,this.lightRight.targetAlpha,.2)},void 0===G&&(G={}),G.Button=function(t,e,i,s,a){Phaser.Button.call(this,game,G.l(t),G.l(e),null),this.state=game.state.getCurrentState(),G.changeTexture(this,i),this.anchor.setTo(.5),this.sfx=G.sfx.button,this.active=!0,this.baseSprite=i,this.onClick=new Phaser.Signal,s&&this.onClick.add(s,a||this),this.onInputDown.add(this.click,this),this.terms=[],this.IMMEDIATE=!1,this.scaleOnClick=!0,this.targetAlphaTermsNotFulfilled=.5,this.targetAlpha=1,this.pulsing=!1},G.Button.prototype=Object.create(Phaser.Button.prototype),G.Button.constructor=G.Button,G.Button.prototype.update=function(){this.checkTerms()?this.targetAlpha=1:this.targetAlpha=this.targetAlphaTermsNotFulfilled,this.alpha=G.lerp(this.alpha,this.targetAlpha,.2,.05),this.updateChildren()},G.Button.prototype.pulse=function(t){this.pulsing=!0,this.pulsingTween=game.add.tween(this.scale).to({x:t||1.1,y:t||1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},G.Button.prototype.stopPulse=function(t){this.pulsingTween&&this.pulsingTween.stop(),this.scale.setTo(t||1),this.pulsing=!1},G.Button.prototype.click=function(){if(this.active&&this.checkTerms()){this.active=!1,this.onClick.dispatch(),this.sfx.play();this.scale.x,this.scale.y;this.IMMEDIATE?this.active=!0:(G.spritesheetMap[this.baseSprite+"_pressed"]&&G.changeTexture(this,this.baseSprite+"_pressed"),game.time.events.add(200,(function(){this.active=!0,G.changeTexture(this,this.baseSprite)}),this))}},G.Button.prototype.checkTerms=function(){for(var t=0;t<this.terms.length;t++)if(!this.terms[t][0].call(this.terms[t][1]))return!1;return!0},G.Button.prototype.addTerm=function(t,e){this.terms.push([t,e])},G.Button.prototype.addImageLabel=function(t){this.label=game.make.image(0,0,"ssheet",t),this.label.anchor.setTo(.5),this.addChild(this.label)},G.Button.prototype.addTextLabel=function(t,e){this.label=game.make.text(0,0,t,e),this.label.anchor.setTo(.5),this.addChild(this.label)},G.Button.prototype.addTextLabelMultiline=function(t,e){var i=1/G.Loader.currentConfigMulti;this.label=new G.MultiLineText(0,0,t,e,Math.floor(this.height*i*.5),this.width*i*.8,this.height*i*.7,"center",.5,.5),this.addChild(this.label)},G.Button.prototype.stopTweens=function(){G.stopTweens(this)},G.Button.prototype.changeTexture=function(t){G.changeTexture(this,t)},G.Button.prototype.add=function(t){return this.addChild(t)},G.Button.prototype.updateChildren=function(){for(var t=this.children.length;t--;)this.children[t].update()},G.ComboController=function(t){this.board=t,this.combo=0,this.shoutouts=G.json.settings.shoutouts,G.sb("colorDirtHit").add((function(t){this.combo++}),this),this.board.onIdle.add((function(){for(var t in this.shoutouts){var e=this.shoutouts[t];this.combo>=e[0]&&this.combo<=e[1]&&G.sb("comboNotification").dispatch(t)}this.combo=0}),this)},G.saveState={makeNewDataObject:function(){return{progress:{lvlIndex:0,time:null,board:null,score:0,boosterNr:G.json.settings.amountOfBoosterOnStart},highscores:[],sawTutorial:[]}},save:function(){this.data.mute=game.sound.mute,sdkHandler.trigger("save",{key:"gmdatastring-templejewels",value:JSON.stringify(this.data),callback:function(){}},this)},init:function(){sdkHandler.trigger("restore",{key:"gmdatastring-templejewels",callback:function(t,e){e?this.data=JSON.parse(e):(this.data=this.makeNewDataObject(),this.resetProgress()),game.sound.mute=this.data.mute||!1,this.ready=!0}.bind(this)},this)},resetProgress:function(){this.data.progress={lvlIndex:0,time:null,board:null,score:0,boosterNr:G.json.settings.amountOfBoosterOnStart},this.save()},getProgressBoardData:function(){return this.data.progress.board},getProgressScore:function(){return this.data.progress.score},getProgressTime:function(){return this.data.progress.time},getProgressBoosterNr:function(){return this.data.progress.boosterNr},getProgressLvlIndex:function(){return this.data.progress.lvlIndex},setProgressBoardData:function(t,e){this.data.progress.board=t,e&&this.save()},setProgressScore:function(t,e){this.data.progress.score=t,e&&this.save()},setProgressBoosterNr:function(t,e){this.data.progress.boosterNr=t,G.sb("onHintAmountChange").dispatch(t),e&&this.save()},setProgressTime:function(t,e){this.data.progress.time=t,e&&this.save()},levelPassed:function(){this.data.progress.lvlIndex++,this.data.progress.board=null,this.data.progress.time=null,this.save()},getHighscore:function(){return this.data.highscores[0]?this.data.highscores[0][1]:0},checkHighscorePosition:function(t){if(0==t)return null;for(var e=null,i=9;i>=0;i--){var s=this.data.highscores[i];if(s&&s[1]>=t)break;e=i}return e},addHighscoreEntry:function(t,e){this.data.highscores.push([t,e]),this.data.highscores=this.data.highscores.sort((function(t,e){return e[1]-t[1]})).slice(0,10),this.save(),G.sb("onListUpdate").dispatch()}},G.ScreenKeyboard=function(t,e,i,s){Phaser.Group.call(this,game),this.aeraWidth=i,this.aeraHeight=s,this.layout=[["1234567890",{key:"Backspace",label:"backspace"}],["QWERTYUIOP"],["ASDFGHJKL"],["ZXCVBNM"]],this.stepY=Math.floor(this.aeraHeight/this.layout.length),this.font=t,this.bgImg=e,this.keyStyle={fill:"#416d83",fontSize:"60px",font:"blogger_sansbold"},this.init(),this.onKeyDown=new Phaser.Signal,this.onResize()},G.ScreenKeyboard.prototype=Object.create(Phaser.Group.prototype),G.ScreenKeyboard.prototype.onResize=function(){},G.ScreenKeyboard.prototype.init=function(){this.layout.forEach((function(t,e){this.processRow(t,e)}),this)},G.ScreenKeyboard.prototype.processRow=function(t,e){for(var i=[],s=0;s<t.length;s++){var a=t[s];if("string"==typeof a)for(var r=0;r<a.length;r++){var o=this.createButton(0,e*this.stepY,a[r]);this.add(o),i.push(o)}else{o=this.createButton(0,e*this.stepY,a);this.add(o),i.push(o)}}this.spreadRow(i)},G.ScreenKeyboard.prototype.createButton=function(t,e,i){var s,a=new G.Button(t,e,this.bgImg,(function(){this.onKeyDown.dispatch({key:s})}),this);return a.alphaOnPointer=!1,a.IMMEDIATE=!0,"string"==typeof i?(s=i,a.addTextLabel(i,this.keyStyle)):(s=i.key,a.label=G.makeImage(0,0,i.label,.5,a)),a},G.ScreenKeyboard.prototype.spreadRow=function(t){G.centerElements(t)},G.SeededRandomDataGenerator=function(){Phaser.RandomDataGenerator.call(this)},G.SeededRandomDataGenerator.prototype=Object.create(Phaser.RandomDataGenerator.prototype),G.SeededRandomDataGenerator.prototype.shuffleArray=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(this.rnd()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}return t},G.SeededRandomDataGenerator.prototype.setSeed=function(t){void 0===t&&(t=Math.random()),this.sow([t])},G.TextBtn=function(t,e,i){this.config=Object.assign({label:"LABEL",type:"int",valMin:-9999999,valMax:99999999,valChoise:["VAL1","VAL2"],setValFunc:function(t){},getValFunc:function(){return 0},exeFunc:function(){},style:{fill:"black",fontSize:"30px"}},i),G.Text.call(this,t,e," ",this.config.style),this.inputEnabled=!0,this.input.useHandCursor=!0,this.events.onInputDown.add(this.onClick,this),this.refreshTxt(),game.add.existing(this)},G.TextBtn.prototype=Object.create(G.Text.prototype),G.TextBtn.prototype.onClick=function(){if("exe"!=this.config.type){if("string"==this.config.type&&this.config.setValFunc(prompt(this.config.label,this.config.getValFunc())),"choise"==this.config.type){var t=this.config.valChoise.indexOf(this.config.getValFunc());this.config.setValFunc(this.config.valChoise[(t+1)%this.config.valChoise.length])}if("int"==this.config.type||"float"==this.config.type){var e=parseFloat(prompt(this.config.label,this.config.getValFunc()));isNaN(e)||("int"==this.config.type&&(e=Math.floor(e)),e=game.math.clamp(e,this.config.valMin,this.config.valMax),this.config.setValFunc(e))}this.refreshTxt()}else this.config.exeFunc()},G.TextBtn.prototype.refreshTxt=function(){"exe"==this.config.type?this.setText(this.config.label):this.setText(this.config.label+": "+this.config.getValFunc(),this)},G.TextCounter=function(t,e,i,s){this.dot=s.dot||!1,this.prefix=s.prefix||"",this.sufix=s.sufix||"",this.lerp=s.lerp||!0,this.lerpValue=s.lerpValue||.2,this.maxWidth=s.maxWidth||500,Phaser.Text.call(this,game,t,e," ",s),this.amount=i,this.amountDisplayed=i,this.updateDisplayedAmount(),game.add.existing(this)},G.TextCounter.prototype=Object.create(Phaser.Text.prototype),G.TextCounter.prototype.update=function(){this.amount!==this.amountDisplayed&&(this.lerp&&(this.amountDisplayed=G.lerp(this.amountDisplayed,this.amount,this.lerpValue,.4)),this.updateDisplayedAmount())},G.TextCounter.prototype.changeAmount=function(t){this.amount+=t},G.TextCounter.prototype.setAmount=function(t){this.amount=t},G.TextCounter.prototype.updateDisplayedAmount=function(){var t=this.dot?G.numberDot(Math.round(this.amountDisplayed)):Math.round(this.amountDisplayed);t=this.prefix+t.toString()+this.sufix,this.text!==t&&(this.setText(t),this.scale.x=1,this.width=Math.min(this.width,this.maxWidth))},G.TutorialHand=function(t){G.Image.call(this,0,0,"tut_hand",0),this.board=t,this.anchor.setTo(0),this.alpha=0,this.ready=!0,this.onReady=new Phaser.Signal,G.sb("onTutorialStep").add(this.doStep,this)},G.TutorialHand.prototype=Object.create(G.Image.prototype),G.TutorialHand.prototype.doStep=function(){if(this.tutorialCells.splice(0,2),0==this.tutorialCells.length)this.ready=!1,game.add.tween(this).to({alpha:0},200,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.add((function(){this.ready=!0,this.onReady.dispatch()}),this);else{var t=this.board.getPxPosition(this.tutorialCells[0],this.tutorialCells[1]);game.add.tween(this).to({x:t.x,y:t.y},200,Phaser.Easing.Sinusoidal.InOut,!0),this.visible=!0}},G.TutorialHand.prototype.setCells=function(t){this.tutorialCells=JSON.parse(JSON.stringify(t.cells)),this.tutorialDelay=t.delay,this.ready?this.initStep():this.onReady.addOnce(this.initStep,this)},G.TutorialHand.prototype.hide=function(){this.ready?this.ready=!0:(G.stopTweens(this),game.add.tween(this).to({alpha:0},200,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.ready=!0,this.onReady.dispatch()}),this))},G.TutorialHand.prototype.initStep=function(){G.stopTweens(this),this.ready=!1;var t=this.board.getPxPosition(this.tutorialCells[0],this.tutorialCells[1]);this.x=t.x,this.y=t.y;var e=this.board.getPxPosition(this.tutorialCells[2],this.tutorialCells[3]);game.add.tween(this).to({x:e.x,y:e.y},1e3,Phaser.Easing.Sinusoidal.Out,!0,this.tutorialDelay,-1,!1),game.add.tween(this).to({alpha:1},200,Phaser.Easing.Sinusoidal.InOut,!0,this.tutorialDelay)},G.TutorialHandBooster=function(){G.Image.call(this,0,0,"tut_hand",0),this.state=game.state.getCurrentState(),this.position=this.state.gameUI.buttons.hintBtn.worldPosition,this.anchor.setTo(0),game.add.tween(this.anchor).to({x:-.2,y:-.25},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.alpha=0,game.add.tween(this).to({alpha:1},200,Phaser.Easing.Sinusoidal.In,!0),G.sb("onShowingHint").addOnce((function(){G.stopTweens(this),game.add.tween(this).to({alpha:0},200,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.destroy()}),this)}),this)},G.TutorialHandBooster.prototype=Object.create(G.Image.prototype),G.TutorialLayer=function(t,e){Phaser.Group.call(this,game);try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:TutorialVisible"})}catch(t){}if(t.RESIZETUT=!0,this.tutorialData=JSON.parse(JSON.stringify(e)),this.tutorialSteps=this.tutorialData.steps,this.board=t,this.state=game.state.getCurrentState(),this.tutTxt=new G.TutorialText(t),this.tutHand=new G.TutorialHand(t),this.board.add(this.tutHand),this.board.onMatch.add((function(){this.currentMatchStep&&(this.currentMatchStep=!1,this.finishStep(this.currentStep))}),this),this.tutorialData.prestepTutorialOverwrites)for(var i in this.tutorialData.prestepTutorialOverwrites)this.state.tutorialOverwrites[i]=this.tutorialData.prestepTutorialOverwrites[i];this.firstMsgDelay=!0,G.sb("onGameStart").add(this.doNextStep,this)},G.TutorialLayer.prototype=Object.create(Phaser.Group.prototype),G.TutorialLayer.prototype.doNextStep=function(){var t=this.tutorialSteps.shift();if(!t)return G.saveState.data.sawTutorial.push(this.state.lvlIndex),G.saveState.save(),void(this.currentStep=null);if(this.currentStep=t,"match"==t.type?this.currentMatchStep=!0:"wait"==t.type?game.time.events.add(t.waitMs,this.finishStep,this,t):"goalAchieved"==t.type?G.sb("onGoalAchieved").addOnce(this.finishStep,this,t):"hint"==t.type&&G.sb("onShowingHint").addOnce((function(){this.finishStep(t)}),this),t.txt&&(this.firstMsgDelay?(this.firstMsgDelay=!1,this.firstMsgDelayEvent=game.time.events.add(2e3,(function(){this.tutTxt.showMsg(t.txt)}),this)):this.tutTxt.showMsg(t.txt)),t.handCells&&this.tutHand.setCells(t.handCells),t.startDesignEvent)try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:t.startDesignEvent})}catch(t){}if(t.HINTFLOW&&(G.saveState.setProgressBoosterNr(G.saveState.getProgressBoosterNr()+1),new G.TutorialHandBooster,new G.TutorialBoosterOverlay),t.tutorialOverwrites)for(var e in t.tutorialOverwrites)this.state.tutorialOverwrites[e]=t.tutorialOverwrites[e];t.saveSawTutorial&&(G.saveState.data.sawTutorial=!0,G.saveState.save())},G.TutorialLayer.prototype.finishStep=function(t){if(this.firstMsgDelayEvent&&(game.time.events.remove(this.firstMsgDelayEvent),this.firstMsgDelayEvent=!1),this.tutHand.hide(),t.dontHideTxt||this.tutTxt.hideMsg(),this.board.inputMgr.exclusiveTutCells=!1,t.finishDesignEvent)try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:t.finishDesignEvent})}catch(t){}t.resetTutorialOverwritesOnFinish&&(this.state.tutorialOverwrites={inputMgrOnClickLock:!1,freezeTime:!1}),this.doNextStep()},G.TutorialBoosterOverlay=function(){Phaser.Graphics.call(this,game),this.state=game.state.getCurrentState(),this.state.gameUI.buttons.add(this),this.state.gameUI.buttons.moveDown(this),this.state.gameUI.buttons.fullScreenBtn.inputEnabled=!1,this.state.gameUI.buttons.pauseBtn.inputEnabled=!1,this.beginFill(0,1),game.device.desktop?this.drawRect(-400,-950,2200,1800):(this.drawRect(-400,-200,1300,1500),this.x=-450),this.alpha=0,game.add.tween(this).to({alpha:.5},200,Phaser.Easing.Sinusoidal.Out,!0),G.sb("onShowingHint").addOnce((function(){G.stopTweens(this),game.add.tween(this).to({alpha:0},200,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.state.gameUI.buttons.fullScreenBtn.inputEnabled=!0,this.state.gameUI.buttons.pauseBtn.inputEnabled=!0,this.destroy()}),this)}),this)},G.TutorialBoosterOverlay.prototype=Object.create(Phaser.Graphics.prototype),G.TutorialText=function(t){Phaser.Group.call(this,game),this.board=t,this.boardW=this.board.getPxWidth()},G.TutorialText.prototype=Object.create(Phaser.Group.prototype),G.TutorialText.prototype.update=function(){this.x=Math.floor(this.board.x+.5*this.board.getPxWidth()),this.y=this.board.y-10,game.device.desktop?this.currentMsg&&(this.currentMsg.scale.setTo(1),this.currentMsg.height=Math.min(this.worldPosition.y-10,this.currentMsg.height),this.currentMsg.scale.x=this.currentMsg.scale.y):this.currentMsg&&(this.currentMsg.scale.setTo(1),this.currentMsg.height=Math.min(this.worldPosition.y-200,this.currentMsg.height),this.currentMsg.scale.x=this.currentMsg.scale.y)},G.TutorialText.prototype.showMsg=function(t){Array.isArray(t)&&(t=sgSettings.config.rewarded.enabled?t[0]:t[1]),this.currentMsg=this.add(new G.Text(0,0,G.txt(t),{font:"blogger_sansbold",fill:"white",fontSize:"40px"},[.5,1],game.device.desktop?game.width-400:.95*game.width,170,!0,"center")),game.add.tween(this.currentMsg).from({alpha:0},200,Phaser.Easing.Sinusoidal.In,!0)},G.TutorialText.prototype.hideMsg=function(){if(this.currentMsg){var t=this.currentMsg;G.stopTweens(t),game.add.tween(t).to({alpha:0},200,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){t.destroy()}))}},G.BoardHints=function(t,e){Phaser.Group.call(this,game),this.board=t,this.hint1=G.makeImage(0,0,null,.5,this),this.hint2=G.makeImage(0,0,null,.5,this);var i=null;"Hex"==e.grid?i="hex_hint":"Triangle"==e.grid?(this.TRIANGLE=!0,i="triangle_hint"):i="square_hint",this.hint1.changeTexture(i),this.hint2.changeTexture(i),this.hint1.blendMode=1,this.hint2.blendMode=1,this.alpha=0,this.visible=!1,G.sb("updatePossibleMoves").add((function(t){this.possibleMoves=t}),this),G.sb("showHint").add(this.showHint,this),G.sb("hideHint").add(this.hideHint,this)},G.BoardHints.prototype=Object.create(Phaser.Group.prototype),G.BoardHints.prototype.showHint=function(){if(0!=this.possibleMoves.length){this.showing=!0,G.sb("onShowingHint").dispatch();var t=game.rnd.pick(this.possibleMoves);this.board.getPxPosition(t[0],t[1],this.hint1),this.board.getPxPosition(t[2],t[3],this.hint2),this.TRIANGLE&&(this.hint1.scale.x=1,this.hint1.anchor.x=.33,this.board.baseGrid.isPointingRight(t[0],t[1])||(this.hint1.scale.x=-1),this.hint2.scale.x=1,this.hint2.anchor.x=.33,this.board.baseGrid.isPointingRight(t[2],t[3])||(this.hint2.scale.x=-1)),G.stopTweens(this),this.alpha=0,this.visible=!0,game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)}},G.BoardHints.prototype.hideHint=function(){this.showing&&(G.sb("onHidingHint").dispatch(),this.showing=!1,G.stopTweens(this),game.add.tween(this).to({alpha:0},500,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.visible=!1}),this))},G.CoinUI=function(t,e){G.Image.call(this,t,e,"coin_rotation_f_0",.5),this.state=game.state.getCurrentState(),this.rotPos=0,this.rotating=!1,this.frameCounter=0},G.CoinUI.prototype=Object.create(G.Image.prototype),G.CoinUI.prototype.init=function(){this.goal=this.state.board.layer[1].grid.count(),this.goalDisplayed=this.goal,this.goalTxt=this.add(new G.Text(0,0,this.goal.toString(),{fill:"#006478",font:"blogger_sansbold",fontSize:"50px",stroke:"#edccb5",strokeThickness:5},.5)),this.state.board.onElementKilled.add(this.onElementKilled,this)},G.CoinUI.prototype.update=function(){this.updateCoinSprite()},G.CoinUI.prototype.startRotation=function(){this.rotating=!0,game.add.tween(this).to({rotPos:12},800,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.add((function(){this.updateCoinSprite(),this.rotating=!1}),this)},G.CoinUI.prototype.updateCoinSpriteFinish=function(){var t,e=Math.floor(this.rotPos)%6;this.rotPos>10?(t="coin_rotation_face_f_"+e,this.goalTxt.visible=!1):t="coin_rotation_f_"+e,this.frameName!==t&&G.changeTexture(this,t)},G.CoinUI.prototype.onElementKilled=function(t,e,i){"colors"==t&&(this.goal=i,0==i?(this.goalDispalyed=0,G.sb("onGoalAchieved").dispatch(),this.startRotation(this.coinFinishFrames)):this.startRotation())},G.CoinUI.prototype.updateCoinSprite=function(){if(this.animPlaying&&this.frameCounter++%2==0){this.animIndex++;var t=this.anim[this.animIndex];t?(this.changeTexture(t.sprite),t.txtScaleX&&(this.goalTxt.scale.x=t.txtScaleX),null!=t.txtPosX&&(this.goalTxt.x=t.txtPosX),void 0!==t.txtVisible&&(this.goalTxt.visible=t.txtVisible),t.updateTxt&&this.goal!==this.goalDispalyed&&(this.goalTxt.setText(this.goal.toString()),this.goalDispalyed=this.goal)):(this.animPlaying=!1,this.goalDispalyed!==this.goal&&this.startRotation())}},G.CoinUI.prototype.startRotation=function(t){this.anim=t||this.coinNormalFrames,this.animIndex=-1,this.animPlaying=!0,this.frameCounter=0},G.CoinUI.prototype.coinNormalFrames=[{sprite:"coin_rotation_f_0",txtScaleX:1,txtPosX:0},{sprite:"coin_rotation_f_1",txtScaleX:.92,txtPosX:4},{sprite:"coin_rotation_f_2",txtScaleX:.7,txtPosX:6},{sprite:"coin_rotation_f_3",txtScaleX:0,txtPosX:0,updateTxt:!0},{sprite:"coin_rotation_f_4",txtScaleX:.7,txtPosX:-6},{sprite:"coin_rotation_f_5",txtScaleX:.92,txtPosX:-4},{sprite:"coin_rotation_f_0",txtScaleX:1,txtPosX:0}],G.CoinUI.prototype.coinFinishFrames=[{sprite:"coin_rotation_f_0",txtScaleX:1,txtPosX:0},{sprite:"coin_rotation_f_1",txtScaleX:.92,txtPosX:4},{sprite:"coin_rotation_f_2",txtScaleX:.7,txtPosX:6},{sprite:"coin_rotation_f_3",txtVisible:!1},{sprite:"coin_rotation_face_f_4"},{sprite:"coin_rotation_face_f_5"},{sprite:"coin_rotation_face_f_0"}],G.GameGoal=function(t,e){this.state=game.state.getCurrentState(),this.goal=this.state.board.layer[1].grid.count();Phaser.Text.call(this,game,t,e,this.goal.toString(),{fill:"#006478",font:"blogger_sansbold",fontSize:"50px",stroke:"#edccb5",strokeThickness:5}),this.anchor.setTo(.5),this.state.board.onElementKilled.add(this.onElementKilled,this),G.sb("finishGame").add((function(){game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)}),this),this.visible=!1},G.GameGoal.prototype=Object.create(Phaser.Text.prototype),G.GameGoal.prototype.onElementKilled=function(t,e,i){"colors"==t&&(this.goal=i,this.setText(i.toString()),0==i&&(G.sb("onGoalAchieved").dispatch(),G.sb("finishGame").dispatch()))},G.GameScore=function(t,e){this.state=game.state.getCurrentState(),this.score=G.saveState.getProgressScore(),this.scoreGained=0,G.TextCounter.call(this,t,e,this.score,{fill:"white",font:"blogger_sansbold",fontSize:"32px",lerp:!0,lerpValue:.4}),this.anchor.setTo(.5),this.bonusPartStarted=0,this.bonusPartFinished=0,G.sb("onBonusPartStart").add((function(){this.bonusPartStarted++}),this),G.sb("onBonusPartFinish").add((function(){this.bonusPartFinished++,this.changeAmount(10),this.scoreGained+=10,this.score=this.amount,this.bonusPartStarted==this.bonusPartFinished&&G.sb("finishGame").dispatch()}),this)},G.GameScore.prototype=Object.create(G.TextCounter.prototype),G.GameScore.prototype.addPoints=function(t){this.scoreGained+=t,this.changeAmount(t),this.score=this.amount,G.saveState.setProgressScore(this.amount)},G.GameScore.prototype.init=function(){this.state.board.onCombinedMatch.add((function(t){switch(t.length){case 3:this.addPoints(100);break;case 4:this.addPoints(200);break;default:this.addPoints(400)}}),this)},G.GameTimer=function(t,e){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.position.setTo(t,e),this.timeMax=this.state.lvlData.time;var i=G.saveState.getProgressTime();this.time=i||this.timeMax,this.ringLeft=G.makeImage(0,0,"time_ring_half",[1,.5],this),this.bgRight=G.makeImage(0,0,"timer_bg_right",[0,.5],this),this.ringRight=G.makeImage(0,0,"time_ring_half",[1,.5],this),this.bgLeft=G.makeImage(0,0,"timer_bg_left",[1,.5],this),this.bgLeft.visible=!1,this.ringRight.scale.x=-1,this.partGroup=game.make.group(),this.partGroup.position.setTo(t,e),this.part=G.makeImage(0,-58,"time_part",.5,this.partGroup),this.part.blendMode=1,this.part.alpha=0,this.active=!1,this.gameCompleted=!1,this.showTimeNorm(this.time/this.timeMax),G.sb("onGameStart").add((function(){this.active=!0}),this),G.sb("finishGame").add((function(){this.active=!1,this.gameCompleted=!0}),this),G.sb("onGoalAchieved").add(this.startBonusTimeDown,this),G.sb("onPause").add((function(){this.pause=!0}),this),G.sb("onUnpause").add((function(){this.pause=!1}),this),G.sb("onColorDirtDeath").add((function(){this.time+=G.json.settings.timeForDirtyTile,this.time=Math.min(this.timeMax,this.time)}),this),this.saidHurryUp=!1},G.GameTimer.prototype=Object.create(Phaser.Group.prototype),G.GameTimer.prototype.startBonusTimeDown=function(){this.update=this.updateBonusTime,this.lastFull=Math.floor(this.time)};G.GameTimer.prototype.update=function(){!this.active||this.pause||this.gameCompleted||this.state.tutorialOverwrites.freezeTime?this.part.alpha=game.math.clamp(this.part.alpha-.05,0,1):(this.time-=.0166666,this.timeMax>20&&this.time<20&&!this.saidHurryUp&&(G.sb("onHurryUp").dispatch(),this.saidHurryUp=!0),G.saveState.setProgressTime(this.time),this.showTimeNorm(this.time/this.timeMax),this.part.scale.setTo(game.rnd.realInRange(.9,1.1)),this.time>0?this.part.alpha=game.math.clamp(this.part.alpha+.05,0,1):this.part.alpha=game.math.clamp(this.part.alpha-.05,0,1),this.time<=0&&(G.sb("outOfTime").dispatch(),G.sb("finishGame").dispatch(),this.active=!1))},G.GameTimer.prototype.updateBonusTime=function(){if(this.active){if(this.time-=.2,this.showTimeNorm(this.time/this.timeMax),this.part.scale.setTo(game.rnd.realInRange(.9,1.1)),this.lastFull!==Math.floor(this.time)){this.lastFull=Math.floor(this.time);var t=this.state.uiTargetParticles.init(this.part.worldPosition.x,this.part.worldPosition.y,"time_part",this.state.gameUI.scoreController);t.onStart.add(this.onBonusStart,t),t.alpha=.8,t.blendMode=1,t.onFinish.add(this.onBonusFinish),t.start()}this.time>0?this.part.alpha=game.math.clamp(this.part.alpha+.05,0,1):this.part.alpha=game.math.clamp(this.part.alpha-.05,0,1),this.time<=0&&(this.active=!1)}else this.part.alpha=game.math.clamp(this.part.alpha-.05,0,1)},G.GameTimer.prototype.onBonusStart=function(){G.sb("onBonusPartStart").dispatch(),this.vel.setTo(game.rnd.realInRange(-5,5),game.rnd.realInRange(-5,5))},G.GameTimer.prototype.onBonusFinish=function(){G.sfx.pop.play(),G.sb("onBonusPartFinish").dispatch()},G.GameTimer.prototype.activate=function(){this.active=!0},G.GameTimer.prototype.showTimeNorm=function(t){t=game.math.clamp(t,0,1),this.bgLeft.visible=t<.5,this.ringLeft.visible=t>=.5,this.partGroup.angle=-360*(1-t),t>.5?(this.ringLeft.angle=-180*(1-(t-.5)/.5),this.ringRight.angle=0):this.ringRight.angle=-180*(1-t/.5)},G.GameUI=function(t){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.sidePanel=G.makeImage(0,0,"side_panel_bg",0,this),this.leavesTimer=G.makeImage(126,50,"leafs_under_ring",.5,this),this.panel=G.makeImage(10,0,"ui_panel",0,this),this.buttonPatternBg=G.makeImage(130,500,"side_panel_pattern",.5,this),this.timer=new G.GameTimer(126,119),this.add(this.timer),this.coin=new G.CoinUI(126,118),this.add(this.coin);var e={fill:"#524863",font:"blogger_sansbold",fontSize:"32px",stroke:"#edccb5",strokeThickness:5};this.scoreLabel=game.make.text(130,290,G.txt(0),e),this.scoreLabel.anchor.setTo(.5),this.add(this.scoreLabel),this.scoreController=new G.GameScore(130,337),this.add(this.scoreController),this.levelLabel=game.make.text(130,384,G.txt(1),e),this.levelLabel.anchor.setTo(.5),this.add(this.levelLabel);e={fill:"white",font:"blogger_sansbold",fontSize:"32px"};this.level=game.make.text(130,431,t+"/"+G.json.levels.length,e),this.level.anchor.setTo(.5),this.add(this.level),this.leaves=new G.LeavesUI,this.add(this.leaves),this.add(this.timer.partGroup),this.buttons=new G.GameUIButtons(130,550),this.add(this.buttons),G.sb("onScreenResize").add(this.onResize,this),this.onResize()},G.GameUI.prototype=Object.create(Phaser.Group.prototype),G.GameUI.prototype.onResize=function(){this.sidePanel.height=Math.max(720,game.height),this.leaves.scale.y=this.sidePanel.scale.y,this.buttons.y=550+Math.floor(220*(1-(950-game.height)/230)),this.buttonPatternBg.y=this.buttons.y+50},G.GameUI.prototype.init=function(){this.coin.init(),this.scoreController.init()},G.GameUIButtons=function(t,e){Phaser.Group.call(this,game),this.position.setTo(t,e).floor(),this.state=game.state.getCurrentState(),game.device.desktop?(this.pauseBtn=new G.Button(-55,105,"button_pause",this.pause,this),this.add(this.pauseBtn),this.fullScreenBtn=new G.Button(-8e3,105,"button_fullscreen"),this.fullScreenBtn.onInputUp.add(this.fullscreen,this),this.add(this.fullScreenBtn),this.hintBtn=this.add(new G.HintBtn(0,0))):(this.pauseBtn=new G.Button(105,34,"button_pause_mobile",this.pause,this),this.add(this.pauseBtn),this.fullScreenBtn=new G.Button(-8e3,-34,"button_fullscreen_mobile"),this.fullScreenBtn.onInputUp.add(this.fullscreen,this),this.add(this.fullScreenBtn),this.hintBtn=this.add(new G.HintBtn(0,0))),this.pauseBtn.addTerm((function(){return!((0==this.state.lvlIndex||1==this.state.lvlIndex)&&this.state.tutLayer)}),this),game.device.iOS&&(this.fullScreenBtn.visible=!1)},G.GameUIButtons.prototype=Object.create(Phaser.Group.prototype),G.GameUIButtons.prototype.booster=function(){G.saveState.getProgressBoosterNr()>0?(this.boosterNr--,G.sb("showHint").dispatch(),G.saveState.setProgressBoosterNr(this.boosterNr,!0),this.boosterNrTxt.setText(this.boosterNr.toString())):sgSettings.config.rewarded.enabled&&new G.HintAdsPopUp},G.GameUIButtons.prototype.pause=function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:IngamePauseButtonPressed"})}catch(t){}G.sb("openPausePopUp").dispatch()},G.GameUIButtons.prototype.fullscreen=function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:IngameFullScreenButtonPressed"})}catch(t){}game.scale.isFullScreen?game.scale.stopFullScreen():game.scale.startFullScreen(!1)},G.GameUIMobile=function(t){Phaser.Group.call(this,game),this.x=.5*game.width,this.sidePanel=G.makeImage(0,0,"side_panel_mobile",[.5,0],this),this.buttonPatternBg=G.makeImage(230,71,"side_panel_mobile_pattern",.5,this),this.timerBg=G.makeImage(0,100,"ui_mobile_panel_time",.5,this),this.timer=new G.GameTimer(0,70),this.add(this.timer),this.coin=new G.CoinUI(0,69),this.add(this.coin),this.scorePanel=this.add(game.make.group()),this.scorePanel.position.setTo(-228,72),this.scorePanelBg=G.makeImage(0,0,"ui_mobile_panel",.5,this.scorePanel);var e={fill:"#524863",font:"blogger_sansbold",fontSize:"28px",stroke:"#edccb5",strokeThickness:5};this.scoreLabel=this.scorePanel.add(new G.Text(-90,-42,G.txt(0),e,[0,.5],170)),this.levelLabel=this.scorePanel.add(new G.Text(-90,40,G.txt(1),e,[0,.5],90)),this.level=this.scorePanel.add(new G.Text(45,42,t,{fill:"white",font:"blogger_sansbold",fontSize:"28px"},.5,78)),this.leaves=new G.LeavesUI,this.add(this.leaves),this.scoreController=new G.GameScore(0,-2),this.scorePanel.add(this.scoreController),this.add(this.timer.partGroup),this.buttons=new G.GameUIButtons(202,71),this.add(this.buttons),G.sb("onScreenResize").add(this.onResize,this),this.onResize()},G.GameUIMobile.prototype=Object.create(Phaser.Group.prototype),G.GameUIMobile.prototype.onResize=function(){this.x=Math.floor(.5*game.width)},G.GameUIMobile.prototype.init=function(){this.coin.init(),this.scoreController.init()},G.HintBtn=function(t,e){Phaser.Group.call(this,game),this.position.setTo(t,e),this.boosterNr=G.saveState.getProgressBoosterNr(),this.btn=new G.Button(0,0,"button_hint",this.onClick,this),this.add(this.btn),this.targetAlphaTermsNotFulfilled=1,this.state=game.state.getCurrentState(),this.counter=G.makeImage(50,30,"hit_number_cell",.5,this),this.counter.text=new G.Text(0,3,this.boosterNr.toString(),{fill:"white",font:"blogger_sansbold",fontSize:"30px"},.5),this.counter.addChild(this.counter.text),game.device.desktop||this.counter.position.setTo(-50,0),this.hintHidden=!0,this.btn.addTerm((function(){return this.state.board.possibleMoves.length>0&&!this.showingHint&&this.state.board.idle&&!this.goalAchieved&&!this.state.tutorialOverwrites.lockHint}),this),sgSettings.config.rewarded.enabled?0==this.boosterNr&&this.counter.text.setText("+"):this.btn.addTerm((function(){return this.boosterNr>0}),this),this.showingHint=!1,G.sb("onShowingHint").add((function(){this.showingHint=!0}),this),G.sb("onHidingHint").add((function(){this.showingHint=!1}),this),G.sb("onBoardEmpty").add((function(){this.inputEnabled=!1}),this),G.sb("onTimesUp").add((function(){this.inputEnabled=!1}),this),G.sb("onGoalAchieved").add((function(){this.goalAchieved=!0}),this),G.sb("onHintAmountChange").add((function(t){this.counter.text.setText(t.toString()),this.boosterNr=t,0==t&&sgSettings.config.rewarded.enabled&&this.counter.text.setText("+")}),this),game.add.existing(this),this.multiScale=1,this.pulseScale=0,game.add.tween(this).to({pulseScale:.05},600,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},G.HintBtn.prototype=Object.create(Phaser.Group.prototype),G.HintBtn.prototype.update=function(){this.btn.update(),this.boosterNr>0||sgSettings.config.rewarded.enabled?this.multiScale=G.lerp(this.multiScale,1,.1,.01):this.multiScale=G.lerp(this.multiScale,0,.1,.01),this.scale.setTo(1+this.pulseScale*this.multiScale)},G.HintBtn.prototype.onClick=function(){if(0==this.boosterNr)if(sgSettings.config.rewarded.enabled){G.sb("openMoreHintPopUp").dispatch();try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:IngameHintButtonPressedWhenAmountZeroWithIncentivizedOption"})}catch(t){}}else try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:IngameHintButtonPressedWhenAmountZero"})}catch(t){}else{try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:IngameHintButtonPressed"}),sdkHandler.trigger("gameTracking",{event:"Sink",dimension1:"Hint",value:1,dimension2:"Level"})}catch(t){}this.boosterNr--,G.saveState.setProgressBoosterNr(this.boosterNr,!0),G.sb("showHint").dispatch(),this.counter.text.setText(this.boosterNr.toString()),0==this.boosterNr&&sgSettings.config.rewarded.enabled&&this.counter.text.setText("+")}},G.HintBtn,G.LeavesUI=function(){Phaser.Group.call(this,game),this.leaves=[],(game.device.desktop?this.coords:this.coordsMobile).forEach((function(t){var e=this.add(new G.LeafUI(t[0],t[1],t[2]));this.leaves.push(e)}),this),this.wind()},G.LeavesUI.prototype=Object.create(Phaser.Group.prototype),G.LeavesUI.prototype.wind=function(){for(var t=0;t<this.leaves.length;t++)this.leaves[t].addWind(150*t)},G.LeavesUI.prototype.coords=[[244,7,"leafs_2"],[319,71,"leafs_7"],[255,187,"leafs_6"],[291,224,"leafs_5"],[288,347,"leafs_4"],[293,432,"leafs_3"],[262,559,"leafs_8"],[299,625,"leafs_1"]],G.LeavesUI.prototype.coordsMobile=[[-367,182,"leafs_2"],[-283,137,"leafs_3"],[-196,137,"leafs_8"],[-113,186,"leafs_6"],[119,166,"leafs_7"],[206,132,"leafs_5"],[284,149,"leafs_1"],[361,166,"leafs_4"]],G.LeafUI=function(t,e,i){G.Image.call(this,t,e,i,[.5,0])},G.LeafUI.prototype=Object.create(G.Image.prototype),G.LeafUI.prototype.addWind=function(t){game.add.tween(this).to({angle:8},2e3,Phaser.Easing.Sinusoidal.InOut,!0,t||0,-1,!0)},G.LvlBackground=function(){Phaser.Group.call(this,game),this.bg=G.makeImage(0,0,"background",0,this),this.fixedToCamera=!0,G.sb("onScreenResize").add(this.onResize,this),this.onResize(),this.addLightBeam(500,-100,2),this.addLightBeam(700,-100,3),this.addLightBeam(900,-100,1),this.addLightBeam(1100,-100,2),this.addLightBeam(800,-100,3),this.addLightBeam(1300,-100,3)},G.LvlBackground.prototype=Object.create(Phaser.Group.prototype),G.LvlBackground.prototype.onResize=function(){game.device.desktop?(this.cameraOffset.x=280,this.bg.width=game.width-280,this.bg.height=game.height):(this.bg.width=Math.max(1500,game.width),this.bg.height=game.height,this.cameraOffset.x=-.5*(this.bg.width-game.width))},G.LvlBackground.prototype.addLightBeam=function(t,e,i){var s=G.makeImage(t,e,"lightbeam_"+i,[.5,0],this);s.angle=45,s.alpha=.8,game.add.tween(s).to({x:t+100},15e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,15e3),game.add.tween(s).to({alpha:.1},9e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,9e3)},G.MainNotifications=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.state=game.state.getCurrentState(),this.active=!0,G.sb("onScreenResize").add(this.onResize,this),this.onResize(),0==this.state.lvlIndex?(G.sfx.vo_welcome.play(),G.sfx.vo_welcome.onStop.addOnce((function(){G.sfx.vo_lets_go.play()}))):this.state.lvlIndex==G.json.levels.length-1&&(G.sfx.vo_final_round.onStop.addOnce((function(){G.sfx.vo_lets_go.play()})),G.sfx.vo_final_round.play()),G.sb("getReady").add((function(){0==this.state.lvlIndex?this.onNotification("notify-ready"):this.state.lvlIndex==G.json.levels.length-1?this.onNotification("notify-finalRound"):(this.onNotification("notify-ready"),G.sfx.vo_lets_go.play())}),this),G.sb("onGameStart").add((function(){this.onNotification("notify-start")}),this),G.sb("comboNotification").add((function(t){G.sfx["vo_"+t].isPlaying||(this.onNotification("notify-"+t),G.sfx["vo_"+t].play())}),this),G.sb("onGoalAchieved").add((function(){this.onNotification("notify-levelComplete",!0),this.active=!1}),this),G.sb("outOfTime").add((function(){this.onNotification("notify-timesUp",!0),G.sfx.vo_time_is_up.play(),this.active=!1}),this),G.sb("onHurryUp").add((function(){this.onNotification("notify-hurryup"),G.sfx.vo_hurry_up.play()}),this)},G.MainNotifications.prototype=Object.create(Phaser.Group.prototype),G.MainNotifications.prototype.onResize=function(){game.device.desktop?(this.cameraOffset.x=280+Math.floor(.5*(game.width-280)),this.cameraOffset.y=Math.floor(.5*game.height)):(this.cameraOffset.x=Math.floor(.5*game.width),this.cameraOffset.y=Math.floor(.5*game.height),this.scale.setTo(.85))},G.MainNotifications.prototype.onNotification=function(t,e){if(this.active){var i=this.getFirstDead()||this.add(new G.Notification);this.children.forEach((function(t){t!==i&&t.alive&&t.onOtherInit()})),i.init(t,e),this.bringToTop(i)}},G.Notification=function(){G.Image.call(this,0,0,null,.5,null),this.kill()},G.Notification.prototype=Object.create(G.Image.prototype),G.Notification.prototype.init=function(t,e){this.position.setTo(0,0),this.scale.setTo(0),this.alpha=1,this.loadTexture(game.cache.getRenderTexture(t).texture),this.revive(),this.msgPos=0,game.add.tween(this.scale).to({x:1,y:1},200,Phaser.Easing.Cubic.Out,!0),this.alphaTimer=e?120:80,this.movingUp=!1},G.Notification.prototype.update=function(){this.y=G.lerp(this.y,-80*this.msgPos,.4,.5),this.alphaTimer--<0&&(this.alpha-=.04,this.alpha<=0&&this.kill())},G.Notification.prototype.onOtherInit=function(){this.movingUp=!0,this.msgPos++,this.alphaTimer=-1},G.HighscorePanel=function(){Phaser.Group.call(this,game),this.hidingOffset=500,this.x=.5*game.width+game.world.bounds.x+this.hidingOffset,this.y=game.height,this.opened=!1,this.bodyBg=G.makeImage(0,0,"leaderboard-body-bg",[.5,0],this),this.contentBg=G.makeImage(0,0,"leaderboard-chin",[.5,0],this),this.contentBg.inputEnabled=!0,this.contentBg.events.onInputDown.add((function(){this.clicked=!0}),this),this.clicked=!1,this.tabsGroup=this.add(game.add.group()),this.tabsGroup.x=-320,this.tabs={},this.contentGroup=this.add(game.add.group()),this.contentGroup.x=-302,this.contentGroup.y=68,this.initCheck=!1,this.responseData=!1,this.prevY=this.y,this.inputPrevY=null,this.inputVelY=0,this.inputPrevX=null,this.inputVelX=0,this.maskGfx=this.add(game.add.graphics()),this.maskGfx.y=68,this.maskGfx.alpha=.5,this.maskWidth=604,this.borderWidth=5,this.maskHeight=80,this.visiblePx=195,this.updateMaskSize(),this.chinGroup=this.add(game.add.group()),this.inviteBtn=new G.Button(0,0,"btn_invite",G.platform.invite),this.inviteBtn.addTextLabel("font-white","Invite Friends",50),this.chinGroup.add(this.inviteBtn),this.toggleBtn=new G.Button(260,0,"btn_up",(function(){this.opened?this.close():this.open()}),this),this.chinGroup.add(this.toggleBtn),G.sb("onScreenResize").add(this.onScreenResize,this),this.onScreenResize(),this.leaderboards={},this.currentLeaderboard=null},G.HighscorePanel.prototype=Object.create(Phaser.Group.prototype),G.HighscorePanel.prototype.init=function(t){game.add.tween(this).to({hidingOffset:0},1e3,Phaser.Easing.Sinusoidal.Out,!0);Object.keys(t).forEach((function(e,i){"GROUP"!==e&&(this.leaderboards[e]=this.add(new G.HighscorePanelLeaderboard(t[e],configH)),this.leaderboards[e].visible=!1,this.leaderboards[e].centerOnCurrent(this.maskWidth,712),this.tabs[e]=this.tabsGroup.add(new G.HighscorePanelTabBtn(0,0,e)),this.tabs[e].onTabClick.add(this.showLeaderboard,this))}),this),-1!==Object.keys(t).indexOf("FRIENDS")?this.showLeaderboard("FRIENDS"):this.showLeaderboard(Object.keys(t)[0])},G.HighscorePanel.prototype.onScreenResize=function(){this.x=.5*game.width+game.world.bounds.x},G.HighscorePanel.prototype.showLeaderboard=function(t){for(name in this.contentGroup.removeAll(),this.leaderboards)this.leaderboards[name].visible=!1,this.leaderboards[name].mask=!1,this.tabs[name].setAsInactive();var e=this.leaderboards;e[t]&&(this.currentLeaderboard=e[t],this.maskGfx.visible=!0,this.currentLeaderboard.visible=!0,this.currentLeaderboard.mask=this.maskGfx,this.tabs[t].setAsActive(),this.tabsGroup.bringToTop(this.tabs[t]),this.contentGroup.add(this.currentLeaderboard),this.currentLeaderboardName=t),this.inputVelY=0,this.inputVelX=0},G.HighscorePanel.prototype.update=function(){this.y=game.height+this.hidingOffset-this.visiblePx,this.chinGroup.y=this.visiblePx-30,this.updateMaskSize(),this.updateInput()},G.HighscorePanel.prototype.updateMaskSize=function(){this.maskGfx.clear(),this.maskGfx.beginFill(16711680,1),this.maskGfx.drawRect(-.5*this.maskWidth,0,this.maskWidth,this.maskHeight)},G.HighscorePanel.prototype.updateInput=function(){if(this.clicked&&this.currentLeaderboard&&game.input.activePointer.isDown){if(null!==this.inputPrevX){var t=.5*(game.input.activePointer.x-this.inputPrevX);this.inputVelX=t}if(null!==this.inputPrevY){var e=.5*(game.input.activePointer.y-this.inputPrevY);this.inputVelY=e}this.inputPrevX=game.input.activePointer.x,this.inputPrevY=game.input.activePointer.y}else this.clicked=!1,this.inputPrevY=null,this.inputPrevX=null;this.currentLeaderboard&&(this.currentLeaderboard.HORIZONTAL&&(this.currentLeaderboard.x+=this.inputVelX),this.currentLeaderboard.VERTICAL&&(this.currentLeaderboard.y+=this.inputVelY),this.boundRistrict(this.currentLeaderboard)),this.inputVelX*=.95,this.inputVelY*=.95,Math.abs(this.inputVelX)<1&&(this.inputVelX=0),Math.abs(this.inputVelY)<1&&(this.inputVelY=0)},G.HighscorePanel.prototype.boundRistrict=function(t){if(t.VERTICAL){var e=Math.min(0,-(t.height-this.maskHeight));t.y>0&&(t.y=G.lerp(t.y,0,.5),t.y<1&&(t.y=0)),t.y<e&&(t.y=G.lerp(t.y,e,.5),t.y>e+1&&(t.y=e))}if(t.HORIZONTAL){var i=Math.min(0,-(t.width-this.maskWidth));t.x>0&&(t.x=G.lerp(t.x,0,.5),t.x<1&&(t.x=0)),t.x<i&&(t.x=G.lerp(t.x,i,.5),t.x>i+1&&(t.x=i))}},G.HighscorePanel.prototype.open=function(t){this.opened=!0,G.stopTweens(this),this.visiblePx=850,this.toggleBtn.angle=180,this.maskHeight=this.visiblePx-70-68,this.showLeaderboard(this.currentLeaderboardName)},G.HighscorePanel.prototype.close=function(t){this.opened=!1,G.stopTweens(this),this.visiblePx=195,this.toggleBtn.angle=0,this.maskHeight=this.visiblePx-70,this.showLeaderboard(this.currentLeaderboardName)},G.HighscorePanelLeaderboard=function(t){Phaser.Group.call(this,game),this.currentUser=null,this.currentUserPos=null,this.init(t),this.scrolledY=0},G.HighscorePanelLeaderboard.prototype=Object.create(Phaser.Group.prototype),G.HighscorePanelLeaderboard.prototype.init=function(t){for(var e=0;e<Math.max(10,t.length);e++)t[e]?this.createEntry(55*e,t[e].rank||e+1,t[e]):this.createEntry(55*e,e+1)},G.HighscorePanelLeaderboard.prototype.centerOnCurrent=function(t){this.currentUserPos&&(this.y=Math.min(this.currentUserPos.y,Math.floor(-this.currentUserPos.y+.5*t)))},G.HighscorePanelLeaderboard.prototype.createEntry=function(t,e,i){t%2&&(G.makeImage(0,t,"leaderboard_highlight",0,this).alpha=.05);if(i&&i.isCurrentUser){var s=G.makeImage(0,t,"leaderboard_highlight",0,this);s.alpha=.1,s.tint=65280,game.add.tween(s).to({alpha:.3},1e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.currentUserPos=new Phaser.Point(0,t+27)}var a;e=this.add(new G.Text(10,t+25,e,{fill:"white",font:"blogger_sansbold",fontSize:"30px"},[0,.5],30));i?(a=G.makeExtImage(50,t,i.image,"d_2",0,this,!1,(function(){this.width=50,this.height=50}))).width=a.height=50:(a=this.add(G.makeImage(50,t,"d_2",0,this))).width=a.height=50;var r=i?i.name:"---";this.add(new G.Text(120,t+25,r,{fill:"white",font:"blogger_sansbold",fontSize:"30px"},[0,.5],500))},G.HighscorePanelTabBtn=function(t,e,i){this.onTabClick=new Phaser.Signal,G.Button.call(this,t,e,"leaderboard_tab_inactive",(function(){this.onTabClick.dispatch(this.tabKey)}),this),this.anchor.setTo(0,1),this.tabKey=i,this.keyTxt=new G.Text(.5*this.width,.5*-this.height,i,{fill:"white",font:"blogger_sansbold",fontSize:"30px"},.5,this.width),this.addChild(this.keyTxt),this.IMMEDIATE=!0,this.setAsInactive()},G.HighscorePanelTabBtn.prototype=Object.create(G.Button.prototype),G.HighscorePanelTabBtn.prototype.setAsActive=function(){G.changeTexture(this,"leaderboard_tab_active"),this.scale.setTo(1)},G.HighscorePanelTabBtn.prototype.setAsInactive=function(){G.changeTexture(this,"leaderboard_tab_inactive"),this.scale.setTo(.95)},G.LeaderboardData={currentPlayer:null,lastGroupPosition:null,fetchLeaderboard:function(t,e){sdkHandler.trigger("getLeaderboard",{scope:[{name:"GLOBAL",topPlayersCount:10,beforePlayerCount:2,afterPlayerCount:3},{name:"FRIENDS",topPlayersCount:10,beforePlayerCount:2,afterPlayerCount:3},{name:"GROUP",topPlayersCount:10,beforePlayerCount:2,afterPlayerCount:3}],callback:function(i,s){i||s&&(this.processLeaderboard(s),this.checkIfNewHighscoreTier(),this.checkIfBeat(),t.call(e,this.leaderboards))}},this)},getLeaderboardData:function(t){return this.leaderboards&&this.leaderboards[t]?this.leaderboards[t]:[]},processLeaderboard:function(t){if(this.leaderboardsPrev=this.leaderboards,this.leaderboards=t,this.currentPlayer=this.leaderboards.GLOBAL.find((function(t){return t.isCurrentUser})),this.leaderboards.GROUP){this.leaderboards.GROUP=this.leaderboards.GROUP.sort((function(t,e){return e.score-t.score})),this.leaderboards.GROUP.forEach((function(t,e){t.rank=e+1}));var e=this.leaderboards.GROUP.find((function(t){return t.isCurrentUser}));!e&&this.currentPlayer&&(e=this.leaderboards.GROUP.find((function(t){return t.userId=this.currentPlayer.userId}),this))&&(e.isCurrentUser=!0)}},checkIfNewHighscoreTier:function(){if(this.currentPlayer&&this.currentPlayer.score>15e3){var t=Math.floor(this.currentPlayer.score/15e3);G.saveState.data.highscoreTierMsgs||(G.saveState.data.highscoreTierMsgs=[]),-1==G.saveState.data.highscoreTierMsgs.indexOf(t)&&(G.saveState.data.highscoreTierMsgs.push(t),G.saveState.save(),FBInstant.updateAsync({action:"CUSTOM",template:"play_turn",cta:"Play!",image:G.generateMsg("MsgWOW",{name:this.currentPlayer.name,avatar:this.currentPlayer.image,score:this.currentPlayer.score}),text:"New highscore!",strategy:"IMMEDIATE",notification:"NO_PUSH"}).then((function(){})))}},checkIfBeat:function(){if(this.leaderboardsPrev&&this.leaderboards&&this.leaderboardsPrev.GROUP&&this.leaderboards.GROUP){var t=this.leaderboardsPrev.GROUP.find((function(t){return t.isCurrentUser})),e=this.leaderboards.GROUP.find((function(t){return t.isCurrentUser}));if(t&&e&&e.rank>t.rank){var i=this.leaderboardsPrev.GROUP.indexOf(e),s=this.leaderboardsPrev.GROUP[i+1];s&&G.platformBeatMsg({name:this.currentPlayer.name,avatar:this.currentPlayer.image,score:this.currentPlayer.score},{name:s.name,avatar:s.image,score:s.score})}}}},G.platform={invite:function(){sdkHandler.trigger("social.playWithFriends",{callback:function(t,e){if(!t){var i=sgSettings.config.user;FBInstant.updateAsync({action:"CUSTOM",template:"play_turn",cta:"Play!",image:G.generateMsg("MsgInvite",{name:i.name,avatar:i.avatar,score:0}),text:"Play!",strategy:"IMMEDIATE",notification:"NO_PUSH"}).then((function(){}))}}})},firstLevelMsg:function(t){var e=sgSettings.config.user;FBInstant.updateAsync({action:"CUSTOM",template:"play_turn",cta:"Play!",image:G.generateMsg("MsgFirst",{name:e.name,avatar:e.avatar,score:t}),text:"First highscore ever!",strategy:"IMMEDIATE",notification:"NO_PUSH"}).then((function(){}))},beatMsg:function(t,e){FBInstant.updateAsync({action:"CUSTOM",template:"play_turn",cta:"Play!",image:G.generateMsg("MsgBeaten",t,e),text:"Friends beaten!",strategy:"IMMEDIATE",notification:"NO_PUSH"}).then((function(){}))}},G.EnterNamePopUp=function(t){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.state=game.state.getCurrentState(),this.score=t,this.inputRegEx=new RegExp("[a-zA-Z0-9.-_ ]"),this.bg=G.makeImage(0,0,"putin_name_panel_bg",.5,this),this.closeBtn=new G.Button(350,-130,"button_close",(function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:GameOverSubmitHighscoreNameEnteringCanceled"})}catch(t){}this.close()}),this),this.closeBtn.IMMEDIATE=!0,this.add(this.closeBtn),this.okButton=new G.Button(0,50,"text_button_base",this.nicknameAccept,this),this.okButton.label=game.make.text(0,0,G.txt(14).toUpperCase(),{fill:"#416d83",font:"blogger_sansbold",fontSize:"40px",stroke:"#f3da49",strokeThickness:5}),this.okButton.label.width=Math.min(this.okButton.label.width,170),this.okButton.label.anchor.setTo(.5),this.okButton.addChild(this.okButton.label),this.add(this.okButton);var e={fill:"#888b4d",font:"blogger_sansbold",fontSize:"50px"};this.inputText=game.make.text(0,-53," ",e),this.inputText.anchor.setTo(.5,.5),this.inputText.setText(""),this.add(this.inputText),this.cursorTxt=game.make.text(0,-55,"|",e),this.cursorTxt.anchor.setTo(0,.5),this.add(this.cursorTxt),this.cursorTxt.inputText=this.inputText,this.cursorTxt.frameCounter=0,this.cursorTxt.update=function(){this.x=this.inputText.x+.5*this.inputText.width,this.frameCounter=++this.frameCounter%60,this.visible=this.frameCounter<30},game.device.desktop?game.input.keyboard.onDownCallback=this.onDownKeyboardCallback.bind(this):(this.scale.setTo(.85),this.screenKeyboard=new G.ScreenKeyboard("font","keyboard_button",1100,360),this.screenKeyboard.scale.setTo(.7),this.add(this.screenKeyboard),this.screenKeyboard.y=219,this.screenKeyboard.onKeyDown.add(this.onDownKeyboardCallback,this),this.binding=G.sb("onScreenResize").add(this.screenKeyboard.onResize,this.screenKeyboard)),G.sb("onScreenResize").add(this.onResize,this),this.onResize()},G.EnterNamePopUp.prototype=Object.create(Phaser.Group.prototype),G.EnterNamePopUp.prototype.onDownKeyboardCallback=function(t){return"Backspace"==t.key?(this.inputText.setText(this.inputText.text.slice(0,Math.max(0,this.inputText.text.length-1))),this.cursorTxt.frameCounter=0):"Enter"==t.key?this.nicknameAccept():this.inputText.text.length<14&&1==t.key.length&&this.inputRegEx.test(t.key)&&(this.inputText.setText(this.inputText.text+t.key),this.cursorTxt.frameCounter=0),t.preventDefault?t.preventDefault():t.returnValue=!1,!1},G.EnterNamePopUp.prototype.onResize=function(){this.cameraOffset.x=Math.floor(.5*game.width),game.device.desktop?this.cameraOffset.y=Math.floor(.5*game.height):this.cameraOffset.y=Math.floor(.45*game.height)},G.EnterNamePopUp.prototype.open=function(){G.sb("openOverlay").dispatch(),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.ignoreChildInput=!1}),this)},G.EnterNamePopUp.prototype.close=function(){this.screenKeyboard&&this.screenKeyboard.destroy(),game.input.keyboard.onDownCallback=null,this.binding&&this.binding.detach(),this.ignoreChildInput=!0,G.sb("closeOverlay").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.destroy()}),this)},G.EnterNamePopUp.prototype.nicknameAccept=function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:GameOverSubmitHighscoreNameEntered"})}catch(t){}G.saveState.addHighscoreEntry(this.inputText.text||"Player",this.score),this.close(),this.state.highscoresPopUp.open()},G.HighscoreListRT=function(){this.rt=game.make.renderTexture(660,550,"rt_highscoreList",!0);this.txt=game.make.text(0,0," ",{fill:"#f3d84b",font:"blogger_sansbold",fontSize:"36px"}),G.sb("onListUpdate").addPermanent(this.redrawList,this)},G.HighscoreListRT.prototype.redrawList=function(){this.rt.clear();for(var t=0;t<10;t++)this.txt.anchor.x=1,this.txt.setText(t+1+"."),this.txt.updateTransform(),this.rt.renderXY(this.txt,60,48*t),this.txt.anchor.setTo(0),this.txt.setText(G.saveState.data.highscores[t]?G.saveState.data.highscores[t][0]:"---"),this.txt.updateTransform(),this.rt.renderXY(this.txt,90,48*t),this.txt.anchor.x=1,this.txt.setText(G.saveState.data.highscores[t]?G.saveState.data.highscores[t][1]:"---"),this.txt.updateTransform(),this.rt.renderXY(this.txt,630,48*t)},G.HighscoresPopUp=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.bg=G.makeImage(0,0,"highscores_window_bg",.5,this),this.closeBtn=new G.Button(322,-270,"button_close",(function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:HighscoreClosed"})}catch(t){}this.close()}),this),this.closeBtn.IMMEDIATE=!0,this.add(this.closeBtn);this.titleTxt=game.make.text(0,-290,G.txt(7).toUpperCase(),{fill:"white",font:"blogger_sansbold",fontSize:"72px"}),this.titleTxt.width=Math.min(this.titleTxt.width,550),this.titleTxt.anchor.setTo(.5,0),this.add(this.titleTxt),this.list=G.makeImage(0,-200,G.getRT("rt_highscoreList"),[.5,0],this),G.sb("onScreenResize").add(this.onResize,this),this.onResize(),G.sb("openHighscore").add(this.open,this),this.alpha=0,this.playBtn=new G.Button(0,330,"button_Play",(function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:HighscorePlayButtonClicked"})}catch(t){}this.close()}),this),this.add(this.playBtn),this.ignoreChildInput=!0,game.device.desktop||this.scale.setTo(.85)},G.HighscoresPopUp.prototype=Object.create(Phaser.Group.prototype),G.HighscoresPopUp.prototype.onResize=function(){this.cameraOffset.x=Math.floor(.5*game.width),this.cameraOffset.y=Math.floor(.46*game.height)},G.HighscoresPopUp.prototype.open=function(){G.sb("openOverlay").dispatch(),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.ignoreChildInput=!1}),this)},G.HighscoresPopUp.prototype.close=function(){this.ignoreChildInput=!0,G.sb("closeOverlay").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},G.LevelFinishedPopUp=function(t,e,i){this.state=game.state.getCurrentState(),this.PASSED=t;try{this.PASSED?sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:LevelCompleteScreenAppears"}):sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:GameOverScreenVisible"})}catch(t){}var s=this.state.gameUI.scoreController.scoreGained;sdkHandler.trigger("levelFinish",{level:this.state.lvlIndex+1,score:e,state:t?"win":"lose",shareImage:G.logoURI,shareText:"My new score!"});try{sdkHandler.trigger("gameTracking",{event:"Complete",dimension1:"Level"+G.zeroPad(this.state.lvlIndex+1),value:s})}catch(t){}Phaser.Group.call(this,game),this.fixedToCamera=!0,this.score=e,this.bg=G.makeImage(0,0,"gameover_window_bg",.5,this),this.addTitle(t,i),t?this.addExtraBoosters():this.decor=G.makeImage(0,-113,"time_up_pattern",.5,this),this.addScores(e,i),this.addButton(t,i),this.button.visible=!1,sdkHandler.trigger("beforePlayButtonDisplay",{callback:function(){this.button.visible=!0}},this),game.time.events.add(500,(function(){i&&t?G.sfx.vo_congratulations.play():i&&0==this.highscorePosition?G.sfx.vo_new_highscore.play():i&&G.sfx.vo_try_again.play()}),this),G.sb("onScreenResize").add(this.onResize,this),this.onResize(),G.sb("openHighscore").add(this.open,this),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.InOut,!0),this.alpha=0,this.open()},G.LevelFinishedPopUp.prototype=Object.create(Phaser.Group.prototype),G.LevelFinishedPopUp.prototype.addTitle=function(t,e){var i,s;i=t?{fill:"#53df37",font:"blogger_sansbold",fontSize:"90px",stroke:"#009700",strokeThickness:10}:{fill:"#ff6f23",font:"blogger_sansbold",fontSize:"90px",stroke:"#902220",strokeThickness:10},s=t&&e?G.txt(13):t?G.txt(8):G.txt(9),this.titleTxt=game.make.text(0,-290,s.toUpperCase(),i),this.titleTxt.width=Math.min(this.titleTxt.width,550),this.titleTxt.anchor.setTo(.5,0),this.add(this.titleTxt)},G.LevelFinishedPopUp.prototype.addExtraBoosters=function(){this.boosterImg=G.makeImage(0,-113,"button_hint",[0,.5],this);this.boosterTxt=game.make.text(0,-113,"+"+G.json.settings.amountOfBoosterAfterLevel,{fill:"#f3d84b",font:"blogger_sansbold",fontSize:"90px",stroke:"#c18233",strokeThickness:8}),this.boosterTxt.anchor.y=.5,this.add(this.boosterTxt);var t=Math.floor(-.5*(this.boosterImg.width+5+this.boosterTxt.width));this.boosterImg.x=t,this.boosterTxt.x=this.boosterImg.right+5,G.saveState.setProgressBoosterNr(G.saveState.getProgressBoosterNr()+1,!0)},G.LevelFinishedPopUp.prototype.addButton=function(t,e){this.button=new G.Button(0,215,"text_button_base",e?this.onButtonGameEnd:this.onButtonContinue,this),this.add(this.button),this.button.label=game.make.text(0,0,t?G.txt(10).toUpperCase():G.txt(11).toUpperCase(),{fill:"#416d83",font:"blogger_sansbold",fontSize:"40px",stroke:"#f3da49",strokeThickness:5}),this.button.label.width=Math.min(this.button.label.width,170),this.button.label.anchor.setTo(.5),this.button.addChild(this.button.label),this.add(this.button)},G.LevelFinishedPopUp.prototype.addScores=function(t,e){var i={fill:"#f3d84b",font:"blogger_sansbold",fontSize:"60px"};this.scoreLabelTxt=game.make.text(-295,-15,G.txt(0).toUpperCase()+":",i),this.scoreLabelTxt.width=Math.min(this.scoreLabelTxt.width,300),this.add(this.scoreLabelTxt),i.maxWidth=580-this.scoreLabelTxt.width,this.scoreTxt=new G.TextCounter(295,-15,0,i),this.scoreTxt.anchor.setTo(1,0),this.add(this.scoreTxt),game.time.events.add(500,(function(){this.scoreTxt.changeAmount(t)}),this);var s={fill:"#c18233",font:"blogger_sansbold",fontSize:"50px"};if(this.highscoreLabelTxt=game.make.text(-295,60,G.txt(12).toUpperCase()+":",s),this.highscoreLabelTxt.width=Math.min(this.highscoreLabelTxt.width,300),this.add(this.highscoreLabelTxt),this.highscoreTxt=game.make.text(295,60,G.saveState.getHighscore().toString(),s),this.highscoreTxt.anchor.setTo(1,0),this.highscoreTxt.width=Math.min(this.highscoreTxt.width,300),this.add(this.highscoreTxt),this.highscorePosition=G.saveState.checkHighscorePosition(t),e&&null!==this.highscorePosition){this.highscoreAchieved=!0,this.badge=G.makeImage(310,-60,"best_badge",.5,this);i={fill:"#f9c952",font:"blogger_sansbold",fontSize:"100px"};this.badge.nrTxt=game.make.text(0,0,(this.highscorePosition+1).toString(),i),this.badge.nrTxt.anchor.setTo(.5),this.badge.addChild(this.badge.nrTxt),this.badge.scale.setTo(0),game.add.tween(this.badge.scale).to({x:.7,y:.7},300,Phaser.Easing.Elastic.Out,!0,400)}},G.LevelFinishedPopUp.prototype.onButtonContinue=function(){this.ignoreChildInput=!0;try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:LevelCompleteScreenNextButtonPressed"})}catch(t){}G.sfx.music.volume=0,sdkHandler.trigger("interstitialAd",{callback:function(){G.sfx.music.volume=1,game.camera.onFadeComplete.addOnce((function(){game.state.start("Game")})),game.camera.fade(0,300,!0)}},this)},G.LevelFinishedPopUp.prototype.onButtonGameEnd=function(){this.ignoreChildInput=!0;var t=this.highscoreAchieved,e=this.score;try{t?sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:GameOverScreenSubmitButtonClicked"}):sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:GameOverContinueButtonClicked"})}catch(t){}G.sfx.music.volume=0,sdkHandler.trigger("interstitialAd",{callback:function(){G.sfx.music.volume=1,game.camera.onFadeComplete.addOnce((function(){game.state.start("MainMenu",!0,!1,t,e)}),this),game.camera.fade(0,300,!0)}},this)},G.LevelFinishedPopUp.prototype.onResize=function(){game.device.desktop?(this.cameraOffset.x=330+Math.floor(.5*(game.width-330)),this.cameraOffset.y=Math.floor(.5*game.height)):(this.cameraOffset.x=Math.floor(.5*game.width),this.cameraOffset.y=Math.floor(.5*game.height),this.scale.setTo(.85))},G.LevelFinishedPopUp.prototype.open=function(){G.sb("openOverlay").dispatch(),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.ignoreChildInput=!1}),this)},G.LevelFinishedPopUp.prototype.close=function(){this.ignoreChildInput=!0,G.sb("closeOverlay").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},G.MoreHintPopUp=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.bg=G.makeImage(0,0,"no_more_hints_bg",.5,this),this.watchGroup=this.addWatchGroup(),this.sorryNoAdsGroup=this.addSorryNoAdsGroup(),this.thanksForWatchingGroup=this.addThanksForWatchingGroup(),this.continueBtn=new G.Button(0,155,"text_button_base",this.close,this),this.continueBtn.addChild(new G.Text(0,0,G.txt(19).toUpperCase(),{fill:"#f0fbff",font:"blogger_sansbold",fontSize:"40px",stroke:"#9b3930",strokeThickness:5},.5,160)),this.add(this.continueBtn),this.continueBtn.IMMEDIATE=!0,G.sb("onScreenResize").add(this.onResize,this),this.onResize(),this.alpha=0,this.ignoreChildInput=!0,this.watchGroup.ignoreChildInput=!0,this.thanksForWatchingGroup.ignoreChildInput=!0,this.sorryNoAdsGroup.ignoreChildInput=!0,G.sb("openMoreHintPopUp").add(this.open,this)},G.MoreHintPopUp.prototype=Object.create(Phaser.Group.prototype),G.MoreHintPopUp.prototype.addWatchGroup=function(){var t=this.add(game.make.group());return t.titleTxt=game.make.text(5,-195,G.txt(15).toUpperCase(),{fill:"#ecb733",font:"blogger_sansbold",fontSize:"80px",stroke:"#a65f1d",strokeThickness:8}),t.titleTxt.width=Math.min(t.titleTxt.width,550),t.titleTxt.anchor.setTo(.5,0),t.add(t.titleTxt),t.watchVideoBtn=new G.Button(0,25,"button_watch_video",this.watchAd,this),t.watchVideoBtn.label=new G.Text(45,0,G.txt(16).toUpperCase(),{fill:"#3e6c7c",font:"blogger_sansbold",fontSize:"40px",stroke:"#c6ddaf",strokeThickness:5},.5,370,95,!0,"center"),t.watchVideoBtn.addChild(t.watchVideoBtn.label),t.add(t.watchVideoBtn),t.cancelBtn=new G.Button(0,155,"button_cancel",(function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:GetMoreHintsPopupCanceledWithoutVideo"})}catch(t){}this.close()}),this),t.cancelBtn.addChild(new G.Text(0,0,G.txt(17).toUpperCase(),{fill:"#f0fbff",font:"blogger_sansbold",fontSize:"40px",stroke:"#9b3930",strokeThickness:5},.5,160)),t.add(t.cancelBtn),t.cancelBtn.IMMEDIATE=!0,t},G.MoreHintPopUp.prototype.addThanksForWatchingGroup=function(){var t=this.add(game.make.group());return t.thanksTxt=new G.Text(5,-130,G.txt(18),{fill:"#ecb733",font:"blogger_sansbold",fontSize:"70px",stroke:"#a65f1d",strokeThickness:8},.5,550,170,!0,"center"),t.add(t.thanksTxt),t.rewardTxt=new G.LabelGroupT("+"+G.json.settings.hintsForAD+"@button_hint@",0,20,{fill:"#ecb733",font:"blogger_sansbold",fontSize:"100px",stroke:"#a65f1d",strokeThickness:7},.5,550,0),t.add(t.rewardTxt),t},G.MoreHintPopUp.prototype.addSorryNoAdsGroup=function(){var t=this.add(game.make.group());return t.sorry=new G.Text(0,-60,G.txt(20),{fill:"#f0fbff",font:"blogger_sansbold",fontSize:"70px",stroke:"#9b3930",strokeThickness:5},.5,550,300,!0,"center"),t.add(t.sorry),t},G.MoreHintPopUp.prototype.onResize=function(){game.device.desktop?(this.cameraOffset.x=330+Math.floor(.5*(game.width-330)),this.cameraOffset.y=Math.floor(.5*game.height)):(this.cameraOffset.x=Math.floor(.5*game.width),this.cameraOffset.y=Math.floor(.5*game.height),this.scale.setTo(.85))},G.MoreHintPopUp.prototype.open=function(){G.sb("openOverlay").dispatch(),this.sorryNoAdsGroup.visible=!1,this.sorryNoAdsGroup.alpha=0,this.thanksForWatchingGroup.visible=!1,this.thanksForWatchingGroup.alpha=0,this.watchGroup.visible=!0,this.watchGroup.ignoreChildInput=!1,this.watchGroup.alpha=1,this.continueBtn.visible=!1;try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:GetMoreHintsPopupVisible"})}catch(t){}game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.ignoreChildInput=!1}),this)},G.MoreHintPopUp.prototype.close=function(){this.watchGroup.ignoreChildInput=!0,this.thanksForWatchingGroup.ignoreChildInput=!0,this.sorryNoAdsGroup.ignoreChildInput=!0,G.sb("closeOverlay").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},G.MoreHintPopUp.prototype.watchAd=function(){this.watchGroup.ignoreChildInput=!0,game.add.tween(this.watchGroup).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0);try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:WatchNowButtonClicked"})}catch(t){}sdkHandler.trigger("rewardedAd",{callback:function(t){if(t){var e=G.saveState.getProgressBoosterNr();G.saveState.setProgressBoosterNr(e+G.json.settings.hintsForAD,!0);try{sdkHandler.trigger("gameTracking",{event:"Source",dimension1:"Hint",value:G.json.settings.hintsForAD,dimension2:"RewardedVideo"})}catch(t){}this.thanksForWatchingGroup.visible=!0,game.add.tween(this.thanksForWatchingGroup).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0)}else this.sorryNoAdsGroup.visible=!0,game.add.tween(this.sorryNoAdsGroup).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0);this.continueBtn.visible=!0}},this)},G.PauseBgGems=function(t,e){Phaser.Group.call(this,game),this.position.setTo(t,e);for(var i=1;i<=8;i++)this.makeGem(280,45*i,i)},G.PauseBgGems.prototype=Object.create(Phaser.Group.prototype),G.PauseBgGems.prototype.update=function(){this.angle+=.5},G.PauseBgGems.prototype.makeGem=function(t,e,i){var s=G.lengthDirX(e,t,!1),a=G.lengthDirY(e,t,!1);this.add(new G.PauseBgGem(s,a,i))},G.PauseBgGem=function(t,e,i){G.Image.call(this,t,e,"d_"+i,.5),this.overlay=G.makeImage(0,0,"d_"+i+"_shine",.5,this),this.overlay.alpha=0,this.overlay.blendMode=1,game.add.tween(this.overlay).to({alpha:.5},2e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},G.PauseBgGem.prototype=Object.create(G.Image.prototype),G.PausePopUp=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.state=game.state.getCurrentState(),this.bgGems=this.add(new G.PauseBgGems(0,20)),this.bg=G.makeImage(0,0,"statue",.5,this);this.pauseTxt=game.make.text(5,-130,G.txt(6),{fill:"#524863",font:"blogger_sansbold",fontSize:"32px",stroke:"#edccb5",strokeThickness:5}),this.pauseTxt.width=Math.min(this.pauseTxt.width,110),this.pauseTxt.anchor.setTo(.5,0),this.add(this.pauseTxt),this.continueBtn=new G.Button(0,-10,"button_Play",(function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:PauseScreenContinueButtonPressed"})}catch(t){}sdkHandler.trigger("interstitialAd",{callback:function(){this.close()}},this)}),this),this.continueBtn.IMMEDIATE=!0,this.add(this.continueBtn),this.soundBtn=new G.Button(-105,50,game.sound.mute?"button_Sound_off":"button_Sound_on",this.switchSound,this),this.add(this.soundBtn),this.homeBtn=new G.Button(105,50,"button_Home",this.home,this),this.add(this.homeBtn),this.restartBtn=new G.Button(0,110,"button_Replay",this.restart,this),this.add(this.restartBtn),this.restartBtn.visible=!1,this.homeBtn.visible=!1,sdkHandler.trigger("beforePlayButtonDisplay",{callback:function(){this.restartBtn.visible=!0,this.homeBtn.visible=!0}},this),this.alpha=0,this.ignoreChildInput=!0,G.sb("openPausePopUp").add(this.open,this),G.sb("onScreenResize").add(this.onResize,this),this.game.onPause.add(this.open,this),G.sb("onPause").add((function(){this.pause=!0}),this),G.sb("onUnpause").add((function(){this.pause=!1}),this),this.onResize()},G.PausePopUp.prototype=Object.create(Phaser.Group.prototype),G.PausePopUp.prototype.onResize=function(){game.device.desktop?this.cameraOffset.x=330+Math.floor(.5*(game.width-330)):this.cameraOffset.x=Math.floor(.5*game.width),this.cameraOffset.y=Math.floor(.5*game.height)},G.PausePopUp.prototype.open=function(){!0!==this.pause&&(G.sfx.music.pause(),G.sb("openOverlay").dispatch(),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){this.ignoreChildInput=!1}),this))},G.PausePopUp.prototype.close=function(){G.sfx.music.resume(),this.ignoreChildInput=!0,G.sb("closeOverlay").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},G.PausePopUp.prototype.switchSound=function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:PauseScreenSoundButtonPressed"})}catch(t){}G.sfx.music.resume(),G.saveState.data.mute=!G.saveState.data.mute,game.sound.mute=G.saveState.data.mute,this.soundBtn.baseSprite=game.sound.mute?"button_Sound_off":"button_Sound_on"},G.PausePopUp.prototype.home=function(){this.ignoreChildInput=!0,G.sfx.music.resume();try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:PauseScreenHomeButtonPressed"})}catch(t){}sdkHandler.trigger("levelFinish",{level:this.state.lvlIndex+1,score:Math.max(0,this.state.gameUI.scoreController.score),state:"lose",shareImage:G.logoURI,shareText:"My new score!"}),G.sfx.music.volume=0,sdkHandler.trigger("interstitialAd",{callback:function(){game.sound.mute=G.saveState.data.mute,G.sfx.music.volume=1,game.camera.onFadeComplete.addOnce((function(){G.saveState.save(),game.state.start("MainMenu")})),game.camera.fade(0,300)}},this)},G.PausePopUp.prototype.restart=function(){this.ignoreChildInput=!0,G.sfx.music.resume();try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:PauseScreenResetGameButtonPressed"})}catch(t){}sdkHandler.trigger("levelFinish",{level:this.state.lvlIndex+1,score:Math.max(0,this.state.gameUI.scoreController.score),state:"lose",shareImage:G.logoURI,shareText:"My new score!"}),G.sfx.music.volume=0,sdkHandler.trigger("interstitialAd",{callback:function(){G.sfx.music.volume=1,game.camera.onFadeComplete.addOnce((function(){G.saveState.resetProgress(),game.state.start("Game")})),game.camera.fade(0,300)}},this)},G.PopUpOverlay=function(t){Phaser.Graphics.call(this,game),this.fixedToCamera=!0,this.alpha=0,this.toAlpha=t||.8,G.sb("openOverlay").add(this.open,this),G.sb("closeOverlay").add(this.close,this),G.sb("onScreenResize").add(this.onResize,this),this.onResize(),game.add.existing(this)},G.PopUpOverlay.prototype=Object.create(Phaser.Graphics.prototype),G.PopUpOverlay.prototype.onResize=function(){this.clear(),this.beginFill(0,1),this.drawRect(0,0,game.width,game.height)},G.PopUpOverlay.prototype.open=function(){this.inputEnabled=!0,G.stopTweens(this),game.add.tween(this).to({alpha:this.toAlpha},300,Phaser.Easing.Sinusoidal.Out,!0),G.sb("onPause").dispatch()},G.PopUpOverlay.prototype.close=function(){G.stopTweens(this),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){G.sb("onUnpause").dispatch(),this.inputEnabled=!1}),this)},G.FireFlyGroup=function(t){Phaser.Group.call(this,game),this.rect=t;for(var e=0;e<20;e++)this.add(new G.FireflyMM(this.rect))},G.FireFlyGroup.prototype=Object.create(Phaser.Group.prototype),G.DecorGroup=function(t,e){Phaser.Group.call(this,game),this.position.setTo(t,e).floor(),this.circleGroup=this.add(game.make.group()),this.decCircleLeft=G.makeImage(-530,0,"dec_left",[.5,.5],this.circleGroup),this.torchLeft=G.makeImage(-510,0,"torch",.5,this),this.fireLeft=new G.FrameAnimation(-473,-100,"fire_anim",30),this.fireLeft.play(-1),this.add(this.fireLeft),this.decCircleRight=G.makeImage(530,0,"dec_left",[.5,.5],this.circleGroup),this.decCircleRight.scale.x=-1,this.torchRight=G.makeImage(510,0,"torch",.5,this),this.torchRight.scale.x=-1,this.fireRight=new G.FrameAnimation(473,-100,"fire_anim",30),this.fireRight.scale.x=-1,this.fireRight.play(-1,!1,3),this.add(this.fireRight),G.sb("onScreenResize").add(this.onResize,this),this.onResize()},G.DecorGroup.prototype=Object.create(Phaser.Group.prototype),G.DecorGroup.prototype.onResize=function(){var t=Math.floor(.5*(game.width-1280));game.device.desktop||(t+=100),this.x=.5*game.width,this.y=.5*game.height,this.fireLeft.x=-473-t,this.torchLeft.x=-510-t,this.decCircleLeft.x=-530-t,this.fireRight.x=473+t,this.torchRight.x=510+t,this.decCircleRight.x=530+t},G.FireflyMM=function(t){this.goToTargets=t;t=this.goToTargets;this.rect=t;var e=t.x+Math.random()*t.width,i=t.y+Math.random()*t.height;G.Image.call(this,e,i,"firefly_light",.5),this.blendMode=1,this.spherePos=new Phaser.Point(e,i),this.sphereOffset=new Phaser.Point(-10,-10),this.sphereOffset2=new Phaser.Point(-10,5),this.onMoveComplete=new Phaser.Signal,this.sphereTweens=[],game.add.tween(this.sphereOffset).to({x:10},2e3+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,500),game.add.tween(this.sphereOffset).to({y:10},1477+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,400),game.add.tween(this.sphereOffset2).to({x:10},2e3+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,500),game.add.tween(this.sphereOffset2).to({x:-5},2500+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,500),this.alphaTween=game.add.tween(this).to({alpha:.4},1e3+game.rnd.between(-200,200),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.alphaTween.timeline[0].dt=game.rnd.between(0,300),this.onMoveComplete.add((function(){game.time.events.add(game.rnd.between(100,1e3),this.goToRandom,this)}),this),game.time.events.add(game.rnd.between(100,1e3),this.goToRandom,this)},G.FireflyMM.prototype=Object.create(G.Image.prototype),G.FireflyMM.prototype.update=function(){this.x=this.spherePos.x+this.sphereOffset.x+this.sphereOffset2.x,this.y=this.spherePos.y+this.sphereOffset.y+this.sphereOffset2.y},G.FireflyMM.prototype.goTo=function(t,e){var i=Phaser.Point.distance(this.spherePos,{x:t,y:e});game.add.tween(this.spherePos).to({x:t,y:e},50*i,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.add(this.onMoveComplete.dispatch,this.onMoveComplete)},G.FireflyMM.prototype.goToRandom=function(){var t=this.rect.x+Math.random()*this.rect.width,e=this.rect.y+Math.random()*this.rect.height;this.goTo(t,e)},G.Logo=function(t,e){Phaser.Group.call(this,game),this.pX=t,this.pY=e,this.glowUnder=G.makeImage(0,20,"logo_under_glow",.5,this),this.glowUnder.blendMode=1,this.glowUnder.alpha=0,game.add.tween(this.glowUnder).to({alpha:1},2e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.logo=G.makeImage(0,0,"logo",.5,this),this.glowLeft=G.makeImage(-76,17,"d_left_glow",.5,this),this.glowLeft.blendMode=1,this.glowLeft.alpha=0,this.glowCenter=G.makeImage(-6,4,"d_center_glow",.5,this),this.glowCenter.blendMode=1,this.glowCenter.alpha=0,this.glowRight=G.makeImage(66,16,"d_right_glow",.5,this),this.glowRight.blendMode=1,this.glowRight.alpha=0,this.gemsGlow(),G.sb("onScreenResize").add(this.onResize,this),this.onResize()},G.Logo.prototype=Object.create(Phaser.Group.prototype),G.Logo.prototype.gemsGlow=function(){game.add.tween(this.glowLeft).to({alpha:1},2e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.glowCenter).to({alpha:1},2e3,Phaser.Easing.Sinusoidal.InOut,!0,500,-1,!0),game.add.tween(this.glowRight).to({alpha:1},2e3,Phaser.Easing.Sinusoidal.InOut,!0,1e3,-1,!0)},G.Logo.prototype.onResize=function(){this.x=Math.floor(this.pX*game.width),this.y=Math.floor(this.pY*game.height)},G.TitleMenu=function(t,e){Phaser.Group.call(this,game),this.pX=t,this.pY=e,this.decCenter=G.makeImage(0,10,"dec_center",.5,this),this.highscoreBtn=new G.Button(0,80,"button_highscores",(function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:MainMenuHighscoreClicked"})}catch(t){}G.sb("openHighscore").dispatch()}),this),this.highscoreBtn.label=game.make.text(0,0,G.txt(7),{fill:"#017fd1",font:"blogger_sansbold",fontSize:"32px",stroke:"#abdeff",strokeThickness:5}),this.highscoreBtn.label.width=Math.min(this.highscoreBtn.label.width,170),this.highscoreBtn.label.anchor.setTo(.5),this.highscoreBtn.addChild(this.highscoreBtn.label),this.add(this.highscoreBtn),this.playBtn=new G.Button(0,190,"button_Play",this.play,this),this.add(this.playBtn),this.soundBtn=new G.Button(-120,270,game.sound.mute?"button_Sound_off":"button_Sound_on",this.switchSound,this),this.add(this.soundBtn),this.moreGamesBtn=new G.Button(120,270,"button_MoreGames",(function(){sdkHandler.trigger("moreGames")})),this.add(this.moreGamesBtn),this.moreGamesBtn.visible=!1,this.decBottom=G.makeImage(0,300,"dec_bottom",.5,this),G.sb("onScreenResize").add(this.onResize,this),this.onResize()},G.TitleMenu.prototype=Object.create(Phaser.Group.prototype),G.TitleMenu.prototype.play=function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:MainMenuPlayClicked"})}catch(t){}this.ignoreChildInput=!0,game.camera.onFadeComplete.addOnce((function(){game.state.start("Game")})),game.camera.fade(0,300,!0)},G.TitleMenu.prototype.switchSound=function(){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:"Ingame:MainMenuSoundClicked"})}catch(t){}game.sound.mute=!game.sound.mute,this.soundBtn.baseSprite=game.sound.mute?"button_Sound_off":"button_Sound_on"},G.TitleMenu.prototype.onResize=function(){this.x=Math.floor(this.pX*game.width),this.y=Math.floor(this.pY*game.height)},window.initGame=function(){var t=new Phaser.Game(1280,720,Phaser.CANVAS,"",null,!0);window.game=t,t.state.add("Boot",G.Boot),t.state.add("Preloader",G.Preloader),t.state.add("Game",G.Game),t.state.add("EditorLvl",G.EditorLvl),t.state.add("EditorLvlMgr",G.EditorLvlMgr),t.state.add("MainMenu",G.MainMenu),t.state.add("EditorLvlMgr2",G.EditorLvlMgr2),t.state.start("Boot")},window.startGame=function(){sgSdk.initialize(["basic","levelGame"],{build:"1.0.0",supportedLanguages:["en","de","es","fr","it","pt","ru","tr","nl","pl","ja"],id:"temple-jewels",freezeGame:function(){game.paused=!0},unfreezeGame:function(){game.paused=!1},runGame:function(){game.state.start("MainMenu")},goToLevel:function(){}},(function(t,e,i){window.sgSettings=e,window.sdkHandler=i;var s="ja"===sgSettings.config.env.locale?"BOOT-logo_ja":"BOOT-logo";G.ASSETS={spritesheets:["board",s,"buttons","fx","fx2","fx3","leaderboard","popups","titlescreen","ui"],sfx:["bang_0.mp3","bang_1.mp3","bang_2.mp3","button.mp3","click.mp3","game_over.mp3","game_won.mp3","match.mp3","music.mp3","pop.mp3","vo_amazing.mp3","vo_congratulations.mp3","vo_fantastic.mp3","vo_final_round.mp3","vo_hurry_up.mp3","vo_lets_go.mp3","vo_new_highscore.mp3","vo_perfect.mp3","vo_time_is_up.mp3","vo_try_again.mp3","vo_welcome.mp3","vo_well_done.mp3"],images:["background.png","light.png","light_right.png","splash_bg.png"],json:["BOARDSETTINGS.json","languages.json","levels.json","settings.json"],fonts:{}},window.initGame()}))}})()}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](i,i.exports,__webpack_require__),i.exports}__webpack_require__.amdD=function(){throw new Error("define cannot be used indirect")},__webpack_require__.amdO={};var __webpack_exports__=__webpack_require__(475)})();